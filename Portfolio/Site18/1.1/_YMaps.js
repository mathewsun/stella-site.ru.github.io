YMaps.onLoad(function(bt,Ct){function r(t,e){if("string"!=typeof t)return null;var i;if(!(i=t.match(a)))return null;var n=function(t){var e={};if("string"==typeof t){var i="+"==h.trim(t)?["+"]:t.toLowerCase().split(/\s*\+\s*/);e.altKey=-1!=h.inArray("alt",i),e.ctrlKey=-1!=h.inArray("ctrl",i),e.shiftKey=-1!=h.inArray("shift",i),e.key=i[i.length-1]}else{if(void 0===t)return null;(e=t).altKey=!!e.alt,e.ctrlKey=!!e.ctrl,e.shiftKey=!!e.shift}if(e.shortcut=(e.altKey?"alt+":"")+(e.ctrlKey?"ctrl+":"")+(e.shiftKey?"shift+":"")+e.key,e.disableInInput=!!e.disableInInput,!e.key)return null;if("string"!=typeof e.key){var n=parseInt(e.key);isNaN(n)||(e.key=String.fromCharCode(n).toLowerCase())}else if(e.key=e.key.toLowerCase(),1<e.key.length){var o=!1;if(h.each(c,function(){o=o||this.toString()==e.key}),!o)return null}return e}(e);if(!n||!n.key)return null;var o=h.trim(t.replace(a,""));return{handled:i.join(" "),unhandled:o,parsedData:n}}var h,l,s,a,c,u,t;!function(){var w,g=this,P=bt.jQuery=function(t,e){return new P.fn.init(t,e)},s=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,i=/^.[^:#\[\.,]*$/;function c(t,e){e.src?P.ajax({url:e.src,async:!1,dataType:"script"}):P.globalEval(e.text||e.textContent||e.innerHTML||""),e.parentNode&&e.parentNode.removeChild(e)}function y(){return+new Date}P.fn=P.prototype={init:function(t,e){if((t=t||document).nodeType)return this[0]=t,this.length=1,this.context=t,this;if("string"==typeof t){var i=s.exec(t);if(!i||!i[1]&&e)return P(e).find(t);if(!i[1]){var n=document.getElementById(i[3]);if(n&&n.id!=i[3])return P().find(t);var o=P(n||[]);return o.context=document,o.selector=t,o}t=P.clean([i[1]],e)}else if(P.isFunction(t))return P(document).ready(t);return t.selector&&t.context&&(this.selector=t.selector,this.context=t.context),this.setArray(P.isArray(t)?t:P.makeArray(t))},selector:"",jquery:"@VERSION",size:function(){return this.length},get:function(t){return t===w?Array.prototype.slice.call(this):this[t]},pushStack:function(t,e,i){var n=P(t);return n.prevObject=this,n.context=this.context,"find"===e?n.selector=this.selector+(this.selector?" ":"")+i:e&&(n.selector=this.selector+"."+e+"("+i+")"),n},setArray:function(t){return this.length=0,Array.prototype.push.apply(this,t),this},each:function(t,e){return P.each(this,t,e)},index:function(t){return P.inArray(t&&t.jquery?t[0]:t,this)},attr:function(e,t,i){var n=e;if("string"==typeof e){if(t===w)return this[0]&&P[i||"attr"](this[0],e);(n={})[e]=t}return this.each(function(t){for(e in n)P.attr(i?this.style:this,e,P.prop(this,n[e],i,t,e))})},css:function(t,e){return("width"==t||"height"==t)&&parseFloat(e)<0&&(e=w),this.attr(t,e,"curCSS")},text:function(t){if("object"!=typeof t&&null!=t)return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(t));var e="";return P.each(t||this,function(){P.each(this.childNodes,function(){8!=this.nodeType&&(e+=1!=this.nodeType?this.nodeValue:P.fn.text([this]))})}),e},wrapAll:function(t){if(this[0]){var e=P(t,this[0].ownerDocument).clone();this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return this.each(function(){P(this).contents().wrapAll(t)})},wrap:function(t){return this.each(function(){P(this).wrapAll(t)})},append:function(){return this.domManip(arguments,!0,function(t){1==this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1==this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)})},end:function(){return this.prevObject||P([])},push:[].push,sort:[].sort,splice:[].splice,find:function(e){if(1!==this.length)return this.pushStack(P.unique(P.map(this,function(t){return P.find(e,t)})),"find",e);var t=this.pushStack([],"find",e);return t.length=0,P.find(e,this[0],t),t},clone:function(t){var e=this.map(function(){if(P.support.noCloneEvent||P.isXMLDoc(this))return this.cloneNode(!0);var t=this.outerHTML;if(!t){var e=this.ownerDocument.createElement("div");e.appendChild(this.cloneNode(!0)),t=e.innerHTML}return P.clean([t.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]});if(!0===t){var n=this.find("*").andSelf(),o=0;e.find("*").andSelf().each(function(){if(this.nodeName===n[o].nodeName){var t=P.data(n[o],"events");for(var e in t)for(var i in t[e])P.event.add(this,e,t[e][i],t[e][i].data);o++}})}return e},filter:function(i){return this.pushStack(P.isFunction(i)&&P.grep(this,function(t,e){return i.call(t,e)})||P.multiFilter(i,P.grep(this,function(t){return 1===t.nodeType})),"filter",i)},closest:function(e){var i=P.expr.match.POS.test(e)?P(e):null,n=0;return this.map(function(){for(var t=this;t&&t.ownerDocument;){if(i?-1<i.index(t):P(t).is(e))return P.data(t,"closest",n),t;t=t.parentNode,n++}})},not:function(t){if("string"==typeof t){if(i.test(t))return this.pushStack(P.multiFilter(t,this,!0),"not",t);t=P.multiFilter(t,this)}var e=t.length&&t[t.length-1]!==w&&!t.nodeType;return this.filter(function(){return e?P.inArray(this,t)<0:this!=t})},add:function(t){return this.pushStack(P.unique(P.merge(this.get(),"string"==typeof t?P(t):P.makeArray(t))))},is:function(t){return!!t&&0<P.multiFilter(t,this).length},hasClass:function(t){return!!t&&this.is("."+t)},val:function(e){if(e!==w)return"number"==typeof e&&(e+=""),this.each(function(){if(1==this.nodeType)if(P.isArray(e)&&/radio|checkbox/.test(this.type))this.checked=0<=P.inArray(this.value,e)||0<=P.inArray(this.name,e);else if(P.nodeName(this,"select")){var t=P.makeArray(e);P("option",this).each(function(){this.selected=0<=P.inArray(this.value,t)||0<=P.inArray(this.text,t)}),t.length||(this.selectedIndex=-1)}else this.value=e});var t=this[0];if(t){if(P.nodeName(t,"option"))return(t.attributes.value||{}).specified?t.value:t.text;if(P.nodeName(t,"select")){var i=t.selectedIndex,n=[],o=t.options,s="select-one"==t.type;if(i<0)return null;for(var a=s?i:0,r=s?i+1:o.length;a<r;a++){var h=o[a];if(h.selected){if(e=P(h).val(),s)return e;n.push(e)}}return n}return(t.value||"").replace(/\r/g,"")}return w},html:function(t){return t===w?this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null:this.empty().append(t)},replaceWith:function(t){return this.after(t).remove()},eq:function(t){return this.slice(t,+t+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(i){return this.pushStack(P.map(this,function(t,e){return i.call(t,e,t)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(t,e,i){if(this[0]){var n=(this[0].ownerDocument||this[0]).createDocumentFragment(),o=P.clean(t,this[0].ownerDocument||this[0],n),s=n.firstChild;if(s)for(var a=0,r=this.length;a<r;a++)i.call((h=this[a],l=s,e&&P.nodeName(h,"table")&&P.nodeName(l,"tr")?h.getElementsByTagName("tbody")[0]||h.appendChild(h.ownerDocument.createElement("tbody")):h),1<this.length||0<a?n.cloneNode(!0):n);o&&P.each(o,c)}var h,l;return this}},P.fn.init.prototype=P.fn,P.extend=P.fn.extend=function(){var t,e=arguments[0]||{},i=1,n=arguments.length,o=!1;for("boolean"==typeof e&&(o=e,e=arguments[1]||{},i=2),"object"==typeof e||P.isFunction(e)||(e={}),n==i&&(e=this,--i);i<n;i++)if(null!=(t=arguments[i]))for(var s in t){var a=e[s],r=t[s];e!==r&&(o&&r&&"object"==typeof r&&!r.nodeType?e[s]=P.extend(o,a||(null!=r.length?[]:{}),r):r!==w&&(e[s]=r))}return e};var a=/z-?index|font-?weight|opacity|zoom|line-?height/i,l=document.defaultView||{},e=Object.prototype.toString;P.extend({noConflict:function(t){return g.$=_$,t&&(g.jQuery=_jQuery),P},isFunction:function(t){return"[object Function]"===e.call(t)},isArray:function(t){return"[object Array]"===e.call(t)},isXMLDoc:function(t){return 9===t.nodeType&&"HTML"!==t.documentElement.nodeName||!!t.ownerDocument&&P.isXMLDoc(t.ownerDocument)},globalEval:function(t){if(t&&/\S/.test(t)){var e=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.type="text/javascript",P.support.scriptEval?i.appendChild(document.createTextNode(t)):i.text=t,e.insertBefore(i,e.firstChild),e.removeChild(i)}},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()==e.toUpperCase()},each:function(t,e,i){var n,o=0,s=t.length;if(i)if(s===w){for(n in t)if(!1===e.apply(t[n],i))break}else for(;o<s&&!1!==e.apply(t[o++],i););else if(s===w){for(n in t)if(!1===e.call(t[n],n,t[n]))break}else for(var a=t[0];o<s&&!1!==e.call(a,o,a);a=t[++o]);return t},prop:function(t,e,i,n,o){return P.isFunction(e)&&(e=e.call(t,n)),"number"!=typeof e||"curCSS"!=i||a.test(o)?e:e+"px"},className:{add:function(i,t){P.each((t||"").split(/\s+/),function(t,e){1!=i.nodeType||P.className.has(i.className,e)||(i.className+=(i.className?" ":"")+e)})},remove:function(t,e){1==t.nodeType&&(t.className=e!==w?P.grep(t.className.split(/\s+/),function(t){return!P.className.has(e,t)}).join(" "):"")},has:function(t,e){return t&&-1<P.inArray(e,(t.className||t).toString().split(/\s+/))}},swap:function(t,e,i){var n={};for(var o in e)n[o]=t.style[o],t.style[o]=e[o];for(var o in i.call(t),e)t.style[o]=n[o]},css:function(t,e,i,n){if("width"!=e&&"height"!=e)return P.curCSS(t,e,i);var o,s="width"==e?["Left","Right"]:["Top","Bottom"];function a(){o="width"==e?t.offsetWidth:t.offsetHeight,"border"!==n&&P.each(s,function(){n||(o-=parseFloat(P.curCSS(t,"padding"+this,!0))||0),"margin"===n?o+=parseFloat(P.curCSS(t,"margin"+this,!0))||0:o-=parseFloat(P.curCSS(t,"border"+this+"Width",!0))||0})}return 0!==t.offsetWidth?a():P.swap(t,{position:"absolute",visibility:"hidden",display:"block"},a),Math.max(0,Math.round(o))},curCSS:function(t,e,i){var n,o=t.style;if("opacity"==e&&!P.support.opacity)return""==(n=P.attr(o,"opacity"))?"1":n;if(e.match(/float/i)&&(e=b),!i&&o&&o[e])n=o[e];else if(l.getComputedStyle){e.match(/float/i)&&(e="float"),e=e.replace(/([A-Z])/g,"-$1").toLowerCase();var s=l.getComputedStyle(t,null);s&&(n=s.getPropertyValue(e)),"opacity"==e&&""==n&&(n="1")}else if(t.currentStyle){var a=e.replace(/\-(\w)/g,function(t,e){return e.toUpperCase()});if(n=t.currentStyle[e]||t.currentStyle[a],!/^\d+(px)?$/i.test(n)&&/^\d/.test(n)){var r=o.left,h=t.runtimeStyle.left;t.runtimeStyle.left=t.currentStyle.left,o.left=n||0,n=o.pixelLeft+"px",o.left=r,t.runtimeStyle.left=h}}return n},clean:function(t,r,e){if(void 0===(r=r||document).createElement&&(r=r.ownerDocument||r[0]&&r[0].ownerDocument||document),!e&&1===t.length&&"string"==typeof t[0]){var i=/^<(\w+)\s*\/?>$/.exec(t[0]);if(i)return[r.createElement(i[1])]}var h=[],n=[],l=r.createElement("div");if(P.each(t,function(t,e){if("number"==typeof e&&(e+=""),e){if("string"==typeof e){var i=(e=e.replace(/(<(\w+)[^>]*?)\/>/g,function(t,e,i){return i.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?t:e+"></"+i+">"})).replace(/^\s+/,"").substring(0,10).toLowerCase(),n=!i.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!i.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||i.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!i.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!i.indexOf("<td")||!i.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!i.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!P.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];for(l.innerHTML=n[1]+e+n[2];n[0]--;)l=l.lastChild;if(!P.support.tbody)for(var o=/<tbody/i.test(e),s=i.indexOf("<table")||o?"<table>"!=n[1]||o?[]:l.childNodes:l.firstChild&&l.firstChild.childNodes,a=s.length-1;0<=a;--a)P.nodeName(s[a],"tbody")&&!s[a].childNodes.length&&s[a].parentNode.removeChild(s[a]);!P.support.leadingWhitespace&&/^\s/.test(e)&&l.insertBefore(r.createTextNode(e.match(/^\s*/)[0]),l.firstChild),e=P.makeArray(l.childNodes)}e.nodeType?h.push(e):h=P.merge(h,e)}}),e){for(var o=0;h[o];o++)!P.nodeName(h[o],"script")||h[o].type&&"text/javascript"!==h[o].type.toLowerCase()?(1===h[o].nodeType&&h.splice.apply(h,[o+1,0].concat(P.makeArray(h[o].getElementsByTagName("script")))),e.appendChild(h[o])):n.push(h[o].parentNode?h[o].parentNode.removeChild(h[o]):h[o]);return n}return h},attr:function(t,e,i){if(!t||3==t.nodeType||8==t.nodeType)return w;var n=!P.isXMLDoc(t),o=i!==w;if(e=n&&P.props[e]||e,t.tagName){var s=/href|src|style/.test(e);if("selected"==e&&t.parentNode&&t.parentNode.selectedIndex,e in t&&n&&!s){if(o){if("type"==e&&P.nodeName(t,"input")&&t.parentNode)throw"type property can't be changed";t[e]=i}if(P.nodeName(t,"form")&&t.getAttributeNode(e))return t.getAttributeNode(e).nodeValue;if("tabIndex"!=e)return t[e];var a=t.getAttributeNode("tabIndex");return a&&a.specified?a.value:t.nodeName.match(/(button|input|object|select|textarea)/i)?0:t.nodeName.match(/^(a|area)$/i)&&t.href?0:w}if(!P.support.style&&n&&"style"==e)return P.attr(t.style,"cssText",i);o&&t.setAttribute(e,""+i);var r=!P.support.hrefNormalized&&n&&s?t.getAttribute(e,2):t.getAttribute(e);return null===r?w:r}return P.support.opacity||"opacity"!=e?(e=e.replace(/-([a-z])/gi,function(t,e){return e.toUpperCase()}),o&&(t[e]=i),t[e]):(o&&(t.zoom=1,t.filter=(t.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(i)+""=="NaN"?"":"alpha(opacity="+100*i+")")),t.filter&&0<=t.filter.indexOf("opacity=")?parseFloat(t.filter.match(/opacity=([^)]*)/)[1])/100+"":"")},trim:function(t){return(t||"").replace(/^\s+|\s+$/g,"")},makeArray:function(t){var e=[];if(null!=t){var i=t.length;if(null==i||"string"==typeof t||P.isFunction(t)||t.setInterval)e[0]=t;else for(;i;)e[--i]=t[i]}return e},inArray:function(t,e){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},merge:function(t,e){var i,n=0,o=t.length;if(P.support.getAll)for(;null!=(i=e[n++]);)t[o++]=i;else for(;null!=(i=e[n++]);)8!=i.nodeType&&(t[o++]=i);return t},unique:function(e){var i=[],t={};try{for(var n=0,o=e.length;n<o;n++){var s=P.data(e[n]);t[s]||(t[s]=!0,i.push(e[n]))}}catch(t){i=e}return i},grep:function(t,e,i){for(var n=[],o=0,s=t.length;o<s;o++)!i!=!e(t[o],o)&&n.push(t[o]);return n},map:function(t,e){for(var i=[],n=0,o=t.length;n<o;n++){var s=e(t[n],n);null!=s&&(i[i.length]=s)}return i.concat.apply([],i)}});var t=navigator.userAgent.toLowerCase();function o(t,e){return t[0]&&parseInt(P.curCSS(t[0],e,!0),10)||0}P.browser={version:(t.match(/(?:rv|webkit|opera|msie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(t),opera:/opera/.test(t),msie:/msie/.test(t)&&!/opera/.test(t),mozilla:/mozilla/.test(t)&&!/(compatible|webkit)/.test(t)},P.each({parent:function(t){return t.parentNode},parents:function(t){return P.dir(t,"parentNode")},next:function(t){return P.nth(t,2,"nextSibling")},prev:function(t){return P.nth(t,2,"previousSibling")},nextAll:function(t){return P.dir(t,"nextSibling")},prevAll:function(t){return P.dir(t,"previousSibling")},siblings:function(t){return P.sibling(t.parentNode.firstChild,t)},children:function(t){return P.sibling(t.firstChild)},contents:function(t){return P.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:P.makeArray(t.childNodes)}},function(i,n){P.fn[i]=function(t){var e=P.map(this,n);return t&&"string"==typeof t&&(e=P.multiFilter(t,e)),this.pushStack(P.unique(e),i,t)}}),P.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,r){P.fn[a]=function(t){for(var e=[],i=P(t),n=0,o=i.length;n<o;n++){var s=(0<n?this.clone(!0):this).get();P.fn[r].apply(P(i[n]),s),e=e.concat(s)}return this.pushStack(e,a,t)}}),P.each({removeAttr:function(t){P.attr(this,t,""),1==this.nodeType&&this.removeAttribute(t)},addClass:function(t){P.className.add(this,t)},removeClass:function(t){P.className.remove(this,t)},toggleClass:function(t,e){"boolean"!=typeof e&&(e=!P.className.has(this,t)),P.className[e?"add":"remove"](this,t)},remove:function(t){t&&!P.filter(t,[this]).length||(P("*",this).add([this]).each(function(){P.event.remove(this),P.removeData(this)}),this.parentNode&&this.parentNode.removeChild(this))},empty:function(){for(P(this).children().remove();this.firstChild;)this.removeChild(this.firstChild)}},function(t,e){P.fn[t]=function(){return this.each(e,arguments)}});var r="jQuery"+y(),h=0,u={};function n(){return!1}function d(){return!0}P.extend({cache:{},data:function(t,e,i){var n=(t=t==g?u:t)[r];return n=n||(t[r]=++h),e&&!P.cache[n]&&(P.cache[n]={}),i!==w&&(P.cache[n][e]=i),e?P.cache[n][e]:n},removeData:function(e,t){var i=(e=e==g?u:e)[r];if(t){if(P.cache[i]){for(t in delete P.cache[i][t],t="",P.cache[i])break;t||P.removeData(e)}}else{try{delete e[r]}catch(t){e.removeAttribute&&e.removeAttribute(r)}delete P.cache[i]}},queue:function(t,e,i){if(t){e=(e||"fx")+"queue";var n=P.data(t,e);!n||P.isArray(i)?n=P.data(t,e,P.makeArray(i)):i&&n.push(i)}return n},dequeue:function(t,e){var i=P.queue(t,e),n=i.shift();e&&"fx"!==e||(n=i[0]),n!==w&&n.call(t)}}),P.fn.extend({data:function(t,e){var i=t.split(".");if(i[1]=i[1]?"."+i[1]:"",e!==w)return this.trigger("setData"+i[1]+"!",[i[0],e]).each(function(){P.data(this,t,e)});var n=this.triggerHandler("getData"+i[1]+"!",[i[0]]);return n===w&&this.length&&(n=P.data(this[0],t)),n===w&&i[1]?this.data(i[0]):n},removeData:function(t){return this.each(function(){P.removeData(this,t)})},queue:function(e,i){return"string"!=typeof e&&(i=e,e="fx"),i===w?P.queue(this[0],e):this.each(function(){var t=P.queue(this,e,i);"fx"==e&&1==t.length&&t[0].call(this)})},dequeue:function(t){return this.each(function(){P.dequeue(this,t)})}}),function(){var _=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,a=0,f=Object.prototype.toString,m=function(t,e,i,n){if(i=i||[],1!==(e=e||document).nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return i;var o,s,a,r,h=[],l=!0;for(_.lastIndex=0;null!==(o=_.exec(t));)if(h.push(o[1]),o[2]){r=RegExp.rightContext;break}if(1<h.length&&g.exec(t))if(2===h.length&&v.relative[h[0]])s=x(h[0]+h[1],e);else for(s=v.relative[h[0]]?[e]:m(h.shift(),e);h.length;)t=h.shift(),v.relative[t]&&(t+=h.shift()),s=x(t,s);else{var c=n?{expr:h.pop(),set:b(n)}:m.find(h.pop(),1===h.length&&e.parentNode?e.parentNode:e,M(e));for(s=m.filter(c.expr,c.set),0<h.length?a=b(s):l=!1;h.length;){var u=h.pop(),d=u;v.relative[u]?d=h.pop():u="",null==d&&(d=e),v.relative[u](a,d,M(e))}}if(!(a=a||s))throw"Syntax error, unrecognized expression: "+(u||t);if("[object Array]"===f.call(a))if(l)if(1===e.nodeType)for(var p=0;null!=a[p];p++)a[p]&&(!0===a[p]||1===a[p].nodeType&&C(e,a[p]))&&i.push(s[p]);else for(p=0;null!=a[p];p++)a[p]&&1===a[p].nodeType&&i.push(s[p]);else i.push.apply(i,a);else b(a,i);if(r&&(m(r,e,i,n),y&&(hasDuplicate=!1,i.sort(y),hasDuplicate)))for(p=1;p<i.length;p++)i[p]===i[p-1]&&i.splice(p--,1);return i};m.matches=function(t,e){return m(t,null,null,e)},m.find=function(t,e,i){var n;if(!t)return[];for(var o=0,s=v.order.length;o<s;o++){var a,r=v.order[o];if(a=v.match[r].exec(t)){var h=RegExp.leftContext;if("\\"!==h.substr(h.length-1)&&(a[1]=(a[1]||"").replace(/\\/g,""),null!=(n=v.find[r](a,e,i)))){t=t.replace(v.match[r],"");break}}}return{set:n=n||e.getElementsByTagName("*"),expr:t}},m.filter=function(t,e,i,n){for(var o,s,a=t,r=[],h=e,l=e&&e[0]&&M(e[0]);t&&e.length;){for(var c in v.filter)if(null!=(o=v.match[c].exec(t))){var u,d,p=v.filter[c];if(s=!1,h==r&&(r=[]),v.preFilter[c])if(o=v.preFilter[c](o,h,i,r,n,l)){if(!0===o)continue}else s=u=!0;if(o)for(var _=0;null!=(d=h[_]);_++)if(d){var f=n^!!(u=p(d,o,_,h));i&&null!=u?f?s=!0:h[_]=!1:f&&(r.push(d),s=!0)}if(u!==w){if(i||(h=r),t=t.replace(v.match[c],""),!s)return[];break}}if(t==a){if(null==s)throw"Syntax error, unrecognized expression: "+t;break}a=t}return h};var v=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")}},relative:{"+":function(t,e,i){var n="string"==typeof e,o=n&&!/\W/.test(e),s=n&&!o;o&&!i&&(e=e.toUpperCase());for(var a,r=0,h=t.length;r<h;r++)if(a=t[r]){for(;(a=a.previousSibling)&&1!==a.nodeType;);t[r]=s||a&&a.nodeName===e?a||!1:a===e}s&&m.filter(e,t,!0)},">":function(t,e,i){var n="string"==typeof e;if(n&&!/\W/.test(e)){e=i?e:e.toUpperCase();for(var o=0,s=t.length;o<s;o++){if(r=t[o]){var a=r.parentNode;t[o]=a.nodeName===e&&a}}}else{for(o=0,s=t.length;o<s;o++){var r;(r=t[o])&&(t[o]=n?r.parentNode:r.parentNode===e)}n&&m.filter(e,t,!0)}},"":function(t,e,i){var n=a++,o=h;if(!e.match(/\W/)){var s=e=i?e:e.toUpperCase();o=r}o("parentNode",e,n,t,s,i)},"~":function(t,e,i){var n=a++,o=h;if("string"==typeof e&&!e.match(/\W/)){var s=e=i?e:e.toUpperCase();o=r}o("previousSibling",e,n,t,s,i)}},find:{ID:function(t,e,i){if(void 0!==e.getElementById&&!i){var n=e.getElementById(t[1]);return n?[n]:[]}},NAME:function(t,e,i){if(void 0!==e.getElementsByName){for(var n=[],o=e.getElementsByName(t[1]),s=0,a=o.length;s<a;s++)o[s].getAttribute("name")===t[1]&&n.push(o[s]);return 0===n.length?null:n}},TAG:function(t,e){return m.getElementsByTagName(e,t[1])}},preFilter:{CLASS:function(t,e,i,n,o,s){if(t=" "+t[1].replace(/\\/g,"")+" ",s)return t;for(var a,r=0;null!=(a=e[r]);r++)a&&(o^(a.className&&0<=(" "+a.className+" ").indexOf(t))?i||n.push(a):i&&(e[r]=!1));return!1},ID:function(t){return t[1].replace(/\\/g,"")},TAG:function(t,e){for(var i=0;!1===e[i];i++);return e[i]&&M(e[i])?t[1]:t[1].toUpperCase()},CHILD:function(t){if("nth"==t[1]){var e=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(("even"==t[2]?"2n":"odd"==t[2]&&"2n+1")||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]);t[2]=e[1]+(e[2]||1)-0,t[3]=e[3]-0}return t[0]=a++,t},ATTR:function(t,e,i,n,o,s){var a=t[1].replace(/\\/g,"");return!s&&v.attrMap[a]&&(t[1]=v.attrMap[a]),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(t,e,i,n,o){if("not"===t[1]){if(!(1<t[3].match(_).length||/^\w/.test(t[3]))){var s=m.filter(t[3],e,i,!0^o);return i||n.push.apply(n,s),!1}t[3]=m(t[3],null,null,e)}else if(v.match.POS.test(t[0])||v.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return!1===t.disabled&&"hidden"!==t.type},disabled:function(t){return!0===t.disabled},checked:function(t){return!0===t.checked},selected:function(t){return t.parentNode.selectedIndex,!0===t.selected},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,i){return!!m(i[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){return"text"===t.type},radio:function(t){return"radio"===t.type},checkbox:function(t){return"checkbox"===t.type},file:function(t){return"file"===t.type},password:function(t){return"password"===t.type},submit:function(t){return"submit"===t.type},image:function(t){return"image"===t.type},reset:function(t){return"reset"===t.type},button:function(t){return"button"===t.type||"BUTTON"===t.nodeName.toUpperCase()},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,i,n){return e===n.length-1},even:function(t,e){return e%2==0},odd:function(t,e){return e%2==1},lt:function(t,e,i){return e<i[3]-0},gt:function(t,e,i){return e>i[3]-0},nth:function(t,e,i){return i[3]-0==e},eq:function(t,e,i){return i[3]-0==e}},filter:{PSEUDO:function(t,e,i,n){var o=e[1],s=v.filters[o];if(s)return s(t,i,e,n);if("contains"===o)return 0<=(t.textContent||t.innerText||"").indexOf(e[3]);if("not"===o){for(var a=e[3],r=(i=0,a.length);i<r;i++)if(a[i]===t)return!1;return!0}},CHILD:function(t,e){var i=e[1],n=t;switch(i){case"only":case"first":for(;n=n.previousSibling;)if(1===n.nodeType)return!1;if("first"==i)return!0;n=t;case"last":for(;n=n.nextSibling;)if(1===n.nodeType)return!1;return!0;case"nth":var o=e[2],s=e[3];if(1==o&&0==s)return!0;var a=e[0],r=t.parentNode;if(r&&(r.sizcache!==a||!t.nodeIndex)){var h=0;for(n=r.firstChild;n;n=n.nextSibling)1===n.nodeType&&(n.nodeIndex=++h);r.sizcache=a}var l=t.nodeIndex-s;return 0==o?0==l:l%o==0&&0<=l/o}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||t.nodeName===e.replace("\\:",":")},CLASS:function(t,e){return-1<(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)},ATTR:function(t,e){var i=e[1],n=v.attrHandle[i]?v.attrHandle[i](t):null!=t[i]?t[i]:t.getAttribute(i),o=n+"",s=e[2],a=e[4];return null==n?"!="===s:"="===s?o===a:"*="===s?0<=o.indexOf(a):"~="===s?0<=(" "+o+" ").indexOf(a):a?"!="===s?o!=a:"^="===s?0===o.indexOf(a):"$="===s?o.substr(o.length-a.length)===a:"|="===s&&(o===a||o.substr(0,a.length+1)===a+"-"):o&&!1!==n},POS:function(t,e,i,n){var o=e[2],s=v.setFilters[o];if(s)return s(t,i,e,n)}}},g=v.match.POS;for(var t in v.match)v.match[t]=RegExp(v.match[t].source+/(?![^\[]*\])(?![^\(]*\))/.source);var y,e,o,i,b=function(t,e){return t=Array.prototype.slice.call(t),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(t){b=function(t,e){var i=e||[];if("[object Array]"===f.call(t))Array.prototype.push.apply(i,t);else if("number"==typeof t.length)for(var n=0,o=t.length;n<o;n++)i.push(t[n]);else for(n=0;t[n];n++)i.push(t[n]);return i}}function r(t,e,i,n,o,s){for(var a="previousSibling"==t&&!s,r=0,h=n.length;r<h;r++){var l=n[r];if(l){a&&1===l.nodeType&&(l.sizcache=i,l.sizset=r),l=l[t];for(var c=!1;l;){if(l.sizcache===i){c=n[l.sizset];break}if(1!==l.nodeType||s||(l.sizcache=i,l.sizset=r),l.nodeName===e){c=l;break}l=l[t]}n[r]=c}}}function h(t,e,i,n,o,s){for(var a="previousSibling"==t&&!s,r=0,h=n.length;r<h;r++){var l=n[r];if(l){a&&1===l.nodeType&&(l.sizcache=i,l.sizset=r),l=l[t];for(var c=!1;l;){if(l.sizcache===i){c=n[l.sizset];break}if(1===l.nodeType)if(s||(l.sizcache=i,l.sizset=r),"string"!=typeof e){if(l===e){c=!0;break}}else if(0<m.filter(e,[l]).length){c=l;break}l=l[t]}n[r]=c}}}document.documentElement.compareDocumentPosition?y=function(t,e){var i=4&t.compareDocumentPosition(e)?-1:t===e?0:1;return 0==i&&(hasDuplicate=!0),i}:"sourceIndex"in document.documentElement?y=function(t,e){var i=t.sourceIndex-e.sourceIndex;return 0==i&&(hasDuplicate=!0),i}:document.createRange&&(y=function(t,e){var i=t.ownerDocument.createRange(),n=e.ownerDocument.createRange();i.selectNode(t),i.collapse(!0),n.selectNode(e),n.collapse(!0);var o=i.compareBoundaryPoints(Range.START_TO_END,n);return 0===o&&(hasDuplicate=!0),o}),function(){var t=document.createElement("form"),e="script"+(new Date).getTime();t.innerHTML="<input name='"+e+"'/>";var i=document.documentElement;i.insertBefore(t,i.firstChild),document.getElementById(e)&&(v.find.ID=function(t,e,i){if(void 0!==e.getElementById&&!i){var n=e.getElementById(t[1]);return n?n.id===t[1]||void 0!==n.getAttributeNode&&n.getAttributeNode("id").nodeValue===t[1]?[n]:w:[]}},v.filter.ID=function(t,e){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&i&&i.nodeValue===e}),i.removeChild(t)}(),(e=document.createElement("div")).appendChild(document.createComment("")),0<e.getElementsByTagName("*").length&&(v.find.TAG=function(t,e){var i=m.getElementsByTagName(e,t[1]);if("*"===t[1]){for(var n=[],o=0;i[o];o++)1===i[o].nodeType&&n.push(i[o]);i=n}return i}),e.innerHTML="<a href='#'></a>",e.firstChild&&void 0!==e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(v.attrHandle.href=function(t){return t.getAttribute("href",2)}),document.querySelectorAll&&(o=m,(i=document.createElement("div")).innerHTML="<p class='TEST'></p>",i.querySelectorAll&&0===i.querySelectorAll(".TEST").length||((m=function(t,e,i,n){if(e=e||document,!n&&9===e.nodeType&&!M(e))try{return b(e.querySelectorAll(t),i)}catch(t){}return o(t,e,i,n)}).find=o.find,m.filter=o.filter,m.selectors=o.selectors,m.matches=o.matches)),P.browser.msie&&(!document.documentMode||document.documentMode<8||9<=document.documentMode)?m.getElementsByTagName=function(t,e){var i=e.indexOf(":");if(-1==i)return t.getElementsByTagName(e);var n,o=e.slice(0,i),s=[];e=e.slice(i+1);for(var a=0,r=(n=t.getElementsByTagName(e)).length;a<r;a++)n[a].scopeName==o&&s.push(n[a]);return s}:m.getElementsByTagName=function(t,e){return t.getElementsByTagName(e)},document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){if(!(P.browser.opera&&parseFloat(P.browser.version)<9.5||P.browser.mozilla&&parseFloat(P.browser.version)<1.9)){var t=document.createElement("div");t.innerHTML="<div class='test e'></div><div class='test'></div>",0!==t.getElementsByClassName("e").length&&(t.lastChild.className="e",1!==t.getElementsByClassName("e").length&&(v.order.splice(1,0,"CLASS"),v.find.CLASS=function(t,e,i){if(void 0!==e.getElementsByClassName&&!i)return e.getElementsByClassName(t[1])}))}}();var C=document.compareDocumentPosition?function(t,e){return 16&t.compareDocumentPosition(e)}:function(t,e){return t!==e&&(!t.contains||t.contains(e))},M=function(t){return 9===t.nodeType&&"HTML"!==t.documentElement.nodeName||!!t.ownerDocument&&M(t.ownerDocument)},x=function(t,e){for(var i,n=[],o="",s=e.nodeType?[e]:e;i=v.match.PSEUDO.exec(t);)o+=i[0],t=t.replace(v.match.PSEUDO,"");t=v.relative[t]?t+"*":t;for(var a=0,r=s.length;a<r;a++)m(t,s[a],n);return m.filter(o,n)};P.find=m,P.filter=m.filter,P.expr=m.selectors,P.expr[":"]=P.expr.filters,m.selectors.filters.hidden=function(t){return 0===t.offsetWidth||0===t.offsetHeight},m.selectors.filters.visible=function(t){return 0<t.offsetWidth||0<t.offsetHeight},m.selectors.filters.animated=function(e){return P.grep(P.timers,function(t){return e===t.elem}).length},P.multiFilter=function(t,e,i){return i&&(t=":not("+t+")"),m.matches(t,e)},P.dir=function(t,e){for(var i=[],n=t[e];n&&n!=document;)1==n.nodeType&&i.push(n),n=n[e];return i},P.nth=function(t,e,i,n){e=e||1;for(var o=0;t&&(1!=t.nodeType||++o!=e);t=t[i]);return t},P.sibling=function(t,e){for(var i=[];t;t=t.nextSibling)1==t.nodeType&&t!=e&&i.push(t);return i}}(),P.event={add:function(o,t,s,a){if(3!=o.nodeType&&8!=o.nodeType){if(o.setInterval&&o!=g&&(o=g),s.guid||(s.guid=this.guid++),a!==w){var e=s;(s=this.proxy(e)).data=a}var r=P.data(o,"events")||P.data(o,"events",{}),h=P.data(o,"handle")||P.data(o,"handle",function(){return void 0===P||P.event.triggered?w:P.event.handle.apply(arguments.callee.elem,arguments)});h.elem=o,P.each(t.split(/\s+/),function(t,e){var i=e.split(".");e=i.shift(),s.type=i.slice().sort().join(".");var n=r[e];P.event.specialAll[e]&&P.event.specialAll[e].setup.call(o,a,i),n||(n=r[e]={},P.event.special[e]&&!1!==P.event.special[e].setup.call(o,a,i)||(o.addEventListener?o.addEventListener(e,h,!1):o.attachEvent&&o.attachEvent("on"+e,h))),n[s.guid]=s,P.event.global[e]=!0}),o=null}},guid:1,global:{},remove:function(s,t,a){if(3!=s.nodeType&&8!=s.nodeType){var r,h=P.data(s,"events");if(h){if(t===w||"string"==typeof t&&"."==t.charAt(0))for(var e in h)this.remove(s,e+(t||""));else t.type&&(a=t.handler,t=t.type),P.each(t.split(/\s+/),function(t,e){var i=e.split(".");e=i.shift();var n=RegExp("(^|\\.)"+i.slice().sort().join(".*\\.")+"(\\.|$)");if(h[e]){if(a)delete h[e][a.guid];else for(var o in h[e])n.test(h[e][o].type)&&delete h[e][o];for(r in P.event.specialAll[e]&&P.event.specialAll[e].teardown.call(s,i),h[e])break;r||(P.event.special[e]&&!1!==P.event.special[e].teardown.call(s,i)||(s.removeEventListener?s.removeEventListener(e,P.data(s,"handle"),!1):s.detachEvent&&s.detachEvent("on"+e,P.data(s,"handle"))),r=null,delete h[e])}});for(r in h)break;if(!r){var i=P.data(s,"handle");i&&(i.elem=null),P.removeData(s,"events"),P.removeData(s,"handle")}}}},trigger:function(t,e,i,n){var o=t.type||t;if(!n){if(t="object"==typeof t?t[r]?t:P.extend(P.Event(o),t):P.Event(o),0<=o.indexOf("!")&&(t.type=o=o.slice(0,-1),t.exclusive=!0),i||(t.stopPropagation(),this.global[o]&&P.each(P.cache,function(){this.events&&this.events[o]&&P.event.trigger(t,e,this.handle.elem)})),!i||3==i.nodeType||8==i.nodeType)return w;t.result=w,t.target=i,(e=P.makeArray(e)).unshift(t)}t.currentTarget=i;var s=P.data(i,"handle");if(s&&s.apply(i,e),(!i[o]||P.nodeName(i,"a")&&"click"==o)&&i["on"+o]&&!1===i["on"+o].apply(i,e)&&(t.result=!1),!n&&i[o]&&!t.isDefaultPrevented()&&(!P.nodeName(i,"a")||"click"!=o)){this.triggered=!0;try{i[o]()}catch(t){}}if(this.triggered=!1,!t.isPropagationStopped()){var a=i.parentNode||i.ownerDocument;a&&P.event.trigger(t,e,a,!0)}},handle:function(t){var e,i;(t=t=P.event.fix(t||g.event)).currentTarget=this;var n=t.type.split(".");t.type=n.shift(),e=!n.length&&!t.exclusive;var o=RegExp("(^|\\.)"+n.slice().sort().join(".*\\.")+"(\\.|$)");for(var s in i=(P.data(this,"events")||{})[t.type]){var a=i[s];if(e||o.test(a.type)){t.handler=a,t.data=a.data;var r=a.apply(this,arguments);if(r!==w&&!1===(t.result=r)&&(t.preventDefault(),t.stopPropagation()),t.isImmediatePropagationStopped())break}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(e){if(e[r])return e;var t=e;e=P.Event(t);for(var i,n=this.props.length;n;)e[i=this.props[--n]]=t[i];if(e.target||(e.target=e.srcElement||document),3==e.target.nodeType&&(e.target=e.target.parentNode),!e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement),e.relatedTarget&&St.mozilla)try{e.relatedTarget.nodeType}catch(t){e.relatedTarget=null}if(null==e.pageX&&null!=e.clientX){var o=document.documentElement,s=document.body;e.pageX=e.clientX+(o&&o.scrollLeft||s&&s.scrollLeft||0)-(o.clientLeft||0),e.pageY=e.clientY+(o&&o.scrollTop||s&&s.scrollTop||0)-(o.clientTop||0)}!e.which&&(e.charCode||0===e.charCode?e.charCode:e.keyCode)&&(e.which=e.charCode||e.keyCode),!e.metaKey&&e.ctrlKey&&(e.metaKey=e.ctrlKey),!e.which&&e.button&&(e.which=1&e.button?1:2&e.button?3:4&e.button?2:0);o=document.documentElement,s=document.body;return St.opera&&St.version<=9.27||(e.clientX-=o.clientLeft||s.clientLeft||0,e.clientY-=o.clientTop||s.clientTop||0),e},proxy:function(t,e){return(e=e||function(){return t.apply(this,arguments)}).guid=t.guid=t.guid||e.guid||this.guid++,e},special:{ready:{setup:v,teardown:function(){}}},specialAll:{live:{setup:function(t,e){P.event.add(this,e[0],_)},teardown:function(t){if(t.length){var e=0,i=RegExp("(^|\\.)"+t[0]+"(\\.|$)");P.each(P.data(this,"events").live||{},function(){i.test(this.type)&&e++}),e<1&&P.event.remove(this,t[0],_)}}}}},P.Event=function(t){if(!this.preventDefault)return new P.Event(t);t&&t.type?(this.originalEvent=t,this.type=t.type):this.type=t,this.timeStamp=y(),this[r]=!0},P.Event.prototype={preventDefault:function(){this.isDefaultPrevented=d;var t=this.originalEvent;t&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=d;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d,this.stopPropagation()},isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n};function p(t){for(var e=t.relatedTarget;e&&e!=this;)try{e=e.parentNode}catch(t){e=this}e!=this&&(t.type=t.data,P.event.handle.apply(this,arguments))}function _(n){var o=RegExp("(^|\\.)"+n.type+"(\\.|$)"),t=!0,s=[];return P.each(P.data(this,"events").live||[],function(t,e){if(o.test(e.type)){var i=P(n.target).closest(e.data)[0];i&&s.push({elem:i,fn:e})}}),s.sort(function(t,e){return P.data(t.elem,"closest")-P.data(e.elem,"closest")}),P.each(s,function(){if(!1===this.fn.call(this.elem,n,this.fn.data))return t=!1}),t}function f(t,e){return["live",t,e.replace(/\./g,"`").replace(/ /g,"|")].join(".")}P.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(t,e){P.event.special[e]={setup:function(){P.event.add(this,t,p,e)},teardown:function(){P.event.remove(this,t,p)}}}),P.fn.extend({bind:function(t,e,i){return"unload"==t?this.one(t,e,i):this.each(function(){P.event.add(this,t,i||e,i&&e)})},one:function(t,e,i){var n=P.event.proxy(i||e,function(t){return P(this).unbind(t,n),(i||e).apply(this,arguments)});return this.each(function(){P.event.add(this,t,n,i&&e)})},unbind:function(t,e){return this.each(function(){P.event.remove(this,t,e)})},trigger:function(t,e){return this.each(function(){P.event.trigger(t,e,this)})},triggerHandler:function(t,e){if(this[0]){var i=P.Event(t);return i.preventDefault(),i.stopPropagation(),P.event.trigger(i,e,this[0]),i.result}},toggle:function(t){for(var e=arguments,i=1;i<e.length;)P.event.proxy(t,e[i++]);return this.click(P.event.proxy(t,function(t){return this.lastToggle=(this.lastToggle||0)%i,t.preventDefault(),e[this.lastToggle++].apply(this,arguments)||!1}))},hover:function(t,e){return this.mouseenter(t).mouseleave(e)},ready:function(t){return v(),P.isReady?t.call(document,P):P.readyList.push(t),this},live:function(t,e){var i=P.event.proxy(e);return i.guid+=this.selector+t,P(document).bind(f(t,this.selector),this.selector,i),this},die:function(t,e){return P(document).unbind(f(t,this.selector),e?{guid:e.guid+this.selector+t}:null),this}}),P.extend({isReady:!1,readyList:[],ready:function(){P.isReady||(P.isReady=!0,P.readyList&&(P.each(P.readyList,function(){this.call(document,P)}),P.readyList=null),P(document).triggerHandler("ready"))}});var m=!1;function v(){m||(m=!0,document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),P.ready()},!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),P.ready())}),document.documentElement.doScroll&&g==g.top&&function(){if(!P.isReady){try{document.documentElement.doScroll("left")}catch(t){return setTimeout(arguments.callee,0)}P.ready()}}()),P.event.add(g,"load",P.ready))}P.each("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error".split(","),function(t,e){P.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)}}),P(g).bind("unload",function(){for(var t in P.cache)1!=t&&P.cache[t].handle&&P.event.remove(P.cache[t].handle.elem)}),function(){P.support={};var t=document.documentElement,e=document.createElement("script"),i=document.createElement("div"),n="script"+(new Date).getTime();i.style.display="none",i.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var o=i.getElementsByTagName("*"),s=i.getElementsByTagName("a")[0];if(o&&o.length&&s){P.support={leadingWhitespace:3==i.firstChild.nodeType,tbody:!i.getElementsByTagName("tbody").length,objectAll:!!i.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!i.getElementsByTagName("link").length,style:/red/.test(s.getAttribute("style")),hrefNormalized:"/a"===s.getAttribute("href"),opacity:"0.5"===s.style.opacity,cssFloat:!!s.style.cssFloat,scriptEval:!1,noCloneEvent:!0,boxModel:null},e.type="text/javascript";try{e.appendChild(document.createTextNode("window."+n+"=1;"))}catch(t){}t.insertBefore(e,t.firstChild),g[n]&&(P.support.scriptEval=!0,delete g[n]),t.removeChild(e),i.attachEvent&&i.fireEvent&&(i.attachEvent("onclick",function(){P.support.noCloneEvent=!1,i.detachEvent("onclick",arguments.callee)}),i.cloneNode(!0).fireEvent("onclick")),P(function(){var t=document.createElement("div");t.style.width=t.style.paddingLeft="1px",document.body.appendChild(t),P.boxModel=P.support.boxModel=2===t.offsetWidth,document.body.removeChild(t).style.display="none"})}}();var b=P.support.cssFloat?"cssFloat":"styleFloat";P.props={for:"htmlFor",class:"className",float:b,cssFloat:b,styleFloat:b,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"},P.fn.extend({_load:P.fn.load,load:function(t,e,i){if("string"!=typeof t)return this._load(t);var n=t.indexOf(" ");if(0<=n){var o=t.slice(n,t.length);t=t.slice(0,n)}var s="GET";e&&(P.isFunction(e)?(i=e,e=null):"object"==typeof e&&(e=P.param(e),s="POST"));var a=this;return P.ajax({url:t,type:s,dataType:"html",data:e,complete:function(t,e){"success"!=e&&"notmodified"!=e||a.html(o?P("<div/>").append(t.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(o):t.responseText),i&&a.each(i,[t.responseText,e,t])}}),this},serialize:function(){return P.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?P.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(t,i){var e=P(this).val();return null==e?null:P.isArray(e)?P.map(e,function(t,e){return{name:i.name,value:t}}):{name:i.name,value:e}}).get()}}),P.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(t,e){P.fn[e]=function(t){return this.bind(e,t)}});var C=y();P.extend({get:function(t,e,i,n){return P.isFunction(e)&&(i=e,e=null),P.ajax({type:"GET",url:t,data:e,success:i,dataType:n})},getScript:function(t,e){return P.get(t,null,e,"script")},getJSON:function(t,e,i){return P.get(t,e,i,"json")},post:function(t,e,i,n){return P.isFunction(e)&&(i=e,e={}),P.ajax({type:"POST",url:t,data:e,success:i,dataType:n})},ajaxSetup:function(t){P.extend(P.ajaxSettings,t)},ajaxSettings:{url:location.href,global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,xhr:function(){return g.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(i){var n,o,s,t=/=\?(&|$)/g,e=(i=P.extend(!0,i,P.extend(!0,{},P.ajaxSettings,i))).type.toUpperCase();if(i.data&&i.processData&&"string"!=typeof i.data&&(i.data=P.param(i.data)),"jsonp"==i.dataType&&("GET"==e?i.url.match(t)||(i.url+=(i.url.match(/\?/)?"&":"?")+(i.jsonp||"callback")+"=?"):i.data&&i.data.match(t)||(i.data=(i.data?i.data+"&":"")+(i.jsonp||"callback")+"=?"),i.dataType="json"),"json"==i.dataType&&(i.data&&i.data.match(t)||i.url.match(t))&&(n=i.jsonpCallback||"jsonp"+C++,i.data&&(i.data=(i.data+"").replace(t,"="+n+"$1")),i.url=i.url.replace(t,"="+n+"$1"),i.dataType="script",g[n]=g[n]||function(t){s=t,m(),v(),g[n]=w;try{delete g[n]}catch(t){}l&&l.removeChild(c)}),"script"==i.dataType&&null==i.cache&&(i.cache=!1),!1===i.cache&&"GET"==e){var a=y(),r=i.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+a+"$2");i.url=r+(r==i.url?(i.url.match(/\?/)?"&":"?")+"_="+a:"")}i.data&&"GET"==e&&(i.url+=(i.url.match(/\?/)?"&":"?")+i.data,i.data=null),i.global&&!P.active++&&P.event.trigger("ajaxStart");var h=/^(\w+:)?\/\/([^\/?#]+)/.exec(i.url);if("script"==i.dataType&&"GET"==e&&h&&(h[1]&&h[1]!=location.protocol||h[2]!=location.host)){var l=document.getElementsByTagName("head")[0],c=document.createElement("script");if(i.scriptCharset&&(c.charset=i.scriptCharset),c.src=i.url,!n){var u=!1;c.onload=c.onreadystatechange=function(){u||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(u=!0,m(),v(),c.onload=c.onreadystatechange=null,l.removeChild(c))}}return l.appendChild(c),w}var d=!1,p=i.xhr();i.username?p.open(e,i.url,i.async,i.username,i.password):p.open(e,i.url,i.async);try{i.data&&p.setRequestHeader("Content-Type",i.contentType),i.ifModified&&p.setRequestHeader("If-Modified-Since",P.lastModified[i.url]||"Thu, 01 Jan 1970 00:00:00 GMT"),p.setRequestHeader("X-Requested-With","XMLHttpRequest"),p.setRequestHeader("Accept",i.dataType&&i.accepts[i.dataType]?i.accepts[i.dataType]+", */*":i.accepts._default)}catch(t){}if(i.beforeSend&&!1===i.beforeSend(p,i))return i.global&&!--P.active&&P.event.trigger("ajaxStop"),p.abort(),!1;i.global&&P.event.trigger("ajaxSend",[p,i]);function _(t){if(0==p.readyState)f&&(clearInterval(f),f=null,i.global&&!--P.active&&P.event.trigger("ajaxStop"));else if(!d&&p&&(4==p.readyState||"timeout"==t)){if(d=!0,f&&(clearInterval(f),f=null),"success"==(o="timeout"==t?"timeout":P.httpSuccess(p)?i.ifModified&&P.httpNotModified(p,i.url)?"notmodified":"success":"error"))try{s=P.httpData(p,i.dataType,i)}catch(t){o="parsererror"}if("success"==o){var e;try{e=p.getResponseHeader("Last-Modified")}catch(t){}i.ifModified&&e&&(P.lastModified[i.url]=e),n||m()}else P.handleError(i,p,o);v(),t&&p.abort(),i.async&&(p=null)}}if(i.async){var f=setInterval(_,13);0<i.timeout&&setTimeout(function(){p&&!d&&_("timeout")},i.timeout)}try{p.send(i.data)}catch(t){P.handleError(i,p,null,t)}function m(){i.success&&i.success(s,o),i.global&&P.event.trigger("ajaxSuccess",[p,i])}function v(){i.complete&&i.complete(p,o),i.global&&P.event.trigger("ajaxComplete",[p,i]),i.global&&!--P.active&&P.event.trigger("ajaxStop")}return i.async||_(),p},handleError:function(t,e,i,n){t.error&&t.error(e,i,n),t.global&&P.event.trigger("ajaxError",[e,t,n])},active:0,httpSuccess:function(t){try{return!t.status&&"file:"==location.protocol||200<=t.status&&t.status<300||304==t.status||1223==t.status}catch(t){}return!1},httpNotModified:function(t,e){try{var i=t.getResponseHeader("Last-Modified");return 304==t.status||i==P.lastModified[e]}catch(t){}return!1},httpData:function(t,e,i){var n=t.getResponseHeader("content-type"),o="xml"==e||!e&&n&&0<=n.indexOf("xml"),s=o?t.responseXML:t.responseText;if(o&&"parsererror"==s.documentElement.tagName)throw"parsererror";return i&&i.dataFilter&&(s=i.dataFilter(s,e)),"string"==typeof s&&("script"==e&&P.globalEval(s),"json"==e&&(s=g.eval("("+s+")"))),s},param:function(t){var i=[];function e(t,e){i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}if(P.isArray(t)||t.jquery)P.each(t,function(){e(this.name,this.value)});else for(var n in t)P.isArray(t[n])?P.each(t[n],function(){e(n,this)}):e(n,P.isFunction(t[n])?t[n]():t[n]);return i.join("&").replace(/%20/g,"+")}});var M,x={},S=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function T(t,e){var i={};return P.each(S.concat.apply([],S.slice(0,e)),function(){i[this]=t}),i}P.fn.extend({show:function(t,e){if(t)return this.animate(T("show",3),t,e);for(var i=0,n=this.length;i<n;i++){var o=P.data(this[i],"olddisplay");if(this[i].style.display=o||"","none"===P.css(this[i],"display")){var s,a=this[i].tagName;if(x[a])s=x[a];else{var r=P("<"+a+" />").appendTo("body");"none"===(s=r.css("display"))&&(s="block"),r.remove(),x[a]=s}P.data(this[i],"olddisplay",s)}}for(i=0,n=this.length;i<n;i++)this[i].style.display=P.data(this[i],"olddisplay")||"";return this},hide:function(t,e){if(t)return this.animate(T("hide",3),t,e);for(var i=0,n=this.length;i<n;i++){var o=P.data(this[i],"olddisplay");o||"none"===o||P.data(this[i],"olddisplay",P.css(this[i],"display"))}for(i=0,n=this.length;i<n;i++)this[i].style.display="none";return this},_toggle:P.fn.toggle,toggle:function(e,t){var i="boolean"==typeof e;return P.isFunction(e)&&P.isFunction(t)?this._toggle.apply(this,arguments):null==e||i?this.each(function(){var t=i?e:P(this).is(":hidden");P(this)[t?"show":"hide"]()}):this.animate(T("toggle",3),e,t)},fadeTo:function(t,e,i){return this.animate({opacity:e},t,i)},animate:function(c,t,e,i){var n=P.speed(t,e,i);return this[!1===n.queue?"each":"queue"](function(){var t,r=P.extend({},n),h=1==this.nodeType&&P(this).is(":hidden"),l=this;for(t in c){if("hide"==c[t]&&h||"show"==c[t]&&!h)return r.complete.call(this);"height"!=t&&"width"!=t||!this.style||(r.display=P.css(this,"display"),r.overflow=this.style.overflow)}return null!=r.overflow&&(this.style.overflow="hidden"),r.curAnim=P.extend({},c),P.each(c,function(t,e){var i=new P.fx(l,r,t);if(/toggle|show|hide/.test(e))i["toggle"==e?h?"show":"hide":e](c);else{var n=e.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),o=i.cur(!0)||0;if(n){var s=parseFloat(n[2]),a=n[3]||"px";"px"!=a&&(l.style[t]=(s||1)+a,o=(s||1)/i.cur(!0)*o,l.style[t]=o+a),n[1]&&(s=("-="==n[1]?-1:1)*s+o),i.custom(o,s,a)}else i.custom(o,e,"")}}),!0})},stop:function(t,e){var i=P.timers;return t&&this.queue([]),this.each(function(){for(var t=i.length-1;0<=t;t--)i[t].elem==this&&(e&&i[t](!0),i.splice(t,1))}),e||this.dequeue(),this}}),P.each({slideDown:T("show",1),slideUp:T("hide",1),slideToggle:T("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(t,i){P.fn[t]=function(t,e){return this.animate(i,t,e)}}),P.extend({speed:function(t,e,i){var n="object"==typeof t?t:{complete:i||!i&&e||P.isFunction(t)&&t,duration:t,easing:i&&e||e&&!P.isFunction(e)&&e};return n.duration=P.fx.off?0:"number"==typeof n.duration?n.duration:P.fx.speeds[n.duration]||P.fx.speeds._default,n.old=n.complete,n.complete=function(){!1!==n.queue&&P(this).dequeue(),P.isFunction(n.old)&&n.old.call(this)},n},easing:{linear:function(t,e,i,n){return i+n*t},swing:function(t,e,i,n){return(-Math.cos(t*Math.PI)/2+.5)*n+i}},timers:[],fx:function(t,e,i){this.options=e,this.elem=t,this.prop=i,e.orig||(e.orig={})}}),P.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(P.fx.step[this.prop]||P.fx.step._default)(this),"height"!=this.prop&&"width"!=this.prop||!this.elem.style||(this.elem.style.display="block")},cur:function(t){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var e=parseFloat(P.css(this.elem,this.prop,t));return e&&-1e4<e?e:parseFloat(P.curCSS(this.elem,this.prop))||0},custom:function(t,e,i){this.startTime=y(),this.start=t,this.end=e,this.unit=i||this.unit||"px",this.now=this.start,this.pos=this.state=0;var n=this;function o(t){return n.step(t)}o.elem=this.elem,o()&&P.timers.push(o)&&!M&&(M=setInterval(function(){for(var t=P.timers,e=0;e<t.length;e++)t[e]()||t.splice(e--,1);t.length||(clearInterval(M),M=w)},13))},show:function(){this.options.orig[this.prop]=P.attr(this.elem.style,this.prop),this.options.show=!0,this.custom("width"==this.prop||"height"==this.prop?1:0,this.cur()),P(this.elem).show()},hide:function(){this.options.orig[this.prop]=P.attr(this.elem.style,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e=y();if(t||e>=this.options.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update();var i=this.options.curAnim[this.prop]=!0;for(var n in this.options.curAnim)!0!==this.options.curAnim[n]&&(i=!1);if(i){if(null!=this.options.display&&(this.elem.style.overflow=this.options.overflow,this.elem.style.display=this.options.display,"none"==P.css(this.elem,"display")&&(this.elem.style.display="block")),this.options.hide&&P(this.elem).hide(),this.options.hide||this.options.show)for(var o in this.options.curAnim)P.attr(this.elem.style,o,this.options.orig[o]);this.options.complete.call(this.elem)}return!1}var s=e-this.startTime;return this.state=s/this.options.duration,this.pos=P.easing[this.options.easing||(P.easing.swing?"swing":"linear")](this.state,s,0,1,this.options.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update(),!0}},P.extend(P.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){P.attr(t.elem.style,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=t.now+t.unit:t.elem[t.prop]=t.now}}}),document.documentElement.getBoundingClientRect?P.fn.offset=function(){if(!this[0])return{top:0,left:0};if(this[0]===this[0].ownerDocument.body)return P.offset.bodyOffset(this[0]);var t=this[0].getBoundingClientRect(),e=this[0].ownerDocument,i=e.body,n=e.documentElement,o=n.clientTop||i.clientTop||0,s=n.clientLeft||i.clientLeft||0;return{top:t.top+(self.pageYOffset||P.boxModel&&n.scrollTop||i.scrollTop)-o,left:t.left+(self.pageXOffset||P.boxModel&&n.scrollLeft||i.scrollLeft)-s}}:document.getBoxObjectFor?P.fn.offset=function(){if(this[0]===document)return{top:0,left:0};for(var t=document.getBoxObjectFor(this[0]),e=0,i=0,n=this[0],o=n.ownerDocument,s=o.documentElement,a=o.body,r=o.defaultView.getComputedStyle(n,null);(n=n.parentNode)&&n!==a&&n!==s;)e+=n.scrollTop,i+=n.scrollLeft;return{top:t.y-parseInt(r.borderTopWidth,10)-e,left:t.x-parseInt(r.borderLeftWidth,10)-i}}:P.fn.offset=function(){if(!this[0])return{top:0,left:0};if(this[0]===this[0].ownerDocument.body)return P.offset.bodyOffset(this[0]);P.offset.initialized||P.offset.initialize();for(var t,e=this[0],i=e.offsetParent,n=e.ownerDocument,o=n.documentElement,s=n.body,a=n.defaultView,r=a.getComputedStyle(e,null),h=e.offsetTop,l=e.offsetLeft;(e=e.parentNode)&&e!==s&&e!==o;)t=a.getComputedStyle(e,null),(!St.opera||9.27<St.version||"TR"!=e.tagName&&"TBODY"!=e.tagName)&&(h-=e.scrollTop,l-=e.scrollLeft),e===i&&(h+=e.offsetTop,l+=e.offsetLeft,!P.offset.doesNotAddBorder||P.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(e.tagName)||(h+=parseInt(t.borderTopWidth,10)||0,l+=parseInt(t.borderLeftWidth,10)||0),i,i=e.offsetParent),P.offset.subtractsBorderForOverflowNotVisible&&"visible"!==t.overflow&&(h+=parseInt(t.borderTopWidth,10)||0,l+=parseInt(t.borderLeftWidth,10)||0),r=t;return"relative"!==r.position&&"static"!==r.position||(h+=s.offsetTop,l+=s.offsetLeft),"fixed"===r.position&&(h+=Math.max(o.scrollTop,s.scrollTop),l+=Math.max(o.scrollLeft,s.scrollLeft)),{top:h,left:l}},P.offset={initialize:function(){if(!this.initialized){var t,e,i,n,o,s=document.body,a=document.createElement("div"),r=s.style.marginTop;for(o in n={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"})a.style[o]=n[o];a.innerHTML='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>',s.insertBefore(a,s.firstChild),e=(t=a.firstChild).firstChild,i=t.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==e.offsetTop,this.doesAddBorderForTableAndCells=5===i.offsetTop,t.style.overflow="hidden",t.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,s.style.marginTop="1px",this.doesNotIncludeMarginInBodyOffset=0===s.offsetTop,s.style.marginTop=r,s.removeChild(a),this.initialized=!0}},bodyOffset:function(t){P.offset.initialized||P.offset.initialize();var e=t.offsetTop,i=t.offsetLeft;return P.offset.doesNotIncludeMarginInBodyOffset&&(e+=parseInt(P.curCSS(t,"marginTop",!0),10)||0,i+=parseInt(P.curCSS(t,"marginLeft",!0),10)||0),{top:e,left:i}}},P.fn.extend({position:function(){var t;if(this[0]){var e=this.offsetParent(),i=this.offset(),n=/^body|html$/i.test(e[0].tagName)?{top:0,left:0}:e.offset();i.top-=o(this,"marginTop"),i.left-=o(this,"marginLeft"),n.top+=o(e,"borderTopWidth"),n.left+=o(e,"borderLeftWidth"),t={top:i.top-n.top,left:i.left-n.left}}return t},offsetParent:function(){for(var t=this[0].offsetParent||document.body;t&&!/^body|html$/i.test(t.tagName)&&"static"==P.css(t,"position");)t=t.offsetParent;return P(t)}});var E="number"==typeof g.pageXOffset;P.each(["Left","Top"],function(e,t){var i="scroll"+t;P.fn[i]=function(t){return this[0]?t!==w?this.each(function(){this==g||this==document?g.scrollTo(e?P(g).scrollLeft():t,e?t:P(g).scrollTop()):this[i]=t}):this[0]==g||this[0]==document?E?self[e?"pageYOffset":"pageXOffset"]:P.boxModel&&document.documentElement[i]||document.body[i]:this[0][i]:null}}),P.each(["Height","Width"],function(t,e){var i=e.toLowerCase();P.fn["inner"+e]=function(){return this[0]?P.css(this[0],i,!1,"padding"):null},P.fn["outer"+e]=function(t){return this[0]?P.css(this[0],i,!1,t?"margin":"border"):null};var n=e.toLowerCase();P.fn[n]=function(t){return this[0]==g?St.opera&&g["inner"+e]||"CSS1Compat"==document.compatMode&&document.documentElement["client"+e]||document.body["client"+e]:this[0]==document?Math.max(document.documentElement["client"+e],document.body["scroll"+e],document.documentElement["scroll"+e],document.body["offset"+e],document.documentElement["offset"+e]):t===w?this.length?P.css(this[0],n):null:this.css(n,"string"==typeof t?t:t+"px")}})}(),bt.jQuery.os={name:(/(win|mac|linux|sunos|solaris|iphone)/.exec(navigator.platform.toLowerCase())||["unknown"])[0].replace("sunos","solaris")},bt.jQuery.fn.removeFromDom=function(){return this.each(function(){this&&this.parentNode&&this.parentNode.removeChild(this)})},h=bt.jQuery,l=h.fn.bind,s=h.fn.unbind,a=/keydown|keypress|keyup/g,c={8:"backspace",9:"tab",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",107:"+",109:"-",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scroll",144:"numlock"},u={},h.fn.bind=function(t,e,i){var n;if(n=r(t,e)){n.unhandled&&l.call(this,n.unhandled,e,i);var o=h.isFunction(e),s=o&&e||i,a="string"==typeof e?{shortcut:e}:o?{}:e;return a.__hotkeys__=n,l.call(this,n.handled,a,function(t,e,i){return t.guid||(t.guid=h.event.guid++),u[t.guid]||(u[t.guid]={}),e.guid=u[t.guid][i]=e.guid||u[t.guid][i]||h.event.guid++,e}(s,function(t){!function(t){if(t.data&&t.data.__hotkeys__){var e=t.data.__hotkeys__.parsedData;t.altKey=t.altKey||t.originalEvent.altKey;try{if(e.disableInInput&&t.originalTarget&&t.originalTarget.nodeName){var i=t.originalTarget.nodeName.toLowerCase();if("input"==i||"textarea"==i)return!1}}catch(t){}if((c[t.which]==e.key||String.fromCharCode(t.which).toLowerCase()==e.key)&&function(e,i,t){var n=!0;return h.each(t,function(){var t=this.toString();n=n&&e[t]==i[t]}),n}(e,t,["altKey","ctrlKey","shiftKey"]))return!0}return!1}(t)||s.apply(this,arguments)},n.parsedData.shortcut))}return l.apply(this,arguments)},h.fn.unbind=function(t,e,i){var n;if((n=r(t,e))&&i.guid){n.unhandled&&s.call(this,n.unhandled,e,i);var o=u[i.guid][n.parsedData.shortcut];return s.call(this,n.handled,{guid:o})}return s.apply(this,arguments)},function(i){i.fn.wheel=function(t){return this[t?"bind":"trigger"]("wheel",t)},i.event.special.wheel={setup:function(){i.event.add(this,t,e,{})},teardown:function(){i.event.remove(this,t,e)}};var t=i.browser.mozilla?"DOMMouseScroll"+(i.browser.version<"1.9"?" mousemove":""):"mousewheel";function e(t){var e=t.originalEvent;switch(t.type){case"mousemove":return i.extend(t.data,{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY});case"DOMMouseScroll":i.extend(t,t.data),t.delta=-t.detail/3,void 0!==e.axis&&1==e.axis?(t.deltaX=t.delta,t.deltaY=0):(t.deltaX=0,t.deltaY=t.delta);break;case"mousewheel":t.delta=t.wheelDelta/120,void 0!==e.wheelDeltaX?(t.deltaX=e.wheelDeltaX/120,t.deltaY=e.wheelDeltaY/120):(t.deltaX=0,t.deltaY=t.delta),i.browser.opera&&i.browser.version<"9.2"&&(t.delta*=-1)}return t.type="wheel",i.event.handle.call(this,t,t.delta)}}(bt.jQuery),Ct.loadByRequire&&(t=function(){document.body?bt.jQuery.ready():window.setTimeout(t,10)})();var Mt,xt,wt=bt.Utils=Ct.Utils={},Pt=bt.jQuery,St=wt.browser=Pt.extend({},Pt.browser);St.version=parseFloat(St.version),St.quirksMode="BackCompat"==document.compatMode,St.ieDocumentMode=St.msie&&(document.documentMode||0);var e,Tt=wt.support=Pt.extend({},Pt.support);St.webkit=St.safari,e=window.navigator.userAgent.toLowerCase(),St.chrome=-1!=e.indexOf("chrome"),St.safari=-1!=e.indexOf("safari")&&!St.chrome,St.operaMobile=-1!=e.indexOf("opera mobi"),Tt.android=-1!=e.indexOf("android"),Tt.adobeAIR=-1!=e.indexOf("adobeair"),Tt.touchscreen=(St.safari||-1!=e.indexOf("dolfin"))&&-1!=e.indexOf("mobile")||Tt.android||St.operaMobile;var i,n,o,d,p,_,f,m,v,g,y,Et=wt.UNDEF="undefined",Lt=wt.extend=function(t,e){function i(){}return(i.prototype=e.prototype).constructor=e,t.prototype=new i},Ot=wt.bindContext=function(t,e){return function(){return t.apply(e,arguments)}},It=wt.callMethod=function(t,e){t=t instanceof Array?t:[t];for(var i,n=Array.prototype.slice.call(arguments,2),o=0,s=t.length;o<s;o++)(i=t[o])[e].apply(i,n)};function b(){this.originalEvent.preventDefault()}function C(){this.originalEvent.stopPropagation()}wt.NULL=function(){return null},wt.boundaryRestrict=function(t,e,i){return typeof t==Et||typeof e==Et||null==e||typeof i==Et||null==i?NaN:Math.max(Math.min(t,i),e)},wt.cycleRestrict=function(t,e,i){return typeof t==Et||typeof e==Et||null==e||typeof i==Et||null==i?NaN:t==Number.POSITIVE_INFINITY?i:t==Number.NEGATIVE_INFINITY?e:t-Math.floor((t-e)/(i-e))*(i-e)},wt.normalizeContent=function(t){return""===t||null===t||typeof t==Et||9==t.nodeType?null:3==t.nodeType||1==t.nodeType?new Ct.DOMLayout(null,null,t):"object"==typeof t?t:new Ct.TextLayout(null,null,t,0)},wt.size=function(t,e,i){if(typeof e==Et){var n=Pt(t);return new bt.Size(n.width(),n.height())}var o,s;s=e instanceof Bt?(o=e.x,e.y):(o=e,typeof i==Et?e:i),t.style.width=o+"px",t.style.height=s+"px"},wt.position=function(t,e,i){if(typeof e==Et)return new Bt(t.offsetLeft,t.offsetTop);if(e instanceof Bt)var n=e.x,o=e.y;else n=e,o=typeof i==Et?e:i;t.style.left=n+"px",t.style.top=o+"px"},wt.sign=function(t){var e=Number(t);return e<0?-1:0<e?1:0},wt.fixIESize=function(t,e,i){t.css(e,t.parent().eq(0)["top"==e||"bottom"==e?"height":"width"]()%2?i[0]+"px":i[1]+"px")},wt.imagesOnLoad=function(t,o,s){for(var e=Pt("img",t),a=0,r=0,i=0,n=e.length;i<n;i++)!function(e,i){var n=function(t){Pt(i).css({visibility:""}),At(e).events.remove(["load","error"],n),a--,o&&o(i),0==a&&s&&s(r)};i.src&&(Pt(i).css({visibility:"hidden"}),At(e).events.add(["load","error"],n),e.src=i.src,a++)}(document.createElement("img"),e[i]);0==(r=a)&&s&&window.setTimeout(function(){s(r)},0)},wt.touchEventFix=function(t,e,i){if(typeof t.fixedTouch!=Et)return t;var n=Pt.extend({},t.originalEvent||t),o=i?i.originalEvent||i:n,s=o.touches[0],a=o.touches[1];return n.preventDefault=b,n.stopPropagation=C,n.which=n.button=1,n.originalEvent=t,n.fixedTouch=!0,e&&"none"==e||Pt.each(["clientX","clientY","pageX","pageY","screenX","screenY"],function(){var t=this.toString();n[t]="average"==e&&a?(s[t]+a[t])/2:s[t]}),n},i=0,Pt.extend(wt,{uniqueIdField:"YMaps__id"+((new Date).getTime()+Math.round(1e4*Math.random())),windowId:"YMaps__id"+i,generateId:function(){return"YMaps__id"+ ++i},generateUniqueId:function(){return"YMaps__id"+((new Date).getTime()+Math.round(1e4*Math.random()))},getUniqueId:function(t){return t===window?this.windowId:t[this.uniqueIdField]||this.setUniqueId(t)},setUniqueId:function(t,e){return typeof e==Et&&(e=wt.generateId()),t[this.uniqueIdField]=e}}),n=new function(){var s,a,n,i,o,r,h,l=St.mozilla&&St.version<1.9||St.opera&&St.version<9.2,c=[];function u(t){i&&i!=t&&e(),(i=t)&&(i.setCapture(),i.attachEvent("onlosecapture",v))}function e(){i&&(i.detachEvent("onlosecapture",v),i.releaseCapture(),i=null)}function d(t,e){St.msie&&St.ieDocumentMode<9?i.attachEvent("on"+t,e):document.addEventListener(t,e,!0)}function t(t,e){St.msie&&St.ieDocumentMode<9?i.detachEvent("on"+t,e):document.removeEventListener(t,e,!0)}function p(t,e){return e?3!=t.which||St.safari&&"mac"==Pt.os.name?0:1:1==t[St.msie&&St.ieDocumentMode<9?"button":"which"]?1:0}function _(){l&&At(document).events.remove("mouseout",v),o?(t("click",b),t("mousemove",C),t("mousedown",C)):Tt.touchscreen?(t("touchmove",m),t("touchend",y),t("touchcancel",y)):(t("mousemove",m),t("mouseup",y)),St.msie&&St.ieDocumentMode<9&&e()}function f(t,e){var i=e.getEvent();!s&&p(i,t.byRightButton())&&(e.preventMapEvent(),o=a=0,s=t,n=St.mozilla?i.originalEvent.explicitOriginalTarget:i.target,St.msie&&St.ieDocumentMode<9&&u(s.getElement()),l&&At(document).events.add("mouseout",v),Tt.touchscreen?(d("touchmove",m),d("touchend",y),d("touchcancel",y)):(d("mousemove",m),d("mouseup",y)),i.preventDefault(),h=r=i,Rt.notify(s,"start",i))}function m(t){if(!(Tt.touchscreen&&1<t.touches.length)){var e=Tt.touchscreen?wt.touchEventFix(t):Pt.event.fix(t),i=s.getTremor();if(Ct.preventMapEvent(e,"mousemove"),e.preventDefault(),r=e,!a){var n=typeof i.offset!=Et,o=typeof i.time!=Et;n||o?(n&&(Math.abs(h.clientX-e.clientX)>i.offset||Math.abs(h.clientY-e.clientY)>i.offset)&&(a=1),o&&e.timeStamp-h.timeStamp>i.time&&(a=1)):a=1}a&&Rt.notify(s,"move",e)}}function v(t){var e=Pt.event.fix(t);!function(t){return"losecapture"==t.type?1:"mouseout"==t.type?t.relatedTarget?0:1:0}(e)||g(e)}function g(t){_();var e=s;s=null,Rt.notify(e,"stop",Tt.touchscreen?r:t)}function y(t){var e=Tt.touchscreen?wt.touchEventFix(t,"first",r):Pt.event.fix(t);s&&p(e,s.byRightButton())&&(g(e),a&&(Ct.preventMapEvent(e,"mouseup"),e.preventDefault(),Tt.touchscreen||!p(e)||!St.msie&&n!=(St.mozilla?t.explicitOriginalTarget:e.target)||(o=1,St.msie&&St.ieDocumentMode<9&&u(document.body),d("click",b),d("mousemove",C),d("mousedown",C))))}function b(t){Pt.event.fix(t).stopPropagation(),_()}function C(){_()}this.add=function(i){if(-1==Pt.inArray(i,c)){var t=i.getMap();c.push(i),i.listener=t?bt.Events.observe(t,t.Events.MouseDown,function(t,e){f(i,e)}):At(i.getElement()).events.eventListener().add("mousedown",function(t){var e=new bt.MouseEvent(t,this._map);e.isMapEventPrevented()||f(i,e)})}},this.remove=function(t){var e=Pt.inArray(t,c);-1!=e&&(s==t&&g(r),t.listener.cleanup?t.listener.cleanup():t.listener.removeAll(),c.splice(e,1))},this.abort=function(t){s==t&&(_(),s=null,a=0)}},wt.DragAndDrop={},wt.DragAndDrop.MouseMove=function(t,e,i,n){this._element=t,this._byRightButton=e,this._tremor=i||{},this._map=n,this._id=wt.generateUniqueId()},wt.DragAndDrop.MouseMove.prototype={getElement:function(){return this._element},getId:function(){return this._id},byRightButton:function(){return this._byRightButton},getTremor:function(){return this._tremor},getMap:function(){return this._map},beginListening:function(){n.add(this)},stopListening:function(){n.remove(this)},abort:function(){n.abort(this)}},(wt.ObjectStorage=function(){this._objects={}}).prototype={add:function(t,e){this._objects[t]=e},get:function(t){return"object"!=typeof t||t instanceof String?this._objects[t]:t},remove:function(t){var e=this.get(t);return delete this._objects[t],e}},bt.dataDispatcher={storage:{},add:function(t,e,i){var n="string"==typeof t?t:wt.getUniqueId(t),o=this.storage[n]||(this.storage[n]={list:{},count:0});o.list[e]||o.count++,o.list[e]=i},get:function(t,e){var i="string"==typeof t?t:wt.getUniqueId(t),n=this.storage[i];return n&&n.list[e]},remove:function(t,e){var i="string"==typeof t?t:wt.getUniqueId(t),n=this.storage[i];n&&n.list[e]&&(delete n.list[e],--n.count||delete this.storage[i])}},o=bt.dataDispatcher,Mt=bt.DataManager=function(t){this.object=t},(xt=Mt.prototype).add=function(t,e){return o.add(this.object,t,e),this},xt.get=function(t){return o.get(this.object,t)},xt.remove=function(t){return o.remove(this.object,t),this},function(){Mt=bt.EventManager=function(t){this.object=t,this.types={},this.typesCount=0};var d=(xt=Mt.prototype).getListenerId=function(t,e){return wt.getUniqueId(t)+wt.getUniqueId(e||window)};xt.add=function(t,e,i){for(var n=this.types,o="string"==typeof t?[t]:t,s=d(e,i),a=0,r=o.length;a<r;a++){var h=o[a],l=n[h],c=!1;if(l||(l=n[h]={first:null,last:null,list:{}},this.typesCount++,c=!0),!l.list[s]){var u={callback:e,context:i||window,next:null,prev:l.last};l.last?l.last.next=u:l.first=u,l.last=l.list[s]=u}c&&this.onStartListening(h)}return this},xt.remove=function(t,e,i){for(var n="string"==typeof e?e:d(e,i),o="string"==typeof t?[t]:t,s=this.types,a=0,r=o.length;a<r;a++){var h=o[a],l=s[h];if(l&&l.list[n]){var c=l.list[n];c.deleted=!0,c.prev?c.prev.next=c.next:l.first==c&&(l.first=c.next),c.next?c.next.prev=c.prev:l.last==c&&(l.last=c.prev),delete l.list[n],l.last||(delete s[h],this.typesCount--,this.onStopListening(h))}}return this},xt.onStartListening=function(t){this.fire("startlistening",t)},xt.onStopListening=function(t){this.fire("stoplistening",t)},xt.removeAll=function(){var t=this.types;for(var e in t)t.hasOwnProperty(e)&&(delete t[e],this.typesCount--,this.onStopListening(e));return this};var s=Array.prototype.slice;xt.fire=function(t){for(var e=this.types,i=e&&e[t],n=i&&i.first,o=s.call(arguments,1);n;)if(n.callback.apply(n.context,o),n.deleted){for(;n&&n.deleted;)n=n.prev;n=n?n.next:i.first}else n=n.next;return this},xt.eventListener=function(){return new bt.EventListener(this)}}(),Mt=bt.EventListener=function(t){this.events=t,this.types={}},(xt=Mt.prototype).add=function(t,e,i){for(var n="string"==typeof t?[t]:t,o=this.events,s=o.getListenerId(e,i),a=0,r=n.length;a<r;a++){var h=n[a],l=this.types[h]||(this.types[h]={count:0,listeners:{}});l.listeners[s]||(l.listeners[s]=!0,l.count++,o.add(h,e,i))}return this},xt.remove=function(t,e,i){for(var n="string"==typeof t?[t]:t,o=this.events,s=o.getListenerId(e,i),a=0,r=n.length;a<r;a++){var h=n[a],l=this.types[h];l&&l.listeners[s]&&(delete l.listeners[s],--l.count||delete this.types[h],o.remove(h,e,i))}return this},xt.removeAll=function(){var t=this.events;for(var e in this.types)if(this.types.hasOwnProperty(e)){var i=this.types[e].listeners;for(var n in i)i.hasOwnProperty(n)&&t.remove(e,n)}return this.types={},this},function(){function i(t){var e=Pt.event.fix(t);o?s.get(this.window||this,a).fire(e.type,e):s.get(this,a).fire(e.type,e)}var n=Array.prototype.slice,s=bt.dataDispatcher,a="events",r="ieHandler",o=St.msie&&9<=St.ieDocumentMode,e=bt.domDispatcher={override:{startlistening:{start:wt.NULL,stop:wt.NULL},stoplistening:{start:wt.NULL,stop:wt.NULL}},add:function(t,e,i,n){var o=s.get(t,a);return o||(o=new h(t),s.add(t,a,o),St.msie&&St.ieDocumentMode<9&&s.add(t,r,function(i){return function(t){var e=Pt.event.fix(t);s.get(i,a).fire(e.type,e)}}(wt.getUniqueId(t)))),o.add(e,i,n),this},remove:function(t,e,i,n){var o=s.get(t,a);return o&&o.remove(e,i,n),this},removeAll:function(t){var e=s.get(t,a);return e&&e.removeAll(),this},fire:function(t){var e=s.get(t,a);if(e){var i=n.call(arguments,1);e.fire.apply(e,i)}return this},startListening:function(t,e){this.override[e]?this.override[e].start(t):St.msie&&St.ieDocumentMode<9?t.object.attachEvent("on"+e,s.get(t.object,r)):t.object.addEventListener(e,i,!1)},stopListening:function(t,e){this.override[e]?this.override[e].stop(t):St.msie&&St.ieDocumentMode<9?t.object.detachEvent("on"+e,s.get(t.object,r)):t.object.removeEventListener(e,i,!1),t.typesCount||(s.remove(t.object,a),St.msie&&St.ieDocumentMode<9&&s.remove(t.object,r))}},h=function(t){bt.EventManager.call(this,t)};xt=Lt(h,bt.EventManager);var l=bt.EventManager.prototype;xt.onStartListening=function(t){e.startListening(this,t),l.onStartListening.call(this,t)},xt.onStopListening=function(t){l.onStopListening.call(this,t),e.stopListening(this,t)}}(),d=bt.domDispatcher,Mt=bt.DomEventManager=function(t){this.object=t},(xt=Mt.prototype).add=function(t,e,i){return d.add(this.object,t,e,i),this},xt.remove=function(t,e,i){return d.remove(this.object,t,e,i),this},xt.removeAll=function(){return d.removeAll(this.object),this},xt.fire=function(){var t=[this.object].concat(arguments);d.fire.apply(d,t)},xt.getListenerId=bt.EventManager.prototype.getListenerId,xt.eventListener=function(){return new bt.EventListener(this)},Tt.touchscreen||(p=St.mozilla&&St.version<1.9,_=null,f=["clientX","clientY","pageX","pageY","screenX","screenY"],m=St.mozilla?"DOMMouseScroll":"mousewheel",v="wheelHandler",g=function(t,e){var i=e.originalEvent;if("mousemove"==i.type)_=e;else{var n=Pt.extend({},e);St.opera&&St.version<9.2&&(n.delta*=-1),"DOMMouseScroll"==i.type?(n.delta=-n.detail/3,void 0!==i.axis&&1==i.axis?(n.deltaX=i.delta,n.deltaY=0):(n.deltaX=0,n.deltaY=n.delta),p&&_&&Pt.each(f,function(t,e){n[e]=_[e]})):"mousewheel"==i.type&&(n.delta=n.wheelDelta/120,typeof i.wheelDeltaX!=Et?(n.deltaX=i.wheelDeltaX/120,n.deltaY=i.wheelDeltaY/120):(n.deltaX=0,n.deltaY=n.delta)),n.type="wheel",t.fire("wheel",n)}},bt.domDispatcher.override.wheel={start:function(e){function t(t){g(e,t)}e.add(p?[m,"mousemove"]:m,t),bt.dataDispatcher.add(e.object,v,t)},stop:function(t){wt.getUniqueId(t.object),t.remove(p?[m,"mousemove"]:m,bt.dataDispatcher.get(t.object,v)),bt.dataDispatcher.remove(t.object,v)}}),Tt.touchscreen||(y={start:function(e,i,t){function n(t){y.fire(e,i,t)}bt.dataDispatcher.add(e.object,i+"Handler",n),e.add(t,n)},stop:function(t,e,i){t.remove(i,bt.dataDispatcher.get(t.object,e+"Handler")),bt.dataDispatcher.remove(t.object,e+"Handler")},fire:function(t,e,i){for(var n=i.relatedTarget,o=t.object;n&&n!=o;)try{n=n.parentNode}catch(t){n=o}if(n!=o){var s=Pt.extend({},i);s.type=e,t.fire(e,s)}}},bt.domDispatcher.override.mouseenter={start:function(t){y.start(t,"mouseenter","mouseover")},stop:function(t){y.stop(t,"mouseenter","mouseover")}},bt.domDispatcher.override.mouseleave={start:function(t){y.start(t,"mouseleave","mouseout")},stop:function(t){y.stop(t,"mouseleave","mouseout")}}),Tt.touchscreen&&function(){function t(e){bt.domDispatcher.override[e]={start:function(t){i(t,e)},stop:function(t){o(t,e)}}}for(var e=["mouseenter","mousemove","mouseleave","mousedown","mouseup","click","dblclick","contextmenu","wheel","multitouchstart","multitouchmove","multitouchend"],n="touchData",i=function(t,e){var i=bt.dataDispatcher.get(t.object,n);i||(i={types:{},count:0,touchMapper:new bt.TouchMapper(t)},bt.dataDispatcher.add(t.object,n,i)),i.types[e]||(i.count||i.touchMapper.start(),i.types[e]=!0,i.count++)},o=function(t,e){var i=bt.dataDispatcher.get(t.object,n);i&&i.types[e]&&(delete i.types[e],--i.count||(i.touchMapper.stop(),bt.dataDispatcher.remove(t.object,n)))},s=0,a=e.length;s<a;s++)t(e[s])}(),Mt=bt.TouchMapper=function(t){this.events=t,this.__state={started:0,moved:0,multitouch:0},this.__initialZoomDistance=0},(xt=Mt.prototype).start=function(){this.__state={started:0,moved:0,multitouch:0},this.__listener=this.events.eventListener().add("touchstart",this.__onTouchStart,this).add("touchmove",this.__onTouchMove,this).add(["touchend","touchcancel"],this.__onTouchEnd,this)},xt.stop=function(){this.__listener.removeAll(),this.__state.started&&this.__actionEnd(wt.touchEventFix(this.__state.moved?this.__lastTouchMove:this.__initTouch),+new Date),this.__state.started=0,this.__state.multitouch=0,this.__state.moved=0},xt.__onTouchStart=function(t){var e=t.originalEvent;this.__state.started||1!=e.touches.length||(this.__state.started=1,this.__initTouch=e,this.__actionBegin(wt.touchEventFix(e))),1<e.touches.length&&!this.__state.multitouch&&(this.__initialZoomDistance=this.__getZoomDistance(e),this.__state.multitouch=1,this.__notify("multitouchstart",wt.touchEventFix(e,"none")))},xt.__getZoomDistance=function(t){var e=t.touches[0].clientX,i=t.touches[0].clientY,n=e-t.touches[1].clientX,o=i-t.touches[1].clientY;return Math.sqrt(n*n+o*o)},xt.__onTouchMove=function(t){var e=t.originalEvent;if(1==(this.__lastTouchMove=e).touches.length)this.__state.started||this.__onTouchStart(t),this.__state.moved||(this.__state.moved=1),this.__notify("mousemove",wt.touchEventFix(e));else{this.__state.multitouch=1,this.__notify("multitouchmove",wt.touchEventFix(e,"none"));var i=this.__getZoomDistance(e),n=i/(this.__initialZoomDistance||1),o=(1<n?1:-1)*Math.floor(Math.abs(Math.log(n)/Math.log(2)));if(0!=o){var s=wt.touchEventFix(e,"average");s.delta=s.deltaY=o,s.deltaX=0,this.__notify("wheel",s),this.__initialZoomDistance=i}}},xt.__actionBegin=function(t){this.__notify("mouseenter",t),this.__notify("mousemove",t),this.__notify("mousedown",t)},xt.__onTouchEnd=function(t){var e=t.originalEvent;this.__state.started&&this.__actionEnd(wt.touchEventFix(e,"average",this.__state.moved?this.__lastTouchMove:this.__initTouch),e.timeStamp),this.__state.multitouch&&this.__notify("multitouchend",wt.touchEventFix(e,"none")),this.__state.started=0,this.__state.multitouch=0,this.__state.moved=0},xt.__actionEnd=function(t,e){var i=Ct.isMapEventPrevented(t,"mouseup");this.__notify("mouseup",t),i||this.__state.multitouch||(e-this.__initTouch.timeStamp>kt.touch.contextMenuTimeout&&!this.__state.moved?(this.__notify("contextmenu",t),this.__lastClickTimestamp=null):this.__lastClickTimestamp&&e-this.__lastClickTimestamp<kt.dblClickTimeout?(this.__notify("click",t),this.__notify("dblclick",t),this.__lastClickTimestamp=null):(this.__notify("click",t),this.__lastClickTimestamp=e)),this.__notify("mouseleave",t)},xt.__notify=function(t,e){e.type=t,this.events.fire(t,e)};var At=bt.dom=function(t){return{events:new bt.DomEventManager(t),data:new bt.DataManager(t)}},kt=bt.Constants={copyrights:{agreement:" ",agreementLink:"http://maps.yandex.ru/agreement.xml",logoLink:"http://maps.yandex.ru",addStateToLogoLink:!0},metric:{millimetre:"",centimetre:"",metre:"",kilometre:"",days:".",day:".",hours:".",minutes:".",seconds:"."},types:{MAP:"",SATELLITE:"",HYBRID:""},tremor:{draggingControl:{offset:5,time:300},placemark:{offset:5,time:300},graphicsEditor:{offset:5,time:300}},dblClickTimeout:500,touch:{contextMenuTimeout:400},hints:{miniMap:{show:"  ",hide:"  "},ruler:{close:" ",sure:"  ? \n\n(    \n    )"},toolBar:{move:" ",magnifier:"",ruler:"   "},balloon:{close:""},zoom:[{index:2,value:""},{index:5,value:""},{index:9,value:""},{index:13,value:""},{index:16,value:""}],loading:{timeout:"     "},searchControl:{mapSearch:"  ",find:"",wait:"   ...",notFound:"     ",clear:"",quantity:[{found:"",objects:""},{found:"",objects:""},{found:"",objects:""}],correction:"       .  ",previous:["",""],next:["",""],noname:" "},typeControl:{more:""},graphicsEditor:{deleteVertex:"",startDrawing:"",stopDrawing:"",removeInterior:" ",addInterior:"  "}}};kt.imageRoot=Ct.versionPath+"i/0.4/",kt.images={transparentImage:kt.imageRoot+"zero.gif",toolBar:{iconSprite:kt.imageRoot+"icons/icon-hand-ruler-zoom.png"}},kt.cursors={arrow:{class:"YMaps-cursor-default",cursor:"default"},crosshair:{class:"YMaps-cursor-crosshair",cursor:"crosshair"},grab:{class:"YMaps-cursor-grab",cursor:"url("+kt.imageRoot+"cursors/grab.png) 16 16, url("+kt.imageRoot+"cursors/grab.png), move"},grabbing:{class:"YMaps-cursor-grabbing",cursor:"url("+kt.imageRoot+"cursors/grabbing.png) 16 16, url("+kt.imageRoot+"cursors/grabbing.png), move"},help:{class:"YMaps-cursor-help",cursor:"url("+kt.imageRoot+"cursors/help.png), help"},move:{class:"YMaps-cursor-move",cursor:"move"},pointer:{class:"YMaps-cursor-pointer",cursor:"pointer"},zoom:{class:"YMaps-cursor-zoom",cursor:"url("+kt.imageRoot+"cursors/zoom_in.png) 6 6, url("+kt.imageRoot+"cursors/zoom_in.png), crosshair"},inherit:{class:"YMaps-cursor-inherit",cursor:"inherit"}},bt.State={EMPTY:"Empty",LOADING:"Loading",SUCCESS:"Success",FAILURE:"Failure"},bt.ZIndex={POLYGON:10,POLYLINE:20,MAP_LAYER:5,LAYER_CONTAINER:1,COMMON_OBJECT_LAYER:50,OVERLAY_SHADOW:100,OVERLAY:110,OVERLAY_HOVER:120,OVERLAY_DRAG:130,EDITOR_GLASS_PANE:150,EDITOR_EDGE_MARKER:160,EDITOR_VERTEX_MARKER:170,BALLOON:200,OVERLAY_ACTIVE:210,CONTROL:1e3,POPUP:1001},bt.Cursor={ARROW:"arrow",CROSSHAIR:"crosshair",GRAB:"grab",GRABBING:"grabbing",HELP:"help",MOVE:"move",POINTER:"pointer",ZOOM:"zoom",INHERIT:"inherit"},bt.TILE_SIZE=256,bt.GraphicsEditingMenuIDs={Delete:"Delete",StartDrawing:"StartDrawing",StopDrawing:"StopDrawing",AddInterior:"AddInterior",RemoveInterior:"RemoveInterior"},kt.MapDOMEvents=["click","dblclick","contextmenu","mouseup","mousedown","mousemove","wheel"],kt.MapMultiTouchEvents=["multitouchstart","multitouchmove","multitouchend"],bt.Interactivity={NONE:0,STATIC:-1,INTERACTIVE:1},function(){var l=kt.metric;bt.humanDistance=function(t,e){for(var i=e?r:a,n=i.length-1,o=0,s=n;o<s;o++)if(t<i[o+1][0]){n=o;break}return n=i[n],t=Math.round(t/n[1])*n[1],t/=n[2],t=Number(t.toFixed(n[3])),String(t).replace(".",",")+"&#160;"+n[4]};var t=l.metre,e=l.kilometre,a=[[0,1,1,0,t],[5e-5,1e-4,.001,1,l.millimetre],[.02,.001,.01,1,l.centimetre],[.2,.01,1,2,t],[2,.1,1,1,t],[20,1,1,0,t],[1e3,1,1e3,3,e],[2e3,10,1e3,2,e],[7e3,100,1e3,1,e],[5e4,1e3,1e3,0,e]],r=[[0,1,1,0,t],[10,10,1,0,t],[100,50,1,0,t],[1e3,100,1e3,1,e],[3e3,1e3,1e3,0,e]];bt.humanDuration=function(t){for(var e,i=[1,60,3600,86400],n=[60,60,24,0],o=[l.seconds,l.minutes,l.hours,l.days],s=[0,0,0,0],a=[],r=3,h=t;h&&0<=r;r--)e=Math.floor(t/i[r]),h=t%i[r],20<=e&&(e+=.5<=h/i[r]?1:0,h=0),e==n[r]&&n[r]?s[r+1]++:s[r]=e,t=h;for(r=0;r<=3;r++)s[r]&&(1==s[r]&&3==r&&(o[r]=l.day),a.unshift(s[r]+"&#160;"+o[r]));return a.length||a.unshift("0&#160;"+o[0]),a.join("&#160;")},Ct.statCount=function(t){t.share&&!Ct.counterShare||Pt.ajax({url:[Ct.statCounter+"jclck/dtype=stred","/pid="+t.pid,"/cid="+t.cid,"/path="+t.path,"/rnd="+((new Date).getTime()+Math.round(100*Math.random())),"/*"+Ct.mapsUrl].join(""),cache:!0,type:"GET",dataType:"script"})};try{parent&&parent.WebUI&&Ct.statCount({pid:443,cid:72959,path:"intranet.1C.1_1"})}catch(t){}Ct.checkVisibility=function(t){try{if(document.elementFromPoint&&t.getBoundingClientRect){var e=t.getBoundingClientRect(),i=document.elementFromPoint(Math.round((e.left+e.right)/2),Math.round((e.top+e.bottom)/2));if(null===i)return"invisible";for(;i&&i!=t;)i=i.parentNode?i.parentNode:null;return i?"visible":"blocked"}return"unable"}catch(t){return"unable"}}}(),Ct.MathLib={ortho:function(t,e){function n(t,e){return Dt.getCoordPoint(t*o,e*o,s)}var i=[t],o=180/Math.PI,s=t.isUnbounded()&&e.isUnbounded(),a=t.getX()/o,r=t.getY()/o,h=(e.isUnbounded()?e.getX():wt.cycleRestrict(e.getX(),t.getX()-180,t.getX()+180))/o,l=e.getY()/o,c=h-a,u=Math.round(Math.abs(c)/Math.PI),d=Math.sin(c);if(1e-8<Math.abs(d)&&Math.cos(c)<1-1e-8)for(var p=Math.sin(r),_=Math.cos(r),f=Math.sin(l),m=Math.cos(l),v=Math.ceil(50*(2*Math.floor(u/2)*Math.PI+Math.acos(p*f+_*m*Math.cos(c))))||1,g=c/v,y=1;y<v;y++){var b=a+g*y,C=-Math.atan((p*m*Math.sin(b-h)-f*_*Math.sin(b-a))/(_*m*d));i.push(n(b,C))}else{function M(t,e,i){return[n(t,e),n(t,i)]}var x=0<Math.cos(c)?wt.sign(l-r):wt.sign(r+l),w=wt.sign(c);if(Math.abs(x)<1e-8&&(x=1),u){var P=x*Math.PI/2;i=M(a,r,P);for(y=1;y<u;y++)i.push(n(a+Math.PI*(y-.5)*w,P)),Pt.merge(i,M(a+Math.PI*y*w,P,-P)),P=-P;i.push(n(h-.5*Math.PI*w,P),n(h,P))}}return i.push(e),i},intervalsIntersect:function(t,e,i,n){if(e<t){var o=t;t=e,e=o}if(n<i){o=i;i=n,n=o}return n<t||e<i?0:1},sectorsIntersect:function(t,e,i,n){return t=wt.cycleRestrict(t,0,360),e=wt.cycleRestrict(e,t,t+360),i=wt.cycleRestrict(i,e,e-360),n=wt.cycleRestrict(n,i,i+360),Ct.MathLib.intervalsIntersect(t,e,i,n)}};var Bt=bt.Point=function(t,e){this.x=("number"==typeof t?t:Number(t))||0,this.y=typeof e==Et?this.x:("number"==typeof e?e:Number(e))||0};Bt.fromString=function(t){return t=t.split(","),new Bt(t[0],t[1])},Bt.prototype={getX:function(){return this.x},getY:function(){return this.y},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},toString:function(t){return typeof t==Et||isNaN(parseInt(t))?this.x+","+this.y:Number(this.x.toFixed(t))+","+Number(this.y.toFixed(t))},copy:function(){return new this.constructor(this.x,this.y)},moveToX:function(t){return this.x=t,this},moveToY:function(t){return this.y=t,this},moveTo:function(t){return this.x=t.x,this.y=t.y,this},moveByX:function(t){return this.x+=t,this},moveByY:function(t){return this.y+=t,this},moveBy:function(t){return this.x+=t.x,this.y+=t.y,this},diff:function(t){return new this.constructor(t.x-this.x,t.y-this.y)},equals:function(t){return this.x==t.x&&this.y==t.y},scale:function(t){var e=typeof t.x!=Et&&typeof t.y!=Et;return this.x*=e?t.x:t,this.y*=e?t.y:t,this},scaleX:function(t){return this.x*=t,this},scaleY:function(t){return this.y*=t,this},apply:function(t){return this.x=t(this.x),this.y=t(this.y),this},applyX:function(t){return this.x=t(this.x),this},applyY:function(t){return this.y=t(this.y),this},neg:function(){return new this.constructor(-this.x,-this.y)},distance:function(t){var e=this.diff(t);return Math.sqrt(e.x*e.x+e.y*e.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},angle:function(){return Math.acos(this.x/this.length())}},Bt.prototype.constructor=Bt,bt.Size=Bt,bt.GeoPoint=function(t,e,i){this._unbounded=i||0,this.setX(("number"==typeof t?t:Number(t))||0),this.setY(("number"==typeof e?e:Number(e))||0)},xt=bt.GeoPoint.prototype,bt.GeoPoint.fromString=function(t){return t=t.split(","),new bt.GeoPoint(t[0],t[1])},xt.toString=function(t){return t=typeof t!=Et?t:6,Number(this.getX().toFixed(t))+","+Number(this.getY().toFixed(t))},xt.isUnbounded=function(){return this._unbounded},xt.setLng=function(t){return this.__lng=this._unbounded?t:wt.cycleRestrict(t,-180,180),this},xt.setX=xt.setLng,xt.getLng=function(){return this.__lng},xt.getX=xt.getLng,xt.setLat=function(t){return this.__lat=this._unbounded?t:wt.boundaryRestrict(t,-90,90),this},xt.setY=xt.setLat,xt.getLat=function(){return this.__lat},xt.getY=xt.getLat,xt.moveTo=function(t){return this.setX(t.getX()),this.setY(t.getY()),this},xt.copy=function(){return new bt.GeoPoint(this.getX(),this.getY(),this._unbounded)},xt.diff=function(t){var e=t.getX()-this.getX();if(!t._unbounded){var i=Math.round(e/360);i&&(e-=360*i)}return new Bt(e,t.getY()-this.getY())},xt.moveBy=function(t){return this.setX(this.getX()+t.getX()),this.setY(this.getY()+t.getY()),this},xt.distance=function(t){return Dt.distance(this,t)},xt.equals=function(t){return Math.abs(t.getX()-this.getX())<2e-7&&Math.abs(t.getY()-this.getY())<2e-7&&t.isUnbounded()==this.isUnbounded()},(Mt=bt.Bounds=function(t,e){this._left=t.x,this._right=e.x,this._top=e.y,this._bottom=t.y}).prototype={_getResultPoint:function(t,e){return new Bt(t,e)},_getDirection:function(t){return this.getLeftBottom().diff(t||this.getRightTop())},getTop:function(){return this._top},getRight:function(){return this._right},getBottom:function(){return this._bottom},getLeft:function(){return this._left},equals:function(t){return this.getLeftBottom().equals(t.getLeftBottom())&&this.getRightTop().equals(t.getRightTop())},getLeftTop:function(){return this._getResultPoint(this._left,this._top)},getRightTop:function(){return this._getResultPoint(this._right,this._top)},getRightBottom:function(){return this._getResultPoint(this._right,this._bottom)},getLeftBottom:function(){return this._getResultPoint(this._left,this._bottom)},getCenter:function(){return this._getResultPoint((this._left+this._right)/2,(this._top+this._bottom)/2)},getSpan:function(){return this._getDirection().apply(Math.abs)},contains:function(t){var e=this._getDirection(),i=this._getDirection(t);return i.getX()>=Math.min(0,e.getX())&&i.getX()<=Math.max(0,e.getX())&&i.getY()>=Math.min(0,e.getY())&&i.getY()<=Math.max(0,e.getY())},copy:function(){return new this.constructor(this.getLeftBottom(),this.getRightTop())},getMapZoom:function(t){var e=0,i=t.coordSystem,n=i.getCoordPoint(this._left,this._bottom,1),o=n.copy().moveBy(this._getDirection()),s=i.fromCoordPoint(n).diff(i.fromCoordPoint(o)).apply(Math.abs),a=t._state.size.x,r=s.x;for(r/a<s.y/t._state.size.y&&(r=s.y,a=t._state.size.y);a<r;)r=Math.floor(r/2),e++;return Math.max(i.getMaxZoom()-e,0)},intersects:function(t){return Ct.MathLib.intervalsIntersect(this.getLeft(),this.getRight(),t.getLeft(),t.getRight())&&Ct.MathLib.intervalsIntersect(this.getBottom(),this.getTop(),t.getBottom(),t.getTop())}},Mt=bt.GeoBounds=function(t,e){this._left=t.getX(),this._right=e.getX(),this._top=e.getY(),this._bottom=t.getY(),this._isResultUnbounded=t.isUnbounded()&&e.isUnbounded()},xt=Lt(Mt,bt.Bounds),Mt.fromCenterAndSpan=function(t,e){var i=Dt._radius,n=Math.PI,o=Dt._epsilon,s=Math.min(Math.max(t.getY()*n/180,-n/2+o),n/2-o),a=Math.max(Math.min(e.y,180),0),r=a*n/180,h=i*Math.log(Math.tan(s/2+n/4)),l=Math.exp(2*h/i),c=(l+1)*Math.tan(Math.min(Math.max(r/2,-n/2+o),n/2-o)),u=-l,d=Math.max(c*c-4*u,0),p=(-c+Math.sqrt(d))/2*1,_=2*(Math.atan(p)-n/4)*180/n,f=t.isUnbounded()?e.x/2:Math.min(e.x/2,180-o);return new bt.GeoBounds(new bt.GeoPoint(t.getX()-f,_,t.isUnbounded()),new bt.GeoPoint(t.getX()+f,_+a,t.isUnbounded()))},xt._getResultPoint=function(t,e){return new bt.GeoPoint(t,e,this._isResultUnbounded)},xt._getDirection=function(t){var e=(t=t||this.getRightTop()).isUnbounded()?t.getX()-this._left:wt.cycleRestrict(t.getX()-this._left,-1e-10,360-1e-10),i=t.getY()-this._bottom;return new Bt(e,i)},xt.getCenter=function(){var t=Dt.getCoordPoint(this._left,this._bottom,1),e=t.copy().moveBy(this._getDirection()),i=Dt.fromCoordPoint(t).moveBy(Dt.fromCoordPoint(e)).scale(.5),n=Dt.toCoordPoint(i,1);return this._getResultPoint(n.getX(),n.getY())},xt.intersects=function(t){return Ct.MathLib.intervalsIntersect(this.getBottom(),this.getTop(),t.getBottom(),t.getTop())&&(this._isResultUnbounded?Ct.MathLib.intervalsIntersect(this.getLeft(),this.getRight(),t.getLeft(),t.getRight()):Ct.MathLib.sectorsIntersect(this.getLeft(),this.getRight(),t.getLeft(),t.getRight()))},Mt=bt.CollectionBounds=function(t){var e=new Bt;bt.Bounds.call(this,e,e),this._empty=1,t&&this.add(t)},(xt=Lt(Mt,bt.Bounds)).add=function(t){if(t instanceof Array){var e=this;Pt.each(t,function(){e.add(this)})}else this._empty?(this._left=this._right=t.x,this._top=this._bottom=t.y,this._empty=0):(t.x>this._right?this._right=t.x:t.x<this._left&&(this._left=t.x),t.y<this._bottom?this._bottom=t.y:t.y>this._top&&(this._top=t.y))},xt.clear=function(){this._left=this._top=this._right=this._bottom=0},Mt=bt.GeoCollectionBounds=function(t){var e=new bt.GeoPoint(0,0);bt.GeoBounds.call(this,e,e),this._empty=1,this._lngs=[],t&&this.add(t)},(xt=Lt(Mt,bt.GeoBounds)).clear=function(){this._left=this._top=this._right=this._bottom=0,this._lngs=[]},xt._insert=function(t){var e=wt.cycleRestrict(t.getX(),-180,180),i=t.getY();return this._empty&&(this._left=this._right=e,this._top=this._bottom=i,this._empty=0),this._top<i?this._top=i:this._bottom>i&&(this._bottom=i),e},xt.add=function(t){if(t instanceof Array){var e=this;Pt.each(t,function(){e._lngs.push(e._insert(this))})}else this._lngs.push(this._insert(t));this._lngs.sort(function(t,e){return t-e});var i=0,n=this._lngs.length;if(0<n&&180<this._lngs[n-1]-this._lngs[0]){for(var o=0;o<n-1;o++)this._lngs[o+1]-this._lngs[o]>this._lngs[i+1]-this._lngs[i]&&(i=o);this._lngs[0]+360-this._lngs[n-1]>this._lngs[i+1]-this._lngs[i]?(this._left=this._lngs[0],this._right=this._lngs[n-1]):(this._left=this._lngs[i+1],this._right=this._lngs[i])}else this._left=this._lngs[0],this._right=this._lngs[n-1]},Mt=bt.GeoCoordSystem=function(t,e){this._radius=t||6378137,this._equator=t?2*Math.PI*t:40075016.68557849,this._e=.0818191908426,this._e2=.00669437999014,this._epsilon=1e-10,this._maxZoom=e||23,this._worldSize=Math.pow(2,this._maxZoom+8),this._a=this._worldSize/this._equator,this._b=this._equator/2,this._latRestriction=89.3},(xt=Mt.prototype).getCoordPoint=function(t,e,i){return new bt.GeoPoint(t,e,i)},xt.getCoordBounds=function(t,e){return new bt.GeoBounds(t,e)},xt.getWorldSize=function(){return new bt.Point(this._worldSize,this._worldSize)},xt.getMaxZoom=function(){return this._maxZoom},xt.fromCoordPoint=function(t,e){if(t.isUnbounded()||!e)return this._mercatorToPixels(this._geoToMercator(t));var i=e.getX();return this._mercatorToPixels(this._geoToMercator(this.getCoordPoint(wt.cycleRestrict(t.getX(),i-180,i+180),t.getY(),1)))},xt.toCoordPoint=function(t,e){return this._mercatorToGeo(this._pixelsToMercator(t),e)},xt.restrict=function(t){return t.copy().setY(wt.boundaryRestrict(t.getY(),-this._latRestriction,this._latRestriction))},xt.distance=function(t,e){var i=Math.PI/180,n=t.getX()*i,o=t.getY()*i,s=e.getX()*i,a=e.getY()*i,r=0;if(!(Math.abs(a-o)<this._epsilon&&Math.abs(n-s)<this._epsilon)){var h=Math.cos((o+a)/2);r=this._radius*Math.sqrt((1-this._e2)/(1-this._e2*h*h))*Math.acos(Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(s-n))}return r},xt.rulerDistance=function(t,e){var i=t.getX(),n=t.getY(),o=e.getX(),s=e.getY(),a=0;if(!(Math.abs(s-n)<this._epsilon&&Math.abs(i-o)<this._epsilon)){var r=(n+(s-n)/2)*Math.PI/180,h=Math.atan((60*o-60*i)/(60*s-60*n)*Math.cos(r)),l=this._radius,c=2*Math.PI*l/360;a=Math.abs(s-n)<this._epsilon?Math.abs((o-i)/Math.sin(h)*Math.cos(r)*c):Math.abs(c*(s-n)/Math.cos(h))}return a},xt._mercatorToGeo=function(t,e){var i=Math.PI/2,n=this._radius,o=i-2*Math.atan(1/Math.exp(t.y/n)),s=o+.003356551468879694*Math.sin(2*o)+657187271079536e-20*Math.sin(4*o)+1.764564338702e-8*Math.sin(6*o)+5328478445e-20*Math.sin(8*o),a=t.x/n;return new bt.GeoPoint(180*a/Math.PI,180*s/Math.PI,e)},xt._geoToMercator=function(t){var e=t.getX()*Math.PI/180,i=wt.boundaryRestrict(t.getY(),-90,90)*Math.PI/180,n=this._radius,o=this._e,s=o*Math.sin(i),a=(Math.tan(Math.PI/4+i/2)||this._epsilon)/Math.pow(Math.tan(Math.PI/4+Math.asin(s)/2),o);return new Bt(n*e,n*Math.log(a))},xt._mercatorToPixels=function(t){return new Bt(Math.round((this._b+t.x)*this._a),Math.round((this._b-t.y)*this._a))},xt._pixelsToMercator=function(t){return new Bt(t.x/this._a-this._b,this._b-t.y/this._a)};var M,x,w,P,S,T,Dt=new bt.GeoCoordSystem;function E(t,e){if(St.msie){var i,n;try{i=t.clientX,n=t.clientY}catch(t){n=i=0}w==e&&("mousemove"!=w||i==P&&n==S)||("mousemove"==(w=e)&&(P=i,S=n),T={})}else{var o=t.originalEvent||t;o!=x&&(x=o,T={})}}Mt=bt.CartesianCoordSystem=function(t,e,i,n){this._left=t.x,this._right=e.x,this._bottom=t.y,this._top=e.y,this._xRange=this._right-this._left,this._yRange=this._top-this._bottom,this._scale=i||1,this._maxZoom=n||23,this._worldSize=Math.pow(2,this._maxZoom+8),this._bitsPerTile=Math.round(Math.log(bt.TILE_SIZE)/Math.log(2)),this._pixelMask=(1<<this._bitsPerTile)-1},(xt=Mt.prototype).getCoordPoint=function(t,e,i){return new Bt(t,e)},xt.getCoordBounds=function(t,e){return new bt.Bounds(t,e)},xt.fromCoordPoint=function(t){return new Bt(Math.round((t.getX()-this._left)/this._xRange*(this._worldSize-1)),Math.round((1-(t.getY()-this._bottom)/this._yRange)*(this._worldSize-1)))},xt.toCoordPoint=function(t){return new Bt(this._left+t.getX()/(this._worldSize-1)*this._xRange,this._bottom+(1-t.getY()/(this._worldSize-1))*this._yRange)},xt.distance=function(t,e){var i=t.diff(e).scale(this._scale);return Math.sqrt(i.x*i.x+i.y*i.y)},xt.rulerDistance=xt.distance,xt.restrict=function(t){return new Bt(wt.boundaryRestrict(t.getX(),Math.min(this._left,this._right),Math.max(this._left,this._right)),wt.boundaryRestrict(t.getY(),Math.min(this._bottom,this._top),Math.max(this._bottom,this._top)))},xt.getWorldSize=function(){return new bt.Point(this._worldSize,this._worldSize)},xt.getMaxZoom=function(){return this._maxZoom},Mt=bt.MouseEvent=function(t,e){var i=t.originalEvent&&!t.fixedTouch?t.originalEvent:t;Tt.touchscreen&&i.touches?(this._event=wt.touchEventFix(i),this._event.type=t.type):this._event=Pt.event.fix(t),this._map=e},(xt=Mt.prototype={getCoordPoint:function(t){return this._point||(this._point=this._map.converter.localPixelsToCoordinates(this.getLocalPixels(),1)),t?this._point.copy():this._map.coordSystem.getCoordPoint(this._point.getX(),this._point.getY())},getLocalPixels:function(){return this._posInPixels||(this._posInPixels=this._map.converter.clientPixelsToLocalPixels(new Bt(this._event.clientX,this._event.clientY))),this._posInPixels},getEvent:function(){return this._event}}).getGeoPoint=xt.getCoordPoint,T={},Ct.preventMapEvent=function(t,e){(function(t,e){St.msie&&(M=M||window.setTimeout(function(){T={},M=null},0)),E(t,e)})(t,e=e||t.type),T[e]=!0},Ct.isMapEventPrevented=function(t,e){return E(t,e=e||t.type),T[e]||!1},xt.preventMapEvent=function(){Ct.preventMapEvent(this._event)},xt.isMapEventPrevented=function(){return Ct.isMapEventPrevented(this._event)},bt.MultiTouchEvent=function(t,e){this._event=wt.touchEventFix(t,"none"),this.touches=[];for(var i=0,n=this._event.touches.length;i<n;i++)this.touches[i]=new Ct.Touch(this._event.touches[i],e)},bt.MultiTouchEvent.prototype={getEvent:function(){return this._event},preventMapEvent:function(){Ct.preventMapEvent(this._event)},isMapEventPrevented:function(){return Ct.isMapEventPrevented(this._event)}},Ct.Touch=function(t,e){this._touch=t,this._map=e},Ct.Touch.prototype={getCoordPoint:function(t){return this._point||(this._point=this._map.converter.localPixelsToCoordinates(this.getLocalPixels(),1)),t?this._point.copy():this._map.coordSystem.getCoordPoint(this._point.getX(),this._point.getY())},getLocalPixels:function(){return this._posInPixels||(this._posInPixels=this._map.converter.clientPixelsToLocalPixels(new Bt(this._touch.clientX,this._touch.clientY))),this._posInPixels}},Mt=bt.Group=function(){this._objects=[]},(xt=Mt.prototype).Events={Add:"Add",Remove:"Remove"},xt.add=function(t,i){typeof t!=Et&&(i=typeof i!=Et?this._normalizeIndex(i):this.length(),t instanceof Array?Pt.each(t,Ot(function(t,e){this._add(e,i+t)},this)):this._add(t,i))},xt._add=function(t,e){this._objects.splice(e,0,t),Rt.notify(this,this.Events.Add,this,t,e)},xt.splice=function(i,t){i=this._normalizeIndex(i);for(var e=[],n=0;n<t&&i<this._objects.length;n++)e=e.concat(this._removeByIndex(i));return Pt.each(Array.prototype.slice.call(arguments,2),Ot(function(t,e){this._add(e,i+t)},this)),e},xt._normalizeIndex=function(t){return(t=Math.min(t,this.length()))<0?Math.max(0,t+this.length()):t},xt.remove=function(t){if(t instanceof Array){var i=[];return Pt.each(t,Ot(function(t,e){i=i.concat(this._removeObject(e))},this)),i}return this._removeObject(t)},xt._removeObject=function(t){var e=this.indexOf(t);return-1!=e?this._removeByIndex(e):[]},xt._removeByIndex=function(t){var e=this._objects.splice(t,1);return Rt.notify(this,this.Events.Remove,this,e[0],t),e},xt.removeAll=function(){for(;this._objects.length;)this._removeByIndex(0)},xt.get=function(t){var e=this._objects.length;return t<0&&(t=e+t)<0||e<=t?null:this._objects[t]},xt.indexOf=function(t){return Pt.inArray(t,this._objects)},xt.length=function(){return this._objects.length},xt.forEach=function(e,i){var n=this;Pt.each(this._objects,function(t){e.call(i,this,t,n)})},xt.filter=function(t,e,i){var n=[];return this.__filter(n,this,t,e,i),n},xt.__filter=function(t,e,i,n,o){for(var s,a=0,r=e.length();a<r;a++)i.call(n,s=e.get(a))&&t.push(s),!o&&s instanceof bt.Group&&this.__filter(t,s,i,n)},(Mt=bt.AGeoObject=function(){this.id=null,this.name=null,this.description=null,this.metaDataProperty={},this._boundedBy=null,this._parentGroup=null,this._style=null,this._computedStyle=null}).fullStyle={parentStyle:null,hasHint:!1,hasBalloon:!0,iconStyle:{href:kt.imageRoot+"micro/pmlbs.png",size:new Bt(28,29),offset:new Bt(-7,-28),shadow:null,template:"default#icon"},iconContentStyle:{template:"default#iconContent"},hintStyle:{template:"default#hint"},hintContentStyle:{template:"default#hintContent"},balloonStyle:{template:"default#balloon"},balloonContentStyle:{template:"default#balloonContent"},lineStyle:{strokeColor:"ff0000",strokeWidth:1},polygonStyle:{strokeColor:"ff0000",strokeWidth:1,fillColor:"ff0000",fill:1,outline:1}},Mt.shadowStyle={template:"default#iconShadow",href:null,offset:new Bt,size:new Bt},(xt=Mt.prototype).onAddToGroup=function(t){this._parentGroup=t,this.update()},xt.onRemoveFromGroup=function(){this._parentGroup=null,this.update()},xt.getParentGroup=function(){return this._parentGroup},xt.setStyle=function(t){this._style=t,this.update()},xt.getStyle=function(){return this._style},xt.getComputedStyle=function(){if(!this._computedStyle){for(var t,e=this,i=bt.Style,n=bt.Styles;!t&&e;)t=e.getStyle(),e=e.getParentGroup();this._computedStyle=i.copy(n.get(t)||n.get(n.DefaultStyleKey));for(var o=this._computedStyle.parentStyle;o;)(o=n.get(o))&&(i.extendStyle(this._computedStyle,o,0),o=o.parentStyle);var s=this.getParentGroup();i.extendStyle(this._computedStyle,s?s.getComputedStyle():bt.AGeoObject.fullStyle,1);var a=this._computedStyle.iconStyle.shadow;a?i.extendStyle(a,bt.AGeoObject.shadowStyle,1):a==Et&&(this._computedStyle.iconStyle.shadow=null)}return this._computedStyle},xt.update=function(){this._computedStyle=null},xt.setBounds=function(t){this._boundedBy=t},xt.getBounds=function(){return this._boundedBy},Mt=bt.AInteractiveGeoObject=function(t){bt.AGeoObject.call(this),t=t||{},this._style=t.style,this._hintOptions=Pt.extend({},t.hintOptions),this._hasHint=t.hasHint,this._hintContent=null,this._hintCustomContent=null,this._hintCustomContentLayout=null,this._balloonOptions=Pt.extend({},t.balloonOptions),this._hasBalloon=t.hasBalloon,this._balloonContent=null,this._balloonCustomContent=null,this._balloonCustomContentLayout=null},(xt=Lt(Mt,bt.AGeoObject)).setOptions=function(t,e){t=t||{};var i=e?{hintOptions:{},balloonOptions:{},style:bt.Styles.get(bt.Styles.DefaultStyleKey),hasHint:void 0,hasBalloon:void 0}:{style:this.getStyle(),hasHint:this._hasHint,hasBalloon:this._hasBalloon,hintOptions:this.getHintOptions(),balloonOptions:this.getBalloonOptions()};for(var n in t)i[n]=t[n];this._hasHint=i.hasHint,this._hasBalloon=i.hasBalloon,this.setHintOptions(i.hintOptions,1),this.setBalloonOptions(i.balloonOptions,1),this.setStyle(i.style)},xt.getOptions=function(){return{style:this.getStyle(),hasHint:typeof this._hasHint==Et?this.getComputedStyle().hasHint:this._hasHint,hasBalloon:typeof this._hasBalloon==Et?this.getComputedStyle().hasBalloon:this._hasBalloon,hintOptions:this.getHintOptions(),balloonOptions:this.getBalloonOptions()}},xt.update=function(){bt.AGeoObject.prototype.update.call(this),this._hintContent=this._balloonContent=null},xt.setHintContent=function(t){this._hintCustomContent=t,this._hintCustomContentLayout=wt.normalizeContent(t),this._hintContent=null},xt.getHintContent=function(){return this._hintCustomContent},xt._getHintContentLayout=function(){if(!this._hintContent)if(this._hintCustomContentLayout)this._hintContent=this._hintCustomContentLayout;else{var t=bt.Templates.get(this.getComputedStyle().hintContentStyle.template);t=t||bt.Templates.get(bt.AGeoObject.fullStyle.hintContentStyle.template),this._hintContent=t.build(this)}return this._hintContent},xt.setHintOptions=function(t,e){this._hintOptions=e?t:Pt.extend(this._hintOptions,t)},xt.getHintOptions=function(){return this._hintOptions||{}},xt._getComputedHintOptions=function(){var t=this.getHintOptions();return t.style||(t=Pt.extend({},t,{style:this.getComputedStyle().hintStyle})),t.layoutContext=this,t},xt.openBalloon=function(t,e){typeof t!=Et&&this.setBalloonContent(t),e&&this.setBalloonOptions(e)},xt.closeBalloon=function(){},xt.setBalloonOptions=function(t,e){this._balloonOptions=e?t:Pt.extend(this._balloonOptions,t)},xt.getBalloonOptions=function(){return this._balloonOptions||{}},xt._getComputedBalloonOptions=function(){var t=this.getBalloonOptions();return t.style||(t=Pt.extend({},t,{style:this.getComputedStyle().balloonStyle})),t.layoutContext=this,t},xt.setBalloonContent=function(t){this._balloonCustomContent=t,this._balloonCustomContentLayout=wt.normalizeContent(t),this._balloonContent=null},xt.getBalloonContent=function(){return this._balloonCustomContent},xt._getBalloonContentLayout=function(){if(!this._balloonContent)if(this._balloonCustomContentLayout)this._balloonContent=this._balloonCustomContentLayout;else{var t=bt.Templates.get(this.getComputedStyle().balloonContentStyle.template);t=t||bt.Templates.get(bt.AGeoObject.fullStyle.balloonContentStyle.template),this._balloonContent=t.build(this)}return this._balloonContent},Ct.TileCoordinates=function(c){var s=c.coordSystem,u=s.getMaxZoom(),d=s.getWorldSize(),t=new bt.Point(d.getX()/2,d.getY()/2),e=s.toCoordPoint(t),i=s.toCoordPoint(t.copy().moveBy(d),1),n=s.fromCoordPoint(e,i).diff(t),p=!!n.getX(),_=!!n.getY();this.fromPixels=function(t,e,i){var n={number:null,offset:null},o=u-e,s=i||bt.TILE_SIZE,a=p?wt.cycleRestrict(t.getX(),0,d.getX()):t.getX(),r=_?wt.cycleRestrict(t.getY(),0,d.getY()):t.getY(),h=new Bt(a,r).scale(Math.pow(2,-o)),l=h.copy().scale(1/s).apply(Math.floor);return 0<=a&&a<d.getX()&&0<=r&&r<d.getY()&&(n.number=l),n.offset=l.copy().scale(s).diff(h).scale(c.animator.getState().scaleCoefficient).apply(Math.round),n},this.toPixels=function(t,e,i,n){var o=u-i,s=n||bt.TILE_SIZE;return t.copy().scale(s).moveBy(e.copy().scale(1/c.animator.getState().scaleCoefficient)).scale(Math.pow(2,o))},this.scale=function(t,e,i){var n=typeof e==Et?c.getZoom():Number(e),o=typeof i==Et?s.getMaxZoom():Number(i);return t.copy().scale(Math.pow(2,o-n))}},Ct.Animator=function(s){var a=1,n=null,o=new Bt;this.getState=function(){return{startPixelCenter:n||s._state.centerInTiles,currentPixelCenter:s._state.centerInTiles,scaleCoefficient:a}},this.start=function(){n=s._state.centerInTiles.copy(),Rt.notify(s,s.Events.SmoothZoomStart,s),s.__layerManager.onSmoothZoomStart()},this.scale=function(t){var e=s.converter.coordinatesToLocalPixels(t.saveThisPosition);a=t.scaleCoefficient;var i=s.converter.coordinatesToLocalPixels(t.saveThisPosition),n=e.diff(i),o=s.tileCoordinates.scale(n.scale(1/a));s._state.centerInTiles.moveBy(o),s.__layerManager.onSmoothZoomTick(t)},this.move=function(t){s._state.centerInTiles.moveBy(s.tileCoordinates.scale(t).scale(1/a));var e=o.moveBy(t).copy().apply(Math.floor);if(e.x||e.y){o=e.diff(o),s._state.offset.moveBy(e.neg());var i=e.copy().apply(Math.abs);s._state.size.x<i.x||s._state.size.y<i.y?n?this.stop():s.update():(s.__layerManager.onMove(s._state.offset,e.neg()),Rt.notify(s,s.Events.Move,s,e))}},this.stop=function(t){n&&(n=null,s._state.zoom=wt.boundaryRestrict(t||Math.round(s._state.zoom+Math.log(a)/Math.log(2)),s.getCurrentMinZoom(),s.getCurrentMaxZoom()),a=1,s.__layerManager.onSmoothZoomEnd(),Rt.notify(s,s.Events.SmoothZoomEnd,s),s.update(),Rt.notify(s,s.Events.BoundsChange,s))}},Ct.Converter=function(o){var s=o._state,a=o.coordSystem;this.localPixelsToCoordinates=function(t,e){var i=s.centerInPixels.diff(t),n=o.tileCoordinates.scale(i);return n.scale(1/o.animator.getState().scaleCoefficient).moveBy(s.centerInTiles),a.toCoordPoint(n,e)},this.coordinatesToLocalPixels=function(t,e){var i=e?t:o.coordSystem.restrict(t),n=a.fromCoordPoint(i,o.getCenter(1));return o.tileCoordinates.scale(s.centerInTiles.diff(n).scale(o.animator.getState().scaleCoefficient),a.getMaxZoom(),o.getZoom()).moveBy(s.centerInPixels)},this.clientPixelsToCoordinates=function(t,e){return this.localPixelsToCoordinates(this.clientPixelsToLocalPixels(t),e)},this.coordinatesToClientPixels=function(t,e){return this.localPixelsToClientPixels(this.coordinatesToLocalPixels(t,e))},this.clientPixelsToLocalPixels=function(t){return s.getDomOffset().diff(t).moveBy(new Bt(Pt(window).scrollLeft(),Pt(window).scrollTop()))},this.localPixelsToClientPixels=function(t){return new Bt(Pt(window).scrollLeft(),Pt(window).scrollTop()).diff(t.copy().moveBy(s.getDomOffset()))},this.coordinatesToMapPixels=function(t,e){return this.localPixelsToMapPixels(this.coordinatesToLocalPixels(t,e))},this.mapPixelsToCoordinates=function(t,e){return this.localPixelsToCoordinates(this.mapPixelsToLocalPixels(t),e)},this.mapPixelsToLocalPixels=function(t){return t.copy().moveBy(s.offset)},this.localPixelsToMapPixels=function(t){return s.offset.diff(t)}};var L,O,I,Rt=(L=new function(){var c={},u={};function d(t,e){t.listener.apply(t.context,e)}this.addObserver=function(t){var e=t.id;(c[e]||(c[e]=[])).push(t);var i=u[e];if(i)for(var n=0,o=i.length;n<o;n++)d(t,i[n])},this.removeObserver=function(t){var e,i=c[t.id];i&&-1!=(e=Pt.inArray(t,i))&&(i.splice(e,1),0==i.length&&delete c[t.id])},this.notify=function(t,e,i,n){var o=A(e,t),s=c[o];if(n&&(u[o]||(u[o]=[])).push(i),s)for(var a,r=0,h=s.slice(),l=h.length;r<l;r++)(a=h[r]).added&&d(a,i)}},k.prototype={enable:function(){this.added||(L.addObserver(this),this.added=1)},disable:function(){this.added&&(L.removeObserver(this),this.added=0)},cleanup:function(){this.disable(),this.context=this.listener=null}},bt.Events=new function(){this.observe=function(t,e,i,n,o){if(o=typeof o!=Et?o:1,e instanceof Array){for(var s=[],a=0,r=e.length;a<r;a++)s[a]=new k(e[a],i,t,o,n||t);return s}return new k(e,i,t,o,n||t)},this.notify=function(t,e){L.notify(t,e,Array.prototype.slice.call(arguments,2))},this.notifyPermanent=function(t,e){L.notify(t,e,Array.prototype.slice.call(arguments,2),1)}});function A(t,e){var i=e;return e&&"object"!=typeof e||(i=wt.getUniqueId(e||bt)),t+"_"+i}function k(t,e,i,n,o){this.id=A(t,i),this.listener=e,this.context=o,this.added=0,n&&this.enable()}function B(t,i){bt.Templates.add(t,{build:function(t,e){return wt.normalizeContent(i(t,e))}})}function D(e,n,o){return function(){var t=new bt.ToolBarRadioButton(bt.ToolBar.DEFAULT_GROUP,{hint:kt.hints.toolBar[e],icon:St.msie&&St.version<7?kt.images.toolBar.iconSprite:kt.images.transparentImage,width:"19"},{selected:o});if(t._applyTemplate=function(){bt.ToolBarRadioButton.prototype._applyTemplate.call(this),Pt(this._parentContainer).find("img").addClass("YMaps-icon_"+e)},n){var i=e.charAt(0).toUpperCase()+e.substr(1).toLowerCase();t.onAddToToolBar=function(t,e){bt.ToolBarRadioButton.prototype.onAddToToolBar.call(this,t,e),this._listeners=[Rt.observe(this,this.Events.Select,function(){t.getMap()["enable"+i]()}),Rt.observe(this,this.Events.Deselect,function(){t.getMap()["disable"+i]()})]},t.onRemoveFromToolBar=function(){It(this._listeners,"cleanup"),bt.ToolBarRadioButton.prototype.onRemoveFromToolBar.call(this)}}return t}}function R(t,e,i){var n=t.options.minWayPoints||2;!t.wayPoints||t.wayPoints.length<n?(e.error={code:400,message:"bad request"},i(!0)):i()}function Y(i,n,o){var s=i.wayPoints.length,a={boundedBy:i.options.boundedBy,strictBounds:i.options.strictBounds,origin:i.options.origin,results:1},r=!1;function h(t,e){return-1===Pt.inArray(e,i.viaPoints)}function l(t,e){n.allWayPoints[e]={request:String(i.wayPoints[e]),status:t?"ok":"error",data:t},t||(r=!0),--s||(n.wayPoints=Pt.grep(n.allWayPoints,h),o(r))}n.allWayPoints=[],Pt.each(i.wayPoints,function(e,t){var i=function(t){var e=Pt.map(String(t).split(","),Number);if(2===e.length&&!Pt.grep(e,isNaN).length)return e}(t);if(i)l({type:"coords",point:i},e);else{var n=new bt.Geocoder(t,a);Rt.observe(n,[n.Events.Load,n.Events.Fault],function(t){l(t.get(0)&&function(t){var e=t.getGeoPoint(),i=t.getBounds();return{type:"geocoder",text:t.text,kind:t.kind,precision:t.precision,AddressDetails:t.AddressDetails,point:[e.getLng(),e.getLat()],boundedBy:[[i.getLeft(),i.getTop()],[i.getRight(),i.getBottom()]]}}(t.get(0)),e)})}})}function N(t){switch(t.type){case"Feature":return Pt.map(t.geometry.geometries,N);case"Point":return{indexInPolyline:t.lodIndex}}}function j(t,e){var i=t.properties.RouteMetaData;return{distance:i.Distance.value,duration:i[e].value,boundedBy:t.properties.boundedBy,routes:Pt.map(t.features,function(t){return function(t,e){var i=t.properties.PathMetaData;return{distance:i.Distance.value,duration:i[e].value,boundedBy:t.properties.boundedBy,encodedPoints:t.properties.encodedCoordinates,routeSegments:Pt.map(t.features,function(t){return function(t,e){var i=t.properties.SegmentMetaData;return{angle:i.angle,street:i.street||"",action:i.Action.value,distance:i.Distance.value,duration:i[e].value,indexInPolyline:t.geometry.geometries[0].lodIndex}}(t,e)}),viaPoints:Pt.map(t.features,N)}}(t,e)})}}function z(t,i,n){var o=t.options.avoidTrafficJams?"DurationInTraffic":"Duration";Pt.ajax({url:function(t,e){var i=Pt.map(e.allWayPoints,function(t){return t.data.point.toString()});return Ct.routeService+"2.0/?"+Pt.param({key:Ct.userKey||[],lang:"ru_RU",origin:t.options.origin,results:1,rll:i.join("~"),rtm:t.options.avoidTrafficJams?"dtr":"atm",token:Ct.token,via:t.viaPoints.join("~")||[]})}(t,i),dataType:"jsonp",cache:1,scriptCharset:"utf-8",success:function(t){var e=t.data;e?e.features&&e.features.length&&Pt.extend(i,j(e.features[0],o)):i.error=t.error||t,n(!e)}})}function H(i,n){return function(t,e){i&&i.call(n,{request:t,response:e})}}function Z(t){return new bt.GeoPoint(t[0],t[1])}function U(t){return new bt.GeoBounds(Z(t[0]),Z(t[1]))}function F(t){return new bt.RouteSegment(t.indexInPolyline,t.distance,t.duration,t.action,t.angle,t.street)}function $(t){return new bt.ViaPoint(t.indexInPolyline)}function G(t){return new bt.Route(t.encodedPoints,t.levels,t.boundedBy&&U(t.boundedBy),Pt.map(t.routeSegments,F),t.distance,t.duration,Pt.map(t.viaPoints,$))}function V(t){var e=t.response,i=[];return Pt.each(e.wayPoints,function(t,e){if("error"===e.status)return!1;i.push(function(t){var e=new bt.WayPoint(Z(t.point));return"geocoder"===t.type?(e.setBounds(U(t.boundedBy)),e.AddressDetails=t.AddressDetails,e.precision=t.precision,e.kind=t.kind,e.text=t.text):e.text=e.getGeoPoint().toString(),e}(e.data))}),{distance:e.distance,duration:e.duration,boundedBy:e.boundedBy&&U(e.boundedBy),routes:Pt.map(e.routes,G),wayPoints:i,error:e.error}}Mt=bt.OverlayGroup=function(){bt.Group.call(this),this._map=this._parentContainer=null,this.__listeners=[Rt.observe(this,this.Events.Add,function(t,e,i){this._onAddObject(e,i)},this),Rt.observe(this,this.Events.Remove,function(t,e,i){this._onRemoveObject(e,i)},this)]},(xt=Lt(Mt,bt.Group)).getMap=function(){return this._map},xt.getParentContainer=function(){return this._parentContainer},xt.onAddToMap=function(t,e){this._map=t,this._parentContainer=e,this.forEach(this.__addObjectToMap,this)},xt._onAddObject=function(t){this.__addObjectToMap(t)},xt.__addObjectToMap=function(t){this._map&&t.onAddToMap(this._map,this._parentContainer)},xt.onRemoveFromMap=function(){this.forEach(this.__removeObjectFromMap,this),this._map=this._parentContainer=null},xt._onRemoveObject=function(t){this.__removeObjectFromMap(t)},xt.__removeObjectFromMap=function(t){this._map&&t.onRemoveFromMap()},xt.onMapUpdate=function(){It(this._objects.slice(),"onMapUpdate")},(Mt=Ct.ALayer=function(t){this._options=Pt.extend({},Ct.ALayer.fullOptions,t),this._$element=Pt('<div class="YMaps-layer" style="z-index: '+this._options.zIndex+';"></div>')}).fullOptions={zIndex:bt.ZIndex.MAP_LAYER},(xt=Ct.ALayer.prototype).onAddToMap=function(t,e){this._map=t,this._$element.appendTo(e),wt.position(this._$element[0],this._map._state.offset)},xt.onRemoveFromMap=function(){this._$element.removeFromDom(),this._map=null},xt.onMapUpdate=function(){wt.position(this._$element[0],this._map._state.offset)},xt.update=function(){this._map&&this.onMapUpdate()},xt.getMap=function(){return this._map},xt.getContainer=function(){return this._$element[0]},xt.onMove=function(t,e){wt.position(this._$element[0],t)},xt.onSmoothZoomStart=function(){this._$element.addClass("YMaps-display-none")},xt.onSmoothZoomTick=wt.NULL,xt.onSmoothZoomEnd=function(){this._$element.removeClass("YMaps-display-none")},xt.getCopyright=function(t,e){return""},xt.setOptions=function(t,e){var i=Pt.extend({},e?Ct.ALayer.fullOptions:this._options,t);i.zIndex!=this._options.zIndex&&this._$element.css("z-index",i.zIndex),this._options=i},xt.getOptions=function(){return this._options},Mt=bt.Layer=function(t,e){Ct.ALayer.call(this,e),this._dataSource=t},(xt=Lt(Mt,Ct.ALayer)).getTileDataSource=function(){return this._dataSource},xt.onAddToMap=function(t,e){Ct.ALayer.prototype.onAddToMap.call(this,t,e);var i=this._master;i||(this._master=i=new Ct.TileContainer(this._dataSource),i.setZIndex(6)),i.setVisible(1),i.onAddToMap(this.getMap(),this.getContainer()),i.update(),this._slave&&(this._slave.setVisible(0),this._slave.onAddToMap(this.getMap(),this.getContainer())),this.__eventListener=At(this.getContainer()).events.eventListener().add(["selectstart","dragstart"],function(t){t.preventDefault()})},xt.onRemoveFromMap=function(){this._master.onRemoveFromMap(),this._slave&&this._slave.onRemoveFromMap(),this.__eventListener.removeAll(),Ct.ALayer.prototype.onRemoveFromMap.call(this)},xt.onMove=function(t,e){if(Ct.ALayer.prototype.onMove.call(this,t,e),St.opera){var i=this;window.setTimeout(function(){i._master.onMove(e)},0)}else this._master.onMove(e)},xt.onMapUpdate=function(){Ct.ALayer.prototype.onMapUpdate.call(this),this._slave&&!this._afterSmoothZoom&&this._slave.setVisible(0),this._master.update(),this._afterSmoothZoom=0},xt.getTileInPosition=function(t){return this._master?this._master.getTileInPosition(t):null},St.opera&&St.version<9.5?xt.onSmoothZoomStart=xt.onSmoothZoomTick=xt.onSmoothZoomEnd=wt.NULL:(xt.onSmoothZoomStart=function(){this._dataSource.smoothZoomEnabled()?this._slave&&this._slave.setVisible(0):this._master.setVisible(0)},xt.onSmoothZoomTick=function(t){this._dataSource.smoothZoomEnabled()&&this._master.scale(t.scaleCoefficient,t.saveThisPosition?this.getMap().converter.coordinatesToMapPixels(t.saveThisPosition):null)},xt.onSmoothZoomEnd=function(){if(this._dataSource.smoothZoomEnabled()){var t=this._master,e=this._slave;e||(e=new Ct.TileContainer(this._dataSource)).onAddToMap(this.getMap(),this.getContainer()),t.setPosition(t.getPosition().moveBy(this.getMap()._state.offset)),t.setZIndex(5),e.setZIndex(6),e.setVisible(1),this._dataSource.isTransparent()&&t.setVisible(0),this._master=e,this._slave=t,this._afterSmoothZoom=1}else this._master.setVisible(1)}),bt.ImageTile=function(t){this._state=bt.State.EMPTY,this._dataSource=t,this._pngInIE=t.isTransparent()&&St.msie&&St.version<7&&5.4<St.version;var e=this._image=Pt("<img />")[0];e.galleryImg=!1,this._element=this._pngInIE?Pt("<span />")[0]:e,this._position=new Bt,this._size=null,this._url="",this._element.style.position="absolute",this.scale(1)},(xt=bt.ImageTile.prototype).getState=function(){return this._state},xt.onAddToMap=function(t,e){At(this._image).events.add("load",this._onLoad,this).add("error",this._onError,this),this._map=t,e.appendChild(this._element)},xt.onRemoveFromMap=function(){At(this._image).events.remove("load",this._onLoad,this).remove("error",this._onError,this),this._element.parentNode.removeChild(this._element)},xt.scale=function(t){var e=this._dataSource.getTileSize()*t;e!=this._size&&this._setSize(e)},xt._setSize=function(t){wt.size(this._element,this._size=t)},xt.setPosition=function(t){this._position.moveTo(t),wt.position(this._element,this._position)},xt.getPosition=function(){return this._position.copy()},xt.load=function(t,e){t&&typeof e!=Et&&this._setUrl(this._dataSource.getTileUrl(t,e))},xt._setUrl=function(t){t?(this._state=bt.State.LOADING,this._setSrc(t)):this._onError()},xt._setSrc=function(t){this._url=t,(!St.opera||9.5<=St.version)&&(this._element.style.display="none"),this._image.src=t,St.webkit&&this._image.complete&&this._onLoad()},xt.abort=function(){this._image.complete||this._onError()},xt.error=function(){this._onError()},xt._onError=function(){this._state=bt.State.FAILURE;var t=this._dataSource.getErrorTileUrl();this._url!=t&&this._setSrc(t)},St.opera&&St.version<9.5?xt._onLoad=function(){this._state=bt.State.SUCCESS,this._map&&Rt.notify(this._map,this._map.Events._NeedRedraw)}:xt._onLoad=function(){this._state=bt.State.SUCCESS,this._pngInIE?(this._element.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+this._image.src+")",this._element.style.display="block"):this._element.style.display=""},Ct.TileContainer=function(t){this._dataSource=t,this._curTileSize=t.getTileSize(),this._scaleCoefficient=1,this._freeTiles=[],this._addedTiles=[],this._visible=1,this._zIndex=""},Ct.TileContainer.prototype={onAddToMap:function(t,e){this._map!=t&&(this._map&&this._parentContainer.removeChild(this._element),this._map=t,this._parentContainer=e,this._element=Pt('<div style="'+(this._visible?"":"display:none;")+(this._zIndex?"z-index:"+this._zIndex+";":"")+'" />').addClass("YMaps-tile-container")[0],e.appendChild(this._element))},onRemoveFromMap:function(){for(var t=0,e=this._addedTiles.length;t<e;t++){var i=this;Pt.each(this._addedTiles[t],function(){i._releaseTile(this)})}this._addedTiles=[]},onMove:function(t){if(!this._isEmpty()){var e=this.getSize(),i=t.copy().apply(Math.abs);e.x<i.x||e.y<i.y?this._centering():this._updateCells(0<t.x?1:0,0<t.y?1:0)}},update:function(){this._curTileSize!=this._dataSource.getTileSize()&&this.scale(1);var t=0,e=0,i=this._map.getContainerSize();i.x&&i.y&&(t=Math.ceil((i.y+1)/this._curTileSize)+1,e=Math.ceil((i.x+1)/this._curTileSize)+1),this._fill(t,e),this._isEmpty()||this._centering()},_fill:function(t,e){var i=this._addedTiles.length,n=this._addedTiles[0]?this._addedTiles[0].length:0;if(t<i){for(var o=t;o<i;o++){var s=this;Pt.each(this._addedTiles[o],function(){s._releaseTile(this)})}this._addedTiles.splice(t,i-t),i=t}if(e<n){for(o=0;o<i;o++){for(a=e;a<n;a++)this._releaseTile(this._addedTiles[o][a]);this._addedTiles[o].splice(e,n-e)}n=e}if(i<t||n<e){for(o=0;o<i;o++)for(a=n;a<e;a++)this._addedTiles[o].push(this._occupyTile());var a,r;for(o=i;o<t;o++){for(r=[],a=0;a<e;a++)r.push(this._occupyTile());this._addedTiles.push(r)}}},_centering:function(){var t=this._map._state,e=this._curTileSize,i=this._map.getZoom(),n=t.centerInTiles,o=this._addedTiles.length,s=0<o?this._addedTiles[0].length:0,a=new Bt((s>>1)*e,(o>>1)*e),r=this._map.tileCoordinates.fromPixels(n,i,this._dataSource.getTileSize()).offset;a.moveBy(new Bt(1&s?r.x:r.x-e*(r.x>e/2),1&o?r.y:r.y-e*(r.y>e/2))),a=t.centerInPixels.diff(a).moveBy(t.offset).neg(),this.setPosition(a,1)},_releaseTile:function(t){t.abort(),this._freeTiles.push(t),t.onRemoveFromMap()},_occupyTile:function(){var t=this._freeTiles.shift()||this._dataSource.getTile();return t.onAddToMap(this._map,this._element),t.scale(this._scaleCoefficient),t},_callMethod:function(t){for(var e,i,n,o=Array.prototype.slice.call(arguments,1),s=0,a=this._addedTiles.length;s<a;s++)for(i=0,n=(e=this._addedTiles[s]).length;i<n;i++)e[i][t].apply(e[i],o)},setPosition:function(t,e){for(var i=0,n=this._addedTiles.length;i<n;i++)this._updateRow(i,t.copy(),e),t.moveByY(this._curTileSize)},getPosition:function(){return this._isEmpty()?new Bt:this._addedTiles[0][0].getPosition().copy()},setZIndex:function(t){this._zIndex=t,Pt(this._element).css("zIndex",t)},setVisible:function(t){this._visible=t,this._callMethod("abort"),Pt(this._element).css("display",t?"":"none")},scale:function(t,e){var i=this.getPosition();e&&(i=e.diff(i).scale(t/this._scaleCoefficient).moveBy(e)),this._curTileSize=this._dataSource.getTileSize()*t,this._callMethod("scale",t),this.setPosition(i),this._scaleCoefficient=t},getSize:function(){return this._isEmpty()?new Bt:new Bt(this._addedTiles[0].length*this._curTileSize,this._addedTiles.length*this._curTileSize)},_updateCells:function(t,e){for(var i=this._map._state.offset,n=this._map.getContainerSize(),o=this._curTileSize;;){var s=this.getPosition(),a=this.getSize();if(!t&&s.x+i.x+o<0)this._shift(0,0);else if(!e&&s.y+i.y+o<0)this._shift(1,0);else if(t&&s.x+a.x+i.x-o>n.x)this._shift(0,1);else{if(!(e&&s.y+a.y+i.y-o>n.y))break;this._shift(1,1)}}},_shift:function(t,e){var i=this.getPosition(),n=this.getSize(),o=this._addedTiles.length;if(t)if(e){var s=new Bt(i.x,i.y-this._curTileSize),a=this._addedTiles.pop();this._addedTiles.splice(0,0,a),this._updateRow(0,s,1)}else{s=new Bt(i.x,i.y+n.y);var r=this._addedTiles.shift();this._addedTiles.splice(o,0,r),this._updateRow(o-1,s,1)}else if(e){s=new Bt(i.x-this._curTileSize,i.y);for(var h=0;h<o;h++)a=this._addedTiles[h].pop(),this._addedTiles[h].splice(0,0,a);this._updateColumn(0,s,1)}else{var l;for(s=new Bt(i.x+n.x,i.y),h=0;h<o;h++)r=(l=this._addedTiles[h]).shift(),l.splice(l.length,0,r);this._updateColumn(this._addedTiles[0].length-1,s,1)}},_updateRow:function(t,e,i){for(var n=0,o=this._addedTiles[t],s=o.length;n<s;n++)e&&(o[n].setPosition(e.copy()),e.moveByX(this._curTileSize)),i&&this._updateTileUrl(o[n])},_updateColumn:function(t,e,i){for(var n=0,o=this._addedTiles.length;n<o;n++)e&&(this._addedTiles[n][t].setPosition(e.copy()),e.moveByY(this._curTileSize)),i&&this._updateTileUrl(this._addedTiles[n][t])},_updateTileUrl:function(t){var e=t.getPosition().copy();e.moveBy(new Bt(this._curTileSize/2));var i=this._map,n=i.getZoom(),o=i.converter.mapPixelsToLocalPixels(e),s=i._state.centerInPixels.diff(o),a=i.tileCoordinates.scale(s).scale(1/i.animator.getState().scaleCoefficient).moveBy(i._state.centerInTiles),r=i.tileCoordinates.fromPixels(a,n,this._dataSource.getTileSize()).number;r?t.load(r,n):t.error()},_isEmpty:function(){return!this._addedTiles[0]||!this._addedTiles[0].length},getTileInPosition:function(t){if(!this._map||this._isEmpty())return null;var e=this._map.converter.mapPixelsToLocalPixels(this._addedTiles[0][0].getPosition()),i=this._addedTiles[0].length,n=this._addedTiles.length,o=Math.floor((t.x-e.x)/this._curTileSize),s=Math.floor((t.y-e.y)/this._curTileSize);return o<0||i<=o||s<0||n<=s?null:this._addedTiles[s][o]}},Mt=Ct.CursorManager=function(t){this._$element=Pt(t),this._stack=[]},(xt=Mt.prototype).addCursor=function(t){kt.cursors[t]&&(this._stack.push(t),this._setCursor(t))},xt._setCursor=function(t){var e=kt.cursors[t];if(St.msie)if(e.cursor!==bt.Cursor.INHERIT||8<=St.version&&8<=document.documentMode){var i=e.cursor.replace(/[^,]+\s+\d+\s+\d+\s*,?\s*/g,"");this._$element.css("cursor",i)}else this._$element[0].style.cursor=this._$element[0].parentNode.currentStyle.cursor;else if(!St.opera)if(this._$element[0].namespaceURI&&"http://www.w3.org/2000/svg"==this._$element[0].namespaceURI){var n=this._$element[0].className.baseVal.split(" ");if(this._current){var o=kt.cursors[this._current].class;n=Pt.map(n,function(t){if(t!=o)return t})}n.push(e.class),this._$element[0].className.baseVal=n.join(" ")}else this._current&&this._$element.removeClass(kt.cursors[this._current].class),this._$element.addClass(e.class);this._current=t},xt.removeCursor=function(t){for(var e=this._stack.length-1;0<=e&&this._stack[e]!==t;)e--;if(-1!=e){this._stack.splice(e,1);var i=this._stack.length;i==e&&(0<i?this._setCursor(this._stack[i-1]):this._unsetCursor())}},xt._unsetCursor=function(){if(this._current){if(St.msie)this._$element.css("cursor","");else if(!St.opera)if(this._$element[0].namespaceURI&&"http://www.w3.org/2000/svg"==this._$element[0].namespaceURI){var t=this._$element[0].className.baseVal.split(" "),e=kt.cursors[this._current].class;t=Pt.map(t,function(t){if(t!=e)return t}),this._$element[0].className.baseVal=t.join(" ")}else this._$element.removeClass(kt.cursors[this._current].class);this._current=null}},Ct.ControlsLayer=function(i,t,n){var e=Rt.observe(i,i.Events.MouseDown,function(){try{St.msie&&document.selection&&"None"!=document.selection.type?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}catch(t){}}),o=At(t).events.eventListener().add(kt.MapDOMEvents,function(t){if("wheel"==t.type&&St.mozilla&&St.version<=1.8&&t.clientX==t.originalEvent.clientX&&t.clientY==t.originalEvent.clientY){var e=i.converter.coordinatesToClientPixels(i.getCenter());t.clientX=e.getX(),t.clientY=e.getY()}s(t.type,new bt.MouseEvent(t,i),i)});function s(t,e,i){Rt.notify(i,"before"+t,i,e),e.isMapEventPrevented()||Rt.notify(i,t,i,e),n||St.mozilla&&St.version<1.9&&"contextmenu"==t&&e.isMapEventPrevented()||e.getEvent().stopPropagation()}Tt.touchscreen&&o.add(kt.MapMultiTouchEvents,function(t){s(t.type,new bt.MultiTouchEvent(t,i),i)}),Rt.observe(i,i.Events.Destruct,function(){e.cleanup(),o.removeAll()})},Ct.LayerManager=function(a){var i=Pt("<div />").addClass("YMaps-layer-container").css("z-index",bt.ZIndex.LAYER_CONTAINER)[0],n=Pt("<div />").addClass("YMaps-map-type-layer-container")[0],r=[];function o(t,e){for(var i,n=null,o=null,s=0,a=r.length;s<a;s++)r[s].getZoomRange&&(i=r[s].getZoomRange(t,e))&&(o=null==o?i.max:Math.max(o,i.max),n=null==n?i.min:Math.min(n,i.min));return{min:n,max:o}}a.getContainer().appendChild(i),i.appendChild(n),this.getContainer=function(){return i},this.add=function(t){r.push(t)},this.addToMap=function(t,e){t.onAddToMap(a,e?n:i)},this.remove=function(t){var e=Pt.inArray(t,r);-1!=e&&r.splice(e,1)},this.removeFromMap=function(t){t.onRemoveFromMap()},this.onMapUpdate=function(){It(r.slice(),"onMapUpdate")},this.onMove=function(t,e){It(r.slice(),"onMove",t,e)},this.onSmoothZoomStart=function(){It(r.slice(),"onSmoothZoomStart")},this.onSmoothZoomTick=function(t){It(r.slice(),"onSmoothZoomTick",t)},this.onSmoothZoomEnd=function(){It(r.slice(),"onSmoothZoomEnd")},this.getCopyrights=function(){for(var t,e=[],i=a.getBounds(),n=a.getZoom(),o=0,s=r.length;o<s;o++)(t=r[o].getCopyright(i,n))&&e.push(t);return e},this.getMinZoom=function(t,e){return o(t,e).min},this.getMaxZoom=function(t,e){return o(t,e).max}},(Mt=bt.Layers=new wt.ObjectStorage).get=function(t){var e=this._objects[t];return"function"==typeof e?new e:e||null},bt.MapType=function(t,e,i){function n(t,e){e["get"+t.charAt(0).toUpperCase()+t.substr(1)]=function(){return i[t]}}for(var o in t=t instanceof Array?t.slice():[],this.getLayers=function(){return t.slice()},(i=Pt.extend({},{textColor:"#000",minZoom:null,maxZoom:null},i)).name=e,this.setName=function(t){i.name=t},i)n(o,this)},(Mt=bt.TileDataSource=function(t,e,i){this._tileUrlTemplate=t,this._isTransparent=!!e,this._smoothZoomEnabled=typeof i!=Et?i:1}).ERROR_TILE_URL=kt.imageRoot+"404.gif",Mt.TRANSPARENT_TILE_URL=Mt.TRANPARENT_TILE_URL=kt.imageRoot+"404t.png",Mt.prototype={__gStrings:["","G","Ga","Gag","Gaga","Gagar","Gagari","Gagarin"],getTile:function(){return new bt.ImageTile(this)},getTileUrl:function(t,e){return this._tileUrlTemplate.replace("%d",2*(1&t.x)+(1&t.y)+1).replace("%c","x="+t.x+"&y="+t.y+"&z="+e).replace("%g","g="+this.__gStrings[(3*t.x+t.y)%8])},getErrorTileUrl:function(){return bt.TileDataSource[(this.isTransparent()?"TRANSPARENT":"ERROR")+"_TILE_URL"]},getTileUrlTemplate:function(){return this._tileUrlTemplate},setTileUrlTemplate:function(t){this._tileUrlTemplate=t},isTransparent:function(){return this._isTransparent},smoothZoomEnabled:function(){return this._smoothZoomEnabled},getTileSize:function(){return bt.TILE_SIZE}},function(){var t=new function(){var h={},l={};this.getLayerInfo=function(t,e,i,n){var o={layerId:t,callback:n},s=e.toString(8),a=s+"&"+i,r=h[a];r?(-1===Pt.inArray(t,r.layerIds)&&r.layerIds.push(t),r.listeners.push(o)):(h[a]={ll:s,z:i,layerIds:[t],listeners:[o]},window.setTimeout(function(){!function(e){var n=Pt.param({l:e.layerIds.join(","),ll:e.ll,z:e.z,lang:"ru_RU"}),t=l[n];t?t.listeners=t.listeners.concat(e.listeners):(l[n]=e,Pt.ajax({url:Ct.coverageService+"v2/?"+n,dataType:"jsonp",jsonpCallback:decodeURIComponent(n).replace(/\W/g,"_"),scriptCharset:"utf-8",cache:1,success:function(t){if(delete l[n],t&&"success"===t.status){var i=t.data;Pt.map(e.listeners,function(e){var t=Pt.grep(i,function(t){return t.id===e.layerId})[0];t&&e.callback(t)})}}}))}(h[a]),delete h[a]},0))}};function o(t,e,i){bt.Layer.call(this,e),this.id=t,this._copyright="",this._zoomRange=this._staticZoomRange=i}function e(t,e,i){function n(){o.call(this,t,e,i)}Lt(n,o),bt.Layers.add(t,n)}Lt(o,bt.Layer),Pt.extend(o.prototype,{onAddToMap:function(t){bt.Layer.prototype.onAddToMap.apply(this,arguments),this._mapListener=Rt.observe(t,t.Events.BoundsChange,this._onBoundsChange,this),this._onBoundsChange()},onRemoveFromMap:function(){this._mapListener.cleanup(),this._mapListener=null,bt.Layer.prototype.onRemoveFromMap.apply(this,arguments)},_onBoundsChange:function(){var e=this,i=this.getMap(),n=i.getCenter(),o=i.getZoom();t.getLayerInfo(this.id,n,o,function(t){n.equals(i.getCenter())&&o===i.getZoom()&&(t.copyrights&&e.setCopyright(t.copyrights.join(", ")),t.zoomRange&&e.setZoomRange({min:t.zoomRange[0],max:t.zoomRange[1]}))})},setCopyright:function(t){this._copyright!==t&&(this._copyright=t,this.getMap()&&this.getMap().updateCopyrights())},getCopyright:function(){return this._copyright},setZoomRange:function(t){this._zoomRange.min===t.min&&this._zoomRange.max===t.max||(this._zoomRange=t,this.getMap()&&this.getMap().updateZoomRange())},getZoomRange:function(t,e){return e?this._zoomRange:this._staticZoomRange}}),e("map",new bt.TileDataSource(Ct.mapTiles),{min:1,max:18}),e("sat",new bt.TileDataSource(Ct.satTiles),{min:1,max:15}),e("skl",new bt.TileDataSource(Ct.sklTiles,1,0),{min:1,max:18});var i={textColor:"#444",minZoom:0,maxZoom:7};function n(t,e){bt.MapType[t]=new bt.MapType(e,kt.types[t],i)}n("MAP",["map"]),i.textColor="#ddd",i.maxZoom=10,n("SATELLITE",["sat"]),n("HYBRID",["sat","skl"])}(),bt.Map=function(t,e){t&&(this._options=Pt.extend({ignoreResize:0,coordSystem:Dt,propagateEvents:!1},e||{}),this._native=!0,this._construct(t),this.__copyrights=new Ct.CopyrightsControl,this.addControl(this.__copyrights),this.enableDblClickZoom(),this.enableDragging(),this._options.ignoreResize||At(window).events.add("resize",this.__onResize,this),Pt.isReady||At(window).events.add("load",function(){this._inited&&this.redraw()},this))},(xt=bt.Map.prototype).Events={Update:"update",TypeChange:"typechange",AddLayer:"addlayer",RemoveLayer:"removelayer",_NeedRedraw:"_needredraw",Redraw:"redraw",BalloonOpen:"BalloonOpen",BalloonClose:"BalloonClose",MoveStart:"movestart",Move:"move",MoveEnd:"moveend",DragStart:"dragstart",Drag:"drag",DragEnd:"dragend",BoundsChange:"boundschange",ZoomRangeChange:"ZoomRangeChange",SmoothZoomStart:"smoothzoomstart",SmoothZoomEnd:"smoothzoomend",BeforeClick:"beforeclick",Click:"click",BeforeDblClick:"beforedblclick",DblClick:"dblclick",BeforeContextMenu:"beforecontextmenu",ContextMenu:"contextmenu",BeforeMouseDown:"beforemousedown",MouseDown:"mousedown",BeforeDOMMouseScroll:"beforewheel",DOMMouseScroll:"wheel",BeforeMouseUp:"beforemouseup",MouseUp:"mouseup",BeforeMouseMove:"beforemousemove",MouseMove:"mousemove",BeforeMultiTouchStart:"beforemultitouchstart",MultiTouchStart:"multitouchstart",BeforeMultiTouchMove:"beforemultitouchmove",MultiTouchMove:"multitouchmove",BeforeMultiTouchEnd:"beforemultitouchend",MultiTouchEnd:"multitouchend",Destruct:"destruct"},xt.Events.ChangeType=xt.Events.TypeChange,xt._construct=function(t){var e=this,i=Pt(t);this._inited=0,this._element=i[0],i.addClass("YMaps"),document.compatMode&&"BackCompat"==document.compatMode&&i.addClass("YMaps-quirks-mode"),St.safari&&i.addClass("YMaps-safari"),this.__overlays=[],this.__overlays_internal=[],this.__createdLayers={},this.__layers=[];var n=new Bt;this._state={cache:!1,size:n,offset:new Bt,centerInTiles:null,centerInPixels:n,_domOffset:n,getDomOffset:function(){return this.cache||e.__updateDomOffset(),this._domOffset}},this.__updateContainerSize(),this.coordSystem=this._options.coordSystem,this.tileCoordinates=new Ct.TileCoordinates(this),this.converter=new Ct.Converter(this),this.animator=new Ct.Animator(this),this.__cursorManager=new Ct.CursorManager(this._element),this.__layerManager=new Ct.LayerManager(this),this.__objectLayer=new Ct.CommonObjectLayer,this.addLayer(this.__objectLayer),this.__controlLayer=new Ct.ControlsLayer(this,this.__layerManager.getContainer(),this._options.propagateEvents),this.__initPredefControls(),this.__setNewType(bt.MapType.MAP),this._state.zoom=this.getMinZoom(),this.hint=new Ct.Hint(this),this.__listeners=[]},xt.__initPredefControls=function(){var n={},o=this;Pt.each(["Dragging","DblClickZoom","ScrollZoom","Magnifier","Ruler","HotKeys","RightButtonMagnifier"],function(t,e){var i;n[e]={enabled:0,control:null},o[i="enable"+e]||(o[i]=function(t){o.__setEnabledControl(e,1,t)}),o[i="disable"+e]||(o[i]=function(){o.__setEnabledControl(e,0)}),o[i=e.charAt(0).toLowerCase()+e.substr(1)+"Enabled"]||(o[i]=function(){return n[e].enabled})});var t=this.__layerManager.getContainer();n.Dragging.control=new Ct.DraggingControl(t),n.Magnifier.control=new Ct.MagnifierControl(t),n.RightButtonMagnifier.control=new Ct.RightButtonMagnifierControl(t),Tt.touchscreen&&(n.ScrollZoom.control=new Ct.TouchZoomControl(t)),this.__actionControls=n,this.__controls=[],this.__controlsPositions=[]},xt.__setEnabledControl=function(t,e,i){var n=this.__actionControls[t];n&&n.enabled!=e&&(e?this.addControl(n.control||(n.control=new Ct[t+"Control"]),null,i):n.enabled&&this.removeControl(n.control),n.enabled=e)},xt.enableMagnifier=function(t){this.draggingEnabled()&&this.__actionControls.Dragging.control._stopListening(),this.__setEnabledControl("Magnifier",1,t)},xt.disableMagnifier=function(){this.draggingEnabled()&&this.__actionControls.Dragging.control._beginListening(),this.__setEnabledControl("Magnifier",0)},xt.addCursor=function(t){this.__cursorManager.addCursor(t)},xt.removeCursor=function(t){this.__cursorManager.removeCursor(t)},xt.getRulerState=function(){return this.__actionControls.Ruler.control?this.__actionControls.Ruler.control.getStateString():""},xt.setRulerState=function(t){this.__actionControls.Ruler.control||(this.enableRuler(),this.disableRuler()),this.__actionControls.Ruler.control.setStateString(t)},xt.redraw=function(t,e){if(this._inited){var i=this.converter.localPixelsToCoordinates(wt.size(this.getContainer()).scale(.5).apply(Math.ceil));this.__updateContainerSize()&&(t?(this.__baseResizeCenter=this.__baseResizeCenter||this.getCenter(),this.setCenter(i),this.panTo(this.__baseResizeCenter,{callback:Ot(function(){this.__baseResizeCenter=null,e&&e.apply(null,arguments)},this)})):(this.update(),Rt.notify(this,this.Events.BoundsChange,this)),Rt.notify(this,this.Events.Redraw,this))}},xt.__updateContainerSize=function(){var t=wt.size(this._element);return this._state.size.equals(t)?this.__updateDomOffset():(this._state.size=t,this._state.centerInPixels=new Bt(Math.ceil(t.x/2),Math.ceil(t.y/2)),1)},xt.__updateDomOffset=function(){var t=this._element,e=Pt(this._element).offset(),i=parseInt(Pt.curCSS(t,"borderLeftWidth",!0),10),n=parseInt(Pt.curCSS(t,"borderTopWidth",!0),10);return e=new Bt(e.left,e.top).moveBy(new Bt(i,n)),this._state._domOffset.equals(e)?0:(this._state._domOffset=e,1)},xt.panTo=function(t,n){n=n||{};var o=t instanceof Array?t:[t],s=n.callback,a=this;if(!this._inited)return this.setCenter(o.pop()),void(s&&s(bt.State.SUCCESS));function r(t){if(o.length&&t!=bt.State.FAILURE){var e=o.shift(),i=a.converter.coordinatesToLocalPixels(a._restrictCenter(e)).diff(a._state.centerInPixels);3*a._state.size.x<Math.abs(i.x)||3*a._state.size.y<Math.abs(i.y)?n.flying?a._flyBy(i.neg(),n):(a.setCenter(e),r(bt.State.SUCCESS)):a.moveBy(i.neg(),1,n)}else s&&s(t)}(n.callback=r)()},xt._flyBy=function(e,i){for(var n=this.getZoom(),t=n,o=3*this._state.size.x,s=3*this._state.size.y;o<Math.abs(e.x)||s<Math.abs(e.y);)e.scale(.5),t--;function a(t){i&&i.callback&&i.callback(t)}var r=this;this.setZoom(t,{smooth:1,callback:function(t){t==bt.State.SUCCESS?r.moveBy(e,1,{callback:function(t){t==bt.State.SUCCESS?r.setZoom(n,{smooth:1,callback:a}):a(t)}}):a(t)}})},xt.moveBy=function(t,e,i){e?this.__getSmoothMoving().start(t,i):(this._moveStart(),this._move(t),this._moveEnd(),i&&i.callback&&i.callback(bt.State.SUCCESS))},xt.startMove=function(t,e){(e=e||{}).nonstop=1,this.__getSmoothMoving().start(t,e)},xt.stopMove=function(){this.__getSmoothMoving().stop(0)},xt.__getSmoothMoving=function(){return this.__smoothMover=this.__smoothMover||new Ct.SmoothMoving(this)},xt._moveStart=function(){this._movingCnt=(this._movingCnt||0)+1,1==this._movingCnt&&Rt.notify(this,this.Events.MoveStart,this)},xt._move=function(t){this.animator.move(t)},xt._moveEnd=function(){this._movingCnt-=1,this._movingCnt||(Rt.notify(this,this.Events.MoveEnd,this),Rt.notify(this,this.Events.BoundsChange,this))},xt._dragStart=function(){this._draggingCnt=(this._draggingCnt||0)+1,1==this._draggingCnt&&Rt.notify(this,this.Events.DragStart,this)},xt._drag=function(){this._draggingCnt&&Rt.notify(this,this.Events.Drag,this)},xt._dragEnd=function(){this._draggingCnt-=1,this._draggingCnt||Rt.notify(this,this.Events.DragEnd,this)},xt.update=function(){this._inited&&(this.__updatePos(),this.__layerManager.onMapUpdate(),Rt.notify(this,this.Events.Update,this))},xt.__onResize=function(){this.__resizeTimeout&&window.clearTimeout(this.__resizeTimeout);var t=this;this.__resizeTimeout=window.setTimeout(function(){t.redraw(1),t.__resizeTimeout=null},0)},xt.__updatePos=function(){this._state.offset=new Bt},xt.setCenter=function(t,e,i){var n=this.coordSystem.fromCoordPoint(this._restrictCenter(t)),o=this._inited,s=0,a=i&&this.__setNewType(i);this.__getZoomer().stop(),this._state.centerInTiles&&this._state.centerInTiles.equals(n)||(this._state.centerInTiles=n,o||(this.__init(),this.__updatePos(),this._inited=1),this._state.zoom=wt.boundaryRestrict(this._state.zoom,this.getCurrentMinZoom(),this.getCurrentMaxZoom()),s=1),typeof e!=Et&&e!=this._state.zoom&&(this._state.zoom=wt.boundaryRestrict(e,this.getCurrentMinZoom(),this.getCurrentMaxZoom()),s=1),!a&&o||(this.__applyCurType(),o&&Rt.notify(this,this.Events.TypeChange,this)),o||(this.__addLayers(),this.__addOverlays(),this.__addControls(),this.getRulerState()&&!this.rulerEnabled()&&(this.enableRuler(),this.disableRuler())),s&&o&&(this.update(),Rt.notify(this,this.Events.BoundsChange,this))},xt._restrictCenter=function(t){return this.coordSystem.restrict(t)},xt.__init=function(){if(this.__updateContainerSize(),St.opera&&St.version<9.5){function t(){Pt(i.__layerManager.getContainer()).toggleClass("fakeClassName"),n=null}function e(){n=n||window.setTimeout(t,0)}var i=this,n=null;this.__listeners.push(Rt.observe(this,this.Events.Move,e)),this.__listeners.push(Rt.observe(this,this.Events._NeedRedraw,e))}this.__listeners=this.__listeners.concat(Rt.observe(this,[this.Events.BoundsChange,this.Events.TypeChange],this.updateZoomRange)),this._native&&(Ct.statCount({share:!0,pid:443,cid:72717,path:"created.1_1"}),this.__setupVisibilityCheck())},xt.getCenter=function(t){var e=this.animator.getState().startPixelCenter;return e&&this.coordSystem.toCoordPoint(e,t)},xt.getBounds=function(t){if(!this._inited)return null;var e=this.getContainerSize(),i=new bt.Point(-e.x%2/2,-e.y%2/2),n=this.converter.localPixelsToCoordinates(new Bt(-i.x,e.y-i.y),1),o=this.converter.localPixelsToCoordinates(new Bt(e.x-i.x,-i.y),1),s=this.coordSystem;if(t)return s.getCoordBounds(n,o);var a=s.fromCoordPoint(n),r=s.fromCoordPoint(o),h=s.getWorldSize(),l=this.coordSystem.getCoordPoint(n.getX(),n.getY()),c=this.coordSystem.fromCoordPoint(l,o);return r.getX()-a.getX()>h.getX()&&Math.abs(c.getX()-a.getX())>=h.getX()-1e-7&&(a.setX(this._state.centerInTiles.x+.5*h.getX()+.5),r.setX(this._state.centerInTiles.x+.5*h.getX()-.5)),r.getY()-a.getY()>h.getY()&&Math.abs(c.getY()-a.getY())>=h.getY()-1e-7&&(a.setY(this._state.centerInTiles.y+.5*h.getY()+.5),r.setY(this._state.centerInTiles.y+.5*h.getY()-.5)),s.getCoordBounds(s.toCoordPoint(a),s.toCoordPoint(r))},xt.setBounds=function(t){this._inited||this.__updateContainerSize(),this.setCenter(t.getCenter(),t.getMapZoom(this))},xt.setType=function(t){this.__setNewType(t)&&(this._inited?(this.__applyCurType(),Rt.notify(this,this.Events.TypeChange,this)):this.updateZoomRange())},xt.__setNewType=function(t){var e=this._state.type;return!!(t&&t instanceof bt.MapType&&e!=t)&&(this._state.type=t,e&&(this.__mapTypeAction("remove",e),this._inited&&this.__mapTypeAction("removeFromMap",e)),this.__mapTypeAction("add",t),!0)},xt.__applyCurType=function(){this.__mapTypeAction("addToMap",this._state.type)},xt.__mapTypeAction=function(t,e){for(var i=0,n=e.getLayers(),o=n.length;i<o;i++)this.__layerManager[t](this.__prepareLayer(n[i]),1)},xt.getType=function(){return this._state.type},xt.__prepareLayer=function(t){return"string"==typeof t?this.__createdLayers[t]||(this.__createdLayers[t]=bt.Layers.get(t)):t},xt.addLayer=function(t){this.__layers.push(t),this._inited&&this.__assignLayer(t,1)},xt.__assignLayer=function(t,e){t=this.__prepareLayer(t),this.__layerManager[e?"add":"remove"](t),this.__layerManager[e?"addToMap":"removeFromMap"](t),Rt.notify(this,this.Events[e?"AddLayer":"RemoveLayer"],this,t),this.updateZoomRange()},xt.__addLayers=function(){for(var t=0,e=this.__layers.length;t<e;t++)this.__assignLayer(this.__layers[t],1)},xt.removeLayer=function(t){var e=Pt.inArray(t,this.__layers);-1!==e&&(this.__layers.splice(e,1),this._inited&&this.__assignLayer(t,0))},xt._getLayerCopyrights=function(){return this.__layerManager.getCopyrights()},xt.setZoom=function(t,e){this.__getZoomer().zoomTo(Number(t),e)},xt.zoomBy=function(t,e){this.__getZoomer().zoomBy(t,e)},xt.__getZoomer=function(){return this.__zoomer||(this.__zoomer=new Ct.Zoomer(this))},xt.getZoom=function(){return this._state.zoom},xt.setMaxZoom=function(t){this._userMaxZoom=t,this.updateZoomRange()},xt.setMinZoom=function(t){this._userMinZoom=t,this.updateZoomRange()},Pt.each(["Min","Max"],function(t,e){var r=e.toLowerCase(),h="min"==r?"max":"min",l="get"+e+"Zoom",c="max"==r;xt[l]=function(t,e,i){var n=this._inited?this.__layerManager[l](t||this.getBounds(),i):null;if(!e){var o=this._state.type[l]();null!=o&&(n=null==n?o:Math[r](n,o));var s=c?this._userMaxZoom:this._userMinZoom;typeof s!=Et&&null!==s&&(n=null==n?s:Math[h](n,s));var a=c?this.coordSystem.getMaxZoom():0;n=null==n?a:Math[h](n,a)}return n},xt["getCurrent"+e+"Zoom"]=function(){return this[l](null,null,!0)}}),xt.updateZoomRange=function(){var t=this.getCurrentMinZoom(),e=this.getCurrentMaxZoom();this.__zoomRange&&this.__zoomRange.min==t&&this.__zoomRange.max==e||(this.__zoomRange={min:t,max:e},bt.Events.notify(this,this.Events.ZoomRangeChange,this,{min:t,max:e}))},xt.getContainer=function(){return this._element},xt.getContainerSize=function(){return this._state.size.copy()},xt.addOverlay=function(t,e){this.__overlays.push(t),this.__overlays_internal.push(!!e),this._inited&&this.__objectLayer.add(t)},xt.__addOverlays=function(){for(var t=0,e=this.__overlays.length;t<e;t++)this.__objectLayer.add(this.__overlays[t])},xt.removeOverlay=function(t){var e=Pt.inArray(t,this.__overlays);-1!==e&&(this.__overlays.splice(e,1),this.__overlays_internal.splice(e,1),this._inited&&this.__objectLayer.remove(t))},xt.removeAllOverlays=function(){for(var t=0,e=this.__overlays.slice(),i=this.__overlays_internal.slice(),n=e.length;t<n;t++)i[t]||this.removeOverlay(e[t])},xt.addControl=function(t,e,i){this.__controls.push(t),this.__controlsPositions.push(e),this._inited&&t.onAddToMap(this,e,i)},xt.__addControls=function(){for(var t=0,e=this.__controls.length;t<e;t++)this.__controls[t].onAddToMap(this,this.__controlsPositions[t])},xt.removeControl=function(t){var e=Pt.inArray(t,this.__controls);-1!==e&&(this.__controls.splice(e,1),this.__controlsPositions.splice(e,1),this._inited&&t.onRemoveFromMap())},xt.openBalloon=function(t,e,i){if(t){i=i||{},this.closeBalloon();var n=this.__balloon;n||(this.__balloon=n=new bt.Balloon,this.__listeners.push(Rt.observe(n,n.Events.Close,this.closeBalloon,this))),(this.__curBalloon=n).setGeoPoint(t.copy()),n.setContent(e),this.__balloonCloseCallback="function"==typeof i.onClose?i.onClose:null,n.setOptions(i,1),this.addOverlay(n),Rt.notify(this,this.Events.BalloonOpen,this)}},xt.closeBalloon=function(){return this.__curBalloon?(this.__balloonCloseCallback&&this.__balloonCloseCallback(),this.__curBalloon=null,this.__balloon._setContent(null),this.removeOverlay(this.__balloon),Rt.notify(this,this.Events.BalloonClose,this),1):0},xt.getBalloon=function(){return this.__curBalloon},xt.addCopyright=function(t){this.__copyrights.addCopyright(t)},xt.removeCopyright=function(t){this.__copyrights.removeCopyright(t)},xt.updateCopyrights=function(){this.__copyrights&&this.__copyrights.update()},xt.__setupVisibilityCheck=function(){var t=this;Ct.counterShare&&(this.__visibilityCheckInterval=window.setInterval(function(){t.__checkVisibility()},1e3))},xt.__checkVisibility=function(){var t=this.getContainerSize();if(0<t.x&&0<t.y){var e=Ct.checkVisibility(this._element);"visible"!=e&&"unable"!=e||this.__teardownVisibilityCheck(),"visible"==e&&(Ct.statCount({pid:443,cid:72717,path:"visible.1_1"}),this.__copyrights.checkVisibility())}},xt.__teardownVisibilityCheck=function(){this.__visibilityCheckInterval&&(window.clearInterval(this.__visibilityCheckInterval),this.__visibilityCheckInterval=null)},xt.destructor=function(){Rt.notify(this,this.Events.Destruct,this),this.__listeners&&It(this.__listeners,"cleanup"),this.__resizeTimeout&&window.clearTimeout(this.__resizeTimeout),this._element&&Pt(this._element).empty(),this._options&&!this._options.ignoreResize&&At(window).events.remove("resize",this.__onResize,this),this.__teardownVisibilityCheck(),this.converter=this.__overlays=this.__overlays_internal=this._element=this.__controls=this.__actionControls=this.__controlsPositions=this.__layers=this._inited=this.__layerManager=this.__objectLayer=this._graphicsLayer=this.__controlLayer=this._state=this.__createdLayers=this.__copyrights=this.__balloon=this.__curBalloon=this.__listeners=null},Mt=Ct.CommonObjectLayer=function(){bt.Group.call(this),Ct.ALayer.call(this,{zIndex:bt.ZIndex.COMMON_OBJECT_LAYER}),Pt(this.getContainer()).addClass("YMaps-common-object-layer"),this.__listeners=[Rt.observe(this,this.Events.Add,function(t,e,i){this.__addObjectToMap(e,i)},this),Rt.observe(this,this.Events.Remove,function(t,e,i){this.__removeObjectFromMap(e,i)},this)]},xt=Lt(Mt,Ct.ALayer),Pt.extend(!0,Mt.prototype,bt.Group.prototype),xt.onAddToMap=function(t,e){Ct.ALayer.prototype.onAddToMap.call(this,t,e),this.forEach(this.__addObjectToMap,this)},xt.__addObjectToMap=function(t){this.getMap()&&t.onAddToMap(this.getMap(),this.getContainer())},xt.onRemoveFromMap=function(){this.forEach(this.__removeObjectFromMap,this),Ct.ALayer.prototype.onRemoveFromMap.call(this)},xt.__removeObjectFromMap=function(t){this.getMap()&&t.onRemoveFromMap()},xt.onSmoothZoomStart=function(){Pt(this.getContainer()).css("visibility","hidden")},xt.onSmoothZoomEnd=function(){Pt(this.getContainer()).css("visibility","visible")},xt.onMapUpdate=function(){Ct.ALayer.prototype.onMapUpdate.call(this),It(this._objects.slice(),"onMapUpdate")},bt.Templates=new wt.ObjectStorage,(Mt=bt.Styles=new wt.ObjectStorage).DefaultStyleKey="default#style",Mt=Ct.ABaseLayout=function(t,e){this._context=t,this._map=e,this._parentNode=null},(xt=Mt.prototype)._setContent=function(t,e){this._contentLayout&&this._contentLayout.onRemoveFromParent(),t&&t.onAddToParent(e),this._contentLayout=t},xt.getRootNodes=function(){return this._$elements},xt.onAddToParent=function(t){this._parentNode=t,Pt(t).append(this._$elements)},xt.onRemoveFromParent=function(){this._parentNode=null,this._$elements.removeFromDom()},Mt=Ct.TextLayout=function(t,e,i,n){Ct.ABaseLayout.call(this,t,e),this._text=String(i),(this._isTemplate=n)||(this.update=function(){})},(xt=Lt(Mt,Ct.ABaseLayout)).onAddToParent=function(t){this._parentNode=t,this._isTemplate||!this._$elements?(this._$elements=Pt("<div />"),this._$elements.html(this._isTemplate?this.__prepareTemplate(this._text,this._context):this._text),this._$elements=this._$elements.contents(),Pt(t).append(this._$elements),St.msie&&St.version<7&&this.__pngFix()):Pt(t).append(this._$elements)},xt.__pngFix=function(){for(var t=this._$elements.filter("img").add(this._$elements.find("img")),o=this,e=0,i=t.length;e<i;e++)!function(i){var n=At(i).events.eventListener().add("load",function(){var t=Pt("<div />").css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i.src+"', sizingMethod='scale')"})[0];wt.size(t,wt.size(i));var e=o._$elements.index(i);-1!=e&&(o._$elements[e]=t),Pt(i).replaceWith(t),n.removeAll()})}(t[e])},xt.__prepareTemplate=function(t,e){var i=new RegExp("\\$\\[[^\\]]*\\]","g"),n=t.match(i);if(n)for(var o,s=0,a=n.length,r=new RegExp("\\|([^\\]]*)");s<a;s++)null==(o=this.__getTemplateVal(n[s],e))&&(o=n[s].match(r))&&2==o.length&&(o=o[1]),t=t.replace(n[s],null==o?"":o);return t},xt.__getTemplateVal=function(t,e){if(t){for(var i=e,n=new RegExp("[^\\$\\[\\]\\|\\s]+"),o=t.match(n)[0].split("."),s="";o.length&&i;)"style"==(s=o.shift())&&i==e&&"function"==typeof e.getComputedStyle?i=e.getComputedStyle():("0"!=s||i instanceof Array)&&(i=i[s]);return i}return null},xt.update=function(){var t=Pt("<div />");t.html(this.__prepareTemplate(this._text,this._context)),t=t.contents(),this._parentNode&&(this._$elements.remove(),t.appendTo(this._parentNode)),this._$elements=t,St.msie&&St.version<7&&this.__pngFix()},Mt=Ct.DOMLayout=function(t,e,i){Ct.ABaseLayout.call(this,t,e),this._$elements=Pt(i)},(xt=Lt(Mt,Ct.ABaseLayout)).update=wt.NULL,bt.Template=function(t){this._text=t||""},bt.Template.prototype={build:function(t,e){return new Ct.TextLayout(t,e,this._text,1)}},bt.LayoutTemplate=function(t){this._layoutClass=t},bt.LayoutTemplate.prototype={build:function(t,e,i){return new this._layoutClass(t,e,i)}},B("default#iconContent",wt.NULL),B("default#hintContent",function(t){return t.name||null}),B("default#balloonContent",function(t){return"<b>"+(t.name||"")+"</b><div>"+(t.description||"")+"</div>"}),(Mt=bt.Style=function(t){this.parentStyle=t}).copy=function(t){var e=bt.Style.extendStyle({},t,0);return e.parentStyle=t.parentStyle,e},Mt.extendStyle=function(t,e,i){var n,o,s;for(var a in e)n=e[a],"parentStyle"!=a&&typeof n!=Et&&(o=t[a],"shadow"==a&&null===o||(s=typeof o==Et||i&&null===o,"template"==a||null===n||"object"!=typeof n?s&&(t[a]=n):n.copy?s&&(t[a]=n.copy()):(s&&(t[a]={}),bt.Style.extendStyle(t[a],n,i))));return t},bt.IconStyle=function(t){this.template=t},bt.IconShadowStyle=function(t){this.template=t},bt.IconContentStyle=function(t){this.template=t},bt.BalloonStyle=function(t){this.template=t},bt.BalloonContentStyle=function(t){this.template=t},bt.HintStyle=function(t){this.template=t},bt.HintContentStyle=function(t){this.template=t},bt.LineStyle=function(){},bt.PolygonStyle=function(){bt.LineStyle.call(this)},new function(){function t(t,e){var i=new bt.Style(null);return i.iconStyle={offset:new Bt(-7,-28),href:kt.imageRoot+"micro/pm"+e+"s.png",size:new Bt(28,29),shadow:null,template:"default#"+t+"PointIcon"},bt.Styles.add("default#"+t+"Point",i),i}var e,i,n,o={white:"wt",green:"gn",red:"rd",yellow:"yw",darkblue:"db",night:"nt",grey:"gr",blue:"bl",orange:"or",darkorange:"do",pink:"pn",violet:"vv"};for(var s in o)t(s,o[s]),i=o[e=s],n=void 0,(n=new bt.Style(null)).iconStyle={offset:new Bt(-7,-19),href:kt.imageRoot+"placemarks/pm"+i+"s.png",size:new Bt(19,20),shadow:null,template:"default#"+e+"PointIcon"},bt.Styles.add("default#"+e+"SmallPoint",n);bt.Styles.add(bt.Styles.DefaultStyleKey,t("lightblue","lb"))},Ct.Popup=function(t,e){e=e||{},this._map=t,this._style=e.style||bt.AGeoObject.fullStyle.hintStyle,this._vpNode=document.body,this._vpPaddings=this.DEFAULT_VIEWPORT_PADDINGS,this._maxSize=[0,0],this.__actualMaxSize=[0,0],this.__setMaxSize(e.maxWidth||0,e.maxHeight||0),this._layoutContext=null,this._currentLayoutContext=null,this.__showed=0,this._holdOnMouseOver=typeof e.holdOnMouseOver!=Et?e.holdOnMouseOver:1,this._onHide=e.onHide||null,this._recalcActualMaxSize(),this._showTimeout=this.DEFAULT_SHOW_TIMEOUT,typeof e.showTimeout!=Et&&this._setShowTimeout(e.showTimeout),this._hideTimeout=this.DEFAULT_HIDE_TIMEOUT,typeof e.hideTimeout!=Et&&this._setHideTimeout(e.hideTimeout),this.__onShowTimeout=Ot(this.quickShow,this),this.__onHideTimeout=Ot(this.quickHide,this),this._owner=e.owner},(xt=Ct.Popup.prototype).Events={Hide:"Hide",Show:"Show"},xt.DEFAULT_SHOW_TIMEOUT=250,xt.DEFAULT_HIDE_TIMEOUT=700,xt.DEFAULT_VIEWPORT_PADDINGS=[10,10,10,10],xt.setPosition=function(t){t instanceof Bt&&(this._position=t.copy(),this._layout&&this.__showed&&this.__applyPosition())},xt.getPosition=function(){return this._position},xt.__applyPosition=function(){if(this._position){var t=this._map.converter.localPixelsToClientPixels(this._position);t.moveBy(new Bt(Pt(window).scrollLeft(),Pt(window).scrollTop()));var e=this._getActualViewportBounds(),i=e.getLeft(),n=e.getTop(),o=e.getRight(),s=e.getBottom(),a=this._layout.getSize?this._layout.getSize():wt.size(this._container),r=t.x+a.x,h=t.y+a.y;o<r?t.x-=r-o:t.x<i&&(t.x+=i-t.x),s<h?t.y-=h-s:t.y<n&&(t.y+=n-t.y),wt.position(this._container,t.moveBy(this._getBodyOffset().neg()))}},xt._getActualViewportBounds=function(){var t=this._vpPaddings,e=t[0],i=t[1],n=t[2],o=t[3],s=Pt(window),a=s.scrollLeft(),r=s.scrollTop(),h=s.width(),l=s.height(),c=o+i,u=e+n;if(h<c){var d=Math.ceil((c-h)/2);o-=d,i-=d}if(l<u){var p=Math.ceil((u-l)/2);e-=p,n-=p}return new bt.Bounds(new Bt(o+a,-n+l+r),new Bt(-i+h+a,e+r))},xt._getBodyOffset=function(){var t=Pt("body"),e=t.css("position");if("absolute"!=e&&"relative"!=e)return new Bt(0,0);var i=t.offset();return new Bt(i.left,i.top)},xt._setStyle=function(t){this._style!=t&&(this._style=t,this.update())},xt.update=function(){bt.Templates.get(this._style.template)==this._currentTemplate&&this._currentLayoutContext==this._layoutContext&&this._layout?this.__showed&&this._layout.update():(this._removeLayout(),this.__showed&&this._recreate())},xt._recreate=function(){this._removeLayout(),this._createLayout(),this._layout&&(this.__rewriteContent(),this._layout.setMaxSize&&this._layout.setMaxSize.apply(this._layout,this.__actualMaxSize),this.__showed&&this.__showLayout())},xt._removeLayout=function(){this._layout&&(At(this._container).events.remove("mouseenter",this._onMouseOver,this),this.__showed&&this._layout.onRemoveFromParent(),this._layout=null)},xt._createLayout=function(){this._container||(this._container=document.createElement("div"),this._container.style.zIndex=bt.ZIndex.POPUP,this._container.className="YMaps-popup");var t=bt.Templates.get(this._style.template);t=t||bt.Templates.get(bt.AGeoObject.fullStyle.hintStyle.template),this._currentTemplate=t,this._currentLayoutContext=this._layoutContext,this._layout=t.build(this._layoutContext,this._map,this._owner),this._layout.onAddToParent(this._container)},xt.__showLayout=function(){this._container.style.visibility="hidden",this._vpNode.appendChild(this._container),this._layout.update(),this.__applyPosition(),this._container.style.visibility="visible"},xt.setContent=function(t){this._content=t,this._contentLayout=wt.normalizeContent(t),this._layout&&(this.__rewriteContent(),this.__showed&&(this._layout.update(),this.__applyPosition()))},xt.getContent=function(){return this._content},xt.getLayout=function(){return this.__showed?this._layout:null},xt.getContentLayout=function(){return this.__showed&&this._contentLayout||null},xt.__rewriteContent=function(){this._layout.setContent&&this._layout.setContent(this._contentLayout)},xt.setOptions=function(t,e){t=t||{};var i=e?{style:bt.AGeoObject.hintStyle,maxWidth:0,maxHeight:0,showTimeout:this.DEFAULT_SHOW_TIMEOUT,hideTimeout:this.DEFAULT_HIDE_TIMEOUT,holdOnMouseOver:1,onHide:null,layoutContext:null}:this.getOptions();for(var n in t)i[n]=t[n];this._layoutContext=i.layoutContext,this.__setMaxSize(i.maxWidth,i.maxHeight),this._recalcActualMaxSize(),this._setShowTimeout(i.showTimeout),this._setHideTimeout(i.hideTimeout),this._holdOnMouseOver=i.holdOnMouseOver,this._onHide=i.onHide,this._setStyle(i.style)},xt.getOptions=function(){return{style:this._style,maxWidth:this._maxSize[0],maxHeight:this._maxSize[1],showTimeout:this._showTimeout,hideTimeout:this._hideTimeout,holdOnMouseOver:this._holdOnMouseOver,onHide:this._onHide,layoutContext:this._layoutContext}},xt.__setMaxSize=function(t,e){t=Math.max(t,0)||0,e=Math.max(e,0)||0;var i=0;return this._maxSize[0]!=t&&(this._maxSize[0]=t,i=1),this._maxSize[1]!=e&&(this._maxSize[1]=e,i=1),i},xt._recalcActualMaxSize=function(){var t=this._getActualViewportBounds();this.__actualMaxSize=[Math.min(t.getRight()-t.getLeft(),this._maxSize[0]||1/0),Math.min(t.getBottom()-t.getTop(),this._maxSize[1]||1/0)],this._layout&&(this._layout.setMaxSize&&this._layout.setMaxSize.apply(this._layout,this.__actualMaxSize),this.__showed&&(this._layout.update(),this.__applyPosition()))},xt._setShowTimeout=function(t){"number"!=typeof t||isNaN(t)||(this._showTimeout=t)},xt._setHideTimeout=function(t){"number"!=typeof t||isNaN(t)||(this._hideTimeout=t)},xt._clearAllTimeouts=function(){this._clearShowTimeout(),this._clearHideTimeout()},xt._clearShowTimeout=function(){this.__showTimeoutID&&(window.clearTimeout(this.__showTimeoutID),this.__showTimeoutID=null)},xt._clearHideTimeout=function(){this.__hideTimeoutID&&(window.clearTimeout(this.__hideTimeoutID),this.__hideTimeoutID=null)},xt.show=function(t){this._clearHideTimeout(),t&&this.setPosition(t),this.__showed||(0==this._showTimeout?this.quickShow(t):this.__showTimeoutID||(this.__showTimeoutID=window.setTimeout(this.__onShowTimeout,this._showTimeout)))},xt.quickShow=function(t){this._clearAllTimeouts(),t&&this.setPosition(t),this.__showed||(this.__showed=1,this._layout?(this._layout.onAddToParent(this._container),this.__showLayout()):this._recreate(),Rt.notify(this,this.Events.Show,this),this._hiding=0,At(this._container).events.add("mouseenter",this._onMouseOver,this))},xt.hide=function(){this._hiding=1,this._clearShowTimeout(),this.__showed?0==this._hideTimeout?this.quickHide():this.__hideTimeoutID||(this.__hideTimeoutID=window.setTimeout(this.__onHideTimeout,this._hideTimeout)):this._onHide&&this._onHide()},xt.quickHide=function(){this._clearAllTimeouts(),!this.__showed||this._holdOnMouseOver&&this.__isMouseOver||this._hide()},xt._hide=function(){this._clearAllTimeouts(),this.__showed&&(this.__showed=0,this.__isMouseOver=0,At(this._container).events.remove("mouseenter",this._onMouseOver,this).remove("mousemove",this._onMouseOut,this),this._layout.onRemoveFromParent(),this._vpNode.removeChild(this._container),this._onHide&&this._onHide(),Rt.notify(this,this.Events.Hide,this))},xt.isShown=function(){return this.__showed},xt._onMouseOver=function(t){this.__isMouseOver=1,this._holdOnMouseOver&&this._clearAllTimeouts(),At(this._container).events.remove("mouseenter",this._onMouseOver,this).add("mouseleave",this._onMouseOut,this)},xt._onMouseOut=function(t){this.__isMouseOver=0,At(this._container).events.remove("mouseleave",this._onMouseOut,this).add("mouseenter",this._onMouseOver,this),this._holdOnMouseOver&&this._hiding&&this.hide()},xt.destructor=function(){this._clearAllTimeouts(),this._removeLayout(),this._vpNode=null},function(){var a;Mt=Ct.Hint=function(t){this.__popup=new Ct.Popup(t,{owner:this}),this._offset=null,this._onHide=null;var e=this;Rt.observe(this.__popup,this.__popup.Events.Show,function(){Rt.notify(this,this.Events.Show,this)},this),Rt.observe(this.__popup,this.__popup.Events.Hide,function(){Rt.notify(this,this.Events.Hide,this)},this),this._onHideCallback=function(){e._onHide&&(e._onHide(),e._onHide=null)}},(xt=Mt.prototype).Events={Hide:"Hide",Show:"Show"},xt.show=function(t,e,i){var n=this.isShown();n&&Rt.notify(this,this.Events.Hide,this),this._onHideCallback(),this.setOptions(i),this.setContent(e),this.__popup.show(t.copy().moveBy(this._offset)),n&&Rt.notify(this,this.Events.Show,this)},xt.setOptions=function(t){t=t||{};var e={style:bt.AGeoObject.fullStyle.hintStyle,showTimeout:250,maxWidth:750,maxHeight:300,offset:new Bt(15,15)};for(var i in t)e[i]=t[i];var n=e.hintOffset||e.offset;this._offset&&!this._offset.equals(n)&&this.isShown()&&this.__popup.setPosition(this.__popup._position.copy().moveBy(this._offset.neg()).moveBy(n)),this._offset=n,this._onHide=e.onHide,e.onHide=this._onHideCallback,this.__popup.setOptions(e,1)},xt.setContent=function(t){this.__popup.setContent(t)},xt.getLayout=function(){return this.__popup.getLayout()},xt.getContentLayout=function(){return this.__popup.getContentLayout()},xt.moveTo=function(t){this.__popup.setPosition(t.copy().moveBy(this._offset))},xt.isShown=function(){return this.__popup.isShown()},xt.hide=function(t){this.__popup.setOptions({hideTimeout:typeof t==Et?this.__popup.DEFAULT_HIDE_TIMEOUT:t},0),this.__popup.hide()};function t(t,e){Ct.ABaseLayout.call(this,t,e);var i=this._$elements=Pt('<div class="YMaps-b-balloon-point">                        <div class="YMaps-b-balloon YMaps-b-balloon_hint">                            <table class="YMaps-b-balloon-frame">                            <tr>                                <td class="YMaps-b-balloon-tl"><i class="YMaps-b-balloon-bit"><i></i></i></td>                                <td class="YMaps-b-balloon-t"><i class="YMaps-b-balloon-bit"><i></i></i></td>                                <td class="YMaps-b-balloon-tr"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            </tr>                            <tr>                                <td class="YMaps-b-balloon-ml"></td>                                <td class="YMaps-b-balloon-m">                                    <div class="YMaps-b-balloon-content"></div>                                </td>                                <td class="YMaps-b-balloon-mr"></td>                            </tr>                            <tr>                                <td class="YMaps-b-balloon-b" colspan="3">                                    <i class="YMaps-b-balloon-corners">                                        <i class="YMaps-b-balloon-bit"><i></i></i>                                        <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_l"><i></i></i>                                        <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_r"><i></i></i>                                    </i>                                </td>                            </tr>                            </table>                        </div>                    </div>');this._nodes={visContainer:i.find(".YMaps-b-balloon"),content:i.find(".YMaps-b-balloon-content"),table:i.find(".YMaps-b-balloon-frame")},this._topNode=i[0],this._size=null,this._hasContent=!1}(xt=Lt(t,Ct.ABaseLayout)).DEFAULT_MIN_WIDTH=42,xt.update=function(){if(this._parentNode&&this._hasContent){St.msie&&this._$elements.toggleClass("fakeClassName");var t=this._nodes.content,e=this._maxSize,i=this._nodes.visContainer;(!a||a.x<0)&&(a=new bt.Point(i.find(".YMaps-b-balloon-ml").width()+i.find(".YMaps-b-balloon-mr").width()-2,i.find(".YMaps-b-balloon-t").height()+i.find(".YMaps-b-balloon-b").height()),St.opera&&9.5<=St.version&&(a.x-=1)),i.css("width","10000px"),t.css({width:"",height:"",overflow:"",float:"left"});var n=t.width();("mac"==Pt.os.name&&St.mozilla||St.msie&&9==St.ieDocumentMode)&&n++;var o=n+a.getX();e[0]&&o>e[0]?o=e[0]:o<this.DEFAULT_MIN_WIDTH&&(o=this.DEFAULT_MIN_WIDTH),t.css("width",Math.max(0,o-a.getX()));var s=t.height()+a.getY();e[1]&&s>e[1]&&(s=e[1]),t.css({height:Math.max(0,s-a.getY()),overflow:"hidden",float:""}),i.css("width","")}},xt.setMaxSize=function(t,e){this._maxSize=[t,e]},xt.setContent=function(t){if(this._setContent(t,this._nodes.content[0]),t){this._$elements.css({display:""});var e=this;wt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()}),this._hasContent=!0}else this._$elements.css({display:"none"}),this._hasContent=!1;this._size=null},xt.getSize=function(){return this._size||(this._size=wt.size(this._nodes.table[0])),this._size},bt.Templates.add("default#hint",new bt.LayoutTemplate(t))}(),Mt=bt.Balloon=function(t){t=t||{},this._style=t.style||bt.AGeoObject.fullStyle.balloonStyle,this._layoutContext=null,this._currentLayoutContext=null,this._maxSize=[0,0],this.__setMaxSize(t.maxWidth||0,t.maxHeight||0),this._hasCloseButton=typeof t.hasCloseButton==Et?1:t.hasCloseButton,this._margin=this.MARGIN,typeof t.margin!=Et&&this.__setMargin.apply(this,[].concat(t.margin)),this._mapAutoPan=typeof t.mapAutoPan==Et?1:t.mapAutoPan;var e=this;this.__closeHandler=function(t){e._onCloseClick(t)}},(xt=Mt.prototype).Events={Close:"Close",CloseButtonClick:"Close"},xt.MARGIN=[33,10,20,33],xt.setOptions=function(t,e){t=t||{};var i=e?{style:bt.AGeoObject.fullStyle.balloonStyle,maxWidth:0,maxHeight:0,hasCloseButton:1,margin:this.MARGIN,mapAutoPan:1,layoutContext:null}:this.getOptions();for(var n in t)i[n]=t[n];this._layoutContext=i.layoutContext,this._setHasCloseButton(i.hasCloseButton),this._setMaxSize(i.maxWidth,i.maxHeight),this.__setMargin.apply(this,[].concat(i.margin)),this._mapAutoPan=i.mapAutoPan,this._setStyle(i.style)},xt.getOptions=function(){return{style:this._style,maxWidth:this._maxSize[0],maxHeight:this._maxSize[1],hasCloseButton:this._hasCloseButton,margin:this._margin,mapAutoPan:this._mapAutoPan,layoutContext:this._layoutContext}},xt._setMaxSize=function(t,e){this.__setMaxSize(t,e)&&this._layout&&this._layout.setMaxSize&&(this._layout.setMaxSize(this._maxSize[0],this._maxSize[1]),this._parentContainer&&(this._layout.update(),this.__updatePosition()))},xt.__setMaxSize=function(t,e){t=Math.max(t,0)||0,e=Math.max(e,0)||0;var i=0;return this._maxSize[0]!=t&&(this._maxSize[0]=t,i=1),this._maxSize[1]!=e&&(this._maxSize[1]=e,i=1),i},xt.__setMargin=function(t,e,i,n){"number"==typeof t&&(this._margin=[t,"number"==typeof e?e:e=t,"number"==typeof i?i:i=t,"number"==typeof n?n:n=e])},xt._setContent=function(t){this._content=t,this._contentLayout=wt.normalizeContent(t),this._layout&&(this.__rewriteContent(),this._parentContainer&&(this._layout.update(),this.__updatePosition()))},xt.setContent=function(t){this._setContent(t),this._mapAutoPan&&this._layout&&this._parentContainer&&this.mapAutoPan()},xt.getContent=function(){return this._content},xt.getLayout=function(){return this._map&&this._layout||null},xt.getContentLayout=function(){return this._map&&this._contentLayout||null},xt.__rewriteContent=function(){this._layout.setContent&&this._contentLayout&&this._layout.setContent(this._contentLayout)},xt.setCoordPoint=function(t){this._point=t,this.__updatePosition()},xt.setGeoPoint=xt.setCoordPoint,xt.getCoordPoint=function(){return this._point},xt.getGeoPoint=xt.getCoordPoint,xt._setStyle=function(t){this._style!=t&&(this._style=t,this.update())},xt.update=function(){bt.Templates.get(this._style.template)==this._currentTemplate&&this._currentLayoutContext==this._layoutContext&&this._layout?this._parentContainer&&this._layout.update():(this.__clearLayout(),this._parentContainer&&(this.__createLayout(),this._layout.setMaxSize&&this._layout.setMaxSize(this._maxSize[0],this._maxSize[1]),this.__rewriteContent(),this.__applyHasCloseButton(),this.__addToParentContainer(),this.__updatePosition()))},xt.__addToParentContainer=function(){this._layout.onAddToParent(this._container)},xt.__updatePosition=function(){if(this._parentContainer){if(!this._point)throw"Balloon position point is not defined.";this.__posInPixels=this._map.converter.coordinatesToMapPixels(this._point),wt.position(this._container,this.__posInPixels)}},xt.onMapUpdate=function(){this.__updatePosition()},xt.__clearLayout=function(){this._layout&&(this._parentContainer&&this._layout.onRemoveFromParent(),this._layout=this.__writtenContent=null)},xt.__createLayout=function(){var t=bt.Templates.get(this._style.template);t=t||bt.Templates.get(bt.AGeoObject.fullStyle.balloonStyle.template),this._currentTemplate=t,this._currentLayoutContext=this._layoutContext,this._layout=t.build(this._layoutContext,this._map,this)},xt._onCloseClick=function(t){Ct.preventMapEvent(t),Rt.notify(this,this.Events.CloseButtonClick,this)},xt._setHasCloseButton=function(t){typeof t!=Et&&(this._hasCloseButton=t,this._layout&&(this.__applyHasCloseButton(),this._parentContainer&&this._layout.update()))},xt.__applyHasCloseButton=function(){this._hasCloseButton?this._layout.enableClose&&this._layout.enableClose(this.__closeHandler):this._layout.disableClose&&this._layout.disableClose()},xt.onAddToMap=function(t,e){this._map=t,this._parentContainer=e,this._container||(this._container=Pt('<div class="YMaps-balloon" style="position: absolute; z-index:'+bt.ZIndex.BALLOON+';"></div>')[0],At(this._container).events.add("contextmenu",this.__onContextMenu,this)),e.appendChild(this._container),this._layout?(this.__addToParentContainer(),this.__updatePosition()):this.update(),this.__mapMoveEndListener=Rt.observe(this._map,this._map.Events.MoveEnd,this._onMapMoveEnd,this),this._mapAutoPan&&this.mapAutoPan()},xt.__onContextMenu=function(t){var e=new bt.MouseEvent(t,this._map);e.isMapEventPrevented()||(t.preventDefault(),e.preventMapEvent())},xt._onMapMoveEnd=function(){this.__posInPixels&&this.__updatePosition()},xt.onRemoveFromMap=function(){At(this._container).events.remove("contextmenu",this.__onContextMenu,this),this._parentContainer.removeChild(this._container),this._parentContainer=this._map=null,this._autoPanTimeout&&window.clearTimeout(this._autoPanTimeout),this._layout&&this._layout.onRemoveFromParent(),this.__mapMoveEndListener&&(this.__mapMoveEndListener.cleanup(),this.__mapMoveEndListener=null)},xt.mapAutoPan=function(t){if(this._map&&this._map._state){if(St.webkit&&this._container.offsetParent==document.body){var e=this;return void(this._autoPanTimeout=window.setTimeout(function(){e._autoPanTimeout=null,e.mapAutoPan()},100))}var i=this._map.converter,n=this._map.getContainerSize(),o=i.coordinatesToLocalPixels(this._point),s=this._margin,a=this._layout.getSize?this._layout.getSize():wt.size(this._container);this._layout.getOffset&&o.moveBy(this._layout.getOffset());var r=o.y-s[0],h=o.x+a.x+s[1],l=o.y+a.y+s[2],c=o.x-s[3],u=new Bt;c<=0?u.moveToX(-1*c):h>n.x&&u.moveToX(n.x-h),r<=0?u.moveToY(-1*r):l>n.y&&u.moveToY(n.y-l),u.x||u.y?this._map.moveBy(u.neg(),Math.abs(u.x)<3*n.x&&Math.abs(u.y)<3*n.y,{callback:t}):t&&window.setTimeout(function(){t(bt.State.SUCCESS)},0)}},new function(){function t(t,e,i){Ct.ABaseLayout.call(this,t,e);var n=this._$elements=Pt('<div class="YMaps-b-balloon-point">                <div class="YMaps-b-balloon YMaps-b-balloon_full YMaps-b-balloon_close-on">                    <div class="YMaps-b-balloon-wrap">                        <table class="YMaps-b-balloon-frame">                        <tr>                            <td class="YMaps-b-balloon-tl"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-t"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-tr"><i class="YMaps-b-balloon-bit"><i></i></i></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-ml"></td>                            <td class="YMaps-b-balloon-m">                                <div class="YMaps-b-balloon-content"></div>                            </td>                            <td class="YMaps-b-balloon-mr"></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-b" colspan="3">                                <i class="YMaps-b-balloon-corners">                                    <i class="YMaps-b-balloon-bit"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_l"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_r"><i></i></i>                                </i>                            </td>                        </tr>                        </table>                        <i class="YMaps-b-balloon-close" title=""><i></i></i>                        <i class="YMaps-b-balloon-shad"><i></i></i>                    </div>                    <i class="YMaps-b-balloon-tail-full">                        <i class="YMaps-b-balloon-tail-top"><i></i></i>                        <i class="YMaps-b-balloon-tail-middle"><i></i></i>                        <i class="YMaps-b-balloon-tail-bottom"><i></i></i>                    </i>                </div>                </div>');this.__balloon=i,this._nodes={visContainer:n.find(".YMaps-b-balloon")[0],contentParent:n.find(".YMaps-b-balloon-m")[0],content:n.find(".YMaps-b-balloon-content")[0],$close:n.find(".YMaps-b-balloon-close"),$eventBlockNode:n.find(".YMaps-b-balloon-frame"),$shad:n.find(".YMaps-b-balloon-shad"),$tail:n.find(".YMaps-b-balloon-tail-full")},this._nodes.$eventBlockNode=this._nodes.$eventBlockNode.add(this._nodes.$tail).add(this._nodes.$close),this._nodes.$close[0].title=kt.hints.balloon.close}var o,e=Lt(t,Ct.ABaseLayout),_="YMaps-balloon-content-overflow-hidden";function f(){if(!o){var t=null,e=null,i=0,n=0;St.msie?(t=Pt('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>'),Pt("body").append(t),i=Pt("div",t).innerWidth(),t.css("overflow-y","scroll"),n=Pt("div",t).innerWidth(),Pt(t).remove()):(e=Pt('<div style="width:100%;height:200px;"></div>'),t=Pt('<div style="position:absolute;top:-1000px;left:-1000px;width:100px;height:50px;overflow:hidden;"></div>').append(e).appendTo(document.body),i=e.width(),t.css({overflow:"auto"}),n=e.width(),t.remove()),o=i-n}return o}e.onAddToParent=function(t){var e;Pt(t).append(this._$elements),St.mozilla&&(this._ffObservers=[],this._ffObservers.push(Rt.observe(this._map,this._map.Events.MoveStart,function(){e||(e=1,Pt(this._nodes.content).addClass(_))},this)),this._ffObservers.push(Rt.observe(this._map,this._map.Events.MoveEnd,function(){e&&(Pt(this._nodes.content).removeClass(_),e=0)},this)));At(this._nodes.content).events.add("contextmenu",Ct.preventMapEvent);for(var i=0,n=this._nodes.$eventBlockNode.length;i<n;i++)At(this._nodes.$eventBlockNode[i]).events.add(["click","dblclick","mouseup","mousedown","mousemove","wheel","multitouchstart","multitouchmove","multitouchend"],Ct.preventMapEvent);At(this._nodes.$close[0]).events.add("click",this.__onCloseButtonClick,this),this.update()},e.__onCloseButtonClick=function(t){this._closeCallback&&this._closeCallback(t),Ct.preventMapEvent(t)},e.onRemoveFromParent=function(){this._ffObservers&&(It(this._ffObservers,"cleanup"),this._ffObservers=null),At(this._nodes.content).events.removeAll();for(var t=0,e=this._nodes.$eventBlockNode.length;t<e;t++)At(this._nodes.$eventBlockNode[t]).events.removeAll();At(this._nodes.$close[0]).events.removeAll(),Pt(this._nodes.content).removeClass(_),this._$elements.removeFromDom()},e.DEFAULT_MAX_WIDTH=520,e.DEFAULT_MAX_HEIGHT=100,e.DEFAULT_WIDE_MIN_WIDTH=42,e.DEFAULT_TINY_MIN_WIDTH=58,e.DEFAULT_MIN_HEIGHT=15,e.update=function(){if(this.__balloon&&this.__balloon._map&&this.__balloon._map._state){var t,e,i=this._nodes.visContainer,n=this._nodes.content,o=Pt(n),s=this._maxSize[0],a=this._maxSize[1],r=o.hasClass(_);if(r&&o.removeClass(_),wt.size(i,1e4),o.css({overflow:"auto",width:"auto",height:"auto"}),8==St.ieDocumentMode&&o.css("overflow","visible"),St.opera&&Pt(i).css("overflow","hidden"),!s||!a){var h=this._map.getContainerSize();s=s||Math.max(this.DEFAULT_MAX_WIDTH,h.x-60),a=a||(250<h.y?h.y-100:this.DEFAULT_MAX_HEIGHT)}if(St.msie||o.css("maxWidth",s),(t=Math.max(n.scrollWidth,n.offsetWidth)>s)&&St.msie&&o.css("width",s),null!=a&&(St.opera&&o.css("overflow","hidden"),St.msie||o.css("maxHeight",a),(e=Math.max(n.scrollHeight,n.offsetHeight)>a)&&St.msie&&o.css("height",a)),t&&(St.opera&&o.css("overflow","auto"),St.msie)){var l=n.offsetHeight-n.clientHeight;o.css("height",n.offsetHeight+l)}if(St.webkit&&this._$elements[0].offsetParent==document.body){var c=this;this._updateTimeout=window.setTimeout(function(){c._updateTimeout=null,c.update()},100)}else{var u=wt.size(n);(St.msie&&9<=St.version&&!St.quirksMode||"mac"==Pt.os.name&&Pt.browser.mozilla)&&(u.x=Math.min(s,u.x+1)),u.y=Math.max(u.y,this.DEFAULT_MIN_HEIGHT),this._closeCallback?u.x=Math.max(u.x,this.DEFAULT_WIDE_MIN_WIDTH):u.x=Math.max(u.x,this.DEFAULT_TINY_MIN_WIDTH),8<=St.ieDocumentMode&&(t&&(u.y+=f()+1),e&&(u.x+=f()+1)),St.msie&&St.version<8&&(t&&u.y++,e&&u.x++),St.msie&&(u.x=u.x+u.x%2),o.css({width:u.x,height:u.y,overflow:t||e?"auto":"hidden"});var d=this._nodes.contentParent.offsetWidth-u.x;if(u.x+d<52&&(u.x=52-d,o.css("width",u.x)),r&&o.addClass(_),this._nodes.$shad[(50<u.y?"remove":"add")+"Class"]("YMaps-b-balloon-shad_short"),St.opera&&Pt(i).css("overflow",""),Pt(i).css({width:"",height:""}),St.msie&&(6==St.version||St.quirksMode)){var p=9<=St.version&&St.version<=10;wt.fixIESize(this._nodes.$shad,"right",p?[-20,-21]:[-22,-21]),wt.fixIESize(this._nodes.$shad,"bottom",[0,1]),wt.fixIESize(this._nodes.$tail,"right",p?[16,15]:[14,15]),wt.fixIESize(this._nodes.$tail,"bottom",[-38,-37])}St.msie&&(St.version<7||St.quirksMode)&&Pt(this._nodes.content).addClass("YMaps-fake").removeClass("YMaps-fake")}}},e.setMaxSize=function(t,e){this._maxSize=[t,e]},e.getOffset=function(){var t=this.getSize();return new Bt(45-t.x,1-t.y)},e.getSize=function(){return wt.size(this._nodes.visContainer).moveByY(37)},e.enableClose=function(t){this._closeCallback=t,Pt(this._nodes.visContainer).addClass("YMaps-b-balloon_close-on")},e.disableClose=function(){this._closeCallback&&(this._closeCallback=null),Pt(this._nodes.visContainer).removeClass("YMaps-b-balloon_close-on")},e.setContent=function(t){if(this._setContent(t,this._nodes.content),t){var e=this;wt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update(),e.__balloon&&"function"==typeof e.__balloon.mapAutoPan&&e.__balloon.getOptions().mapAutoPan&&e.__balloon.mapAutoPan()})}},bt.Templates.add("default#balloon",new bt.LayoutTemplate(t))},Mt=bt.Placemark=function(t,e){bt.AInteractiveGeoObject.call(this,e),this.setGeoPoint(t),e=e||{},this.__draggable=!!e.draggable,this.__hideIcon=typeof e.hideIcon!=Et?e.hideIcon:1,this.__actualHideIcon=this.__hideIcon,this._map=this._parentContainer=null,this.__iconEventListeners=[],this._interactive=typeof e.interactive!=Et?e.interactive:bt.Interactivity.INTERACTIVE,this.__eventsBound=!1,this.__eventsInitialized=!1;var i=this;this._onHintHide=function(){i._hintVisible=0},this._cursor=e.cursor,this._state={interactive:0,drag:0,hover:0,active:0},this._zIndexManager=new Ct.PlacemarkZIndexManager(this,e)},(xt=Lt(Mt,bt.AInteractiveGeoObject)).isPlacemark=1,xt.__cursors={Default:bt.Cursor.POINTER,Drag:bt.Cursor.GRABBING},xt._states={interactive:"Default",drag:"Drag",hover:"Hover",active:"Active",hidden:"Hidden"},xt.Events={Click:"Click",DblClick:"DblClick",DragStart:"DragStart",Drag:"Drag",DragEnd:"DragEnd",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove",PositionChange:"PositionChange",BalloonOpen:"BalloonOpen",BalloonClose:"BalloonClose",OptionsChange:"OptionsChange",AddToMap:"AddToMap",RemoveFromMap:"RemoveFromMap"},xt.getMap=function(){return this._map},xt.getParentContainer=function(){return this._parentContainer},xt.onAddToMap=function(t,e){this._map=t,this._parentContainer=e,this._ensureContainers(),this._$iconShadowContainer&&(this._$iconShadowContainer.appendTo(this._parentContainer),this._shadowContainerAdded=1),this._$iconContainer.appendTo(this._parentContainer),this._updateIcon(!0),this.__updatePosition(),this._interactive!=bt.Interactivity.NONE&&this.__addIconEventListeners(),this.__mapMoveEndListener=Rt.observe(this._map,this._map.Events.MoveEnd,this._onMapMoveEnd,this),this.__destructListener=Rt.observe(this._map,this._map.Events.Destruct,this._destruct,this),this._zIndexManager.enable(),Rt.notify(this,this.Events.AddToMap,this)},xt._destruct=xt.onRemoveFromMap=function(){this.closeBalloon(),this._hideHintIfVisible(),this._interactive!=bt.Interactivity.NONE&&this.__removeIconEventListeners(),this.__mapMoveEndListener&&this.__mapMoveEndListener.cleanup(),this.__isMouseOver&&(this._setState({hover:0}),this.__isMouseOver=0),this._icon&&this._icon.onRemoveFromParent(),this._$iconContainer&&this._$iconContainer.removeFromDom(),this._iconShadow&&this._iconShadow.onRemoveFromParent(),this._$iconShadowContainer&&(this._$iconShadowContainer.removeFromDom(),this._shadowContainerAdded=0),this.__destructListener.cleanup(),this.__destructListener=this.__mapMoveEndListener=this._map=this._parentContainer=null,this._zIndexManager.disable(),Rt.notify(this,this.Events.RemoveFromMap,this)},xt.onRemoveFromGroup=function(){this._parentGroup=null},xt.__updatePosition=function(t){if(this._parentContainer){if(!this._point)throw"Placemark position point is not defined.";this.__posInPixels=t||this._map.converter.coordinatesToMapPixels(this._point);var e=this.getComputedStyle().iconStyle;this._icon&&wt.position(this._$iconContainer[0],this.__posInPixels.copy().moveBy(this._icon.getOffset?this._icon.getOffset():e.offset)),this._iconShadow&&wt.position(this._$iconShadowContainer[0],this.__posInPixels.copy().moveBy(this._iconShadow.getOffset?this._iconShadow.getOffset():e.shadow.offset)),this._balloonVisible&&this._map.getBalloon().setGeoPoint(this._point)}},xt.onMapUpdate=function(){this.__updatePosition()},xt._onMapMoveEnd=function(){if(this.__posInPixels){var t=this.__posInPixels,e=this._map.converter.coordinatesToMapPixels(this._point);(1<Math.abs(t.getX()-e.getX())||1<Math.abs(t.getY()-e.getY()))&&this.__updatePosition(e)}},xt.update=function(){bt.AInteractiveGeoObject.prototype.update.call(this),this._ensureContainers(),this._parentContainer&&(this._balloonVisible&&this.__actualHideIcon||this._updateIcon(),this._$iconShadowContainer&&!this._shadowContainerAdded&&(this._$iconShadowContainer.prependTo(this._parentContainer),this._shadowContainerAdded=1)),this._updateHint(),this._updateBalloon(),this.__updatePosition()},xt.setOptions=function(t,e){t=t||{},bt.AInteractiveGeoObject.prototype.setOptions.call(this,t,e);var i=e?{draggable:0,hideIcon:1,interactive:bt.Interactivity.INTERACTIVE,cursor:null}:this.getOptions();for(var n in t)i[n]=t[n];this.__draggable&&!i.draggable&&(this.__mouseMove&&this.__mouseMove.abort(),this._onMoveEnd()),this.__draggable=i.draggable,this.__hideIcon=i.hideIcon,this._interactive!=i.interactive&&(this._interactive==bt.Interactivity.NONE?this._$iconContainer&&this._map&&this.__addIconEventListeners():this.__eventsBound&&i.interactive==bt.Interactivity.NONE&&this.__removeIconEventListeners(),this._$iconContainer&&this._setState(i.interactive!=bt.Interactivity.NONE?{interactive:1}:{interactive:0,drag:0,hover:0,active:0}),this._interactive=i.interactive),this._cursor!=i.cursor&&(i.interactive!=bt.Interactivity.NONE?(this.__isDragged&&this.__cursorManager.removeCursor(this.__cursors.Drag),this.__cursorManager.removeCursor(this.__cursor||this.__cursors.Default),this.__cursorManager.addCursor(i.cursor||this.__cursors.Default),this.__isDragged&&this.__cursorManager.addCursor(this.__cursors.Drag)):this.__cursorManager.removeCursor(this.__cursor||this.__cursors.Default),this._cursor=i.cursor),this._zIndexManager.setOptions(i),Rt.notify(this,this.Events.OptionsChange,this)},xt.getOptions=function(){var t=bt.AInteractiveGeoObject.prototype.getOptions.call(this);return t.draggable=this.__draggable,t.hideIcon=this.__hideIcon,t.interactive=this._interactive,t.cursor=this._cursor,Pt.extend(t,this._zIndexManager.getOptions()),t},xt._ensureContainers=function(){this._$iconContainer||(this._$iconContainer=Pt("<div />").addClass("YMaps-placemark").css({"z-index":this._zIndexManager.getZIndex()}),this.__cursorManager=new Ct.CursorManager(this._$iconContainer[0]),this._interactive!=bt.Interactivity.NONE&&this._setState({interactive:1}));var t=this.getComputedStyle().iconStyle.shadow;!this._$iconShadowContainer&&t&&(this._$iconShadowContainer=Pt("<div />").addClass("YMaps-placemark-shadow").css({"z-index":this._zIndexManager.getShadowZIndex()})),this._$iconShadowContainer&&!t&&(this._$iconShadowContainer.removeFromDom(),this._$iconShadowContainer=null,this._shadowContainerAdded=0)},xt._updateIcon=function(t){var e=this.getComputedStyle().iconStyle,i=bt.Templates.get(e.template),n=!this._icon;i=i||bt.Templates.get(bt.AGeoObject.fullStyle.iconStyle.template),this._icon&&this.__currentIconTemplate!=i&&(this._icon.onRemoveFromParent(),n=!0),n?(this._icon=i.build(this,this._map,this),this._icon.onAddToParent(this._$iconContainer[0]),this._icon.setContent&&this._icon.setContent(this._getIconContentLayout()),this.__currentIconTemplate=i):this._icon&&(t&&this._icon.onAddToParent(this._$iconContainer[0]),this._icon.setContent&&this._icon.setContent(this._getIconContentLayout()),this._icon.update());var o=e.shadow;if(o){var s=bt.Templates.get(o.template);s&&(n=!this._iconShadow,this._iconShadow&&this.__currentIconShadowTemplate!=s&&(this._iconShadow.onRemoveFromParent(),n=!0),n?(this._iconShadow=s.build(this,this._map,this),this._iconShadow.onAddToParent(this._$iconShadowContainer[0]),this.__currentIconShadowTemplate=s):this._iconShadow&&(t&&this._iconShadow.onAddToParent(this._$iconShadowContainer[0]),this._iconShadow.update()))}else this._iconShadow&&(this._iconShadow.onRemoveFromParent(),this._iconShadow=null,this.__currentIconShadowTemplate=null)},xt._setState=function(t){for(var e in t){var i=this._states[e],n=t[e],o=this.__cursors[i];this._state[e]!=t[e]&&(this._state[e]=t[e],i="YMaps-"+i,"interactive"==e&&this._cursor&&(o=this._cursor),n?(this._$iconContainer.addClass(i),o&&this.__cursorManager.addCursor(o)):(this._$iconContainer.removeClass(i),o&&this.__cursorManager.removeCursor(o)),this._$iconShadowContainer&&"hidden"==e&&(n?this._$iconShadowContainer.addClass(i):this._$iconShadowContainer.removeClass(i)))}},xt.applyZIndex=function(t){this._$iconContainer&&this._$iconContainer.css({"z-index":t})},xt.applyShadowZIndex=function(t){this._$iconShadowContainer&&this._$iconShadowContainer.css({"z-index":t})},xt.setIconContent=function(t){this._iconCustomContent=t,this._iconCustomContentLayout=wt.normalizeContent(t),this._iconContent=null,this._updateIconContent()},xt._updateIconContent=function(){this._parentContainer&&(this._balloonVisible&&this.__actualHideIcon||(this._icon.setContent&&this._icon.setContent(this._getIconContentLayout()),this._updateIcon(),this.__updatePosition()))},xt._getIconContentLayout=function(){if(!this._iconContent)if(this._iconCustomContentLayout)this._iconContent=this._iconCustomContentLayout;else{var t=bt.Templates.get(this.getComputedStyle().iconContentStyle.template);t=t||bt.Templates.get(bt.AGeoObject.fullStyle.iconContentStyle.template),this._iconContent=t.build(this,this._map,this)}return this._iconContent},xt.getIconContent=function(){return this._iconCustomContent},xt.getIconLayout=function(){return this._map&&this._icon||null},xt.getIconShadowLayout=function(){return this._map&&this._iconShadow||null},xt.getContentLayout=function(){return this._map&&this._iconContent||null},xt.__createIconEventListeners=function(){var t=this._$iconContainer;this.__mouseMove=new wt.DragAndDrop.MouseMove(t[0],0,kt.tremor.placemark),this.__bindPlacemarkListeners(),this.__mouseMove.beginListening(),this.__iconEventListeners=[].concat(Rt.observe(this.__mouseMove,"start",this._onMoveStart,this),Rt.observe(this.__mouseMove,"move",this._onMove,this),Rt.observe(this.__mouseMove,"stop",this._onMoveEnd,this)),this.__eventsBound=!0},xt.__bindPlacemarkListeners=function(){this._iconListener=At(this._$iconContainer[0]).events.eventListener(),this._iconListener.add("contextmenu",function(t){Ct.preventMapEvent(t),t.preventDefault()}).add("click",this._onClick,this).add("mousemove",this._onMouseMove,this).add("mouseout",this._onMouseOut,this).add("mouseover",this._onMouseOver,this).add("dblclick",this._onDblClick,this)},xt.__removeIconEventListeners=function(){this.__eventsBound&&(this.__mouseMove.stopListening(),this._iconListener.removeAll(),It(this.__iconEventListeners,"disable"),this.__eventsBound=!1)},xt.__addIconEventListeners=function(){this.__eventsBound||(this.__eventsInitialized?(this.__mouseMove.beginListening(),this.__bindPlacemarkListeners(),It(this.__iconEventListeners,"enable"),this.__eventsBound=!0):(this.__createIconEventListeners(),this.__eventsInitialized=!0))},xt._onDblClick=function(t){var e=new bt.MouseEvent(t,this._map);this._interactive==bt.Interactivity.INTERACTIVE&&e.preventMapEvent(),Rt.notify(this,this.Events.DblClick,this,e)},xt._onMoveStart=function(t){if(this.__draggable){this._setState({drag:1});var e=this.__dragMoveMapOptions.edge,i=new Bt(t.clientX,t.clientY);this.__dragMoveMapBounds=new bt.Bounds(new Bt(e,e),new Bt(this._map._state.size.x-e,this._map._state.size.y-e)),this.__startMovePos=this._point.copy(),this.__prevDragPixels=i,this.__grabOffset=i.diff(this._map.converter.coordinatesToClientPixels(this._point)),this._hideHintIfVisible(0)}},xt.__dragMoveMapOptions={edge:20,speed:10,maxSpeed:10},xt.__dragMoveMapStop=function(){this.__dragMoveMapActive&&(this.__dragMoveMapActive=0,this.__getDragMoveMapListener().disable())},xt.__dragMoveMapTick=function(t,e){var i=this._map.converter.coordinatesToLocalPixels(this._point);i.moveBy(e),this._point.moveTo(this._map.converter.localPixelsToCoordinates(i,1)),this.__updatePosition(),Rt.notify(this,this.Events.Drag,this,e)},xt.__getDragMoveMapListener=function(){return this.__dragMoveMapListener=this.__dragMoveMapListener||bt.Events.observe(this._map,this._map.Events.Move,this.__dragMoveMapTick,this)},xt._onMove=function(t){if(this.__draggable){this.__isDragged||(this.__isDragged=1,this._hideHintIfVisible(),Rt.notify(this,this.Events.DragStart,this));var e=new Bt(t.clientX,t.clientY);if(this._point.moveTo(this._map.coordSystem.restrict(this._map.converter.clientPixelsToCoordinates(e.copy().moveBy(this.__grabOffset),1))),this.__updatePosition(),this._map.draggingEnabled()&&this._map){var i=this._map.converter.coordinatesToLocalPixels(this._point);if(this.__dragMoveMapBounds.contains(i))this.__dragMoveMapActive&&this._map.stopMove();else{var n=this.__dragMoveMapBounds,o=new Bt(i.x<n.getLeft()?-1:i.x>n.getRight()?1:0,i.y<n.getBottom()?-1:i.y>n.getTop()?1:0);if(!this.__dragMoveMapActive||!this.__dragMoveMapOldDirection.equals(o)){var s=this;this.__dragMoveMapStartOptions=this.__dragMoveMapStartOptions||Pt.extend({callback:function(){s.__dragMoveMapStop()}},this.__dragMoveMapOptions),this._map.startMove(o,this.__dragMoveMapStartOptions),this.__getDragMoveMapListener().enable(),this.__dragMoveMapActive=!0,this.__dragMoveMapOldDirection=o}}}Rt.notify(this,this.Events.Drag,this,this.__prevDragPixels.diff(e)),this.__prevDragPixels=e}},xt._onMoveEnd=function(){this.__draggable&&(this._setState({drag:0}),this.__isDragged&&(this.__dragMoveMapActive&&this._map.stopMove(),this.__stopMove()))},xt._onClick=function(t){var e=new bt.MouseEvent(t,this._map);this._interactive==bt.Interactivity.INTERACTIVE&&e.preventMapEvent(),Rt.notify(this,this.Events.Click,this,e),this.getOptions().hasBalloon&&this._interactive==bt.Interactivity.INTERACTIVE&&(this._balloonVisible?this.closeBalloon():this.openBalloon())},xt.__stopMove=function(){this.__isDragged=0,Rt.notify(this,this.Events.DragEnd,this),Rt.notify(this,this.Events.PositionChange,this,{oldPoint:this.__startMovePos,newPoint:this._point.copy()})},xt._onMouseMove=function(t){var e=new bt.MouseEvent(t,this._map);this._interactive==bt.Interactivity.INTERACTIVE&&(e.preventMapEvent(),this._mouseMoveAction(t)),Rt.notify(this,this.Events.MouseMove,this,e)},xt._onMouseOver=function(t){this.__isMouseOver||t.relatedTarget&&-1!=Pt(t.relatedTarget).parents().index(this._$iconContainer)||(this.__isMouseOver=1,this._interactive==bt.Interactivity.INTERACTIVE&&(this._setState({hover:1}),!this.getOptions().hasHint||this._balloonVisible||this.__isDragged||(this._map.hint.show(this._map.converter.clientPixelsToLocalPixels(new Bt(t.clientX,t.clientY)),this._getHintContentLayout(),this._getComputedHintOptions()),this._hintVisible=1)),Rt.notify(this,this.Events.MouseEnter,this,new bt.MouseEvent(t,this._map)))},xt._onMouseOut=function(t){!this.__isMouseOver||t.relatedTarget&&-1!=Pt(t.relatedTarget).parents().index(this._$iconContainer)||(this.__isMouseOver=0,this._interactive==bt.Interactivity.INTERACTIVE&&(this._setState({hover:0}),this._hideHintIfVisible()),Rt.notify(this,this.Events.MouseLeave,this,new bt.MouseEvent(t,this._map)))},xt._mouseMoveAction=function(t){this._hintVisible&&this._map.hint.moveTo(this._map.converter.clientPixelsToLocalPixels(new Bt(t.clientX,t.clientY)))},xt.setHintContent=function(t){bt.AInteractiveGeoObject.prototype.setHintContent.call(this,t),this._updateHint()},xt.setHintOptions=function(t){bt.AInteractiveGeoObject.prototype.setHintOptions.call(this,t),this._hintVisible&&this._map.hint.setOptions(this._getComputedHintOptions())},xt._getComputedHintOptions=function(){var t=bt.AInteractiveGeoObject.prototype._getComputedHintOptions.call(this,t);return t.onHide=this._onHintHide,t},xt._updateHint=function(){this._hintVisible&&(this._map.hint.setOptions(this._getComputedHintOptions()),this._map.hint.setContent(this._getHintContentLayout()))},xt._hideHintIfVisible=function(t){this._hintVisible&&this._map.hint.hide(t)},xt._updateBalloon=function(){if(this._balloonVisible){var t=this._map.getBalloon();t.setOptions(this._getComputedBalloonOptions(),1),t.setContent(this._getBalloonContentLayout())}},xt.getBalloon=function(){return this._balloonVisible?this._map.getBalloon():null},xt.openBalloon=function(t,e){if(bt.AInteractiveGeoObject.prototype.openBalloon.call(this,t,e),this._map){this._balloonVisible&&this.closeBalloon(),this._hideHintIfVisible();var i=this,n={},o=this._getComputedBalloonOptions();for(var s in o)n[s]=o[s];n.onClose=function(){o.onClose&&o.onClose(),i._onCloseBalloon()},this.__hideIcon?this._setState({hidden:1,hover:0}):this._setState({active:1}),this.__actualHideIcon=this.__hideIcon,this._balloonVisible=1,this._map.openBalloon(this._point,this._getBalloonContentLayout(),n),Rt.notify(this,this.Events.BalloonOpen,this)}},xt.closeBalloon=function(){bt.AInteractiveGeoObject.prototype.closeBalloon.call(this),this._balloonVisible&&this._map.closeBalloon()},xt.setBalloonOptions=function(t){bt.AInteractiveGeoObject.prototype.setBalloonOptions.call(this,t),this._balloonVisible&&this._map.getBalloon().setOptions(this._getComputedBalloonOptions(),1)},xt._onCloseBalloon=function(){this._balloonVisible=0,this.__actualHideIcon?this._setState({hidden:0}):this._setState({active:0}),this._updateIcon(),this.__updatePosition(),Rt.notify(this,this.Events.BalloonClose,this)},xt.setBalloonContent=function(t){bt.AInteractiveGeoObject.prototype.setBalloonContent.call(this,t),this._updateBalloon()},xt.setCoordPoint=function(t){var e=this._point||t;this._point=t.copy(),this.__updatePosition(),Rt.notify(this,this.Events.PositionChange,this,{oldPoint:e,newPoint:t})},xt.setGeoPoint=xt.setCoordPoint,xt.getCoordPoint=function(){return this._point},xt.getGeoPoint=xt.getCoordPoint,Ct.PlacemarkZIndexManager=Mt=function(t,e){this._placemark=t,this._zIndexes={},this._interactiveObservers=[],this.resetState(),this.setOptions(e)},(xt=Mt.prototype).zIndexPriority=["Active","Drag","Hover","Default"],xt.zIndexes={Default:{defaultState:1,defaultValue:bt.ZIndex.OVERLAY,optionName:"zIndex"},Active:{defaultState:0,defaultValue:bt.ZIndex.OVERLAY_ACTIVE,optionName:"zIndexActive"},Drag:{defaultState:0,defaultValue:bt.ZIndex.OVERLAY_DRAG,optionName:"zIndexDrag"},Hover:{defaultState:0,defaultValue:bt.ZIndex.OVERLAY_HOVER,optionName:"zIndexHover"},Shadow:{defaultValue:bt.ZIndex.OVERLAY_SHADOW,optionName:"zIndexShadow"}},xt.resetState=function(){for(var t in this._zIndexState={},this.zIndexes)this._zIndexState[t]=this.zIndexes[t].defaultState},xt.enable=function(){this._enabled=!0;var t=this._placemark;this.resetState(),this._inited||(this._interactiveObservers=[Rt.observe(t,t.Events.BalloonOpen,function(){this._zIndexState.Active=1,this.applyZIndex()},this,!1),Rt.observe(t,t.Events.BalloonClose,function(){this._zIndexState.Active=0,this.applyZIndex()},this,!1),Rt.observe(t,t.Events.MouseEnter,function(){this._zIndexState.Hover=1,this.applyZIndex()},this,!1),Rt.observe(t,t.Events.MouseLeave,function(){this._zIndexState.Hover=0,this.applyZIndex()},this,!1),Rt.observe(t,t.Events.DragStart,function(){this._zIndexState.Drag=1,this.applyZIndex()},this,!1),Rt.observe(t,t.Events.DragEnd,function(){this._zIndexState.Drag=0,this.applyZIndex()},this,!1)],this._inited=!0,this.setOptions(t.getOptions())),this._interactive&&It(this._interactiveObservers,"enable")},xt.disable=function(){this._enabled=!1,It(this._interactiveObservers,"disable")},xt.setOptions=function(t){var e,i=!1;for(var n in this.zIndexes)e=this.zIndexes[n].optionName,void 0!==this._zIndexes[n]&&this._zIndexes[n]==t[e]||(i=!0,this._zIndexes[n]=void 0!==t[e]?t[e]:this.zIndexes[n].defaultValue);t.interactive!=bt.Interactivity.INTERACTIVE?(this._interactive&&(i=!0),this._interactive=!1,this._enabled&&It(this._interactiveObservers,"disable")):(this._interactive||(this.resetState(),i=!0),this._enabled&&It(this._interactiveObservers,"enable"),this._interactive=!0),i&&this.applyZIndex()},xt.getOptions=function(){var t={};for(var e in this.zIndexes)t[this.zIndexes[e].optionName]=this._zIndexes[e];return t},xt.getZIndex=function(){for(var t,e=0,i=this.zIndexPriority.length;e<i;e++)if(t=this.zIndexPriority[e],this._zIndexState[t])return this._zIndexes[t]},xt.getShadowZIndex=function(){return this._zIndexes.Shadow},xt.applyZIndex=function(){this._placemark.applyZIndex(this.getZIndex()),this._placemark.applyShadowZIndex(this.getShadowZIndex())},new function(){function t(t,n){function e(t,e){Ct.ABaseLayout.call(this,t,e);var i=this._$elements=Pt('<div class="YMaps-b-balloon-point">                <div class="YMaps-b-balloon YMaps-b-balloon_small YMaps-b-balloon_'+n+'">                    <div class="YMaps-b-balloon-wrap">                        <table class="YMaps-b-balloon-frame">                        <tr>                            <td class="YMaps-b-balloon-tl"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-t"><i class="YMaps-b-balloon-bit"><i></i></i></td>                            <td class="YMaps-b-balloon-tr"><i class="YMaps-b-balloon-bit"><i></i></i></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-ml"></td>                            <td class="YMaps-b-balloon-m">                                <div class="YMaps-b-balloon-content"></div>                            </td>                            <td class="YMaps-b-balloon-mr"></td>                        </tr>                        <tr>                            <td class="YMaps-b-balloon-b" colspan="3">                                <i class="YMaps-b-balloon-corners">                                    <i class="YMaps-b-balloon-bit"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_l"><i></i></i>                                    <i class="YMaps-b-balloon-bit YMaps-b-balloon-bit_r"><i></i></i>                                </i>                            </td>                        </tr>                        </table>                        <i class="YMaps-b-balloon-shad"><i></i></i>                    </div>                    <i class="YMaps-b-balloon-tail"><i></i></i>                </div></div>');this._nodes={visContainer:i.find(".YMaps-b-balloon"),content:i.find(".YMaps-b-balloon-content"),shad:i.find(".YMaps-b-balloon-shad"),tail:i.find(".YMaps-b-balloon-tail")}}function i(t,e){this._context=t,this._map=e,this._content=null,this._parentNode=null}(xt=Lt(e,Ct.ABaseLayout)).onAddToParent=function(t){Ct.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},xt.update=function(){var t=this._nodes.visContainer;t.css({visibility:"hidden",width:790}),St.opera&&t.css("overflow","hidden"),this._nodes.content.css({overflow:"",width:"auto",height:"auto"});var e=wt.size(this._nodes.content);if("mac"==Pt.os.name&&Pt.browser.mozilla&&e.x++,St.msie){var i=new Bt,n=this._nodes.content[0];Pt.each([["y","Top"],["x","Right"],["y","Bottom"],["x","Left"]],function(){i[this[0]]+=(parseFloat(Pt.curCSS(n,"padding"+this[1],!0))||0)+(parseFloat(Pt.curCSS(n,"border"+this[1]+"Width",!0))||0)}),e.moveBy(i)}wt.size(this._nodes.content[0],new Bt(Math.min(790,Math.max(s,e.x)),Math.max(13,e.y))),this._nodes.content.css("overflow","hidden"),St.opera&&t.css("overflow",""),t.css({width:"",visibility:""}),St.msie&&(6==St.version||7<=St.version&&St.version<8&&"BackCompat"==document.compatMode)&&(wt.fixIESize(this._nodes.shad,"right",[-6,-5]),wt.fixIESize(this._nodes.shad,"bottom",[-1,0]),wt.fixIESize(this._nodes.tail,"bottom",[-13,-12]),wt.fixIESize(this._nodes.tail,"right",[-1,0]))},xt.setContent=function(t){this._setContent(t,this._nodes.content);var e=this;wt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()})},xt.getOffset=function(){return new Bt(0,0)},(xt=i.prototype).onAddToParent=function(t){this._parentNode=t,this._getLayout().onAddToParent(t)},xt.onRemoveFromParent=function(){this._parentNode=null,this._getLayout().onRemoveFromParent()},xt.update=function(){this._getLayout().update()},xt.getRootNodes=function(){return this._getLayout().getRootNodes()},xt.setContent=function(t){if(this._content!=t){var e=this._parentNode;!this._content!=!(this._content=t)?(e&&this._getLayout().onRemoveFromParent(),this._currentLayout=null,this._getLayout(),t&&this._currentLayout.setContent(t),e&&this._currentLayout.onAddToParent(this._parentNode)):this._currentLayout.setContent(t)}},xt._getLayout=function(){return this._currentLayout||(this._content?this._currentLayout=new e(this._context,this._map):this._currentLayout=new a(this._context,this._map)),this._currentLayout},xt.getOffset=function(){return this._currentLayout.getOffset()};var o=new bt.LayoutTemplate(i);return bt.Templates.add("default#"+t+"PointIcon",o),o}var s=St.msie&&St.quirksMode?26:13;t("white","white"),t("green","green"),t("red","red"),t("yellow","yellow"),t("darkblue","blue-d"),t("night","night"),t("grey","grey"),t("blue","blue"),t("orange","orange"),t("darkorange","orange-d"),t("pink","pink"),t("violet","violet"),bt.Templates.add("default#icon",t("lightblue","blue-l"));var a=function(t,e){Ct.ABaseLayout.call(this,t,e);this.__getStyleData();this._$elements=Pt(St.msie&&St.version<7?"<div />":"<img />")};(xt=Lt(a,Ct.ABaseLayout)).__getStyleData=function(){return this._context.getComputedStyle().iconStyle},xt.onAddToParent=function(t){Ct.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},xt.update=function(){var t=this.__getStyleData();St.msie&&St.version<7?this._$elements.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+(t&&t.href)+"', sizingMethod='scale')","line-height":"0px"}):this._$elements[0].src=t&&t.href,t.size&&wt.size(this._$elements[0],t.size)},xt.setContent=wt.NULL,xt.getOffset=function(){return this.__getStyleData().offset||new Bt(0,0)};function e(){a.apply(this,arguments)}(xt=Lt(e,a)).__getStyleData=function(){return this._context.getComputedStyle().iconStyle.shadow},bt.Templates.add("default#iconShadow",new bt.LayoutTemplate(e));for(var i=["airplane.png","anchor.png","arrowDownLeft.png","arrowDownRight.png","arrowLeft.png","arrowRight.png","arrowUp.png","attention.png","badminton.png","bank.png","bar.png","barberShop.png","bicycle.png","bowling.png","buildings.png","bus.png","cafe.png","camping.png","car.png","cellular.png","cinema.png","downhillSkiing.png","dps.png","dryCleaner.png","electricTrain.png","factory.png","fishing.png","gasStation.png","gym.png","hospital.png","house.png","keyMaster.png","mailPost.png","metroKiev.png","metroMoscow.png","metroStPetersburg.png","metroYekaterinburg.png","motobike.png","mushroom.png","phone.png","photographer.png","pingPong.png","restauraunt.png","ship.png","shop.png","skating.png","skiing.png","smartphone.png","stadium.png","storehouse.png","swimming.png","tailorShop.png","teather.png","tennis.png","theater.png","tire.png","train.png","tramway.png","trolleybus.png","truck.png","turnLeft.png","turnRight.png","wifi.png","wifiLogo.png","workshop.png"],n=new bt.Point(-10,-25),o=new bt.Point(27,26),r=new bt.LayoutTemplate(a),h=0,l=i.length;h<l;h++){var c=new bt.Style(null);c.iconStyle={offset:n,size:o,shadow:null,href:kt.imageRoot+"icons/"+i[h],template:r},bt.Styles.add("default#"+i[h].replace(".png","Icon"),c)}},bt.ObjectManager=function(t){var h,l,c,n,u=typeof(t=t||{}).cellSize!=Et?Number(t.cellSize):256,e=typeof t.padding!=Et?Number(t.padding):100,a=typeof t.trackObjects==Et||!!t.trackObjects,r=0,d=[],p=[],_={},f={},m={},s=[],v=[],g=[];function y(t){for(var e in d[t]=[],p[t]=Math.ceil((256<<t)/u),_)if(_.hasOwnProperty(e)&&t<=e){var i,n,o,s=_[e],a=Math.min(t+1,s.length);for(i=0;i<a;i++)if(s[i])for(n=0,o=s[i].length;n<o;n++){var r=s[i][n],h=C(r.getGeoPoint(),t);P(h.x,h.y,t).push(r)}}}function b(){return function(t,e,i){var n=t.getLeftBottom(),o=t.getRightTop(),s=C(n,e,new Bt(-i,i)),a=C(o,e,new Bt(i,-i)),r=p[e];(o.getX()<n.getX()||a.x<s.x)&&(s.x-=r);a.x-s.x+1>=r&&(s.x=0,a.x=r-1);var h=new bt.Bounds(s,a);return h.zoom=e,h}(h.getBounds(),l,e)}function C(t,e,i){var n=h.tileCoordinates.scale(h.coordSystem.fromCoordPoint(t),h.coordSystem.getMaxZoom(),e);return i=i||new Bt,new Bt(Math.floor((n.x+i.x)/u),Math.floor((n.y+i.y)/u))}function M(t,e,i){if(h)for(var n=Math.min(i,d.length-1),o=C(t.getGeoPoint(),n);e<=n;n--)d[n]&&P(o.x,o.y,n).push(t),o.x=o.x>>1,o.y=o.y>>1;else s.push([t,e,i])}function x(t){var e=c.getLeftTop(),i=c.getRightBottom(),n=e.y<=t.y&&t.y<=i.y,o=e.x<=t.x&&t.x<=i.x;if(!o&&e.x<0){var s=p[c.zoom];o=e.x+s<=t.x&&t.x<=s-1}return n&&o}function w(t,e){o(t,e.oldPoint,e.newPoint)}function o(t,e,i){if(h)for(var n,o=d.length-1,s=C(e,o),a=C(i,o);0<=o&&(s.x!=a.x||s.y!=a.y);)d[o]&&((n=A(s.x,s.y,o))&&D(n,t)&&P(a.x,a.y,o).push(t),o==l&&(x(s)?x(a)||k(t):x(a)&&B(t))),s.x=s.x>>1,s.y=s.y>>1,a.x=a.x>>1,a.y=a.y>>1,--o;else g.push([t,e,i])}function P(t,e,i){t<0&&(t+=p[i]);var n=d[i],o=n[t];return o?o[e]||(o[e]=[]):(n[t]=[])[e]=[]}function S(e){return function(t){e.push(t)}}function T(t,e){for(var i=t.getLeft(),n=t.getRight();i<=n;i++)for(var o=t.getTop(),s=t.getBottom();o<=s;o++)O(i,o,t.zoom,e)}function E(t,e,i){O(t,e,i,k)}function L(t,e,i){O(t,e,i,B)}function O(t,e,i,n){var o=A(t,e,i);if(o)for(var s=o.length-1;0<=s;s--)n.call(this,o[s])}function I(i,t,n){!function(t,e,i){var n,o,s=t.getLeft(),a=t.getTop(),r=t.getRight(),h=t.getBottom(),l=e.getLeft(),c=e.getTop(),u=e.getRight(),d=e.getBottom();for(n=s;n<=r;n++){for(o=a;o<=h&&o<c;o++)i(n,o);for(o=Math.max(d+1,a);o<=h;o++)i(n,o)}for(o=Math.max(a,c);o<=Math.min(h,d);o++){for(n=Math.min(r+1,l)-1;s<=n;n--)i(n,o);for(n=Math.max(s,u+1);n<=r;n++)i(n,o)}}(i,t,function(t,e){n.apply(null,[t,e,i.zoom])})}function A(t,e,i){return d[i]?(t<0&&(t+=p[i]),d[i][t]&&d[i][t][e]||null):null}function k(t){h.removeOverlay(t),r--}function B(t){h.addOverlay(t),r++}function D(t,e){for(var i=0,n=0;n<t.length;++n)t[n]===e&&(t.splice(n--,1),i++);return i}this.onAddToMap=function(t){var e,i;if(l=(h=t).getZoom(),d[l])for(e=0,i=s.length;e<i;e++)M.apply(this,s[e]);else y(l);for(s=[],c=b(),n&&n.cleanup(),n=Rt.observe(h,h.Events.MoveEnd,this.onMapUpdate,this),T(c,B),e=0,i=v.length;e<i;e++)this.remove(v[e]);for(v=[],e=0,i=g.length;e<i;e++)o.apply(this,g[e]);g=[]},this.onRemoveFromMap=function(){h&&(T(c,k),n&&n.cleanup(),h=n=null)},this.removeAll=function(){h&&T(c,k),d=[],p=[],_={},m={},function(t,e){for(var i in t)t.hasOwnProperty(i)&&t[i][e]()}(f,"cleanup"),f={},this._update()},this.add=function(t,e,i){if(t){i=typeof i==Et?1/0:Number(i),function(t,n,o){Pt.each([].concat(t),function(t,e){var i=wt.getUniqueId(e);a&&(f[i]=Rt.observe(e,e.Events.PositionChange,w)),m[i]=[o,n]}),_[o]||(_[o]=[]);_[o][n]=(_[o][n]||[]).concat(t)}(t,e=typeof e==Et?0:Math.min(Number(e),i),i);var n,o,s=[].concat(t);for(n=0,o=s.length;n<o;n++)M(s[n],e,i);if(h)if(10<s.length&&!r)T(c,B);else for(n=0,o=s.length;n<o;n++){x(C(s[n].getGeoPoint(),l))&&c.zoom>=e&&c.zoom<=i&&B(s[n])}}},this.remove=function(t){if(t instanceof Array)for(var e=0,i=t.length;e<i;e++)this.remove(t[e]);else if(h){!function(t){var e=wt.getUniqueId(t),i=f[e],n=m[e],o=_[n[0]][n[1]],s=Pt.inArray(t,o);i&&i.cleanup();-1!=s&&o.splice(s,1);delete f[e],delete m[e]}(t);for(var n,o=d.length-1,s=C(t.getGeoPoint(),o);0<=o;)d[o]&&((n=A(s.x,s.y,o))&&D(n,t),o==l&&h&&x(s)&&k(t)),s.x=s.x>>1,s.y=s.y>>1,--o}else v.push(t)},this.onMapUpdate=function(){setTimeout(this._update,0)},this._update=function(){if(h){l=h.getZoom(),d[l]||y(l);var t=b();if(t.zoom!=c.zoom){var e=[],i=[],n=S(e),o=S(i);T(c,n),T(t,o);for(var s=e.length-1;0<=s;s--){var a=e[s],r=Pt.inArray(a,i);-1==r?k(a):i.splice(r,1)}for(s=i.length-1;0<=s;s--)B(i[s])}else t.equals(c)||(I(c,t,E),I(t,c,L));c=t}}},Mt=bt.GeoObjectCollection=function(t){bt.OverlayGroup.call(this),bt.AGeoObject.call(this),this._style=t},xt=Lt(Mt,bt.OverlayGroup),Pt.extend(!1,Mt,bt.AGeoObject),Pt.extend(!0,Mt.prototype,bt.AGeoObject.prototype),xt._onAddObject=function(t,e){t.onAddToGroup(this),bt.OverlayGroup.prototype._onAddObject.call(this,t,e)},xt._onRemoveObject=function(t,e){bt.OverlayGroup.prototype._onRemoveObject.call(this,t,e),t.onRemoveFromGroup(this)},xt.update=function(){bt.AGeoObject.prototype.update.call(this),It(this._objects.slice(),"update")},bt.GeocodeProviders=new wt.ObjectStorage,bt.GeocodeProviders.add("yandex#map",new function(){var o={house:"0.005,0.005",street:"0.005,0.005",metro:"0.5,0.5",locality:"0.5,0.5"};function n(t){return new bt.GeoPoint(t[0],t[1])}function e(t){var e=t.properties.boundedBy,i=t.properties.GeocoderMetaData;return(t=new bt.GeocoderResult(n(t.geometry.coordinates))).setBounds(new bt.GeoBounds(n(e[0]),n(e[1]))),t.AddressDetails=i.AddressDetails,t.precision=i.precision,t.text=i.text,t.kind=i.kind,t}function s(t){return{found:t.properties.ResponseMetaData.SearchResponse.found,suggest:function(t){return t&&Pt.map(t,function(t){return"string"==typeof t?t:"<fix>"+t+"</fix>"}).join("")}(t.properties.ResponseMetaData.SearchRequest.suggest),results:Pt.map(t.features,e)}}this.geocode=function(t,e,i,n){Pt.ajax({url:function(t,e){var i=e.boundedBy;return Ct.searchService+"v1/?"+Pt.param({geocoder_kind:e.kind||[],geocoder_sco:"longlat",key:Ct.userKey||[],lang:e.prefLang||"ru_RU",ll:i&&i.getCenter().toString()||[],origin:e.origin||"jsGeocoder",properties:"addressdetails",results:e.results||[],rspn:e.strictBounds?1:[],skip:e.skip||[],spn:i&&i.getSpan().toString(6)||o[e.kind]||[],text:String(t),token:Ct.token,type:"geo"})}(t,e),dataType:"jsonp",scriptCharset:"utf-8",cache:1,success:function(t){"success"===t.status?i(s(t.data)):n(t.message)}})}}),bt.Geocoder=function(t,e){bt.GeoObjectCollection.call(this,"geocoder#result"),e=e||{},this.geocodeProvider=bt.GeocodeProviders.get(e.geocodeProvider||"yandex#map"),this.request=t,this.suggest=null,this.found=0,this.prefLang=e.prefLang||null,this.geocodeProvider.geocode(t,e,Ot(this.__successCallback,this),Ot(this.__failureCallback,this))},(xt=Lt(bt.Geocoder,bt.GeoObjectCollection)).Events.Load="Load",xt.Events.Fault="Fault",xt.__successCallback=function(t){this.found=t.found,this.suggest=t.suggest||null,this.add(t.results),Rt.notifyPermanent(this,this.Events.Load,this)},xt.__failureCallback=function(t){Rt.notifyPermanent(this,this.Events.Fault,this,t)},bt.Templates.add("geocoder#template",new bt.Template("<div>$[text]</div>")),bt.Styles.add("geocoder#result",{balloonContentStyle:{template:"geocoder#template"}}),bt.GeocoderResult=function(t,e){bt.Placemark.call(this,t,e),this.kind="",this.text="",this.precision="",this.AddressDetails=null},Lt(bt.GeocoderResult,bt.Placemark),function(){function t(t){var e=Ct.geoxmlService+"1.2/geoxml.xml",s=/^[a-zA-Z]+:\/\//;this.loadDocument=function(i,n,o){s.test(i)||(i="http://"+i),Pt.ajax({url:e,data:{key:Ct.userKey||[],origin:t,url:i},dataType:"jsonp",scriptCharset:"utf-8",cache:1,success:function(t){var e={url:i};t.response?e.data=t.response:e.error=t.error&&t.error.message||"internal server error",n.call(o,e)}})}}var e=new t("jsapi1KML"),r={setUrl:function(t){this._url=t},getUrl:function(){return this._url},extend:function(o,s,t,a){return Pt.each(t,function(t,e){var i=a?a[t]:e;if(s.hasOwnProperty(i)){var n=r.formatters[e];o[e]=n?n(s[i],s):s[i]}}),o},formatters:{balloonContentStyle:function(t){return new bt.BalloonContentStyle(new bt.Template(t.text))},fill:Number,fillColor:function(t){return t.slice(6,8)+t.slice(4,6)+t.slice(2,4)+t.slice(0,2)},geoObject:function(t){var e,i=t.Style?r.formatters.style(t.Style):r.formatters.key(t.styleUrl);switch(!0){case Boolean(t.Point):var n=r.formatters.points(t.Point.coordinates)[0];e=new bt.Placemark(n,{style:i});break;case Boolean(t.LineString):var o=r.formatters.points(t.LineString.coordinates);e=new bt.Polyline(o,{style:i});break;case Boolean(t.LinearRing||t.Polygon):var s=t.LinearRing||t.Polygon.outerBoundaryIs.LinearRing;o=r.formatters.points(s.coordinates);e=new bt.Polygon(o,{style:i});break;default:var a=[];Pt.each(t,function(t,e){0<=Pt.inArray(t,["Document","Folder","Placemark"])&&(a=a.concat(e))}),e=new bt.GeoObjectCollection(i),Pt.map(a,function(t){e.add(r.formatters.geoObject(t))})}return r.extend(e,t,["id","name","description"])},iconStyle:function(t){var e=new bt.IconStyle;return e.offset=new bt.Point(-16,-32),e.size=new bt.Point(32,32),e.href=t.Icon.href,e},key:function(t){return t&&t.match(/^#/)?r.getUrl()+t:t},kml:function(t){var e=t.Style||t.Document&&t.Document[0].Style;return{Styles:r.formatters.styles(e),Objects:r.formatters.geoObject(t)}},lineStyle:function(t){var e=new bt.LineStyle;return r.extend(e,t,["strokeColor","strokeWidth"],["color","width"])},outline:Number,point:function(t){var e=t.split(",").map(Number);return new bt.GeoPoint(e[0],e[1])},points:function(t){var e=t.match(/\S+/g);return Pt.map(e,r.formatters.point)},polygonStyle:function(t,e){var i=new bt.PolygonStyle;return r.extend(i,e.LineStyle||{},["strokeColor","strokeWidth"],["color","width"]),r.extend(i,t,["fill","fillColor","outline"],["fill","color","outline"])},strokeColor:function(t){return t.slice(6,8)+t.slice(4,6)+t.slice(2,4)+t.slice(0,2)},strokeWidth:Number,style:function(t){var e=new bt.Style;return t.BalloonStyle&&t.BalloonStyle.text&&r.extend(e,t,["balloonContentStyle"],["BalloonStyle"]),r.extend(e,t,["iconStyle","lineStyle","polygonStyle"],["IconStyle","LineStyle","PolyStyle"])},styles:function(t){var i={};return Pt.map(t||[],function(t){var e=r.getUrl()+"#"+t.id;i[e]=r.formatters.style(t)}),i}}};bt.KML=function(t){bt.GeoObjectCollection.call(this),e.loadDocument(t,this.__onLoaded,this)},(xt=Lt(bt.KML,bt.GeoObjectCollection)).Events.Load="Load",xt.Events.Fault="Fault",xt.__onLoaded=function(t){if(t.error)Rt.notifyPermanent(this,this.Events.Fault,this,t.error);else{r.setUrl(t.url);var e=r.formatters.kml(t.data.kml);Pt.each(e.Styles,function(t,e){bt.Styles.add(t,e)}),this.add(e.Objects),Rt.notifyPermanent(this,this.Events.Load,this)}};var i=new t("jsapi1GPX"),o={formatters:{boundedBy:function(t){return t&&new bt.GeoBounds(new bt.GeoPoint(Number(t.minlon),Number(t.minlat)),new bt.GeoPoint(Number(t.maxlon),Number(t.maxlat)))},gpx:function(e){var t=e.metadata||e,i=Pt.extend(new bt.Style,{lineStyle:Pt.extend(new bt.LineStyle,{strokeColor:"006CFFC8",strokeWidth:5})}),n=Pt.extend(new bt.GeoObjectCollection(i),{metaDataProperty:{gpxMetaData:{gpxTagName:"gpx"}},description:t.desc,name:t.name});return Pt.map(["wpt","rte","trk"],function(t){n.add(Pt.map(e[t],o.formatters[t]))}),{View:{boundedBy:o.formatters.boundedBy(t.bounds)},Objects:n}},point:function(t){return new bt.GeoPoint(Number(t.lon),Number(t.lat))},rte:function(t){var e=Pt.map(t.rtept,o.formatters.point);return Pt.extend(new bt.Polyline(e),{metaDataProperty:{gpxMetaData:{gpxTagName:"rte",gpxStartTime:t.rtept[0].time,gpxEndTime:t.rtept.slice(-1)[0].time}},description:t.desc,name:t.name})},trk:function(t){var e=Pt.extend(new bt.GeoObjectCollection,{metaDataProperty:{gpxMetaData:{gpxTagName:"trk"}},description:t.desc,name:t.name});return e.add(Pt.map(t.trkseg,o.formatters.trkseg)),e},trkseg:function(t){var e=Pt.map(t.trkpt,o.formatters.point);return Pt.extend(new bt.Polyline(e),{metaDataProperty:{gpxMetaData:{gpxTagName:"trkseg",gpxStartTime:t.trkpt[0].time,gpxEndTime:t.trkpt.slice(-1)[0].time}}})},wpt:function(t){var e=o.formatters.point(t);return Pt.extend(new bt.Placemark(e),{metaDataProperty:{gpxMetaData:{gpxTagName:"wpt",sym:t.sym,time:t.time}},description:t.desc,name:t.name})}}};bt.GPX=function(t,e){bt.GeoObjectCollection.call(this),this._options=Pt.extend({},{viewAutoApply:1},e),i.loadDocument(t,this.__onLoaded,this)},(xt=Lt(bt.GPX,bt.GeoObjectCollection)).Events.Load="Load",xt.Events.Fault="Fault",xt.__onLoaded=function(t){if(t.error)Rt.notifyPermanent(this,this.Events.Fault,this,t.error);else{var e=o.formatters.gpx(t.data.gpx);this.add(e.Objects),this.view=e.View,this._options.viewAutoApply&&this.applyView(),Rt.notifyPermanent(this,this.Events.Load,this)}},xt.onAddToMap=function(t,e){bt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._options.viewAutoApply&&this.applyView()},xt.applyView=function(){this.getMap()&&this.view&&this.view.boundedBy&&this.getMap().setBounds(this.view.boundedBy)};var n=new t("jsapi1YMapsML"),s={setUrl:function(t){this._url=t},getUrl:function(){return this._url},extend:function(i,n,t){return Pt.map(t,function(t){if(n.hasOwnProperty(t)){var e=s.formatters[t];i[t]=e?e(n[t]):n[t]}}),i},formatters:{balloonContentStyle:function(t){return new bt.BalloonContentStyle(s.formatters.key(t.template))},boundedBy:function(t){return new bt.GeoBounds(s.formatters.point(t.Envelope.lowerCorner.split(" ")),s.formatters.point(t.Envelope.upperCorner.split(" ")))},fill:Number,geoObject:function(t){var e,i=s.formatters.key(t.style);switch(!0){case Boolean(t.Point):var n=s.formatters.point(t.Point);e=new bt.Placemark(n,{style:i});break;case Boolean(t.polylod):var o=t.polylod;e=bt.Polyline.fromEncodedPoints(o.polyline,o.levels,{style:i});break;case Boolean(t.Polygon):o=t.Polygon.exterior.polylod;e=bt.Polygon.fromEncodedPoints(o.polyline,o.levels,{style:i});break;default:e=new bt.GeoObjectCollection(i),Pt.map(t.featureMembers||[],function(t){t=t.GeoObjectCollection||t.GeoObject,e.add(s.formatters.geoObject(t))})}return t.boundedBy&&e.setBounds(s.formatters.boundedBy(t.boundedBy)),s.extend(e,t,["id","metaDataProperty","name","description"])},hasBalloon:Number,hasHint:Number,hintContentStyle:function(t){return new bt.HintContentStyle(s.formatters.key(t.template))},iconContentStyle:function(t){return new bt.IconContentStyle(s.formatters.key(t.template))},iconStyle:function(t){var e=new bt.IconStyle(s.formatters.key(t.template));return s.extend(e,t,["href","offset","size","shadow"])},key:function(t){return t&&t.match(/^#/)?s.getUrl()+t:t},lineStyle:function(t){var e=new bt.LineStyle;return s.extend(e,t,["strokeColor","strokeWidth"])},metaDataProperty:function(t){var n={};return Pt.each(t,function(t,e){var i=e[0];"string"==typeof i.value?n[t]=i.value:n[t]=s.formatters.metaDataProperty(i)}),n},offset:function(t){return new bt.Point(Number(t.x),Number(t.y))},outline:Number,point:function(t){return new bt.GeoPoint(Number(t[0]),Number(t[1]))},polygonStyle:function(t){var e=new bt.PolygonStyle;return s.extend(e,t,["fill","fillColor","outline","strokeColor","strokeWidth"])},shadow:function(t){var e=new bt.IconShadowStyle(s.formatters.key(t.template));return s.extend(e,t,["href","offset","size"])},size:function(t){return new bt.Point(Number(t.x),Number(t.y))},strokeWidth:Number,style:function(t){var e=new bt.Style(s.formatters.key(t.parentStyle),!0);return s.extend(e,t,["balloonContentStyle","hasBalloon","hasHint","hintContentStyle","iconContentStyle","iconStyle","lineStyle","polygonStyle"])},styles:function(t){var n={};return Pt.each(t||[],function(t,e){var i=s.getUrl()+"#"+t;n[i]=s.formatters.style(e)}),n},template:function(t){return new bt.Template(t.text)},templates:function(t){var n={};return Pt.each(t||[],function(t,e){var i=s.getUrl()+"#"+t;n[i]=s.formatters.template(e)}),n},view:function(t){return s.extend({},t||{},["boundedBy","mapType"])},ymaps:function(t){var e=t.Representation||{};return{View:s.formatters.view(e.View),Styles:s.formatters.styles(e.Style),Templates:s.formatters.templates(e.Template),Objects:s.formatters.geoObject(t.GeoObjectCollection)}}}};bt.YMapsML=function(t,e){bt.GeoObjectCollection.call(this),this._options=Pt.extend({},{viewAutoApply:1},e),n.loadDocument(t,this.__onLoaded,this)},(xt=Lt(bt.YMapsML,bt.GeoObjectCollection)).Events.Load="Load",xt.Events.Fault="Fault",xt.__onLoaded=function(t){if(t.error)Rt.notifyPermanent(this,this.Events.Fault,this,t.error);else{s.setUrl(t.url);var e=s.formatters.ymaps(t.data.ymaps);Pt.each(e.Styles,function(t,e){bt.Styles.add(t,e)}),Pt.each(e.Templates,function(t,e){bt.Templates.add(t,e)}),this.add(e.Objects),this.view=e.View,this._options.viewAutoApply&&this.applyView(),Rt.notifyPermanent(this,this.Events.Load,this)}},xt.onAddToMap=function(t,e){bt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._options.viewAutoApply&&this.applyView()},xt.applyView=function(){var t=this.getMap();t&&this.view&&(this.view.mapType&&t.setType(bt.MapType[this.view.mapType]),this.view.boundedBy&&t.setBounds(this.view.boundedBy))}}(),function(){function h(t,e){var i=t.length;if(!i)return null;for(var n=t[0],o={point:n,index:0,distance:n.diff(e).length()},s=1,a=1/0;s<i;s++){var r=t[s];if(!n.equals(r)){var h,l,c,u=n.diff(r),d=n.diff(e),p=(u.x*d.x+u.y*d.y)/(u.x*u.x+u.y*u.y);p<0?(h=e.diff(c=n),l=s-1):1<p?(h=e.diff(c=r),l=s):(h=d.diff(u.copy().scale(p)),l=s-1,c=e.copy().moveBy(h));var _=h.length();_<a&&(o={point:c,index:l,distance:a=_}),n=r}}return o}function o(t,e,i){for(var n=0,o=0,s=t.length;o<s;o++){for(var a=t[o],r=0,h=a.length;r<h;r++)if(a[r].equals(e))return 1;var l=a[h-1];for(r=0;r<h;r++){var c=a[r];if(l.y==c.y&&l.y==e.y&&e.x>Math.min(l.x,c.x)&&e.x<Math.max(l.x,c.x))return 1;if(e.y>Math.min(l.y,c.y)&&e.y<=Math.max(l.y,c.y)&&e.x<=Math.max(l.x,c.x)&&l.y!=c.y){var u=(e.y-l.y)*(c.x-l.x)/(c.y-l.y)+l.x;if(u==e.x)return 1;(l.x==c.x||e.x<=u)&&(n+=i?wt.sign(c.y-l.y):n?-1:1)}l=c}}return n}function a(t,e){for(var i=[],n=[],o=0,s=t.length-1;o<s;o++){var a=t[o].diff(t[o+1]),r=a.scale(1/Math.sqrt(a.x*a.x+a.y*a.y)).scale(e).scale(.5),h=new Bt(r.y,-r.x);n.unshift(t[o].copy().moveBy(h)),n.unshift(t[o+1].copy().moveBy(h)),c(n);var l=new Bt(-r.y,r.x);i.unshift(t[o].copy().moveBy(l)),i.unshift(t[o+1].copy().moveBy(l)),c(i)}return It(i,"apply",Math.round),It(n,"apply",Math.round),n.reverse(),i.concat(n)}function i(){var o=[];this.add=function(t,e){o.push([t,e])},this.remove=function(t,e){for(var i=0,n=o.length;i<n;i++)if(o[0]==t&&o[1]==e){o.splice(i,1);break}},this.invoke=function(){for(var t=0,e=o.length;t<e;t++)o[t][0].apply(o[t][1],arguments)}}var c=function(t){if(t[3]){var e=t[3].diff(t[2]),i=t[0].diff(t[1]),n=e.y*i.x-e.x*i.y;if(0==n)t.splice(1,1);else{var o=(e.x*(t[0].y-t[3].y)-e.y*(t[0].x-t[3].x))/n;o<1&&0<o&&t.splice(1,2,t[0].copy().moveBy(i.copy().scale(o)))}}};bt.CoordVertex=function(t,e){this._coordPoint=t,this._zoom=Number(e)||0,this._changeCallbacks=new i},(xt=bt.CoordVertex.prototype).getVisibilityZoom=function(){return this._zoom},xt.setVisibilityZoom=function(t){this._zoom=Number(t),this._changeCallbacks.invoke(this)},xt.getCoordPoint=function(){return this._coordPoint},xt.setCoordPoint=function(t){this._coordPoint=t,this._changeCallbacks.invoke(this)},xt.addChangeCallback=function(t,e){this._changeCallbacks.add(t,e)},xt.removeChangeCallback=function(t,e){this._changeCallbacks.remove(t,e)};var _=bt.CoordPath=function(t){this._vertices=t||[],this._addVertexCallbacks(this._vertices),this._zoomIndexCache={},this._changeCallbacks=new i};(xt=_.prototype).setVertices=function(t){this._removeVertexCallbacks(this._vertices),this._addVertexCallbacks(t),this._vertices=t,this._resetCache(),this._changeCallbacks.invoke(this)},xt.getVertices=function(){return this._vertices.slice(0)},xt.getNumVertices=function(){return this._vertices.length},xt.getVertex=function(t){return t=t<0?this._vertices.length+t:t,this._vertices[t]},xt.spliceVertices=function(t,e){this._addVertexCallbacks(Array.prototype.slice.call(arguments,2));var i=this._vertices.splice.apply(this._vertices,arguments);return this._removeVertexCallbacks(i),this._resetCache(),this._changeCallbacks.invoke(this),i},xt.getIndexesByZoom=function(t){return this._zoomIndexCache[t]||this._refreshCacheForZoom(t),this._zoomIndexCache[t]},xt._refreshCacheForZoom=function(t){this._zoomIndexCache[t]=[];for(var e=0,i=this._vertices.length;e<i;e++){this._vertices[e].getVisibilityZoom()<=t&&this._zoomIndexCache[t].push(e)}},xt._resetCache=function(){this._zoomIndexCache={}},xt._onVertexChange=function(){this._resetCache(),this._changeCallbacks.invoke(this)},xt.addChangeCallback=function(t,e){this._changeCallbacks.add(t,e)},xt.removeChangeCallback=function(t,e){this._changeCallbacks.remove(t,e)},xt._addVertexCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].addChangeCallback(this._onVertexChange,this)},xt._removeVertexCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].removeChangeCallback(this._onVertexChange,this)};var m=Ct.Graphics=new function(){var a=[];this.getContainer=function(t,e){var i,n;t=t||M;for(var o=0,s=a.length;o<s;o++)if((i=a[o]).map==e&&i.container instanceof t){n=i.container;break}return n||(n=new t,a.push({map:e,container:n})),n.getMap()||e.addOverlay(n,1),n}},t=0,e=0,n=0,s=St.webkit&&523.15<St.version&&!Tt.android&&!Tt.adobeAIR,r=St.mozilla&&1.8<=St.version,l=8<St.ieDocumentMode,u=St.msie&&5.4<St.version,d=St.opera&&9.5<=St.version;s||r||d||l?t=1:u?e=1:n=1,m.SVG=t,m.VML=e,m.SSG=n,bt.PolylineCoordRenderer=function(){function y(t){return[t.getLeftBottom(),t.getLeftTop(),t.getCenter(),t.getRightBottom(),t.getRightTop()]}function b(t,e,i){var n=i.coordSystem,o=n.restrict(t),s=n.fromCoordPoint(o);return s.diff(n.fromCoordPoint(o,n.toCoordPoint(s.copy().moveBy(e),1)))}this._prevPixelBounds=null,this.renderCoords=function(t,e){if(!e)return[];var i=[],n=e.coordSystem,o=e._state.centerInTiles;if(t&&t.length){for(var s,a=0,r=t.length;a<r;a++)s=i[a-1],i.push(n.fromCoordPoint(n.restrict(t[a]),s?n.toCoordPoint(s,1):null));var h=new bt.CollectionBounds(i),l=o,c=h.getCenter();if(this._prevPixelBounds){var u=y(this._prevPixelBounds),d=function(t,n){var o,s=1/0;return Pt.map(t,function(t,e){var i=n.diff(t).length();i<s&&(s=i,o=e)}),o}(u,o);c=y(h)[d],l=u[d]}var p=n.fromCoordPoint(n.toCoordPoint(c),n.toCoordPoint(l,1)),_=b(t[0],c.diff(p),e),f=h.getCenter().moveBy(_).diff(o),m=n.getWorldSize(),v=new Bt(Math.ceil(h.getSpan().getX()/m.getX())||1,Math.ceil(h.getSpan().getY()/m.getY())||1),g=new Bt(f.getX()/m.getX()/v.getX(),f.getY()/m.getY()/v.getY()).apply(Math.round);(g.getX()||g.getY())&&_.moveBy(b(t[0],g.scale(v.scale(m)),e)),(_.getX()||_.getY())&&(Pt.each(i,function(t,e){e.moveBy(_)}),h=new bt.CollectionBounds(i)),this._prevPixelBounds=h}return i}},bt.PolygonCoordRenderer=function(){function E(t,n){var o,s=1/0;return Pt.map(t,function(t,e){var i=n.diff(t).length();i<s&&(s=i,o=e)}),o}function L(t){return[t.getLeftBottom(),t.getLeftTop(),t.getCenter(),t.getRightBottom(),t.getRightTop()]}function O(t,e,i){var n=i.coordSystem,o=n.restrict(t),s=n.fromCoordPoint(o);return s.diff(n.fromCoordPoint(o,n.toCoordPoint(s.copy().moveBy(e),1)))}this._exteriorPixelBounds=null,this.renderCoords=function(t,e){if(!e)return[];for(var i,n,o=[],s=e.coordSystem,a=e._state.centerInTiles,r=0,h=t.length;r<h;r++){var l=t[r],c=[];if(l&&l.length){for(var u,d=0,p=l.length;d<p;d++)u=c[d-1],c.push(s.fromCoordPoint(s.restrict(l[d]),u?s.toCoordPoint(u,1):null));var _=new bt.CollectionBounds(c),f=a,m=_.getCenter();if(this._exteriorPixelBounds){var v=L(this._exteriorPixelBounds),g=E(v,a);m=L(_)[g],f=v[g]}var y=s.fromCoordPoint(s.toCoordPoint(m),s.toCoordPoint(f,1)),b=O(l[0],m.diff(y),e),C=_.getCenter().moveBy(b).diff(a),M=s.getWorldSize(),x=new Bt(Math.ceil(_.getSpan().getX()/M.getX())||1,Math.ceil(_.getSpan().getY()/M.getY())||1),w=new Bt(C.getX()/M.getX()/x.getX(),C.getY()/M.getY()/x.getY()).apply(Math.round);if((w.getX()||w.getY())&&b.moveBy(O(l[0],w.scale(x.scale(M)),e)),(b.getX()||b.getY())&&(Pt.each(c,function(t,e){e.moveBy(b)}),_=new bt.CollectionBounds(c)),0==r)this._exteriorPixelBounds=_;else if(!this._exteriorPixelBounds.intersects(_)){var P=_.getCenter().diff(this._exteriorPixelBounds.getCenter()),S=new Bt(P.getX()/M.getX(),P.getY()/M.getY()).apply(function(t){return t/Math.abs(t)});S=O(l[0],S.scale(M),e);var T=(i=_,n=S,new bt.Bounds(i.getLeftBottom().moveBy(n),i.getRightTop().moveBy(n)));this._exteriorPixelBounds.intersects(T)&&(Pt.each(c,function(t,e){e.moveBy(S)}),_=T)}}o.push(c)}return o}};function x(e){this._map=e,this._listeners=[Rt.observe(e,e.Events.DragStart,this._onMapDragStart,this),Rt.observe(e,e.Events.DragEnd,this._onMapDragEnd,this)],this._layerContainerListener=At(e.__layerManager.getContainer()).events.eventListener(),this._layerContainerListener.add("mousemove",function(t){this._drawMapAutoPan(e,new bt.MouseEvent(t,e))},this).add("mouseleave",function(t){this._stopMapAutoPan()},this)}(xt=x.prototype)._drawMapAutoPan=function(t,e){var i=this._map.converter.localPixelsToMapPixels(e.getLocalPixels()),n=this._map.getContainerSize().scale(.5),o=this._map.converter.localPixelsToMapPixels(n),s=n.copy().moveBy(new Bt(-20)),a=new bt.Bounds(o.copy().moveBy(s.neg()),o.copy().moveBy(s)),r=new bt.Bounds(o.copy().moveBy(n.neg()),o.copy().moveBy(n));if(a.contains(i)||!r.contains(i))this._stopMapAutoPan();else if(!this._mapDraged){this._isMapPanned=1;var h=o.diff(i),l=h.copy().apply(Math.abs),c=new Bt(l.getX()>s.getX(),l.getY()>s.getY()).scale(h.copy().scale(new Bt(1/l.getX(),1/l.getY())));this._map.startMove(c,{startSpeed:4,speed:8})}},xt._onMapDragStart=function(){this._mapDraged=1},xt._onMapDragEnd=function(){this._mapDraged=0},xt._stopMapAutoPan=function(){this._isMapPanned&&(this._isMapPanned=0,this._map.stopMove())},xt.destruct=function(){this._stopMapAutoPan(),It(this._listeners,"cleanup"),this._layerContainerListener.removeAll()};function f(e,i){var n,o,s,a,r,h=Rt.observe(e,"MouseMove",t);function t(t,e){h.cleanup(),h=Rt.observe(t,"MouseLeave",l),(n=new wt.DragAndDrop.MouseMove(e.getEvent().target,0,kt.tremor.graphicsEditor)).beginListening(),o=[Rt.observe(n,"start",d,this),Rt.observe(n,"move",p,this),Rt.observe(n,"stop",f,this)]}function l(){h.cleanup(),h=Rt.observe(e,"MouseMove",t),n.stopListening(),It(o,"cleanup")}function c(){r=1,h.cleanup(),h=Rt.observe(e,"MouseMove",u)}function u(){r=0,h.cleanup(),h=Rt.observe(e,"MouseLeave",c)}function d(t){r=0,h.cleanup(),h=Rt.observe(e,"MouseLeave",c),i.dragStart&&i.dragStart(t)}function p(t){i.dragMove&&(m.VML?(a=t,s=s||setInterval(_,10)):i.dragMove(t))}function _(){a?(i.dragMove(a),a=null):(clearInterval(s),s=null)}function f(t){m.VML&&_(),r?l():(h.cleanup(),h=Rt.observe(e,"MouseLeave",l)),i.dragStop&&i.dragStop(t)}this.destruct=function(){n&&(n.stopListening(),It(o,"cleanup")),h.cleanup()}}function p(t){var n,o,s=function(){var t=Pt("<div class='YMaps-gEditor-glassPane' style='position:absolute;' />");St.msie&&t.css("background","url("+kt.images.transparentImage+")");return t}().css("zIndex",t),a=At(s[0]).events.eventListener(),e={Update:"Update",Click:"Click",DblClick:"DblClick",MouseMove:"MouseMove",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",AddToMap:"AddToMap",RemoveFromMap:"RemoveFromMap"},r={Click:"click",DblClick:"dblclick",MouseMove:"mousemove",MouseEnter:"mouseenter",MouseLeave:"mouseleave"},h={};for(var i in r)r.hasOwnProperty(i)&&(h[i]=function(e,i){return function(t){Rt.notify(i,e,i,new bt.MouseEvent(t,n))}}(e[i],this));function l(){var t=n.getContainerSize(),e=n.converter.localPixelsToMapPixels(new Bt(0,0));s.css({top:e.getY()+"px",left:e.getX()+"px",width:t.getX()+"px",height:t.getY()+"px"}),Rt.notify(this,this.Events.Update,this)}this.getMap=function(){return n},this.onMapUpdate=l,this.onAddToMap=function(t,e){for(var i in n=t,s.appendTo(e),o=Rt.observe(n,n.Events.MoveEnd,l,this),h)h.hasOwnProperty(i)&&a.add(r[i],h[i]);l.call(this),Rt.notify(this,this.Events.AddToMap,this)},this.onRemoveFromMap=function(){a.removeAll(),o.cleanup(),s.removeFromDom(),n=null,Rt.notify(this,this.Events.RemoveFromMap,this)},this.Events=e}function v(){this._map=null,this._$container=Pt("<div />").css({position:"absolute",width:0,height:0,zIndex:0}),this.hide(),this._size=null,this._position=null,this._delta=null,this._shift=new Bt(0,0),this._graphics=[]}(xt=v.prototype).Events={Update:"Update"},xt.onAddToMap=function(t,e){this._map=t,this._$container.appendTo(e),this._moveEndListener=Rt.observe(t,t.Events.MoveEnd,this.onMapMoveEnd,this,1),this._smoothZoomListeners=[Rt.observe(t,t.Events.SmoothZoomStart,this.hide,this,1),Rt.observe(t,t.Events.SmoothZoomEnd,this.show,this,1)],this.update()},xt.onRemoveFromMap=function(){this._moveEndListener.cleanup(),It(this._smoothZoomListeners,"cleanup"),this._$container.removeFromDom(),this._map=this._moveEndListener=this._smoothZoomListeners=null},xt.getMap=function(){return this._map},xt.getSize=function(){return this._size},xt.getDelta=function(){return this._shift.diff(this._delta)},xt.getPosition=function(){return this._position},xt.update=function(){var t=this._map.getContainerSize(),e=this._map.converter.localPixelsToMapPixels(new Bt(0,0));this._shift=new Bt(0,0),this.__mapCenter=this._map.getCenter(1),this._delta=t.copy().scale(1),this._position=this._delta.diff(e),this._size=t.moveBy(this._delta.copy().scale(2)),wt.position(this._$container[0],this._position)},xt.show=function(){this._$container.removeClass("YMaps-display-none")},xt.hide=function(){this._$container.addClass("YMaps-display-none")},xt.onMapMoveEnd=function(){var t=this._map.converter,e=this._map.getCenter(1),i=t.coordinatesToLocalPixels(e,1).diff(t.coordinatesToLocalPixels(this.__mapCenter,1)),n=i.copy().apply(Math.abs);n.getX()>this._delta.getX()/2||n.getY()>this._delta.getY()/2?this.onMapUpdate():this._shift=i},xt.onMapUpdate=function(){this.update(),Rt.notify(this,this.Events.Update,this)},xt.add=function(t){this._graphics.length||this.show(),this._graphics.push(t)},xt.remove=function(t){var e=Pt.inArray(t,this._graphics);-1!=e&&this._graphics.splice(e,1),this._graphics.length||this.hide()},xt.destructor=function(){this._map&&this.onRemoveFromMap(),this._$container=null};function g(){this.styles={},this._eventHandlers={DblClick:this._dblClick,Click:this._click,MouseEnter:this._mouseEnter,MouseLeave:this._mouseLeave,MouseMove:this._mouseMove}}(xt=g.prototype).Events={DblClick:"DblClick",Click:"Click",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove"},xt.getMap=function(){return this._map},xt.onAddToMap=function(t){this._map=t,this._container=m.getContainer(this._containerClass,t),this._createListeners()},xt.onRemoveFromMap=function(){this._map&&(this._destroyListeners(),this._map=this._container=null)},xt.onMapUpdate=function(){this.update()},xt.setCursor=function(t){this._cursor=t},xt.setZIndex=function(t){this._zIndex=t},xt.setGeometry=function(t){this._geometry=t},xt._createListeners=xt._destroyListeners=xt.update=xt._dblClick=xt._click=xt._mouseEnter=xt._mouseLeave=xt._mouseMove=wt.NULL,xt.setUID=function(t){this._uid=t};function y(){g.call(this)}(xt=Lt(y,g)).__translatedEventNames={DblClick:"dblclick",Click:"click",MouseEnter:"mouseenter",MouseLeave:"mouseleave",MouseMove:"mousemove"},xt.onAddToMap=function(t){g.prototype.onAddToMap.call(this,t),this._container.add(this._htmlElement)},xt.onRemoveFromMap=function(){this._mouseChecksReset(),this._map&&(this._container.remove(this._htmlElement),g.prototype.onRemoveFromMap.call(this))},xt.setCursor=function(t){this._cursorManager?this._cursorManager.removeCursor(this._cursor):this._cursorManager=new Ct.CursorManager(this._htmlElement),g.prototype.setCursor.call(this,t),this._cursorManager.addCursor(this._cursor)},xt._createListeners=function(){for(var t in this.domListener=At(this._htmlElement).events.eventListener(),this._eventHandlers)this.domListener.add(this.__translatedEventNames[t],this._eventHandlers[t],this)},xt._destroyListeners=function(){this.domListener.removeAll()},xt._dblClick=function(t){Rt.notify(this,this.Events.DblClick,this,new bt.MouseEvent(t,this._map))},xt._click=function(t){Rt.notify(this,this.Events.Click,this,new bt.MouseEvent(t,this._map))},xt._mouseEnter=function(t){this.isMouseOver||(this.isMouseOver=1,(St.opera||St.mozilla)&&(this.mapBeforeMouseMoveListener=Rt.observe(this._map,this._map.Events.BeforeMouseMove,this._mapMouseMove,this)),Rt.notify(this,this.Events.MouseEnter,this,new bt.MouseEvent(t,this._map)))},xt._mouseLeave=function(t){this.isMouseOver&&(this.isMouseOver=0,(St.opera||St.mozilla)&&this._mouseChecksReset(),Rt.notify(this,this.Events.MouseLeave,this,new bt.MouseEvent(t,this._map)))},xt._mouseChecksReset=function(){this.mapBeforeMouseMoveListener&&this.mapBeforeMouseMoveListener.cleanup()},xt._mouseMove=function(t){this.isMouseOver||this._mouseEnter(t),this.isMouseOver&&Rt.notify(this,this.Events.MouseMove,this,new bt.MouseEvent(t,this._map))},xt._mapMouseMove=function(t,e){var i=e.getEvent();i.target!=this._htmlElement&&this._mouseLeave(i)},xt.setUID=function(t){g.prototype.setUID.call(this,t),this._htmlElement.uid=t};(xt=function(){}.prototype).setPoints=function(t){this._points=t},xt.getPoints=function(){return this._points};function b(t,e){this._id=wt.generateId(),this._coords=t||[],this._zIndex=e||0}(xt=b.prototype).setUID=function(t){var e=this._uid;this._uid=t,Rt.notify(this,"UidChange",this,e,t)},xt.getUID=function(){return this._uid},xt.getId=function(){return this._id},xt.setZIndex=function(t){var e=this._zIndex;this._zIndex=t,Rt.notify(this,"ZIndexChange",this,e,t)},xt.getZIndex=function(){return this._zIndex},xt.setCoords=function(t){this._coords=t,this._cachedBounds=null,Rt.notify(this,"CoordsChange",this)},xt.getCoords=function(){return this._coords},xt.contains=function(t){if(this.getBounds().contains(t))for(var e=this._coords,i=0,n=e.length;i<n;i++)if(o(e[i].coords,t,e[i].nonzero))return 1},xt.getBounds=function(){if(!this._cachedBounds){this._cachedBounds=new bt.CollectionBounds;for(var t=0,e=this._coords.length;t<e;t++)this._cachedBounds.add(this._coords[t].coords)}return this._cachedBounds},xt.setCursor=function(t){this._cursor=t},xt.getCursor=function(){return this._cursor},xt.destruct=function(){Rt.notify(this,"Destruction",this)},xt.click=function(t){Rt.notify(this,"Click",this,t)},xt.dblClick=function(t){Rt.notify(this,"DblClick",this,t)},xt.mouseEnter=function(t){Rt.notify(this,"MouseEnter",this,t)},xt.mouseLeave=function(t){Rt.notify(this,"MouseLeave",this,t)},xt.mouseMove=function(t){Rt.notify(this,"MouseMove",this,t)};function C(i){var o={},s={heads:{},tails:{},maxZIndex:0};function a(t,e){if(t.next=function(t){{if(s.heads[t])return s.heads[t];if(s.maxZIndex<t)return s.heads[s.maxZIndex];for(var e=t-1;0<=e;e--)if(s.heads[e])return s.heads[e]}}(e),t.next&&(t.next.prev=t),t.prev=function(t){if(s.maxZIndex>t)for(var e=t+1;e<=s.maxZIndex;e++)if(s.tails[e])return s.tails[e]}(e),t.prev&&(t.prev.next=t),t.next&&t.next.hotspot.getZIndex()==e){var i=t.hotspot.getUID();if(i){for(var n=t.next;n&&(n.hotspot.getUID()!=i||n.hotspot.getZIndex()!=e);)n=n.next;n&&n.hotspot.getUID()==i&&n.hotspot.getZIndex()==e&&(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=n,t.prev=n.prev,(n.prev=t).prev&&(t.prev.next=t))}}s.heads[e]||(s.tails[e]=t),t.prev&&t.prev.hotspot.getZIndex()==e||(s.heads[e]=t),s.maxZIndex=Math.max(s.maxZIndex,e)}function n(t){var e=t.getId(),i=o[e];i&&(delete o[e],It(i.listeners,"cleanup"),r(i,t.getZIndex()))}function r(t,e){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),s.heads[e]==t)if(t.next&&t.next.hotspot.getZIndex()==e)s.heads[e]=t.next;else if(delete s.heads[e],s.maxZIndex==e)for(var i in s.maxZIndex=0,s.heads)s.heads.hasOwnProperty(i)&&(s.maxZIndex=Math.max(s.maxZIndex,i));s.tails[e]==t&&(t.prev&&t.prev.hotspot.getZIndex()==e?s.tails[e]=t.prev:delete s.tails[e])}function h(t,e,i){var n=o[t.getId()];r(n,e),a(n,i)}this.add=function(t){var e=t.getId(),i={hotspot:t,listeners:[Rt.observe(t,"ZIndexChange",h),Rt.observe(t,"Destruction",n)]};a(o[e]=i,t.getZIndex())},this.remove=n;var l,c,t=[Rt.observe(i,i.Events.Click,function(t,e){var i=u(e,t.getMap());i&&i.click(e)}),Rt.observe(i,i.Events.DblClick,function(t,e){var i=u(e,t.getMap());i&&i.dblClick(e)}),Rt.observe(i,i.Events.MouseMove,function(t,e){var i=u(e,t.getMap());l&&l!=i&&(l.mouseLeave(e),l=null);i&&(l||(i.mouseEnter(e),l=i),i.mouseMove(e));d()}),Rt.observe(i,i.Events.MouseEnter,function(t,e){var i=u(e,t.getMap());i&&(i.mouseEnter(e),l=i);d()}),Rt.observe(i,i.Events.MouseLeave,function(t,e){l&&l.mouseLeave(e);l=null,d()})];function u(t,e){for(var i=s.heads[s.maxZIndex],n=function(t,e){return t.tileCoordinates.scale(t.coordSystem.fromCoordPoint(e),t.coordSystem.getMaxZoom(),t.getZoom())}(e,t.getCoordPoint(1)),o=null;i;){if(i.hotspot.contains(n)){o=i.hotspot;break}i=i.next}return o}function d(){var t=i.getMap(),e=l&&l.getCursor();c!=e&&(c&&t.removeCursor(c),e&&t.addCursor(e)),c=e}this.destruct=function(){bt.jQuery.each(o,function(t,e){It(e.listeners,"cleanup")}),It(t,"cleanup"),o=null}}var M,w,P,S;n&&((xt=Lt(M=function(){v.call(this),this._viewBox=Pt("<div />").css({position:"absolute"})[0],this._$container.append(this._viewBox),this._glassPane=new p(0),this._hotspotField=new C(this._glassPane)},v)).onAddToMap=function(t,e){v.prototype.onAddToMap.call(this,t,e),this._map.addOverlay(this._glassPane,1)},xt.onRemoveFromMap=function(){v.prototype.onRemoveFromMap.call(this),this._map.removeOverlay(this._glassPane)},xt.getHotspotField=function(){return this._hotspotField},xt.add=function(t){v.prototype.add.call(this,t);var e=t.name;if("polyline"==e||"polygon"==e){for(var i=0,n=Pt(this._viewBox).children(),o=n.length;i<o;i++)if(n[i].uid>t.uid)return void Pt(t).insertBefore(n[i]);this._viewBox.appendChild(t)}},xt.remove=function(t){var e=t.parentNode;e==this._viewBox&&(v.prototype.remove.call(this,t),e.removeChild(t))},(xt=Lt(w=function(){g.call(this);var t='<img style="position:absolute;"/>';this._htmlElement=Pt(t)[0],this._htmlElementClon=Pt(t)[0],this._$imageLoader=Pt(t),this._imageLoaderListener=At(this._$imageLoader[0]).events.eventListener()},g)).onRemoveFromMap=function(){this._map&&(this._imageLoaderListener.removeAll(),this._hotspot&&(this._container.getHotspotField().remove(this._hotspot),this._hotspot=null),this._container.remove(this._htmlElement),g.prototype.onRemoveFromMap.call(this))},xt.setCursor=function(t){g.prototype.setCursor.call(this,t),this._hotspot&&this._hotspot.setCursor(this._cursor)},xt.setZIndex=function(t){g.prototype.setZIndex.call(this,t),Pt([this._htmlElement,this._htmlElementClon]).css("zIndex",this._zIndex),this._hotspot&&this._hotspot.setZIndex(this._zIndex)},xt.setUID=function(t){g.prototype.setUID.call(this,t),this._htmlElement.uid=t,this._htmlElementClon.uid=t,this._hotspot&&this._hotspot.setUID(t)},xt._destroyListeners=function(){this._hotspotListeners&&(It(this._hotspotListeners,"cleanup"),this._hotspotListeners=null)},xt.update=function(){if(this._map&&this._geometry){this._containerPosCache&&wt.position(this._htmlElement,this._containerPosCache.diff(this._container.getPosition()).diff(wt.position(this._htmlElement))),this._mapZoom!=this._map.getZoom()&&this._container.remove(this._htmlElement);var t=this._constructImg();this._size=new Bt(t.width,t.height),this._position=this._map.converter.mapPixelsToLocalPixels(new Bt(t.left,t.top)),this._containerPosCache=this._container.getPosition(),this._mapZoom=this._map.getZoom(),this._imageLoaderListener.add("load",this._onImageLoad,this),this._$imageLoader.attr("src",t.src),(St.opera||St.webkit)&&this._$imageLoader.attr("complete")&&this._onImageLoad()}},xt._constructImg=function(){var t=Pt.map(this._geometry,function(t){return t}),e=new bt.CollectionBounds(t),i=this.styles,n=e.getSpan().apply(Math.round),o=Math.round(i.strokeWidth),s=n.x+o,a=n.y+o,r=Math.floor(o/2),h=this._getGeoPoint(e.getCenter(),this._map.coordSystem==Dt),l=this._container.getDelta(),c=i.outline?"c:"+i.strokeColor+this._stringUp(Math.round(255*i.strokeOpacity).toString(16),2,"0")+",w:"+o+",":"w:0,",u=i.fill?"f:"+i.fillColor+this._stringUp(Math.round(255*i.fillOpacity).toString(16),2,"0")+",":"",d=Ct.printerApi+"1.x/?origin=javascriptapi&ll="+h.toString()+"&size="+s+","+a+"&z="+this._map.getZoom()+"&key="+Ct.userKey+"&pl="+c+u+this._encodeGeometry();return{width:s,height:a,left:e.getLeft()+l.x-r,top:e.getBottom()+l.y-r,src:d}},xt._stringUp=function(t,e,i){for(;t.length<e;)t=i+t;return t},xt._encode4bytes=function(t){for(var e=[],i=this._preparePoints(t),n=0,o=i.length;n<o;n++)e=e.concat(yt.encode4bytes(i[n].getX()),yt.encode4bytes(i[n].getY()));return e},xt._preparePoints=function(t){for(var e,i=[],n=0,o=t.length,s=Dt.getCoordPoint(0,0);n<o;n++)e=this._getGeoPoint(t[n],this._map.coordSystem==Dt),i.push(s.diff(e).scale(yt.codingCoefficient).apply(Math.round)),s=e;return i},xt._getGeoPoint=function(t,e){return e?this._map.converter.mapPixelsToCoordinates(t,1):Dt.toCoordPoint(this._map.coordSystem.fromCoordPoint(this._map.converter.mapPixelsToCoordinates(t,1)),1)},xt._onImageLoad=function(){this._imageLoaderListener.removeAll(),wt.position(this._htmlElementClon,this._position),wt.size(this._htmlElementClon,this._size),this._htmlElementClon.src=this._$imageLoader.attr("src"),this._container.remove(this._htmlElement);var t=this._htmlElement;if(this._htmlElement=this._htmlElementClon,this._htmlElementClon=t,this._container.add(this._htmlElement),this._hotspot||(this._hotspot=new b,this._hotspot.setCursor(this._cursor),this._hotspot.setZIndex(this._zIndex),this._hotspot.setUID(this._uid),this._container.getHotspotField().add(this._hotspot)),!this._hotspotListeners)for(var e in this._hotspotListeners=[],this._eventHandlers)this._hotspotListeners.push(Rt.observe(this._hotspot,e,this._eventHandlers[e],this));this._hotspot.setCoords(this._getCoordsArray())},xt._getCoordsArray=wt.NULL,xt._mapPixelsToGlobalPixel=function(t){for(var e=this._map,i=e._state,n=[],o=0,s=t.length;o<s;o++){var a=i.centerInPixels.diff(t[o].copy().moveBy(i.offset));n.push(a.scale(1/e.animator.getState().scaleCoefficient).moveBy(e.tileCoordinates.scale(i.centerInTiles,e.coordSystem.getMaxZoom(),e.getZoom())))}return n},xt._dblClick=function(t,e){Rt.notify(this,this.Events.DblClick,this,e)},xt._click=function(t,e){Rt.notify(this,this.Events.Click,this,e)},xt._mouseEnter=function(t,e){Rt.notify(this,this.Events.MouseEnter,this,e)},xt._mouseLeave=function(t,e){Rt.notify(this,this.Events.MouseLeave,this,e)},xt._mouseMove=function(t,e){Rt.notify(this,this.Events.MouseMove,this,e)},(xt=Lt(P=function(){w.call(this),this._htmlElement.name=this._htmlElementClon.name="polyline",this.styles.fill=0,this.styles.outline=1},w))._getCoordsArray=function(){return[{coords:[a(this._mapPixelsToGlobalPixel(this._geometry),this.styles.strokeWidth)],nonzero:1}]},xt._encodeGeometry=function(){return yt.encode(this._encode4bytes(this._geometry))},(xt=Lt(S=function(){w.call(this),this._htmlElement.name=this._htmlElementClon.name="polygon"},w)).setGeometry=function(t){w.prototype.setGeometry.call(this,t);for(var e=0,i=t.length;e<i;e++){var n=t[e];n[0]&&n.push(n[0])}},xt._getCoordsArray=function(){for(var t=this._geometry,e=[],i=0,n=t.length;i<n;i++)t[i]=this._mapPixelsToGlobalPixel(t[i]),e[i]=a(t[i],this.styles.strokeWidth);return[{coords:t,nonzero:0},{coords:e,nonzero:1}]},xt._encodeGeometry=function(){return Pt.map(this._geometry,Ot(function(t){return yt.encode(this._encode4bytes(t))},this)).join(";")},xt._preparePoints=function(t){var e,i=w.prototype._preparePoints.call(this,t),n=0,o=i.length-1;if(0<o){for(;n<o;n++)e=(e||i[n].copy()).moveBy(i[n+1]);i[o].moveBy(e.diff(i[0]))}return i});e&&((xt=Lt(M=function(){v.call(this);var t=document.createStyleSheet(),e="behavior: url(#default#VML);display:inline-block;";t.addRule("vml\\:group",e),t.addRule("vml\\:shape",e);try{document.namespaces.vml||document.namespaces.add("vml","urn:schemas-microsoft-com:vml")}catch(t){}this.coordSizeCoef=10;var i=this._viewBox=document.createElement("vml:group"),n=i.style;n.position="absolute",n.top=n.left="-1px",this._$container.append(i)},v)).add=function(t){v.prototype.add.call(this,t);for(var e=this._viewBox,i=0,n=e.childNodes,o=n.length;i<o;i++)if(n[i].uid>t.uid)return void e.insertBefore(t,n[i]);e.appendChild(t)},xt.remove=function(t){t.parentElement==this._viewBox&&(v.prototype.remove.call(this,t),this._viewBox.removeChild(t))},xt.update=function(){v.prototype.update.call(this);var t=this._viewBox,e=t.style;e.visibility="hidden",wt.size(t,this._size),t.coordsize=this._size.copy().scale(this.coordSizeCoef).toString(),t.coordorigin=this._position.copy().scale(this.coordSizeCoef).toString(),e.visibility="visible"},xt.refresh=function(){var t=this._map;clearTimeout(this._refreshTimeoutId),this._refreshTimeoutId=setTimeout(function(){Pt(t.getContainer()).addClass("YMaps-fake-class").removeClass("YMaps-fake-class")},250)},(xt=Lt(w=function(){y.call(this)},y)).update=function(){var t=this.styles;this._htmlElement.stroke&&(this._htmlElement.stroke.opacity=Math.round(100*t.strokeOpacity)+"%"),this._htmlElement.strokeweight=t.strokeWidth+"px",this._htmlElement.strokecolor="#"+t.strokeColor,St.version<8&&this._container.refresh()},xt.setZIndex=function(t){g.prototype.setZIndex.call(this,t),this._htmlElement.style.zIndex=t},(xt=Lt(P=function(){w.call(this),this._htmlElement=document.createElement("vml:shape");var t=this._htmlElement.style;t.margin="auto",t.height=t.width="100%",t.zIndex=2,this._htmlElement.name="polyline",this._htmlElement.filled=!1},w)).update=function(){w.prototype.update.call(this);var e=this._container.coordSizeCoef,t=Pt.map(this._geometry,function(t){return t.copy().scale(e).apply(Math.round).toString()}),i=this._htmlElement;i.path="m "+t.shift()+" l "+t.join(" ")+" e",i.coordorigin=this._container.getPosition().copy().scale(e).toString(),i.coordsize=this._container.getSize().copy().scale(e).toString(),i.stroked=!!this.styles.strokeWidth,i.stroke&&(i.stroke.endcap="round")},(xt=Lt(S=function(){w.call(this),this._interiors=[],this._htmlElement=document.createElement("vml:shape");var t=this._htmlElement.style;t.margin="auto",t.width=t.height="100%",t.zIndex=1,this._htmlElement.name="polygon"},w)).update=function(){w.prototype.update.call(this);for(var t,e=this._container.coordSizeCoef,i=this.styles,n=this._htmlElement,o=this._geometry,s="",a=0,r=o.length;a<r;a++)1!=(t=Pt.map(o[a],function(t){return t.copy().scale(e).apply(Math.round).toString()})).length&&(s+=" m "+t.shift()+" l "+t.join(" ")+" x ");s+=" e",n.path=s,n.coordorigin=this._container.getPosition().copy().scale(e).toString(),n.coordsize=this._container.getSize().copy().scale(e).toString(),n.stroked=i.outline&&i.strokeWidth,n.filled=i.fill,n.fillcolor="#"+i.fillColor,n.fill&&(n.fill.opacity=Math.round(100*i.fillOpacity)+"%")},xt.setInteriors=function(t){this._interiors=t});t&&((xt=Lt(M=function(){v.call(this),this._viewBox=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._viewBox.setAttribute("zoomAndPan","disable"),this._$container.append(this._viewBox),this._zIndexGroups=[]},v)).add=function(t){v.prototype.add.call(this,t);var e=t.zIndex,i=this._zIndexGroups[e];if(!i){(i=this._zIndexGroups[e]=document.createElementNS("http://www.w3.org/2000/svg","g")).zIndex=e;for(var n=0,o=(s=this._viewBox.childNodes).length;n<o;n++)if(s[n].zIndex>e){this._viewBox.insertBefore(i,s[n]);break}i.parentNode||this._viewBox.appendChild(i)}var s;for(n=0,o=(s=i.childNodes).length;n<o;n++)if(s[n].uid>t.uid)return void i.insertBefore(t,s[n]);i.appendChild(t)},xt.remove=function(t){var e=this._zIndexGroups[t.zIndex];t.parentNode==e&&(v.prototype.remove.call(this,t),e.removeChild(t))},xt.update=function(){v.prototype.update.call(this),this._viewBox.setAttribute("viewBox",this._position.x+" "+this._position.y+" "+this._size.x+" "+this._size.y),this._viewBox.setAttribute("width",this._size.x),this._viewBox.setAttribute("height",this._size.y)},(xt=Lt(w=function(){y.call(this),St.chrome&&this.styles.outline&&!this.styles.strokeWidth&&(this.styles.outline=0)},y)).update=function(){this._setAttrs(this._getFreshAttrs())},xt._getFreshAttrs=function(){var t=this.styles;return{fill:t.fill?"#"+t.fillColor:"none",stroke:t.outline?"#"+t.strokeColor:"none","stroke-opacity":t.strokeOpacity,"stroke-width":t.strokeWidth+"px"}},xt._setAttrs=function(t){for(var e in t)t.hasOwnProperty(e)&&this._htmlElement.setAttribute(e,t[e])},xt.setZIndex=function(t){g.prototype.setZIndex.call(this,t);var e=this._container,i=this._htmlElement;i.zIndex=t,e&&(e.remove(i),e.add(i))},(xt=Lt(P=function(){w.call(this),this._htmlElement=document.createElementNS("http://www.w3.org/2000/svg","polyline"),this._setAttrs({"stroke-linecap":"round","stroke-linejoin":"round",name:"polyline",zIndex:"2"})},w))._getFreshAttrs=function(){for(var t=w.prototype._getFreshAttrs.call(this),e=0,i=this._geometry.length,n=[];e<i;e++)n.push(this._geometry[e].toString());return t.points=n.join(" "),t},(xt=Lt(S=function(){w.call(this),this._htmlElement=document.createElementNS("http://www.w3.org/2000/svg","path"),this._setAttrs({"stroke-linejoin":"round","fill-rule":"evenodd",name:"polygon",zIndex:"1"})},w))._getFreshAttrs=function(){var t=w.prototype._getFreshAttrs.call(this);t["fill-opacity"]=this.styles.fillOpacity;for(var e=this._geometry,i=0,n=e.length;i<n;i++){for(var o=e[i],s=0,a=o.length,r=[];s<a;s++)r[s]=o[s].toString();e[i]="M "+r.join(" L ")+" Z"}return t.d=e.join(" "),t});function T(){v.call(this)}(xt=Lt(T,v)).add=function(t){v.prototype.add.call(this,t),this._$container.append(t)},xt.remove=function(t){t.parentNode==this._$container[0]&&(v.prototype.remove.call(this,t),this._$container[0].removeChild(t))};function E(){y.call(this),this._containerClass=T,this._htmlElement=Pt("<div />").css("position","absolute")[0]}(xt=Lt(E,y)).update=function(){if(this._map){for(var t=this._geometry,e=new bt.CollectionBounds(t),i=this.styles,n=1.7*i.strokeWidth+7,o=Math.max(i.strokeWidth/1.2,2),s="",a=0,r=t.length-1;a<r;a++)for(var h=t[a],l=t[a+1],c=h.diff(l),u=Math.sqrt(c.x*c.x+c.y*c.y),d=Math.atan(c.y/c.x),p=h.x<=l.x?1:-1,_=p*n*Math.cos(d),f=p*n*Math.sin(d),m=0,v=u/n,g=e.getLeft(),y=e.getTop(),b=new Bt(g,y).moveBy(this._container.getDelta());m<v;m++)s+='<div style="position:absolute;font-size:0px;left:'+(h.x-g+m*_)+"px;top:"+(h.y-y+m*f)+"px;width:"+Math.round(o)+"px;height:"+Math.round(o)+"px;background-color:#"+i.strokeColor+";opacity:"+i.strokeOpacity+";filter:alpha(opacity="+100*i.strokeOpacity+');"></div>';wt.position(this._htmlElement,this._map.converter.mapPixelsToLocalPixels(b).moveBy(new Bt(-Math.floor(o/2)))),Pt(this._htmlElement).html(s)}};function L(t){g.call(this),this._geometry=null,this._shape=null,this._shapeListeners=null,this._shapeClass=t}(xt=Lt(L,g)).onAddToMap=function(t){g.prototype.onAddToMap.call(this,t),this._shape&&this._shape.onAddToMap(t)},xt.onRemoveFromMap=function(){this._shape&&(this._shape.onRemoveFromMap(),this._shape=null),g.prototype.onRemoveFromMap.call(this)},xt.setGeometry=function(t){this._geometry=t},xt._createListeners=function(){this._createShapeListeners()},xt._createShapeListeners=function(){if(this._shape)for(var t in this._shapeListeners=[],this._eventHandlers)this._shapeListeners.push(Rt.observe(this._shape,t,this._eventHandlers[t],this))},xt._destroyListeners=function(){this._destroyShapeListeners()},xt._destroyShapeListeners=function(){this._shapeListeners&&(It(this._shapeListeners,"cleanup"),this._shapeListeners=null)},xt.setCursor=function(t){g.prototype.setCursor.call(this,t),this._shape&&this._shape.setCursor(this._cursor)},xt.setZIndex=function(t){g.prototype.setZIndex.call(this,t),this._shape&&this._shape.setZIndex(this._zIndex)},xt.update=function(){var t=this._shape;if(this._geometry){for(var e in t||(t=this._shape=new this._shapeClass,this._createShapeListeners()),t.setCursor(this._cursor),t.setZIndex(this._zIndex),this.styles)this.styles.hasOwnProperty(e)&&(t.styles[e]=this.styles[e]);t.setGeometry(this._geometry),t.getMap()||t.onAddToMap(this._map),t.update()}else t&&t.onRemoveFromMap()},xt._dblClick=function(t,e){Rt.notify(this,this.Events.DblClick,this,e)},xt._click=function(t,e){Rt.notify(this,this.Events.Click,this,e)},xt._mouseEnter=function(t,e){Rt.notify(this,this.Events.MouseEnter,this,e)},xt._mouseLeave=function(t,e){Rt.notify(this,this.Events.MouseLeave,this,e)},xt._mouseMove=function(t,e){Rt.notify(this,this.Events.MouseMove,this,e)},xt.destructor=xt.onRemoveFromMap;function O(t){bt.AInteractiveGeoObject.call(this,t),t=t||{},this._interactive=typeof t.interactive!=Et?t.interactive:bt.Interactivity.INTERACTIVE,this._geodesic=!!t.geodesic,this._cursor=t.cursor||null,this._zIndex=typeof t.zIndex!=Et?t.zIndex:null,this._draggable=!!t.draggable}(xt=Lt(O,bt.AInteractiveGeoObject)).Events={DblClick:"DblClick",Click:"Click",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave",MouseMove:"MouseMove",DragStart:"DragStart",Drag:"Drag",DragEnd:"DragEnd",BalloonOpen:"BalloonOpen",BalloonClose:"BalloonClose",PositionChange:"PositionChange",StartEditing:"StartEditing",StopEditing:"StopEditing",StartDrawing:"StartDrawing",StopDrawing:"StopDrawing",AddToMap:"AddToMap",RemoveFromMap:"RemoveFromMap",Update:"Update"},xt.getShape=function(){return this._shape},xt.getMap=function(){return this._map},xt.onAddToMap=function(t){this._map=t,this._shape.onAddToMap(this._map),this._createShapeListeners(),this._container=m.getContainer(this._containerClass,t),this._eventListeners.push(Rt.observe(this._container,this._container.Events.Update,this.updateGraphics,this)),this._shape.setCursor(this._getActualCursor()),this._shape.setZIndex(this._getCalculatedZIndex()),this._draggable&&this._enableDragger(),this.update(),Rt.notify(this,this.Events.AddToMap,this)},xt.onRemoveFromMap=function(){this._map&&(this._draggable&&this._disableDragger(),this.stopEditing(),this.closeBalloon(),this._hideHint(0),this._shape.onRemoveFromMap(),this._destroyShapeListeners(),this._map=null,Rt.notify(this,this.Events.RemoveFromMap,this))},xt._createShapeListeners=function(){this._eventListeners=[Rt.observe(this._shape,this.Events.DblClick,this._onDblClick,this),Rt.observe(this._shape,this.Events.Click,this._onClick,this),Rt.observe(this._shape,this.Events.MouseEnter,this._onMouseEnter,this),Rt.observe(this._shape,this.Events.MouseLeave,this._onMouseLeave,this),Rt.observe(this._shape,this.Events.MouseMove,this._onMouseMove,this)]},xt._destroyShapeListeners=function(){It(this._eventListeners,"cleanup"),this._eventListeners=null},xt.onMapUpdate=wt.NULL,xt.update=function(){bt.AInteractiveGeoObject.prototype.update.call(this),this._applyStyle(),this._updateHint(),this._updateBalloon(),this.updateGraphics()},xt.updateGraphics=function(){this._map&&(this._shape.update(),this._balloonVisible&&this._map.getBalloon().setGeoPoint(this._getBalloonPosition())),Rt.notify(this,this.Events.Update,this)},xt.getPixelPoints=wt.NULL,xt._toGeodesicPixels=function(t){for(var e=this._map,i=this._getSegments(Pt.map(t,function(t){return e.coordSystem.toCoordPoint(t,1)})),n=[],o=0,s=i.length;o<s;o++)n=n.concat(Ct.MathLib.ortho(i[o][0],i[o][1]));return n=Pt.map(n,function(t){return e.coordSystem.fromCoordPoint(t)})},xt._getClippedPixels=wt.NULL,xt._applyStyle=wt.NULL,xt.setOptions=function(t,e){bt.AInteractiveGeoObject.prototype.setOptions.call(this,t,e),t=t||{};var i=e?{draggable:0,interactive:bt.Interactivity.INTERACTIVE,geodesic:0,cursor:null,zIndex:null}:this.getOptions(),n=0;for(var o in t)i[o]=t[o];this._interactive==i.interactive&&this._cursor==i.cursor||(this._interactive=i.interactive,this._cursor=i.cursor,this._shape.setCursor(this._getActualCursor())),this._geodesic!=i.geodesic&&(this._geodesic=i.geodesic,n=1),this._zIndex!=i.zIndex&&(this._zIndex=i.zIndex,this._shape.setZIndex(this._getCalculatedZIndex())),this._draggable!=i.draggable&&((this._draggable=i.draggable)?this._enableDragger():this._disableDragger()),(n=this._setChildOptions(t,e)||n)&&this.updateGraphics()},xt._setChildOptions=wt.NULL,xt.getOptions=function(){var t=bt.AInteractiveGeoObject.prototype.getOptions.call(this);return t.interactive=this._interactive,t.geodesic=this._geodesic,t.cursor=this._cursor,t.zIndex=this._zIndex,t.draggable=this._draggable,t.coordRenderer=this._coordRenderer,t},xt._getActualCursor=function(){return this._interactive!=bt.Interactivity.NONE?this._cursor||"pointer":""},xt._getCalculatedZIndex=function(){},xt._enableDragger=function(){this._dragger=new f(this,{dragStart:Ot(this._onDragStart,this),dragMove:Ot(this._onDragMove,this),dragStop:Ot(this._onDragStop,this)})},xt._disableDragger=function(){this._dragger.destruct()},xt._onDragStart=function(t){this._forbidHint(),this._mapAutoPanner=new x(this._map),this._mapMoveListener=Rt.observe(this._map,this._map.Events.Move,this._onMapMoveOnDrag,this),this._shape.setCursor(bt.Cursor.GRABBING),this._prevPixels=new bt.MouseEvent(t,this._map).getLocalPixels(),Rt.notify(this,this.Events.DragStart,this)},xt._onDragMove=function(t){var e=new bt.MouseEvent(t,this._map).getLocalPixels(),i=this._prevPixels.diff(e);this._dragByShift(i),this._prevPixels=e,Rt.notify(this,this.Events.Drag,this,i)},xt._onMapMoveOnDrag=function(t,e){this._dragByShift(e),Rt.notify(this,this.Events.Drag,this,e)},xt._dragByShift=function(t){this._pathShift(this.getCoordPath(),t)},xt._pathShift=function(t,e){for(var i=this._map,n=t.getVertices(),o=0,s=n.length;o<s;o++){var a=n[o].getCoordPoint();a.moveTo(i.converter.localPixelsToCoordinates(i.converter.coordinatesToLocalPixels(a).moveBy(e),1))}t.setVertices(n)},xt._onDragStop=function(t){this._allowHint(),this._mapAutoPanner.destruct(),this._mapMoveListener.cleanup(),this._shape.setCursor(this._getActualCursor()),Rt.notify(this,this.Events.DragEnd,this)},xt._fireEvent=function(t,e){this._interactive!=bt.Interactivity.NONE&&(this._interactive==bt.Interactivity.INTERACTIVE&&e.preventMapEvent(),Rt.notify(this,this.Events[t],this,e))},xt._onDblClick=function(t,e){this._fireEvent("DblClick",e)},xt._onClick=function(t,e){this._fireEvent("Click",e),this._interactive==bt.Interactivity.INTERACTIVE&&this.getOptions().hasBalloon&&(this._balloonVisible?this.closeBalloon():(this._balloonOpenEvent=e,this.openBalloon()))},xt._onMouseEnter=function(t,e){this._fireEvent("MouseEnter",e),this._interactive!=bt.Interactivity.INTERACTIVE||this._hintForbidden||this._hintVisible||this._balloonVisible||!this.getOptions().hasHint||(this._map.hint.show(e.getLocalPixels(),this._getHintContentLayout(),this._getComputedHintOptions()),this._hintVisible=1,this._mouseMoveAction(e))},xt._onMouseLeave=function(t,e){this._fireEvent("MouseLeave",e),this._interactive==bt.Interactivity.INTERACTIVE&&this._hideHint()},xt._hideHint=function(t){this._hintVisible&&(this._map.hint.hide(t),this._hintVisible=0)},xt._forbidHint=function(){this._hintForbidden=!0,this._hideHint(0)},xt._allowHint=function(){this._hintForbidden=!1},xt._onMouseMove=function(t,e){this._fireEvent("MouseMove",e),this._interactive==bt.Interactivity.INTERACTIVE&&this._mouseMoveAction(e)},xt._mouseMoveAction=function(t){this._hintVisible&&this._map.hint.moveTo(t.getLocalPixels())},xt.setHintContent=function(t){bt.AInteractiveGeoObject.prototype.setHintContent.call(this,t),this._updateHint()},xt.setHintOptions=function(t){bt.AInteractiveGeoObject.prototype.setHintOptions.call(this,t),this._hintVisible&&this._map.hint.setOptions(this._getComputedHintOptions())},xt._updateHint=function(){this._hintVisible&&(this._map.hint.setOptions(this._getComputedHintOptions()),this._map.hint.setContent(this._getHintContentLayout()))},xt._updateBalloon=function(){if(this._balloonVisible){var t=this._map.getBalloon();t.setOptions(this._getComputedBalloonOptions(),1),t.setContent(this._getBalloonContentLayout())}},xt.openBalloon=function(t,e){bt.AInteractiveGeoObject.prototype.openBalloon.call(this,t,e);var i=this._getBalloonPosition(this._balloonOpenEvent);if(this._map&&i){this._hideHint(0);var n=this,o={},s=this._getComputedBalloonOptions();for(var a in s)o[a]=s[a];o.onClose=function(){s.onClose&&s.onClose(),n._onCloseBalloon()},this._map.openBalloon(i,this._getBalloonContentLayout(),o),this._balloonOpenEvent=null,this._balloonVisible=1,Rt.notify(this,this.Events.BalloonOpen,this)}},xt._getBalloonPosition=wt.NULL,xt.closeBalloon=function(){bt.AInteractiveGeoObject.prototype.closeBalloon.call(this),this._balloonVisible&&this._map.closeBalloon()},xt.setBalloonOptions=function(t){bt.AInteractiveGeoObject.prototype.setBalloonOptions.call(this,t),this._balloonVisible&&this._map.getBalloon().setOptions(this._getComputedBalloonOptions(),1)},xt._onCloseBalloon=function(){this._firstPointShift=null,this._balloonVisible=0,Rt.notify(this,this.Events.BalloonClose,this)},xt.getBalloon=function(){return this._balloonVisible?this._map.getBalloon():null},xt.setBalloonContent=function(t){bt.AInteractiveGeoObject.prototype.setBalloonContent.call(this,t),this._updateBalloon()},xt._parseColor=function(t){var e,i=[];return i[0]=t.slice(0,6),e=parseInt("0x"+(t.slice(6,8)||"ff"))/255,isNaN(e)||(i[1]=e),i},xt.getNumPoints=function(){return this._path.getNumVertices()},xt.getPoint=function(t){var e=this._path.getVertex(t);return e&&e.getCoordPoint()},xt.getPoints=function(){for(var t=[],e=this._path.getVertices(),i=0,n=e.length;i<n;i++)t[i]=e[i].getCoordPoint().copy();return t},xt.setPoints=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e[i]=new bt.CoordVertex(t[i]);this._path.setVertices(e)},xt.addPoint=function(t,e){t instanceof Array||(t=[t]),e=typeof e!=Et?e:this._path.getNumVertices();for(var i=0,n=t.length;i<n;i++)t[i]=new bt.CoordVertex(t[i]);this._path.spliceVertices.apply(this._path,[e,0].concat(t))},xt.removePoint=function(t){var e=this._path.spliceVertices(t,1);return e[0]&&e[0].getCoordPoint()},xt.splicePoints=function(t,e){for(var i=[t,e],n=2,o=arguments.length;n<o;n++)i[n]=new bt.CoordVertex(arguments[n]);var s=this._path.spliceVertices.apply(this._path,i);for(n=0,o=s.length;n<o;n++)s[n]=s[n].getCoordPoint();return s},xt.getCoordPath=function(){return this._path},xt._onPathPointsChange=function(){this._pathChangeTimeId||(this._pathChangeTimeId=setTimeout(Ot(function(){this._pathChangeTimeId=null,Rt.notify(this,this.Events.PositionChange,this)},this),1)),this.updateGraphics()},xt.startEditing=wt.NULL,xt.stopEditing=function(){if(this._editor){var t=this._editor;this._editor=null,t.stopEditing(),this._draggable&&this._enableDragger()}},xt.setEditingOptions=function(t){t&&(this._editor&&this._editor.setOptions(t),this._editorOptions=Pt.extend(this._editorOptions,t))},xt.getEditingOptions=function(){return this._editor?this._editor.getOptions():this._editorOptions},xt.isEditing=function(){return!!this._editor},xt.isDrawing=function(){return!(!this._editor||!this._editor.getOptions().drawing)},xt._coordsToVertices=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e[i]=new bt.CoordVertex(t[i],0);return e},Mt=bt.Polyline=function(t,e){O.call(this,e),this._shape=new L(P),(t=t||new _)instanceof Array&&(t=new _(this._coordsToVertices(t))),this._path=t,this._path.addChangeCallback(this._onPathPointsChange,this),this._coordRenderer=e&&e.coordRenderer||new bt.PolylineCoordRenderer},xt=Lt(Mt,O),Mt.fromEncodedPoints=function(t,e,i,n){var o=yt.decodePoints(t,n||Dt),s=[],a=[];e&&(s=yt.decodeLevels(e));for(var r=0;r<o.length;r++)a[r]=new bt.CoordVertex(o[r],s[r]);return new bt.Polyline(new _(a),i)},xt._setChildOptions=function(t,e){var i=t.coordRenderer||e?new bt.PolylineCoordRenderer:this._coordRenderer;return this._coordRenderer!=i?(this._coordRenderer=i,1):0},xt.updateGraphics=function(){if(this._map){var e=this._map,t=this._getClippedPixels(Pt.map(this.getPixelPoints(),function(t){return e.converter.coordinatesToMapPixels(e.coordSystem.toCoordPoint(t,1))}),this._container.getPosition(),this._container.getSize());this._shape.setGeometry(t.length?t:null)}O.prototype.updateGraphics.call(this)},xt.getPixelPoints=function(t){if(this._map){var e=typeof(t=t||{}).geodesic==Et?this._geodesic:t.geodesic,i=typeof t.zoom==Et?this._map.getZoom():t.zoom,n=this._path,o=this._coordRenderer.renderCoords(Pt.map(n.getIndexesByZoom(i),function(t){return n.getVertex(t).getCoordPoint()}),this._map);return e&&(o=this._toGeodesicPixels(o)),o}},xt.startEditing=function(){this._editor||(this._draggable&&this._disableDragger(),this._editor=new mt(this,this._editorOptions))},xt._applyStyle=function(){var t,e=this.getComputedStyle(),i={};if(e)for(var n in i.strokeWidth=Number(e.lineStyle.strokeWidth),t=this._parseColor(e.lineStyle.strokeColor),i.strokeColor=t[0],i.strokeOpacity=t[1],i.fill=0,i.outline=1,i)i.hasOwnProperty(n)&&(this._shape.styles[n]=i[n])},xt.getClosestPoint=function(t){var e=h(this.getPixelPoints(),this._map.coordSystem.fromCoordPoint(t));return e&&(e.point=this._map.coordSystem.toCoordPoint(e.point,1),e.index=this._path.getIndexesByZoom(this._map.getZoom())[e.index]),e},xt._getBalloonPosition=function(t){var e=this.getPixelPoints();if(!e.length)return null;var i,n=this._map.coordSystem.toCoordPoint(e[0],1);i=t?t.getCoordPoint(1):this._firstPointShift?n.copy().moveBy(this._firstPointShift):this._map.coordSystem.toCoordPoint(new bt.CollectionBounds(e).getCenter(),1);var o=this.getClosestPoint(i).point;return this._firstPointShift=n.diff(o),o},xt._getClippedPixels=function(t,e,i){for(var n=[],o=[e,e.copy().moveBy(i)],s=0,a=t.length-1;s<a;s++){var r=t[s],h=t[s+1],l=gt.getIntersection(r,h,o);l.intersection&&(n.push(l.from),l.to.equals(h)&&s!=a-1||n.push(l.to))}return n},xt._getSegments=function(t){for(var e=[],i=1,n=t.length;i<n;i++)e.push([t[i-1],t[i]]);return e},xt._getCalculatedZIndex=function(){return null===this._zIndex?bt.ZIndex.POLYLINE:this._zIndex},Mt=bt.PaintPolyline=function(t,e){(e=e||{}).interactive=e.interactive||bt.Interactivity.NONE,bt.Polyline.call(this,t,e),this._containerClass=T,this._shape=new E},xt=Lt(Mt,bt.Polyline);var I=bt.PolygonPoints=Ct.PolygonPoints=function(){_.call(this)};(xt=Lt(I,_)).setEncodedPoints=function(t,e,i){var n=yt.decodePoints(t,i||Dt);e=yt.decodeLevels(e);for(var o=0;o<n.length;o++)n[o]=new bt.CoordVertex(n[o],e[o]);this.setVertices(n)},xt.getPoints=function(){for(var t=[],e=0;e<this._vertices.length;e++)t[e]=this._vertices[e].getCoordPoint();return t},Mt=bt.Polygon=function(t,e){O.call(this,e),this._shape=new L(S),(t=t||new _)instanceof Array&&(t=new _(this._coordsToVertices(t))),this._path=t,this._path.addChangeCallback(this._onPathPointsChange,this),e=e||{},this._interiors=[],e.interiors&&e.interiors.length&&(this._interiors=this._castInteriorsOption(e.interiors),this._addPathCallbacks(this._interiors)),this._coordRenderer=e.coordRenderer||new bt.PolygonCoordRenderer},(xt=Lt(Mt,O))._castInteriorsOption=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var o=t[i];o instanceof Array&&(o=new _(this._coordsToVertices(o))),e[i]=o}return e},xt._addPathCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].addChangeCallback(this._onPathPointsChange,this)},xt._removePathCallbacks=function(t){for(var e=0,i=t.length;e<i;e++)t[e].removeChangeCallback(this._onPathPointsChange,this)},Mt.fromEncodedPoints=function(t,e,i,n){for(var o=t.split(";"),s=e.split(";"),a=[],r=0,h=o.length;r<h;r++){var l=yt.decodePoints(o[r],n||Dt),c=[],u=[];s[r]&&(c=yt.decodeLevels(s[r]));for(var d=0,p=l.length;d<p;d++)u[d]=new bt.CoordVertex(l[d],c[d]);a.push(new _(u))}return new bt.Polygon(a.shift(),Pt.extend({},i,{interiors:a}))},xt._setChildOptions=function(t,e){var i=0,n=t.coordRenderer||e?new bt.PolygonCoordRenderer:this._coordRenderer;return this._coordRenderer!=n&&(this._coordRenderer=n,i=1),t.interiors&&(this._removePathCallbacks(this._interiors),this._interiors=t.interiors&&this._castInteriorsOption(t.interiors),this._addPathCallbacks(this._interiors),i=1,Rt.notify(this,this.Events.PositionChange,this)),i},xt.getOptions=function(){var t=O.prototype.getOptions.call(this);return t.interiors=this._interiors.slice(0),t},xt.updateGraphics=function(){if(this._map){for(var t=this.getPixelPoints(),e=[],i=0,n=t.length;i<n;i++){for(var o=t[i],s=0,a=o.length;s<a;s++){var r=o[s];o[s]=this._map.converter.coordinatesToMapPixels(this._map.coordSystem.toCoordPoint(r,1))}var h=this._getClippedPixels(o,this._container.getPosition(),this._container.getSize());h.length&&e.push(h)}this._shape.setGeometry(e.length?e:null)}O.prototype.updateGraphics.call(this)},xt.getPixelPoints=function(t){if(this._map){for(var e=typeof(t=t||{}).geodesic==Et?this._geodesic:t.geodesic,i=typeof t.zoom==Et?this._map.getZoom():t.zoom,n=[this._path].concat(this._interiors),o=0,s=n.length;o<s;o++){var a=n[o];n[o]=Pt.map(a.getIndexesByZoom(i),function(t){return a.getVertex(t).getCoordPoint()})}var r=this._coordRenderer.renderCoords(n,this._map);if(e)for(o=0,s=r.length;o<s;o++)r[o]=this._toGeodesicPixels(r[o]);return r}},xt._dragByShift=function(t){O.prototype._dragByShift.call(this,t);for(var e=0,i=this._interiors.length;e<i;e++)this._pathShift(this._interiors[e],t)},xt.startEditing=function(){this._editor||(this._draggable&&this._disableDragger(),this._editor=new vt(this,this._editorOptions))},xt._applyStyle=function(){var t,e=this.getComputedStyle(),i={};if(e)for(var n in i.strokeWidth=Number(e.polygonStyle.strokeWidth),t=this._parseColor(e.polygonStyle.strokeColor),i.strokeColor=t[0],i.strokeOpacity=t[1],t=this._parseColor(e.polygonStyle.fillColor),i.fillColor=t[0],i.fillOpacity=t[1],i.fill=!!e.polygonStyle.fill,i.outline=!!e.polygonStyle.outline,i)i.hasOwnProperty(n)&&(this._shape.styles[n]=i[n])},xt.getClosestPoint=function(t){for(var e=this.getPixelPoints(),i=1/0,n=null,o=0,s=e.length;o<s;o++){var a=e[o];a.length&&a.push(a[0]);var r=h(a,this._map.coordSystem.fromCoordPoint(t));r&&r.distance<i&&(i=r.distance,n=r)}return n&&(n.point=this._map.coordSystem.toCoordPoint(n.point,1),n.index=this._path.getIndexesByZoom(this._map.getZoom())[n.index]),n},xt.contains=function(t){return o(this.getPixelPoints(),this._map.coordSystem.fromCoordPoint(t),0)},xt._getBalloonPosition=function(t){for(var e=this.getPixelPoints(),i=[],n=null,o=0,s=e.length;o<s;o++)i=i.concat(e[o]);if(i.length){var a=new bt.CollectionBounds(i);if(t)n=t.getCoordPoint(1);else if(this._balloonPosCoef)n=this._map.coordSystem.toCoordPoint(a.getLeftBottom().moveBy(a.getSpan().scale(this._balloonPosCoef)),1);else{var r=new Bt(0,0);Pt.each(i,function(t,e){r.moveBy(e)}),n=this._map.coordSystem.toCoordPoint(r.scale(1/i.length),1)}this.contains(n)||(n=this.getClosestPoint(n).point),this._balloonPosCoef=a.getSpan().apply(function(t){return Math.pow(t,-1)}).scale(a.getLeftBottom().diff(this._map.coordSystem.fromCoordPoint(n)))}return n},xt._getClippedPixels=function(t,e,i){for(var n=new bt.CollectionBounds([e,e.copy().moveBy(i)]),o=0;o<4;o++){for(var s,a=[new Bt(0==o?n.getLeft():-1/0,3==o?n.getBottom():-1/0),new Bt(2==o?n.getRight():1/0,1==o?n.getTop():1/0)],r=[],h=0,l=t.length;h<l;h++){var c=t[h+1==l?0:h+1],u=gt.getIntersection(t[h],c,a);u.intersection&&(r.push(u.from),(s=u.to).equals(c)||r.push(s))}t=r,s=null}return t},xt._getSegments=function(t){for(var e=[],i=1,n=t.length;i<=n;i++)e.push([t[i-1],i==n?t[0]:t[i]]);return e},xt._getCalculatedZIndex=function(){return null===this._zIndex?bt.ZIndex.POLYGON:this._zIndex};function A(t,e,i,n){this._coordPath=t,this._parentModel=i,this._editor=n,this._graphicsObject=i.getGraphicsObject(),this._map=this._graphicsObject.getMap(),this._edgeModels=[],this._vertexModels=[],this.updateStructure(e)}(xt=A.prototype).Events={Destruct:"Destruct"},xt.updateStructure=function(t){this.updateVertexModels(t),this.updateEdgeModels()},xt.getGraphicsModel=function(){return this._parentModel},xt.getCoordPath=function(){return this._coordPath},xt.getVertexModels=function(){return this._vertexModels},xt.getEdgeModels=function(){return this._edgeModels},xt.getEdgeCoord=function(t){var e=t.prev.getPoint(),i=t.next.getPoint(),n=this._map.coordSystem;if(this._graphicsObject.getOptions().geodesic){var o=Ct.MathLib.ortho(e,i),s=Math.floor((o.length-1)/2);e=o[s],i=o[s+1]}var a=n.fromCoordPoint(e);return n.toCoordPoint(a.moveBy(a.diff(n.fromCoordPoint(i)).scale(.5)),1)},xt.getVertexCoord=function(t){return this._map.coordSystem.toCoordPoint(t.pixels,1)},xt.updateVertexModels=function(t){for(var e=this._map.getZoom(),i=this._coordPath.getIndexesByZoom(e),n=[],o=0,s=i.length;o<s;o++){for(var a=null,r=this._coordPath.getVertex(i[o]),h=r.getCoordPoint(),l=0,c=this._vertexModels.length;l<c;l++)if(this._vertexModels[l].originalPoint==h){a=this._vertexModels.splice(l,1)[0];break}a?a.prev=a.next=null:a=new R(r,this,{originalPoint:h}),Pt.extend(a,{pixels:t[o],index:i[o]});var u=n[o-1];u&&((u.next=a).prev=u),n.push(a)}this._vertexModels=n},xt.updateEdgeModels=function(){for(var t=[],e=0,i=this._vertexModels.length;e<i;e++){var n=null,o=this._vertexModels[e],s=o.next;if(s){for(var a=0,r=this._edgeModels.length;a<r;a++){var h=this._edgeModels[a];if(h.nextOriginalPoint==s.originalPoint&&h.prevOriginalPoint==o.originalPoint){n=this._edgeModels.splice(a,1)[0];break}}(n=n||new Y(this,{nextOriginalPoint:s.originalPoint,prevOriginalPoint:o.originalPoint})).next=s,n.prev=o,t.push(n)}}this._edgeModels=t},xt.insertVertex=function(t,e){var i=this._vertexModels[e],n=this._vertexModels[e-1],o=null,s=null;n?(o=n.index,s=n.next?n.next.index:null,e=n.index+1):i&&(o=i.prev?i.prev.index:null,s=i.index,e=i.index);var a=this._excludeLowZoomVertices(o,s);a.splice(e,0,t),this._coordPath.setVertices(this._collapseArray(a))},xt.removeVertex=function(t){var e=this._excludeLowZoomVertices(t.prev?t.prev.index:null,t.next?t.next.index:null);e.splice(t.index,1),this._coordPath.setVertices(this._collapseArray(e))},xt.setVertexCoordPoint=function(t,e){var i=this._excludeLowZoomVertices(t.prev?t.prev.index:null,t.next?t.next.index:null);t.getVertex().getCoordPoint().moveTo(e),this._coordPath.setVertices(this._collapseArray(i))},xt._collapseArray=function(t){for(var e=0,i=t.length,n=[];e<i;e++)typeof t[e]!=Et&&n.push(t[e]);return n},xt._excludeLowZoomVertices=function(t,e){for(var i=this._coordPath.getVertices(),n=[],o=0,s=i.length;o<s;o++){var a=i[o];(null!=t&&(t<e&&t<o&&o<e||e<t&&(t<o||o<e))||null==t&&o<e||null==e&&t<o)&&a.getVisibilityZoom()>this._map.getZoom()&&-1==Pt.inArray(a.getCoordPoint(),this._editor.getOptions().lockedPoints)||(n[o]=a)}return n},xt.destruct=function(){Rt.notify(this,this.Events.Destruct,this),this._coordPath=this._parentModel=this._editor=null};function k(t,e,i,n){A.call(this,t,e,i,n)}(xt=Lt(k,A)).updateVertexModels=function(t){A.prototype.updateVertexModels.call(this,t);var e=this._vertexModels.length,i=this._vertexModels[e-1],n=this._vertexModels[0];e&&((i.next=n).prev=i)},xt.removeCoordPath=function(){this._parentModel.removeCoordPath(this)};function B(t,e){this._graphicsObject=t,this._editor=e,this._pathModels=[],this._graphicsListener=Rt.observe(t,t.Events.Update,this.update,this),this._updateStructure()}(xt=B.prototype).Events={Update:"Update"},xt.update=function(){this._updateStructure(),Rt.notify(this,this.Events.Update,this)},xt._updateStructure=function(){for(var t=[this._graphicsObject.getCoordPath()].concat(this._graphicsObject.getOptions().interiors),e=this._graphicsObject.getPixelPoints({geodesic:0}),i=[],n=0,o=t.length;n<o;n++){for(var s=null,a=0,r=this._pathModels.length;a<r;a++)if(this._pathModels[a].getCoordPath()==t[n]){s=this._pathModels.splice(a,1)[0];break}s?s.updateStructure(e[n]):s=new k(t[n],e[n],this,this._editor),i.push(s)}It(this._pathModels,"destruct"),this._pathModels=i},xt.getGraphicsObject=function(){return this._graphicsObject},xt.getCoordPathModels=function(){return this._pathModels},xt.removeCoordPath=function(t){var e=t.getCoordPath();if(this._graphicsObject.getCoordPath()!=e){var i=this._graphicsObject.getOptions().interiors,n=Pt.inArray(e,i);-1!=n&&(i.splice(n,1),this._graphicsObject.setOptions({interiors:i}))}},xt.getCoordPathModelByCoordPath=function(t){for(var e=0,i=this._pathModels.length;e<i;e++){var n=this._pathModels[e];if(n.getCoordPath()==t)return n}},xt.getPointsNum=function(){for(var t=0,e=[this._graphicsObject.getCoordPath()].concat(this._graphicsObject.getOptions().interiors),i=0,n=e.length;i<n;i++)t+=e[i].getIndexesByZoom(this._graphicsObject.getMap().getZoom()).length;return t},xt.destruct=function(){this._graphicsListener.cleanup(),It(this._pathModels,"destruct")};function D(t,e){this._graphicsObject=t,this._editor=e,this._pathModel=new A(t.getCoordPath(),this._graphicsObject.getPixelPoints({geodesic:0}),this,e),this._graphicsListener=Rt.observe(t,t.Events.Update,this.update,this)}(xt=D.prototype).Events={Update:"Update"},xt.update=function(){this._pathModel.updateStructure(this._graphicsObject.getPixelPoints({geodesic:0})),Rt.notify(this,this.Events.Update,this)},xt.getGraphicsObject=function(){return this._graphicsObject},xt.getCoordPathModel=function(){return this._pathModel},xt.getPointsNum=function(){return this._graphicsObject.getCoordPath().getIndexesByZoom(this._graphicsObject.getMap().getZoom()).length},xt.destruct=function(){this._graphicsListener.cleanup(),this._pathModel.destruct()};var R=function(t,e,i){this._vertex=t,this._parentModel=e,Pt.extend(this,i)};(xt=R.prototype).getCoordPathModel=function(){return this._parentModel},xt.getVertex=function(){return this._vertex},xt.getPoint=function(){return this._parentModel.getVertexCoord(this)},xt.setVertexCoordPoint=function(t){this._parentModel.setVertexCoordPoint(this,t)},xt.removeVertex=function(){this._parentModel.removeVertex(this)};var Y=function(t,e){this._parentModel=t,Pt.extend(this,e)};(xt=Y.prototype).getPoint=function(){return this._parentModel.getEdgeCoord(this)};function N(t,e,i,n){this._model=t,this._view=e,this._graphicsObject=i,this._editor=n,this._map=i.getMap(),this._editLines=new ht(this._map,this.createStyleForLines()),this._listeners=[Rt.observe(n,n.Events.OptionsChange,this._onOptionsChange,this),Rt.observe(t,t.Events.Update,this._hideContextMenu,this)];var o=n.getOptions();o.drawing&&this._enableDrawing(),o.dragging&&this._enableDragging()}(xt=N.prototype)._onOptionsChange=function(t,e){"drawing"in e&&(e.drawing?this._enableDrawing():this._disableDrawing()),"dragging"in e&&(e.dragging?this._enableDragging():this._disableDragging()),this._hideContextMenu()},xt._hideContextMenu=function(){var t=tt.get(this._map);t.isVisible()&&t.hide()},xt._enableDrawing=function(){this._model.getPointsNum()<this._editor.getOptions().maxPoints?(this._drawingControl=this._createDrawingControl(),this._vertexAddListener=Rt.observe(this._drawingControl,this._drawingControl.Events.VertexDraw,this._onVertexAdd,this)):this._editor.setOptions({drawing:0})},xt._createDrawingControl=wt.NULL,xt._onVertexAdd=function(){this._lastVertexAddDate=new Date},xt._disableDrawing=function(){this._drawingControl&&(this._vertexAddListener.cleanup(),this._drawingControl.destruct(),this._drawingControl=null)},xt._enableDragging=wt.NULL,xt._disableDragging=function(){this._draggingControl.destruct(),this._draggingControl=null},xt.getGlassPane=function(){return this._glassPane||(this._glassPane=new p(bt.ZIndex.EDITOR_GLASS_PANE)),this._glassPane},xt.getVertexHandlers=function(){return{Click:Ot(this._onVertexClick,this),DblClick:Ot(this._onVertexDblClick,this),DragStart:Ot(this._onVertexDragStart,this),Drag:Ot(this._onVertexDrag,this),DragEnd:Ot(this._onVertexDragEnd,this)}},xt._onVertexDblClick=function(t){if(!this._lastVertexAddDate||new Date-this._lastVertexAddDate>H.DBLCLICKTIME){var e=t.metaDataProperty.rec,i=this._editor.getOptions();i.onDblClick?i.onDblClick(this._graphicsObject,e.index,e.getCoordPathModel().getCoordPath()):-1==Pt.inArray(e.originalPoint,i.lockedPoints)&&e.removeVertex()}},xt._onVertexDragStart=function(t){var e=t.metaDataProperty.rec,i=this._onPointDragging(e.getCoordPathModel(),t.getCoordPoint(),e.index,1,0);i&&this._editLines.setCoords(i,this._getLinePoints(e))},xt._onVertexDrag=function(t){var e=t.metaDataProperty.rec,i=this._onPointDragging(e.getCoordPathModel(),t.getCoordPoint(),e.index,1,0);i&&this._editLines.setCoords(i,this._getLinePoints(e))},xt._onVertexDragEnd=function(t){var e=t.metaDataProperty.rec,i=this._onPointDragging(e.getCoordPathModel(),t.getCoordPoint(),e.index,1,1);this._editLines.hide(),i?e.setVertexCoordPoint(i):this._view.update()},xt._onVertexClick=function(t){var e=tt.get(this._map);e.setOwner(t),e.isVisible()||(this._menuContent&&this._menuContent.destruct(),this._menuContent=this._getVertexMenuContent(t.metaDataProperty.rec),null!=this._menuContent&&(e.setContent(this._menuContent.getContainer()),e.show()))},xt._getVertexMenuContent=function(t){for(var e=this._getVertexMenuItems(t),i=null,n=0,o=e.length;n<o;n++)(i=i||new ot).addItem(this._buildMenuItem(t,e[n]));return i},xt._getVertexMenuItems=function(t){var e=this._getNativeMenuItems(t),i=this._editor.getOptions();return i.menuManager&&(e=i.menuManager(t.index,e,t.getCoordPathModel().getCoordPath())),e},xt._getNativeMenuItems=function(t){var e=[],i=this._editor,n=i.getOptions();return-1==Pt.inArray(t.originalPoint,n.lockedPoints)&&e.push({id:bt.GraphicsEditingMenuIDs.Delete,title:kt.hints.graphicsEditor.deleteVertex,onClick:function(){t.removeVertex()}}),n.drawing&&e.push({id:bt.GraphicsEditingMenuIDs.StopDrawing,title:kt.hints.graphicsEditor.stopDrawing,onClick:function(){i.setOptions({drawing:0})}}),e},xt._buildMenuItem=function(e,i){var t=Pt('<span style="white-space: nowrap;cursor: '+bt.Cursor.POINTER+';">'+i.title+"</span><br />"),n=At(t[0]).events.eventListener();return i.hint&&(t[0].title=i.hint),i.onClick&&n.add("click",function(t){new bt.MouseEvent(t,this._map).preventMapEvent(),i.onClick.call(this._graphicsObject,this._graphicsObject,e.index,e.getCoordPathModel().getCoordPath())},this),n.add("mouseenter",function(){t.css("color","#ff0000")}),n.add("mouseleave",function(){t.css("color","")}),t.data("eventListener",n),t},xt.getEdgeHandlers=function(){return{DragStart:Ot(this._onEdgeDragStart,this),Drag:Ot(this._onEdgeDrag,this),DragEnd:Ot(this._onEdgeDragEnd,this)}},xt._onEdgeDragStart=function(t){var e=t.metaDataProperty.rec,i=e.prev,n=this._onPointDragging(i.getCoordPathModel(),t.getCoordPoint(),i.index+1,0,0);n&&this._editLines.setCoords(n,this._getLinePoints(e))},xt._onEdgeDrag=function(t){var e=t.metaDataProperty.rec,i=e.prev,n=this._onPointDragging(i.getCoordPathModel(),t.getCoordPoint(),i.index+1,0,0);n&&this._editLines.setCoords(n,this._getLinePoints(e))},xt._onEdgeDragEnd=function(t){var e=t.metaDataProperty.rec.prev,i=e.getCoordPathModel(),n=this._onPointDragging(i,t.getCoordPoint(),e.index+1,0,1);this._editLines.hide(),n?i.insertVertex(new bt.CoordVertex(this._map.coordSystem.getCoordPoint(n.getX(),n.getY()),this._editor.getOptions().visibilityZoomForNewPoints),Pt.inArray(e,i.getVertexModels())+1):this._view.update()},xt._onPointDragging=function(t,e,i,n,o){var s=this._editor.getOptions().onPointDragging;if(s){var a=this._map,r=Pt.map(t.getVertexModels(),function(t){return t.pixels}),h=Pt.map(r,function(t){return a.converter.coordinatesToMapPixels(a.coordSystem.toCoordPoint(t,1))});h.splice(i,n?1:0,a.converter.coordinatesToMapPixels(e)),e=(e=s(h,i,o))&&a.converter.mapPixelsToCoordinates(e,1)}return e},xt._getLinePoints=function(t){return Pt.map([t.next,t.prev],function(t){return t?t.getPoint():null})},xt.destruct=function(){this._editLines.destruct(),It(this._listeners,"cleanup"),this._drawingControl&&this._drawingControl.destruct(),this._draggingControl&&this._draggingControl.destruct()};function j(t,e,i,n){N.call(this,t,e,i,n)}(xt=Lt(j,N))._createDrawingControl=function(){return new Z(this._model.getCoordPathModel(),this._model,this._graphicsObject,this,this._map,this._editor)},xt._enableDragging=function(){this._draggingControl=new $(this,this._graphicsObject,this._map,this._editor)},xt.createStyleForLines=function(){return this._graphicsObject.getComputedStyle()},xt._getNativeMenuItems=function(t){var e=N.prototype._getNativeMenuItems.call(this,t),i=this._editor.getOptions(),n=t.getCoordPathModel().getVertexModels(),o=t==n[0],s=t==n[n.length-1];return this._model.getPointsNum()<i.maxPoints&&(i.drawing&&(i.fromStart?s:o)||!i.drawing&&(s||o))&&e.push({id:bt.GraphicsEditingMenuIDs.StartDrawing,title:kt.hints.graphicsEditor.startDrawing,onClick:Ot(function(){this._editor.setOptions({fromStart:o?1:0,drawing:1})},this)}),e};function z(t,e,i,n){N.call(this,t,e,i,n)}(xt=Lt(z,N))._onOptionsChange=function(t,e){N.prototype._onOptionsChange.call(this,t,e),"fromIndex"in e&&this._rearrangeCoordPathByIndex(t.getOptions().drawingCoordPath,e.fromIndex)},xt._createDrawingControl=function(){return new U(this._model.getCoordPathModelByCoordPath(this._editor.getOptions().drawingCoordPath),this._model,this._graphicsObject,this,this._map,this._editor)},xt._enableDragging=function(){this._draggingControl=new G(this,this._graphicsObject,this._map,this._editor)},xt.createStyleForLines=function(){var t=bt.Style.copy(this._graphicsObject.getComputedStyle()),e=t.lineStyle,i=t.polygonStyle;return e.strokeColor=i.strokeColor,e.strokeWidth=i.strokeWidth,t},xt._getNativeMenuItems=function(t){var e=N.prototype._getNativeMenuItems.call(this,t),i=this._editor.getOptions(),n=t.getCoordPathModel(),o=n.getCoordPath();!(this._model.getPointsNum()<i.maxPoints)||i.drawing&&i.drawingCoordPath==o&&this._isLastVertexInCoordPath(n,t)||e.push({id:bt.GraphicsEditingMenuIDs.StartDrawing,title:kt.hints.graphicsEditor.startDrawing,onClick:Ot(function(){this._editor.setOptions({fromIndex:t.index,drawingCoordPath:o,drawing:1})},this)});var s=this._graphicsObject.getCoordPath();return o==s||this._isLockedPointsInCoordPath(o)||e.push({id:bt.GraphicsEditingMenuIDs.RemoveInterior,title:kt.hints.graphicsEditor.removeInterior,onClick:Ot(function(){i.drawingCoordPath==o&&this._editor.setOptions({drawingCoordPath:s,drawing:0}),n.removeCoordPath()},this)}),this._model.getPointsNum()<i.maxPoints&&i.drawNewInteriors&&e.push({id:bt.GraphicsEditingMenuIDs.AddInterior,title:kt.hints.graphicsEditor.addInterior,onClick:Ot(function(){var t=new bt.CoordPath,e=this._graphicsObject.getOptions().interiors;e.push(t),this._graphicsObject.setOptions({interiors:e}),this._editor.setOptions({drawingCoordPath:t,drawing:1})},this)}),e},xt._isLastVertexInCoordPath=function(t,e){var i=t.getVertexModels();return i[i.length-1]==e},xt._isLockedPointsInCoordPath=function(t){for(var e=t.getVertices(),i=0,n=e.length;i<n;i++)if(-1!=Pt.inArray(e[i].getCoordPoint(),this._editor.getOptions().lockedPoints))return 1},xt._rearrangeCoordPathByIndex=function(t,e){var i=t.getVertices(),n=t.getNumVertices()-e,o=i.splice(e+1,n);o.length&&(i.splice.apply(i,[0,0].concat(o)),t.setVertices(i))};var H=function(t,e,i,n,o,s){this._coordPathModel=t,this._model=e,this._graphicsObject=i,this._controller=n,this._map=o,this._editor=s,Rt.notify(H,"DrawingStart"),this._lines=new ht(this._map,n.createStyleForLines());var a=this._editor.getOptions();this._glassPane=this._createGlassPane(a.drawOver),this._map.addOverlay(this._glassPane,1),this._drawingTool=new pt(this._glassPane,a.drawingCursor,this._map,Ot(this._drawVertex,this),Ot(this._showLines,this),Ot(this._hideLines,this)),this._listeners=[Rt.observe(H,"DrawingStart",this._onDrawingStart,this),Rt.observe(s,s.Events.OptionsChange,this._onOptionsChange,this),Rt.observe(e,e.Events.Update,this._onModelUpdate,this),Rt.observe(o,o.Events.BeforeDblClick,this._stopDrawingByDblClick,this)],Rt.notify(i,i.Events.StartDrawing,i)};xt=H.prototype,H.DBLCLICKTIME=250,xt.Events={GlassPaneChange:"GlassPaneChange",VertexDraw:"VertexDraw"},xt._onDrawingStart=function(){this._editor.setOptions({drawing:0})},xt._onOptionsChange=function(t,e){"maxPoints"in e&&this._maxPointsCheck(),"drawingCursor"in e&&this._drawingTool.setCursor(e.drawingCursor),"drawOver"in e&&(this._map.removeOverlay(this._glassPane),this._glassPane=this._createGlassPane(e.drawOver),this._map.addOverlay(this._glassPane,1),this._drawingTool.setGlassPane(this._glassPane),Rt.notify(this,this.Events.GlassPaneChange,this))},xt._onModelUpdate=function(){this._hideLines(),this._lines.setStyle(this._controller.createStyleForLines()),this._maxPointsCheck()},xt._maxPointsCheck=function(){this._model.getPointsNum()>=this._editor.getOptions().maxPoints&&this._editor.setOptions({drawing:0})},xt._createGlassPane=function(t){return t?this._controller.getGlassPane():new _t},xt._showLines=function(t){var e=this._onPointDrawing(t.getCoordPoint(1),0);e&&this._lines.setCoords(e,this._getLineEndPoints())},xt._hideLines=function(){this._lines.hide()},xt._onPointDrawing=function(t,e){var i=this._editor.getOptions().onPointDrawing;if(i){var n=this._map,o=this._getDrawPointIndex(),s=Pt.map(this._coordPathModel.getVertexModels(),function(t){return t.pixels}),a=Pt.map(s,function(t){return n.converter.coordinatesToMapPixels(n.coordSystem.toCoordPoint(t,1))});a.splice(o,0,n.converter.coordinatesToMapPixels(t)),t=(t=i(a,o,e))&&n.converter.mapPixelsToCoordinates(t,1)}return t},xt._drawVertex=function(t){var e=this._onPointDrawing(t.getGeoPoint(),1);e&&this._coordPathModel.insertVertex(new bt.CoordVertex(this._map.coordSystem.getCoordPoint(e.getX(),e.getY()),this._editor.getOptions().visibilityZoomForNewPoints),this._getDrawPointIndex()),this._lastAddDate=new Date,Rt.notify(this,this.Events.VertexDraw,this)},xt._stopDrawingByDblClick=function(t,e){this._editor.getOptions().stopDrawingByDblClick&&this._lastAddDate&&new Date-this._lastAddDate<H.DBLCLICKTIME&&(e.isMapEventPrevented()||e.preventMapEvent(),this._editor.setOptions({drawing:0}))},xt.destruct=function(){It(this._listeners,"cleanup"),this._drawingTool.destruct(),this._map.removeOverlay(this._glassPane),this._lines.destruct(),Rt.notify(this._graphicsObject,this._graphicsObject.Events.StopDrawing,this._graphicsObject)};var Z=function(t,e,i,n,o,s){H.call(this,t,e,i,n,o,s)};(xt=Lt(Z,H))._getDrawPointIndex=function(){return this._editor.getOptions().fromStart?0:this._coordPathModel.getVertexModels().length},xt._getLineEndPoints=function(){var t=this._coordPathModel.getVertexModels(),e=t[this._editor.getOptions().fromStart?0:t.length-1];return e?[e.getPoint()]:[]};var U=function(t,e,i,n,o,s){H.call(this,t,e,i,n,o,s),this._createCoordPathListener()};(xt=Lt(U,H))._onOptionsChange=function(t,e){H.prototype._onOptionsChange.call(this,t,e),"drawingCoordPath"in e&&(this._coordPathListener.cleanup(),this._coordPathModel=this._model.getCoordPathModelByCoordPath(e.drawingCoordPath),this._createCoordPathListener())},xt._createCoordPathListener=function(){this._coordPathListener=Rt.observe(this._coordPathModel,this._coordPathModel.Events.Destruct,this._stopDrawing,this)},xt._stopDrawing=function(){this._editor.setOptions({drawingCoordPath:this._graphicsObject.getCoordPath(),drawing:0})},xt._getDrawPointIndex=function(){return this._coordPathModel.getVertexModels().length},xt._getLineEndPoints=function(){var t=this._coordPathModel.getVertexModels(),e=t[t.length-1];return e?[e.getPoint(),e.next.getPoint()]:[]},xt.destruct=function(){this._coordPathListener.cleanup(),H.prototype.destruct.call(this)};function F(t,e,i,n){this._controller=t,this._graphicsObject=e,this._map=i,this._editor=n;var o=this._glassPane=t.getGlassPane();this._glassPaneListeners=Rt.observe(o,[o.Events.AddToMap,o.Events.RemoveFromMap],this._rebuildDraggableObject,this),this._draggingTool=new ut(this._draggableObject=this._createDraggableObject(),n.getOptions().draggingCursor,i,Ot(this._dragGraphicsObject,this)),this._optionsChangeListener=Rt.observe(n,n.Events.OptionsChange,this._onOptionsChange,this)}(xt=F.prototype)._rebuildDraggableObject=function(){this._draggableObject.destruct(),this._draggingTool.setDraggableObject(this._draggableObject=this._createDraggableObject())},xt._onOptionsChange=function(t,e){"draggingCursor"in e&&this._draggingTool.setCursor(e.draggingCursor)},xt._shiftCoordPath=function(t,e){for(var i=t.getVertices(),n=0,o=i.length;n<o;n++){var s=i[n].getCoordPoint();-1==Pt.inArray(s,this._editor.getOptions().lockedPoints)&&s.moveTo(this._map.converter.localPixelsToCoordinates(this._map.converter.coordinatesToLocalPixels(s).moveBy(e),1))}t.setVertices(i)},xt.destruct=function(){It(this._glassPaneListeners,"cleanup"),this._optionsChangeListener.cleanup(),this._draggableObject.destruct(),this._draggingTool.destruct()};var $=function(t,e,i,n){F.call(this,t,e,i,n)};(xt=Lt($,F))._createDraggableObject=function(){return this._glassPane.getMap()?new lt(this._graphicsObject,this._glassPane):new dt(this._graphicsObject)},xt._dragGraphicsObject=function(t){this._shiftCoordPath(this._graphicsObject.getCoordPath(),t)};var G=function(t,e,i,n){F.call(this,t,e,i,n)};(xt=Lt(G,F))._createDraggableObject=function(){return this._glassPane.getMap()?new ct(this._graphicsObject,this._glassPane):new dt(this._graphicsObject)},xt._dragGraphicsObject=function(t){for(var e=[this._graphicsObject.getCoordPath()].concat(this._graphicsObject.getOptions().interiors),i=0,n=e.length;i<n;i++)this._shiftCoordPath(e[i],t)};function V(t,e,i,n,o){this._coordPathModel=t,this._model=e,this._map=n,this._editor=o,this._controller=i,this._edgePool=new at(n,i.getEdgeHandlers(),o),this._vertexPool=new st(n,i.getVertexHandlers(),o),this._optionsChangeListener=Rt.observe(o,o.Events.OptionsChange,this._onOptionsChange,this),this.update()}(xt=V.prototype).getModel=function(){return this._coordPathModel},xt._onOptionsChange=function(t,e){("lockedPoints"in e||"maxPoints"in e||"vertexLockedLayout"in e||"vertexLayout"in e||"edgeLayout"in e)&&this.update()},xt.update=function(){var n=this._map.getBounds(1),o=this._vertexPool.getDragged(),t=this._coordPathModel.getVertexModels(),e=Pt.map(t,function(t){if(n.contains(t.getPoint()))return t;for(var e=0,i=o.length;e<i;e++)if(o[e].metaDataProperty.rec==t)return t}),i=[];this._model.getPointsNum()<this._editor.getOptions().maxPoints&&(i=Pt.map(this._coordPathModel.getEdgeModels(),function(t){if(n.contains(t.getPoint()))return t}));var s=10<this._model.getPointsNum();this._vertexPool.setupMarkers(e,s),this._edgePool.setupMarkers(i,s)},xt.destruct=function(){this._optionsChangeListener.cleanup(),this._edgePool.destruct(),this._vertexPool.destruct()};function X(t,e,i){this._model=t,this._graphicsObject=e,this._editor=i,this._controller=new z(t,this,e,i),this._coordPathViews=[];var n=e.getMap();this._updateListeners=[Rt.observe(n,n.Events.MoveEnd,this.update,this),Rt.observe(t,t.Events.Update,this.update,this)],this.update()}(xt=X.prototype).update=function(){for(var t=this._model.getCoordPathModels(),e=[],i=0,n=t.length;i<n;i++){for(var o=null,s=0,a=this._coordPathViews.length;s<a;s++)if(this._coordPathViews[s].getModel()==t[i]){o=this._coordPathViews.splice(s,1)[0];break}o?o.update():o=new V(t[i],this._model,this._controller,this._graphicsObject.getMap(),this._editor),e.push(o)}It(this._coordPathViews,"destruct"),this._coordPathViews=e},xt.destruct=function(){It(this._updateListeners,"cleanup"),It(this._coordPathViews,"destruct"),this._controller.destruct()};function W(t,e,i){this._model=t,this._graphicsObject=e,this._editor=i,this._controller=new j(t,this,e,i);var n=e.getMap();this._updateListeners=[Rt.observe(n,n.Events.MoveEnd,this.update,this),Rt.observe(t,t.Events.Update,this.update,this)],this._coordPathView=new V(t.getCoordPathModel(),t,this._controller,e.getMap(),i)}(xt=W.prototype).update=function(){this._coordPathView.update()},xt.destruct=function(){It(this._updateListeners,"cleanup"),this._coordPathView.destruct(),this._controller.destruct()};function q(t,e){Ct.ABaseLayout.call(this,t,e),this._$elements=Pt("<div class='YMaps-gEditor-edgePoint' style='position:absolute;top:0;left:0;width:10px;height:10px;overflow:hidden;font-size:0;z-index:1;'></div>");var i=this._$elements[0].style;if(this.cssRounded=""==i.OBorderRadius||""==i.MozBorderRadius||""==i.WebkitBorderRadius||""==i.borderRadius,this.cssRounded)this._$elements.css({backgroundColor:"#eee",border:"1px solid #999",opacity:.8});else{var n=Ct.versionPath+"i/0.4/editor/edgeMarker.png";this._$elements.append(Pt("<i style='position:absolute;top:-10px;left:0;width:10px;height:20px;'></i>").css(St.msie&&6==St.version?{filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+n+",sizingMethod=scale)"}:{background:"url("+n+")"}))}}(xt=Lt(q,Ct.ABaseLayout)).onAddToParent=function(t){Ct.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},xt.update=function(){if(this.cssRounded){var t=this._$elements[0].style;t.width=t.height=this._getSize()+"px",t.MozBorderRadius=t.WebkitBorderRadius=t.borderRadius=this._getSize()/2+1+"px"}this._mouseListeners=[Rt.observe(this._context,this._context.Events.MouseEnter,this._onMouseOver,this),Rt.observe(this._context,this._context.Events.MouseLeave,this._onMouseOut,this)]},xt.onRemoveFromParent=function(){Ct.ABaseLayout.prototype.onRemoveFromParent.call(this),It(this._mouseListeners,"cleanup")},xt._onMouseOver=function(){(this.cssRounded?this._$elements:this._$elements.children()).css(this.cssRounded?{backgroundColor:"#fdff38",opacity:1}:{top:"0"})},xt._onMouseOut=function(){(this.cssRounded?this._$elements:this._$elements.children()).css(this.cssRounded?{backgroundColor:"#eee",opacity:.8}:{top:"-10px"})},xt.getOffset=function(){var t=-this._getSize()/2-(!1!==Pt.boxModel&&1);return new Bt(t,t)},xt._getSize=function(){return 8+(!1===Pt.boxModel&&2)};function K(t,e){Ct.ABaseLayout.call(this,t,e),this._mouseOver=0,this._menuOpen=0,this._$elements=Pt("<div class='YMaps-gEditor-vertexPoint' style='background-color: #fff; border: 1px solid #777; position: absolute; top: 0; left: 0; font-size: 0px; z-index:1'></div>")}(xt=Lt(K,Ct.ABaseLayout)).onAddToParent=function(t){Ct.ABaseLayout.prototype.onAddToParent.call(this,t),this.update(),this._listeners=[Rt.observe(this._context,this._context.Events.MouseEnter,this._onMouseOver,this),Rt.observe(this._context,this._context.Events.MouseLeave,this._onMouseOut,this),Rt.observe(this._context,"MenuShow",this._onMenuShow,this),Rt.observe(this._context,"MenuHide",this._onMenuHide,this)]},xt.onRemoveFromParent=function(){Ct.ABaseLayout.prototype.onRemoveFromParent.call(this),It(this._listeners,"cleanup")},xt._onMouseOver=function(){this._mouseOver=1,this.lightUp()},xt._onMouseOut=function(){this._mouseOver=0,this.lightDown()},xt._onMenuShow=function(){this._menuOpen=1,this.lightUp()},xt._onMenuHide=function(){this._menuOpen=0,this.lightDown()},xt.lightUp=function(){(this._mouseOver||this._menuOpen)&&this._$elements.css("backgroundColor","#fdff38")},xt.lightDown=function(){this._mouseOver||this._menuOpen||this._$elements.css("backgroundColor","#fff")},xt.update=function(){var t=this._$elements[0].style,e=this.getSize();t.width=e.getX()+"px",t.height=e.getY()+"px"},xt.getSize=function(){var t=10+(!1===Pt.boxModel&&2);return new Bt(t,t)},xt.getOffset=function(){return new Bt(-this.getSize().getX()/2-(!1!==Pt.boxModel&&1),-this.getSize().getY()/2-(!1!==Pt.boxModel&&1))};function Q(t,e){K.call(this,t,e),this._$elements.removeClass("YMaps-gEditor-vertexPoint"),this._$elements.addClass("YMaps-gEditor-lockedVertexPoint"),this._$elements.css({backgroundColor:"#eee",borderColor:"#777",opacity:.8})}(xt=Lt(Q,K)).lightDown=function(){this._mouseOver||this._menuOpen||this._$elements.css("backgroundColor","#eee")};function J(t){var e,i,n=new bt.Placemark(t.coordSystem.getCoordPoint(0,0),{style:{iconStyle:{template:new bt.LayoutTemplate(et)}},cursor:bt.Cursor.ARROW,interactive:bt.Interactivity.STATIC,zIndex:bt.ZIndex.EDITOR_VERTEX_MARKER+1}),o=[];function s(){e&&(t.removeOverlay(n),e.setOptions({zIndex:bt.ZIndex.EDITOR_VERTEX_MARKER}),Rt.notify(e,"MenuHide"),clearTimeout(i),It(o,"cleanup"),o=[])}function a(t,e){e.preventMapEvent()}n.metaDataProperty.owner=e,this.isVisible=function(){return n.getMap()},this.setOwner=function(t){t!=e&&(s(),n.metaDataProperty.owner=e=t)},this.getOwner=function(){return e},this.setContent=function(t){n.setIconContent(t)},this.show=function(){e&&(n.setCoordPoint(e.getCoordPoint()),t.addOverlay(n),e.setOptions({zIndex:bt.ZIndex.EDITOR_VERTEX_MARKER+2}),Rt.notify(e,"MenuShow"),o=Rt.observe(t,[t.Events.MoveStart,t.Events.BoundsChange],s).concat(Rt.observe(e,[e.Events.DragStart,e.Events.DblClick],s),Rt.observe(n,[n.Events.DblClick,n.Events.Click,n.Events.MouseEnter,n.Events.MouseLeave,n.Events.MouseMove],a)),i=setTimeout(function(){o.push(Rt.observe(t,t.Events.BeforeClick,s))},0))},this.hide=function(){s()}}var tt=new function(){var n=[],o=[];this.get=function(t){var e,i=Pt.inArray(t,n);return-1!=i?e=o[i]:(e=new J(t),o.push(e),n.push(t)),e}},et=function(t,e){Ct.ABaseLayout.call(this,t,e),this._$elements=Pt("<div class='YMaps-gEditor-menu' style='color: #1a3dc1; font-size: 11px; position: absolute; top: 0; left: 0;padding: 2px 3px; background-color: #fff; border: 1px solid #777;' />")};(xt=Lt(et,Ct.ABaseLayout)).onAddToParent=function(t){Ct.ABaseLayout.prototype.onAddToParent.call(this,t),this.update()},xt.setContent=function(t){this._setContent(t,this._$elements)},xt.getOffset=function(){return this._context.metaDataProperty.owner._icon.getOffset().moveBy(new Bt(-3,-3))},xt.update=function(){var t=this._context.metaDataProperty.owner._icon.getSize().getX()+7;this._$elements.css("paddingLeft",t+"px")};function it(e,i,n){var o=null,s=[];function a(){for(var t=0;t<i;t++){if(!s.length)return clearInterval(o),void(o=null);n(s.shift())}}this.push=function(t){s.push(t),o=o||setInterval(a,e)},this.clear=function(){o&&(clearInterval(o),o=null),s.length=0}}function nt(e,t,i){this._editor=i,this._map=e,this._handlers=t,this._pool={},this._fadePool={},this._dragged=[],this._chunker=new it(20,10,function(t){t.getMap()||e.addOverlay(t)})}var ot=function(){var e=Pt("<div>"),i=[];this.addItem=function(t){i.push(t),e.append(t)},this.getContainer=function(){return e[0]},this.destruct=function(){for(var t;t=i.pop();)t.data("eventListener").removeAll();e.remove()}};nt.createMarkerStyle=function(t){return{hasBalloon:0,hasHint:0,iconStyle:{template:new bt.LayoutTemplate(t)}}},(xt=nt.prototype).getDragged=function(){return this._dragged},xt.setupMarkers=function(t,e){var i=0,n=t.length,o={};for(this._chunker.clear();i<n;i++){var s=t[i],a=this.getMarkerOptions(s),r=null,h=this.getHashKey(s);if(r=this._findMarkerInCell(this._pool,h,s)||this._findMarkerInCell(this._fadePool,h,s)){var l=0,c={},u=r.getOptions();for(var d in a)a.hasOwnProperty(d)&&a[d]!=u[d]&&(l=1,c[d]=a[d]);l&&r.setOptions(c),r.getCoordPoint().equals(s.getPoint())||r.metaDataProperty.dragged||r.setCoordPoint(s.getPoint())}else{r=new bt.Placemark(s.getPoint(),a);var p,_=[],f=this._handlers;for(p in _.push(Rt.observe(r,r.Events.DragStart,this._onDragStart,this),Rt.observe(r,r.Events.DragEnd,this._onDragEnd,this)),f)f.hasOwnProperty(p)&&_.push(Rt.observe(r,r.Events[p],f[p]));Pt.extend(r.metaDataProperty,{listeners:_,rec:s})}r.getMap()||(e?this._chunker.push(r):this._map.addOverlay(r)),(o[h]||(o[h]=[])).push(r)}for(h in this._pool)if(this._pool.hasOwnProperty(h)){var m=this._pool[h];for(i=0,n=m.length;i<n;i++)(r=m[i]).getMap()&&this._map.removeOverlay(r);this._fadePool[h]=(this._fadePool[h]||[]).concat(m)}this._pool=o},xt._findMarkerInCell=function(t,e,i){var n=t[e];if(n)for(var o=0,s=n.length;o<s;o++)if(n[o].metaDataProperty.rec==i){var a=n.splice(o,1)[0];return n.length||delete t[e],a}},xt._onDragStart=function(t){t.metaDataProperty.dragged=1,this._dragged.push(t)},xt._onDragEnd=function(t){t.metaDataProperty.dragged=0;var e=Pt.inArray(t,this._dragged);-1!=e&&this._dragged.splice(e,1)},xt.destruct=function(){this._chunker.clear(),this._cleanupPool(this._pool),this._cleanupPool(this._fadePool)},xt._cleanupPool=function(t){var e,i,n,o,s=tt.get(this._map);for(e in t)if(t.hasOwnProperty(e))for(i=0,n=t[e].length;i<n;i++)o=t[e][i],It(o.metaDataProperty.listeners,"cleanup"),o.getMap()&&(this._map.removeOverlay(o),s.getOwner()==o&&s.hide())};var st=function(t,e,i){nt.call(this,t,e,i)};(xt=Lt(st,nt)).getMarkerOptions=function(t){var e=bt.ZIndex.EDITOR_VERTEX_MARKER,i=this._editor.getOptions(),n=-1!=Pt.inArray(t.originalPoint,i.lockedPoints);return{draggable:n?0:1,style:nt.createMarkerStyle(n?i.vertexLockedLayout:i.vertexLayout),interactive:bt.Interactivity.INTERACTIVE,zIndex:e,zIndexHover:e+2,zIndexDrag:e+2,zIndexActive:e+2}},xt.getHashKey=function(t){var e=t.originalPoint;return e.getX()+","+e.getY()};var at=function(t,e,i){nt.call(this,t,e,i)};(xt=Lt(at,nt)).getMarkerOptions=function(){var t=bt.ZIndex.EDITOR_EDGE_MARKER;return{draggable:1,style:nt.createMarkerStyle(this._editor.getOptions().edgeLayout),interactive:bt.Interactivity.INTERACTIVE,zIndex:t,zIndexHover:t+1,zIndexDrag:t+1,zIndexActive:t+1}},xt.getHashKey=function(t){var e=t.nextOriginalPoint;return e.getX()+","+e.getY()};function rt(t,e){this._map=t.getMap(),this._graphicsObject=t,this._hotspotField=new C(e),this._updateListener=Rt.observe(t,"Update",this._update,this),this._update()}var ht=function(l,t){var c,u,d=[],p=t,_=l.converter,e=Rt.observe(l,l.Events.Update,function(){c&&i()});function i(){for(var t=[],e=0,i=u.length;e<i;e++){var n=u[e],o=_.coordinatesToLocalPixels(n),s=o.diff(c),a=s.length();if(a){s.scale(Math.max(a-(1.7*Number(p.lineStyle.strokeWidth)+7),0)/a);var r=_.localPixelsToCoordinates(o.moveBy(s),1),h=d.shift();h?h.splicePoints(0,2,r,n):(h=new bt.PaintPolyline([r,n],{style:p}),l.addOverlay(h)),t.push(h)}}for(;d.length;)l.removeOverlay(d.shift());d=t}this.setStyle=function(t){It(d,"setStyle",p=t)},this.setCoords=function(t,e){c=_.coordinatesToLocalPixels(t),u=e,i()},this.hide=function(){for(c=null;d.length;)l.removeOverlay(d.shift())},this.destruct=function(){this.hide(),e.cleanup()}};(xt=rt.prototype)._update=function(){this._graphicsObject.getComputedStyle();var t=this._getCoordsArray();this._hotspot?this._hotspot.setCoords(t):(this._hotspot=new b(t,0),this._hotspotField.add(this._hotspot),this._hotspotListeners=[Rt.observe(this._hotspot,"MouseMove",this._onHotspotMouseMove,this),Rt.observe(this._hotspot,"MouseLeave",this._onHotspotMouseLeave,this)])},xt._getCoordsArray=xt._getPixelPoints=wt.NULL,xt._onHotspotMouseMove=function(t,e){Rt.notify(this,"MouseMove",this,e)},xt._onHotspotMouseLeave=function(t,e){Rt.notify(this,"MouseLeave",this,e)},xt.setCursor=function(t){this._hotspot.setCursor(t)},xt.destruct=function(){this._hotspot.destruct(),this._hotspotField.destruct(),It(this._hotspotListeners,"cleanup"),this._updateListener.cleanup()};var lt=function(t,e){rt.call(this,t,e)};(xt=Lt(lt,rt))._getCoordsArray=function(){var t=this._graphicsObject.getComputedStyle();return[{coords:[a(this._getPixelPoints(),t.lineStyle.strokeWidth)],nonzero:1}]},xt._getPixelPoints=function(){var e=this._map;return Pt.map(this._graphicsObject.getPixelPoints(),function(t){return e.tileCoordinates.scale(t,e.coordSystem.getMaxZoom(),e.getZoom())})};var ct=function(t,e){rt.call(this,t,e)};(xt=Lt(ct,rt))._getCoordsArray=function(){for(var t=this._graphicsObject.getComputedStyle(),e=this._getPixelPoints(),i=[],n=0,o=e.length;n<o;n++){var s=e[n];i[n]=a(s,t.polygonStyle.strokeWidth)}return[{coords:e,nonzero:0},{coords:i,nonzero:1}]},xt._getPixelPoints=function(){for(var e=this._map,t=this._graphicsObject.getPixelPoints(),i=0,n=t.length;i<n;i++){var o=t[i];(o=Pt.map(o,function(t){return e.tileCoordinates.scale(t,e.coordSystem.getMaxZoom(),e.getZoom())}))[0]&&o.push(o[0]),t[i]=o}return t};var ut=function(i,e,n,o){var s,t,a,r,h;function l(){t=new f(i,{dragStart:u,dragMove:d,dragStop:_}),e&&i.setCursor(e)}function c(){t.destruct()}function u(t){a=new x(n),r=Rt.observe(n,n.Events.Move,p),s=new bt.MouseEvent(t,n).getLocalPixels()}function d(t){var e=new bt.MouseEvent(t,n).getLocalPixels();h||(i.setCursor(bt.Cursor.GRABBING),h=1),o(s.diff(e)),s=e}function p(t,e){o(e)}function _(t){a.destruct(),r.cleanup(),h&&(i.setCursor(e),h=0)}l(),this.setDraggableObject=function(t){c(),i=t,l()},this.setCursor=function(t){i.setCursor(e=t)},this.destruct=function(){c()}},dt=function(e){var i,t=e.getShape();for(var n in t.Events)t.Events.hasOwnProperty(n)&&Rt.observe(t,t.Events[n],function(i){return function(t,e){Rt.notify(this,i,this,e)}}(t.Events[n]),this);this.setCursor=function(t){typeof i==Et&&(i=e.getOptions().cursor),e.setOptions({cursor:t})},this.destruct=function(){e.setOptions({cursor:i})}},pt=function(e,i,n,o,s,t){var a,r,h,l,c;function u(t){t&&n.addCursor(t)}function d(t){t&&n.removeCursor(t)}function p(){t(),M()}function _(){r=[Rt.observe(e,e.Events.Click,v),Rt.observe(e,e.Events.MouseLeave,g),Rt.observe(e,e.Events.MouseMove,m)],a=r.concat([Rt.observe(n,n.Events.MoveStart,y),Rt.observe(n,n.Events.MoveEnd,b)])}function f(){It(a,"cleanup")}function m(t,e){e.isMapEventPrevented()?p():(e.preventMapEvent(),St.msie?(c=e,l=l||setInterval(C,50)):s(e))}function v(t,e){o(e),e.preventMapEvent()}function g(t,e){p(),e.preventMapEvent()}function y(){It(r,"disable"),p()}function b(){It(r,"enable")}function C(){c?(s(c),c=null):M()}function M(){l&&(clearInterval(l),l=null)}u(i),_(),h=new x(n),this.destruct=function(){h.destruct(),f(),d(i),p()},this.setGlassPane=function(t){f(),e=t,_()},this.setCursor=function(t){d(i),u(i=t)}},_t=function(){var e,i,n,o;this.getMap=function(){return o},this.onMapUpdate=wt.NULL,this.onAddToMap=function(t){(e=At((o=t).__layerManager.getContainer()).events.eventListener()).add("mouseleave",function(t){Rt.notify(this,this.Events.MouseLeave,this,new bt.MouseEvent(t,o)),n=!1},this),i=[Rt.observe(o,o.Events.BeforeClick,function(t,e){e.isMapEventPrevented()||Rt.notify(this,this.Events.Click,this,e)},this),Rt.observe(o,o.Events.BeforeDblClick,function(t,e){e.isMapEventPrevented()||Rt.notify(this,this.Events.DblClick,this,e)},this),Rt.observe(o,o.Events.BeforeMouseMove,function(t,e){e.isMapEventPrevented()?n&&(Rt.notify(this,this.Events.MouseLeave,this,e),n=!1):(n||(Rt.notify(this,this.Events.MouseEnter,this,e),n=!0),Rt.notify(this,this.Events.MouseMove,this,e))},this)]},this.onRemoveFromMap=function(){o=null,e.removeAll(),It(i,"cleanup")}};(xt=_t.prototype).Events={Update:"Update",Click:"Click",DblClick:"DblClick",MouseMove:"MouseMove",MouseEnter:"MouseEnter",MouseLeave:"MouseLeave"};function ft(t,e){this._graphicsObject=t,this._options=Pt.extend({},this._getDefaultOptions(),e),this._model=this._createModel(),this._view=this._createView(),Rt.notify(this._graphicsObject,this._graphicsObject.Events.StartEditing,this._graphicsObject)}(xt=ft.prototype).Events={OptionsChange:"OptionsChange"},xt._getDefaultOptions=function(){return{drawing:0,drawingCursor:bt.Cursor.ARROW,drawOver:0,visibilityZoomForNewPoints:0,stopDrawingByDblClick:1,dragging:0,draggingCursor:bt.Cursor.MOVE,maxPoints:1/0,menuManager:0,onDblClick:null,lockedPoints:[],onPointDragging:0,onPointDrawing:0,vertexLockedLayout:Q,vertexLayout:K,edgeLayout:q}},xt._createModel=wt.NULL,xt._createView=wt.NULL,xt.setOptions=function(t){t=t||{};var e=this._getDefaultOptions(),i={};for(var n in e)e.hasOwnProperty(n)&&typeof t[n]!=Et&&t[n]!=this._options[n]&&(this._options[n]=i[n]=t[n]);Rt.notify(this,this.Events.OptionsChange,this,i)},xt.getOptions=function(){return this._options},xt.stopEditing=function(){this._view.destruct(),this._model.destruct(),Rt.notify(this._graphicsObject,this._graphicsObject.Events.StopEditing,this._graphicsObject),this._graphicsObject=this._view=this._model=null};var mt=function(t,e){ft.call(this,t,e)};(xt=Lt(mt,ft))._getDefaultOptions=function(){return Pt.extend({},ft.prototype._getDefaultOptions.call(this),{fromStart:0})},xt._createModel=function(){return new D(this._graphicsObject,this)},xt._createView=function(){return new W(this._model,this._graphicsObject,this)};var vt=function(t,e){ft.call(this,t,e)};(xt=Lt(vt,ft))._getDefaultOptions=function(){return Pt.extend({},ft.prototype._getDefaultOptions.call(this),{drawingCoordPath:this._graphicsObject.getCoordPath(),drawNewInteriors:0,fromIndex:-1})},xt.setOptions=function(t){ft.prototype.setOptions.call(this,t),this._options.fromIndex=-1},xt._createModel=function(){return new B(this._graphicsObject,this)},xt._createView=function(){return new X(this._model,this._graphicsObject,this)};var gt=new function(){this.getIntersection=function(t,e,i){var n=t.x,o=e.x,s=t.y,a=e.y,r=0,h=0,l=i[0],c=i[1];n<l.x&&(r|=1),n>c.x&&(r|=2),s<l.y&&(r|=4),s>c.y&&(r|=8),o<l.x&&(h|=1),o>c.x&&(h|=2),a<l.y&&(h|=4),a>c.y&&(h|=8);for(var u=0==(r|h),d=0!=(r&h),p=!(u||d),_=!1;!u&&!d;){var f;if(0==r)_=!_,f=n,n=o,o=f,f=s,s=a,a=f,f=r,r=h,h=f;0!=(1&r)?(s+=Math.floor((a-s)*(l.x-n)/(o-n)),n=l.x):0!=(2&r)?(s+=Math.floor((a-s)*(c.x-n)/(o-n)),n=c.x):0!=(4&r)?(n+=Math.floor((o-n)*(l.y-s)/(a-s)),s=l.y):0!=(8&r)&&(n+=Math.floor((o-n)*(c.y-s)/(a-s)),s=c.y),r=0,n<l.x&&(r|=1),n>c.x&&(r|=2),s<l.y&&(r|=4),s>c.y&&(r|=8),u=0==(r|h),d=0!=(r&h)}return{intersection:u,clipping:p,outs:d,to:new Bt(_?n:o,_?s:a),from:new Bt(_?o:n,_?a:s)}}},yt=new function(){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",o="A".charCodeAt(0);this.encode4bytes=function(t){for(var e=[],i=0;i<4;i++)e[i]=255&t,t>>=8;return e},this.encode=function(t){var e="string"==typeof t;if(typeof btoa!=Et)return e||(t=String.fromCharCode.apply(String,t)),btoa(t).replace(/\//g,"_").replace(/\+/g,"-");for(var i,n,o,s,a,r,h,l=[],c=0,u=t.length;c<u;)o=e?(i=t.charCodeAt(c++),n=t.charCodeAt(c++),t.charCodeAt(c++)):(i=t[c++],n=t[c++],t[c++]),s=i>>2,a=(3&i)<<4|n>>4,r=(15&n)<<2|o>>6,h=63&o,isNaN(n)?r=h=64:isNaN(o)&&(h=64),l.push(d.charAt(s),d.charAt(a),d.charAt(r),d.charAt(h));return l.join("")},this.decode=function(t){if(typeof atob!=Et)return atob(t.replace(/_/g,"/").replace(/-/g,"+"));for(var e,i,n,o,s,a,r=[],h=0,l=(t=t.replace(/[^A-Za-z0-9\-_\=]/g,"")).length;h<l;)e=d.indexOf(t.charAt(h++))<<2|(o=d.indexOf(t.charAt(h++)))>>4,i=(15&o)<<4|(s=d.indexOf(t.charAt(h++)))>>2,n=(3&s)<<6|(a=d.indexOf(t.charAt(h++))),r.push(String.fromCharCode(e)),64!=s&&r.push(String.fromCharCode(i)),64!=a&&r.push(String.fromCharCode(n));return r.join("")},this.codingCoefficient=1e6,this.decodePoints=function(t,e){for(var i=this.decode(t),n=i.length,o=0,s=e.getCoordPoint(0,0),a=[];o<n;){for(var r=0,h=0,l=0,c=i.substr(o,8);l<4;)r|=c.charCodeAt(l)<<8*l,h|=c.charCodeAt(l+4)<<8*l,l++;var u=e.getCoordPoint(r/1e6,h/1e6),d=e.getCoordPoint(u.getX()+s.getX(),u.getY()+s.getY());s=d,a.push(d),o+=8}return a},this.decodeLevels=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(t.charCodeAt(i)-o);return e}}}(),function(){Mt=bt.ConnectedPlacemarks=function(t){bt.GeoObjectCollection.call(this,t),this._showLines=1,this._lines=new bt.GeoObjectCollection,this._lines.onAddToGroup(this),this.__placemarkListeners=[]},(xt=Lt(Mt,bt.GeoObjectCollection))._onAddObject=function(e,t){bt.GeoObjectCollection.prototype._onAddObject.call(this,e,t),t&&(t==this.length()-1?this._lines.add(new h([this.get(-2).getGeoPoint(),e.getGeoPoint()])):this._lines.get(t-1).splicePoints(1,1,e.getGeoPoint())),t!=this.length()-1&&this._lines.splice(t,0,new h([e.getGeoPoint(),this.get(t+1).getGeoPoint()]));var i,n,o,s,a=[],r=e.Events;a.push(Rt.observe(e,r.Drag,this._onPlacemarkPositionChange,this),Rt.observe(e,r.PositionChange,function(t,e){this._onPlacemarkPositionChange(t)},this)),Ct.Graphics.SSG&&a.push(Rt.observe(e,r.DragStart,function(){var t=this.indexOf(e);i=0!=t?this._lines.get(t-1):null,n=this._lines.get(t),i&&(o=new l([i.getPoint(0),i.getPoint(1)]),this._lines.splice(t-1,1,o)),n&&(s=new l([n.getPoint(0),n.getPoint(1)]),this._lines.splice(t,1,s))},this),Rt.observe(e,r.DragEnd,function(){var t=this.indexOf(e);o&&(i.splicePoints(0,2,o.getPoint(0),o.getPoint(1)),this._lines.splice(t-1,1,i)),s&&(n.splicePoints(0,2,s.getPoint(0),s.getPoint(1)),this._lines.splice(t,1,n)),i=n=o=s=null},this));this.__placemarkListeners.splice(t,0,a)},xt._onRemoveObject=function(t,e){if(bt.GeoObjectCollection.prototype._onRemoveObject.call(this,t,e),It(this.__placemarkListeners.splice(e,1)[0],"cleanup"),0!=e){var i=this._lines.get(e-1),n=this.get(e);n?i.splicePoints(1,1,n.getGeoPoint()):this._lines.remove(i)}e!=this.length()&&this._lines.remove(this._lines.get(e))},xt._onPlacemarkPositionChange=function(t){var e=this.indexOf(t);if(-1!=e){var i=null,n=this.get(e).getGeoPoint();0!=e&&(i=this._lines.get(e-1))&&i.splicePoints(0,2,this.get(e-1).getGeoPoint(),n),(i=this._lines.get(e))&&i.splicePoints(0,2,n,this.get(e+1).getGeoPoint())}},xt.update=function(){bt.GeoObjectCollection.prototype.update.call(this),this._lines.update()},xt.onAddToMap=function(t,e){bt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._showLines&&this._lines.onAddToMap(t,e)},xt.onRemoveFromMap=function(){bt.GeoObjectCollection.prototype.onRemoveFromMap.call(this),this._showLines&&this._lines.onRemoveFromMap()},xt.setLineVisible=function(t){this._showLines!=t&&(this._showLines=t,this.getMap()&&(t?this._lines.onAddToMap(this.getMap(),this.getParentContainer()):this._lines.onRemoveFromMap()))},xt.getLineVisible=function(){return this._showLines},xt.onMapUpdate=function(){bt.GeoObjectCollection.prototype.onMapUpdate.call(this),this._showLines&&this._lines.onMapUpdate()};var h=function(t){bt.Polyline.call(this,t,{interactive:bt.Interactivity.NONE}),this._getDrawPixels=e};xt=Lt(h,bt.Polyline);var l=function(t){bt.PaintPolyline.call(this,t),this._getDrawPixels=e};xt=Lt(l,bt.PaintPolyline);var e=function(t,e,i){return Pt.map(t,function(t){return i.coordSystem.fromCoordPoint(t,i.getCenter(1))})}}(),Mt=Ct.AItemContainer=function(t){bt.Group.call(this),this.__$itemContainers=new bt.Group,bt.Events.observe(this,this.Events.Add,this.__onAddItem,this),bt.Events.observe(this,this.Events.Remove,this.__onRemoveItem,this),t!=Et&&this.add(t)},(xt=Lt(Mt,bt.Group)).makeContainer=wt.NULL,xt.makeItemContainer=wt.NULL,xt.getContentNode=wt.NULL,xt.getItemContentNode=wt.NULL,xt.getToolBar=function(){return this},xt.getElement=function(){return this.__$element},xt.getItemElement=function(t){return this.__$itemContainers.get(t)},xt.__onAddItem=function(t,e,i){this.__$itemContainers.add(this.makeItemContainer(),i),this.__parentContainer&&this.__buildItem(i)},xt.__buildItem=function(t){var e=this.getContentNode(),i=this.getItemElement(t),n=this.getItemContentNode(t);t>=Pt(e).children().length?i.appendTo(e):i.insertBefore(this.getItemElement(t+1)),this.get(t).onAddToToolBar(this.getToolBar(),n,this)},xt.__onRemoveItem=function(t,e,i){this.__parentContainer&&this.__unbuildItem(e,i),this.__$itemContainers.splice(i,1)},xt.__unbuildItem=function(t,e){t.onRemoveFromToolBar(),this.getItemElement(e).remove()},xt.onAdd=function(t){this.__parentContainer=t,this.__$element=this.makeContainer().appendTo(t);for(var e=0,i=this.length();e<i;e++)this.__buildItem(e)},xt.onRemove=function(){for(var t=0,e=this.length();t<e;t++)this.__unbuildItem(this.get(t),t);this.__$element.remove(),this.__parentContainer=null},Mt=bt.ToolBarSeparator=function(t){this._width=parseInt(t,10),isNaN(this._width)&&(this._width=20)},(xt=Mt.prototype).onAddToToolBar=function(t,e){this._toolBar=t,this._parentContainer=e,Pt(e).css("width",this._width).addClass("YMaps-tool-bar-separator")},xt.onRemoveFromToolBar=function(){this._toolBar=this._parentContainer=null},Mt=bt.ToolBarButton=function(t,e){this._content=Pt.extend({hint:null,caption:null,icon:null,width:null},t),this._options=Pt.extend({selected:0,enabled:1,shown:1},e),this._options.selected&&!this._options.enabled&&(this._options.enabled=1),this._listeners=[],this._toolBar=null},(xt=Mt.prototype).hoverCSSClassName="YMaps-button_hover",xt.activeCssClassName="YMaps-button_active",xt.disabledCssClassName="YMaps-button_disable",xt.Events={Click:"Click"},xt.getContent=function(){return this._content},xt.setContent=function(t){this._content=t||{},this._toolBar&&this._applyTemplate()},xt._applyTemplate=function(){var t,e=Pt(this._parentContainer),i=this._content,n=i.hint||"",o='alt="'+n+'" title="'+n+'"',s=i.icon||null,a=i.caption||(s?"":"&#160;"),r='<i class="YMaps-button-c YMaps-button-l"><i></i></i><i class="YMaps-button-m"><i></i>';n&&e.attr("title",n),s&&(St.msie&&St.version<7?r+='<b class="YMaps-button-opacity"></b><img class="YMaps-icon" src="'+kt.images.transparentImage+'" '+o+' style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+s+');"/>':r+='<img class="YMaps-icon"'+o+' src="'+s+'"/>'),a&&(r+='<span class="YMaps-button-caption">'+a+"</span>"),r+='</i><i class="YMaps-button-c YMaps-button-r"><i></i></i>',e.addClass("YMaps-button").html(r),i.width&&!isNaN(t=parseInt(i.width,10))&&e.find(".YMaps-button-m").css("width",t),this._applyState()},xt._applyState=function(){this._toolBar&&(Pt(this._parentContainer)[this._options.shown?"removeClass":"addClass"]("YMaps-display-none")[this._options.selected?"addClass":"removeClass"](this.activeCssClassName)[this._options.enabled?"removeClass":"addClass"](this.disabledCssClassName),this._applyCursor())},xt._applyCursor=function(){this._toolBar&&Pt(this._parentContainer).find(".YMaps-button-m")[this._options.enabled?"addClass":"removeClass"]("YMaps-cursor-pointer")},xt.onAddToToolBar=function(t,e){this._toolBar=t,this._parentContainer=e,this._applyTemplate();var i=Pt(e),n=this.hoverCSSClassName;this.__domListener=At(e).events.eventListener().add("click",function(t){this._options.enabled&&Rt.notify(this,this.Events.Click,this)},this).add("mouseenter",function(){i.addClass(n)}).add("mouseleave",function(){i.removeClass(n)})},xt.onRemoveFromToolBar=function(){this._toolBar&&(It(this._listeners,"cleanup"),this._listeners=[],this.__domListener.removeAll(),Pt(this._parentContainer).empty(),this._toolBar=this._parentContainer=null)},xt.getToolBar=function(){return this._toolBar},xt.show=function(){this._options.shown||(this._options.shown=1,this._applyState())},xt.hide=function(){this._options.shown&&(this._options.shown=0,this._applyState())},xt.isShown=function(){return this._options.shown},xt.select=function(){!this._options.selected&&this._options.enabled&&(this._options.selected=1,this._applyState())},xt.deselect=function(){this._options.selected&&(this._options.selected=0,this._applyState())},xt.isSelected=function(){return this._options.selected},xt.enable=function(){this._options.enabled||(this._options.enabled=1,this._applyState())},xt.disable=function(){this._options.enabled&&!this._options.selected&&(this._options.enabled=0,this._applyState())},xt.isEnabled=function(){return this._options.enabled},Mt=bt.ToolBarToggleButton=function(t,e){bt.ToolBarButton.call(this,t,e)},(xt=Lt(Mt,bt.ToolBarButton)).Events.Select="Select",xt.Events.Deselect="Deselect",xt.onAddToToolBar=function(t,e){bt.ToolBarButton.prototype.onAddToToolBar.call(this,t,e),this._listeners.push(Rt.observe(this,this.Events.Click,this._onClick))},xt._onClick=function(){this[this.isSelected()?"deselect":"select"]()},xt.select=function(){!this.isSelected()&&this.isEnabled()&&(bt.ToolBarButton.prototype.select.call(this),Rt.notify(this,this.Events.Select,this))},xt.deselect=function(){this.isSelected()&&(bt.ToolBarButton.prototype.deselect.call(this),Rt.notify(this,this.Events.Deselect,this))},Mt=bt.ToolBarRadioButton=function(t,e,i){this._groupId=t,bt.ToolBarToggleButton.call(this,e,i)},(xt=Lt(Mt,bt.ToolBarToggleButton)).getGroupId=function(){return this._groupId},xt._onClick=function(){this.isSelected()||this.select()},xt.select=function(){if(!this.isSelected()&&this.isEnabled()){var t=null;if(this._toolBar){var e=this;Pt.each(e._toolBar.getByGroupId(e.getGroupId()),function(){this!=e&&this.isSelected()&&(this.deselect(),t=this)})}this._options.selected=1,this._applyState(),Rt.notify(this,this.Events.Select,this,t)}},xt._applyCursor=function(){this._toolBar&&Pt(this._parentContainer).find(".YMaps-button-m")[this._options.enabled&&!this._options.selected?"addClass":"removeClass"]("YMaps-cursor-pointer")},Mt=bt.ListBoxItem=function(t){this._caption=t||""},(xt=Mt.prototype).hoverCSSClassName="YMaps-btn-list-item_hover",xt.Events={Click:"Click"},xt._applyTemplate=function(){Pt('<a href="javascript:void(0)">'+this._caption+"</a>").appendTo(this._$parentContainer)},xt.onAddToToolBar=function(t,e,i){this._toolBar=t,this._listBox=i,this._$parentContainer=Pt(e),this.__listener=At(e).events.eventListener().add("mouseenter",function(){this._$parentContainer.addClass(this.hoverCSSClassName)},this).add("mouseleave",function(){this._$parentContainer.removeClass(this.hoverCSSClassName)},this).add("click",function(t){Rt.notify(this,this.Events.Click,this),t.preventDefault()},this),this._applyTemplate()},xt.onRemoveFromToolBar=function(){this.__listener.removeAll(),this._$parentContainer.empty(),this._$parentContainer=this._toolBar=this._listBox=null},xt.getListBox=function(){return this._listBox},xt.setCaption=function(t){this._caption=t,this._toolBar&&this._$parentContainer.html(t)},xt.getCaption=function(){return this._caption},Mt=bt.ListBoxToggleItem=function(t,e){if(bt.ListBoxItem.call(this,t),this.__selected=!!e,St.msie){var i=this;this.__ieChangeListener=function(){window.setTimeout(function(){i.__applyState()},0)}}},(xt=Lt(Mt,bt.ListBoxItem)).Events.Select="Select",xt.Events.Deselect="Deselect",xt._applyTemplate=function(){this._$parentContainer.addClass("YMaps-cursor-pointer").html('<input type="checkbox"'+(this.__selected?'checked="checked" ':"")+"/><span>"+this._caption+"</span>"),this.__applyState()},xt.__applyState=function(){this._toolBar&&this._$parentContainer.find("input").attr("checked",this.__selected?"checked":null)},xt.onAddToToolBar=function(t,e,i){bt.ListBoxItem.prototype.onAddToToolBar.call(this,t,e,i);var n=this._$parentContainer.find("input");this.__checkboxListener=At(n[0]).events.eventListener().add("click",function(t){Rt.notify(this,this.Events.Click,this),t.stopPropagation()},this),St.opera&&St.version<9.5?this.__checkboxListener.add("change",this.__applyState,this):St.msie&&(n[0].onpropertychange=this.__ieChangeListener),this.__clickListener=bt.Events.observe(this,this.Events.Click,function(){this[this.isSelected()?"deselect":"select"]()},this)},xt.onRemoveFromToolBar=function(){this.__clickListener.cleanup(),this.__checkboxListener.removeAll(),St.msie&&(this._$parentContainer.find("input").onpropertychange=null),bt.ListBoxItem.prototype.onRemoveFromToolBar.call(this)},xt.setCaption=function(t){this._caption=t,this._toolBar&&this._$parentContainer.find("span").html(t)},xt.select=function(){this.__selected||(this.__selected=1,this.__applyState(),Rt.notify(this,this.Events.Select,this))},xt.deselect=function(){this.__selected&&(this.__selected=0,this.__applyState(),Rt.notify(this,this.Events.Deselect,this))},xt.isSelected=function(){return this.__selected},Mt=bt.ToolBar=function(t){this.__map=null,t=t||[new bt.ToolBar.MoveButton,new bt.ToolBar.MagnifierButton,new bt.ToolBar.RulerButton],Ct.AItemContainer.call(this,t)},xt=Lt(Mt,Ct.AItemContainer),Mt.DEFAULT_GROUP="default",Mt.MoveButton=D("move",0,1),Mt.MagnifierButton=D("magnifier",1,0),Mt.RulerButton=D("ruler",1,0),xt.makeContainer=function(){return Pt('<div class="YMaps-buttons"></div>').css("z-index",bt.ZIndex.CONTROL-1)},xt.makeItemContainer=function(){return Pt('<div class="YMaps-button"></div>')},xt.getContentNode=function(){return this.getElement()[0]},xt.getItemContentNode=function(t){return this.getItemElement(t)[0]},xt.onAddToMap=function(t,e){this.__map=t,Ct.AItemContainer.prototype.onAdd.call(this,t.getContainer()),(e||new bt.ControlPosition(bt.ControlPosition.TOP_LEFT,new bt.Point(5,5))).apply(this.__$element[0])},xt.onRemoveFromMap=function(){Ct.AItemContainer.prototype.onRemove.call(this)},xt.getMap=function(){return this.__map},xt.getByGroupId=function(e){return this.filter(function(t){return t.getGroupId&&t.getGroupId()==e})},Mt=bt.ListBox=function(t){this.__options=Pt.extend({width:140,caption:""},t),this.__state={color:this.__options.color,expanded:0,enabled:1},this.__captionListeners=[],this.__groupListeners=[],Ct.AItemContainer.call(this)},(xt=Lt(Mt,Ct.AItemContainer)).__baseCSSClass="YMaps-btn",xt.__collapseTimeout=3e3,xt.makeContainer=function(){var t=this.__options.caption||"&#160",e="green"==this.__state.color?"YMaps-btn-name_green":"YMaps-btn-name_layers";return Pt('<div class="'+this.__baseCSSClass+this.__getCSSClass()+(this.__state.enabled?" YMaps-cursor-pointer":"")+'"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i" style="width:'+this.__options.width+'px;"><i class="YMaps-btn__disabler"></i><div class="YMaps-btn-reduce"><a class="YMaps-btn-name '+e+'" href="javascript:void(0)"><span class="YMaps-btn-caption">'+t+'</span><i class="YMaps-arr"><i></i></i></a></div><div class="YMaps-btn-expand"><a class="YMaps-btn-name YMaps-btn-name_layers" href="javascript:void(0)"><span class="YMaps-btn-caption">'+t+'</span><i class="YMaps-arr"><i></i></i></a><ul class="YMaps-btn-list YMaps-btn-list_hover"></ul></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>')},xt.__getCSSClass=function(){var t=this.__state.color,e=[];this.__state.enabled||e.push("disabled"),this.__state.color&&this.__state.expanded?e.push(t,"expanded",t+"-expanded"):(this.__state.color&&e.push(t),this.__state.expanded&&e.push("expanded"));var i=this.__baseCSSClass;return(e=Pt.map(e,function(t){return i+"_"+t})).length?" "+e.join(" "):""},xt.makeItemContainer=function(){return Pt('<li class="YMaps-btn-list-item"></li>')},xt.getContentNode=function(){return this.getElement().find(".YMaps-btn-list")[0]},xt.getItemContentNode=function(t){return this.getItemElement(t)[0]},xt.onAddToToolBar=function(t,e){this.__toolBar=t,Ct.AItemContainer.prototype.onAdd.call(this,e);var i=this.getElement();this.__updateDisablerHeight(),this.__groupListeners=bt.Events.observe(this,[this.Events.Add,this.Events.Remove],this.__updateDisablerHeight,this),this.__leaveListener=At(i[0]).events.eventListener(),this.__state.expanded&&this.__beginMapListening();for(var n=i.find(".YMaps-btn-name"),o=0,s=n.length;o<s;o++){var a=At(n[o]).events.eventListener().add("click",function(t){this[this.__state.expanded?"collapse":"expand"](),t.preventDefault()},this);if(St.msie&&(St.version<8||document.documentMode<8)){var r=i.find(".YMaps-arr");a.add("mouseenter",function(){r.addClass("YMaps-arr_hover")}).add("mouseleave",function(){r.removeClass("YMaps-arr_hover")})}this.__captionListeners.push(a)}var h=t.getMap();this.__destructListener=Rt.observe(h,h.Events.Destruct,this.onRemoveFromToolBar,this)},xt.onRemoveFromToolBar=function(){this.__state.expanded&&this.__stopMapListening(),It(this.__captionListeners,"removeAll"),It(this.__groupListeners,"cleanup"),this.__captionListeners=[],this.__destructListener.cleanup(),Ct.AItemContainer.prototype.onRemove.call(this),this.__toolBar=null,this.getElement().empty()},xt.__updateDisablerHeight=function(){var t=this.getElement();t.find(".YMaps-btn__disabler").height(t.find(".YMaps-btn-i").height()+3)},xt.getToolBar=function(){return this.__toolBar},xt.getCaption=function(){return this.__options.caption},xt.setCaption=function(t){this.__options.caption=t,this.__toolBar&&this.getElement().find(".YMaps-btn-caption").html(t)},xt.expand=function(){this.__state.expanded||this.setState({expanded:1})},xt.collapse=function(){this.__state.expanded&&this.setState({expanded:0})},xt.isExpanded=function(){return this.__state.expanded},xt.enable=function(){this.__state.enabled||this.setState({enabled:1})},xt.disable=function(){this.__state.enabled&&this.setState({enabled:0})},xt.isEnabled=function(){return this.__state.enabled},xt.setState=function(t){if(this.__toolBar&&typeof t.expanded!=Et&&t.expanded!=this.__state.expanded&&(t.expanded?this.__beginMapListening():this.__stopMapListening()),this.__toolBar&&typeof t.enabled!=Et&&t.enabled!=this.__state.enabled&&(t.enabled?this.getElement().addClass("YMaps-cursor-pointer"):this.getElement().removeClass("YMaps-cursor-pointer")),this.__toolBar)var e=this.__getCSSClass();Pt.extend(this.__state,t),this.__toolBar&&this.getElement().removeClass(e).addClass(this.__getCSSClass())},xt.__beginMapListening=function(){var t=this.__toolBar.getMap();this.__leaveListener.add("mouseenter",this.__onMouseEnter,this).add("mouseleave",this.__onMouseLeave,this),this.__mapClickListener=Rt.observe(t,t.Events.Click,function(){this.collapse()},this)},xt.__onMouseEnter=function(){this.__cancelCollapse()},xt.__onMouseLeave=function(){this.__planCollapse()},xt.__planCollapse=function(){var t=this;this.__state.expanded&&(this.__cancelCollapse(),this.__collapseHandler=window.setTimeout(function(){t.collapse()},this.__collapseTimeout))},xt.__cancelCollapse=function(){this.__collapseHandler&&(window.clearTimeout(this.__collapseHandler),this.__collapseHandler=null)},xt.__stopMapListening=function(){this.__cancelCollapse(),this.__leaveListener.removeAll(),this.__mapClickListener.cleanup()},Ct.SmoothZoomer=function(l){var c,e,i,n,u,d=null,p=null,o=1,t=St.opera&&St.version<9.5,_=t?300:25,s=t?1:4,f=null,m=0,v=0;function g(t,e){return l.tileCoordinates.scale(l.coordSystem.fromCoordPoint(t),l.coordSystem.getMaxZoom(),e)}function y(){var t=function(){if(i)m&&v!=m&&(d+=v,i=Math.abs(i-e),v=m);else{if((d+=v)==p)return null;i=e=Math.pow(2,d+(0<m?0:-1)-l.getZoom()),n=e/s,v=m}return i-=n,{saveThisPosition:c,scaleCoefficient:o+=v*n}}();t?l.animator.scale(t):this.stop()}this.zoomTo=function(t,e,i){if(p=t,null===d&&(d=l.getZoom()),m=wt.sign(p-(d+v)),c=(e||l.getCenter()).copy(),i){var n=l.animator.getState().scaleCoefficient,o=p-(l.getZoom()+Math.log(n)/Math.log(2)),s=g(l.coordSystem.toCoordPoint(l._state.centerInTiles),l.getZoom()).scale(n),a=s.copy().diff(g(c,l.getZoom()).scale(n)),r=Math.pow(2,-o),h=new bt.Point(a.getX()/(1-r),a.getY()/(1-r));c=function(t,e){return l.coordSystem.toCoordPoint(l.tileCoordinates.scale(t,e,l.coordSystem.getMaxZoom()))}(s.copy().moveBy(h).scale(1/n),l.getZoom())}f||(m?(l.animator.start(),f=setInterval(Ot(y,this),_),u=Rt.observe(l,l.Events.Destruct,function(){this.stop()},this)):this.stop())},this.stop=function(){f&&(clearInterval(f),f=null,l.animator.stop(p),u.cleanup()),null!==d&&Rt.notify(this,"ZoomEnd",this,d==p),d=p=e=i=n=null,m=v=0,o=1},this.getTargetZoom=function(){return p},this.getCurrentZoom=function(){return d}},Ct.Zoomer=function(o){var s,a=null;function r(t,e){s=null,h(e?bt.State.SUCCESS:bt.State.FAILURE)}function h(t){if(a&&a.callback){var e=a.callback;a.callback=null,e(t)}}this.zoomTo=function(t,e){if(h(bt.State.FAILURE),a=function(t){return Pt.extend({position:null,centering:0,callback:null,smooth:0},t)}(e),o._inited){var i=o.getCenter();a.position&&(i=a.centering?a.position:function(t,e){var i=o._state.centerInTiles.diff(o.coordSystem.fromCoordPoint(t,o.getCenter()));e<0?(i.scale(Math.pow(2,Math.abs(e))-1),i=i.neg()):i.scale((Math.pow(2,e)-1)/Math.pow(2,e));return o._restrictCenter(o.coordSystem.toCoordPoint(i.moveBy(o._state.centerInTiles),1))}(a.position,t-o.getZoom()));var n=function(t,e){var i=new bt.Point(-1e-10),n=o.coordSystem.getCoordBounds(e.copy().moveBy(i),e.copy().moveBy(i.neg()));return wt.boundaryRestrict(t,o.getMinZoom(n),o.getMaxZoom(n))}(t,i);a.smooth&&Math.abs(t-n)<3?!s&&t==o.getZoom()&&a.position&&a.centering?o.panTo(a.position,a):(s||(s=new Ct.SmoothZoomer(o),Rt.observe(s,"ZoomEnd",r,this)),s.zoomTo(n,a.position,a.centering)):(o.setCenter(i,n),h(bt.State.SUCCESS))}else a.position&&a.centering?o.setCenter(a.position,t):o._state.zoom=t,h(bt.State.SUCCESS)},this.zoomBy=function(t,e){this.zoomTo((s?s.getTargetZoom():o.getZoom())+t,e)},this.stop=function(){s&&s.stop()}},Ct.SmoothMoving=function(t){this._map=t,Rt.observe(t,t.Events.Destruct,this._destruct,this),this._actionHandler=Ot(this._actionHandler,this)},(xt=Ct.SmoothMoving.prototype).isActive=function(){return!!this._tickIntervalID},xt.start=function(t,e){this._tickIntervalID&&this._stop(1);var i=this._options=Pt.extend({speedUpTime:120,startSpeed:5,speed:37,timeout:20,nonstop:0},e);this._startZoom=this._map.getZoom(),this._currentPosition=this._map._state.centerInTiles.copy(),this._pixelOffset=t,this._tickIntervalID||(this._currentSpeed=i.startSpeed,this._setTickInterval(),this._map._moveStart()),this._speedIncrement=(i.speed-this._currentSpeed)/(i.speedUpTime/i.timeout)},xt.stop=function(t){this._tickIntervalID&&(clearInterval(this._tickIntervalID),this._tickIntervalID=null,this._stop(t),this._map._moveEnd())},xt._stop=function(t){this.callback(t?bt.State.FAILURE:bt.State.SUCCESS)},xt.callback=function(t){if(this._options.callback){var e=this._options.callback;this._options.callback=null,e(t)}},xt._setTickInterval=function(){this._tickIntervalID=setInterval(this._actionHandler,this._options.timeout)},xt._actionHandler=function(){var t=this._action();1!=t&&this.stop(-1==t)},xt._action=function(){var t=this._map._state.centerInTiles,e=this._pixelOffset,i=-1;if(this._currentPosition.equals(t)&&this._startZoom==this._map.getZoom()){var n=this._options,o=Math.sqrt(e.x*e.x+e.y*e.y),s=e.copy().scale(o?1/o:1);this._currentSpeed!=n.speed&&(this._currentSpeed+=this._speedIncrement,this._currentSpeed=Math[0<this._speedIncrement?"min":"max"](n.speed,this._currentSpeed));var a=s.scale(this._currentSpeed);n.nonstop?i=1:(a.apply(Math.round),(i=this._pixelOffset.distance(new Bt)>a.distance(new Bt))||(a=this._pixelOffset),this._pixelOffset=a.diff(this._pixelOffset)),this._options.moveCallback&&this._options.moveCallback(),this._map._move(a),i&&(this._currentPosition=t.copy())}return i},xt._destruct=function(){this.stop(1),this._map=this._pixelOffset=this._currentPosition=this._tickIntervalID=this._speedIncrement=this._currentSpeed=this._vector=this._startZoom=null},(Mt=bt.ControlPosition=function(t,e){this.anchor=this._normalizeAnchor(t),this.offsets=this._normalizeOffsets(e||new bt.Point)}).TOP_LEFT=0,Mt.TOP_RIGHT=1,Mt.BOTTOM_LEFT=2,Mt.BOTTOM_RIGHT=3,Mt.prototype={_normalizeAnchor:function(t){return isNaN(Number(t))?0:t%4},_normalizeOffsets:function(t){return[this._normalizeCoordinate(t.x),this._normalizeCoordinate(t.y)]},_normalizeCoordinate:function(t){var e=Number(t||0);return isNaN(e)?t:e+"px"},apply:function(t){Pt(t).css(1&this.anchor?"right":"left",this.offsets[0]).css(2&this.anchor?"bottom":"top",this.offsets[1])}},Ct.DraggingControl=function(t){var n,o,s,e,i,a,r=t;function h(){this._beginListening(),n.addCursor("grab")}function l(t){n._state.cache=!0,s=0;var e=new Bt(t.clientX,t.clientY);o=n.converter.clientPixelsToLocalPixels(e),n.addCursor("grabbing")}function c(t){var e=n.converter.clientPixelsToLocalPixels(new Bt(t.clientX,t.clientY)),i=e.diff(o);s||(s=1,n._dragStart(),n._moveStart()),n._move(i),n._drag(i),o=e}function u(){n._state.cache=!1,n.removeCursor("grabbing"),o=null,s&&(n._moveEnd(),n._dragEnd())}this.onAddToMap=function(t){n=t,a=[],i=new wt.DragAndDrop.MouseMove(r,0,kt.tremor.draggingControl,n),(this.onAddToMap=h).call(this)},this._beginListening=function(){i.beginListening(),a.push(Rt.observe(i,"start",l),Rt.observe(i,"move",c),Rt.observe(i,"stop",u)),e=Rt.observe(n,n.Events.Destruct,this._destruct,this)},this.onRemoveFromMap=function(){this._stopListening(),n.removeCursor("grab")},this._stopListening=function(){i.stopListening(),It(a,"cleanup"),a=[],e.cleanup(),o&&u()},this._destruct=function(){n&&(this.onRemoveFromMap(),n=o=null)}},Ct.TouchZoomControl=function(){var s,a,r,h,i,e,l=.001,n=!1;function o(t,e){n||(n=!0,i.move.enable(),i.end.enable(),s.animator.start()),r=p(e),h=_(e),e.preventMapEvent(),e.getEvent().preventDefault()}function c(t,e){var i=p(e),n=i/r,o=_(e);s.animator.move(o.diff(h)),Math.abs(1-n)>l&&(s.animator.scale({saveThisPosition:s._restrictCenter(a.localPixelsToCoordinates(o)),scaleCoefficient:s.animator.getState().scaleCoefficient*n}),r=i),h=o,e.preventMapEvent(),e.getEvent().preventDefault()}function u(t,e){d(),e.preventMapEvent(),e.getEvent().preventDefault()}function d(){i.move.disable(),i.end.disable(),s.animator.stop(),n=!1}function p(t){var e=t.touches[0].getLocalPixels().distance(t.touches[1].getLocalPixels());return Math.max(e,1)}function _(t){return t.touches[0].getLocalPixels().copy().moveBy(t.touches[1].getLocalPixels()).scale(.5)}this.onAddToMap=function(t){a=(s=t).converter,function(){e=Rt.observe(s,s.Events.Destruct,this.onRemoveFromMap,this),i={start:Rt.observe(s,s.Events.MultiTouchStart,o,this),move:Rt.observe(s,s.Events.BeforeMultiTouchMove,c,this,!1),end:Rt.observe(s,s.Events.BeforeMultiTouchEnd,u,this,!1)}}()},this.onRemoveFromMap=function(){s&&(n&&d(),e.cleanup(),i.start.cleanup(),i.move.cleanup(),i.end.cleanup(),s=null)}},Ct.ScrollZoomControl=function(){var o,n,s,a,r,h={smooth:!0},l=0,c=0,u=0,d=0;function p(t,e){var i=e.getEvent(),n=wt.sign(i.deltaY);n&&(d=n,u=new Date,a=a||setTimeout(function(){r=setInterval(function(){c<u?(c=new Date,l+=d,Math.abs(l)<=3&&function(t,e){o.zoomBy(t,{smooth:h.smooth,position:e,callback:function(t){t==bt.State.SUCCESS&&(l=0)}})}(d,e.getCoordPoint(1))):(clearInterval(r),r=a=0)},100)},100)),i.preventDefault()}function _(){this.onRemoveFromMap(),o=null}this.onAddToMap=function(t,e,i){o=t,n=Rt.observe(o,o.Events.DOMMouseScroll,p,this),s=Rt.observe(o,o.Events.Destruct,_,this),i&&(h=Pt.extend({},h,i))},this.onRemoveFromMap=function(){s.cleanup(),n.cleanup(),l=0}},Ct.DblClickZoomControl=function(){var n,o,s,a=[];function r(t,e){l(e.getEvent()),t.zoomBy(1,{smooth:s.smooth,position:e.getGeoPoint(),centering:1})}function h(t){var e=new Date;if(o&&e-o<500){var i=n.converter.clientPixelsToCoordinates(new Bt(t.clientX,t.clientY));n.zoomBy(-1,{smooth:s.smooth,position:i,centering:1}),e=null}o=e}function l(t){t.preventDefault()}function c(t,e){h(e.getEvent()),l(e.getEvent())}this.onAddToMap=function(t,e,i){if(n=t,"mac"==Pt.os.name&&St.mozilla&&1.8<St.version){c=function(t,e){l(e.getEvent())},a.push(Rt.observe(n,n.Events.MouseUp,function(t,e){var i=e.getEvent();3==i.which&&h(i)}))}a.push(Rt.observe(n,n.Events.DblClick,r,this),Rt.observe(n,n.Events.ContextMenu,c,this)),(this.onAddToMap=function(t,e,i){It(a,"enable"),s=Pt.extend({smooth:1},i)})(t,e,i)},this.onRemoveFromMap=function(){o=null,It(a,"disable")}},Ct.MagnifierControl=function(n,o){var l,s,c,a,r,h,u,d,p={smooth:0};function _(t,e,i){o||(l.addCursor("zoom"),d=Rt.observe(l,l.Events.Click,y)),Pt(document).bind("keydown","esc",g),h.beginListening(),u=[Rt.observe(h,"start",f),Rt.observe(h,"move",m),Rt.observe(h,"stop",v)],r=Rt.observe(l,l.Events.Destruct,this._destruct,this),i&&(p=Pt.extend({},p,i))}function f(t){c=l.converter.clientPixelsToLocalPixels(new Bt(t.clientX,t.clientY))}function m(t){a=l.converter.clientPixelsToLocalPixels(new Bt(t.clientX,t.clientY));var e=c.copy(),i=e.diff(a);i.x&&i.y?(i.x<0&&(e.moveByX(i.x),i.scaleX(-1)),i.y<0&&(e.moveByY(i.y),i.scaleY(-1)),wt.position(s,e),wt.size(s,i),Pt(s).css("display","")):Pt(s).css("display","none")}function v(t){(function(t){if(!t.equals(c)){var e=new bt.CollectionBounds([c,t]),i=l.converter.localPixelsToCoordinates(e.getCenter()),n=l.getContainerSize(),o=e.getSpan(),s=n.x/o.x,a=n.y/o.y,r=Math.floor(Math.log(Math.min(s,a))/Math.LN2),h=l.getZoom()+(0<r?r:0);l.setZoom(h,{smooth:p.smooth,position:i,centering:1})}})(a=l.converter.clientPixelsToLocalPixels(new Bt(t.clientX,t.clientY))),e()}function g(t){c&&(h.abort(),e(),t.preventDefault())}function e(){Pt(s).css("display","none"),c=null}function y(t,e){t.setCenter(e.getCoordPoint(),t.getZoom()+1)}this.onAddToMap=function(t,e,i){l=t,s=Pt("<div />").addClass("YMaps-select-frame").css({display:"none","z-index":bt.ZIndex.CONTROL-1})[0],l.getContainer().appendChild(s),h=new wt.DragAndDrop.MouseMove(n,o,null,l),(this.onAddToMap=_).call(this,t,e,i)},this.onRemoveFromMap=function(){r.cleanup(),c&&e(),o||(l.removeCursor("zoom"),d.cleanup()),Pt(document).unbind("keydown","esc",g),h.stopListening(),It(u,"cleanup")},this._destruct=function(){l&&this.onRemoveFromMap(),c=u=s=l=null}},Ct.RightButtonMagnifierControl=function(t){return new Ct.MagnifierControl(t,1)},Ct.HotKeysControl=function(t){var o,s,i,n,a=[],r=0,h=0,l=0,e=0,c=0,u={zoomTimeout:300,startSpeed:1,speed:15,speedUpTime:1100,smooth:0,moveCallback:function(){e&&o._drag()},callback:function(){e&&!c&&(b(),o._dragEnd()),c=0}},d={63234:37,63232:38,63235:39,63233:40},p={};function _(t){u=Pt.extend({},u,t)}function f(t,e,i){s.appendTo(o.getContainer()),s.bind("blur",b),Pt(window).bind("blur",b);var n=St.opera?"keypress":"keydown";Pt.each(["up","right","down","left","shift+up","shift+right","shift+down","shift+left"],function(){var t=this.toString();s.bind(n,t,m).bind("keyup",t,v)}),Pt.each(["+","="],function(){s.bind(n,this.toString(),C)}),s.bind(n,{key:"+",shift:!0},C),Pt.each(["-","_"],function(){s.bind(n,this.toString(),M)}),s.bind(n,{key:"-",shift:!0},M),It(a,"enable"),i&&_(i)}function m(t){var e=g(t);p[e]&&(clearTimeout(p[e]),delete p[e]),function(t,e){var i=h,n=r,o=l;1&t?h=2&t?1:-1:r=2&t?-1:1;(l=e)==o&&i==h&&n==r||y()}(e,t.shiftKey),t.preventDefault()}function v(t){var e=g(t);p[e]=setTimeout(function(){delete p[e],function(t,e){l=e,1&t?h=0:r=0;h||r?y():b()}(e,t.shiftKey)},50),t.preventDefault()}function g(t){var e=t.charCode||t.keyCode;return St.webkit&&St.version<=523.15?d[e]:e}function y(){if(e?c=1:(o._dragStart(),e=1),l&&!St.opera){var t=Pt.extend({},u);t.startSpeed=t.speed,o.startMove(new Bt(h,r),t)}else o.startMove(new Bt(h,r),u)}function b(){for(var t in h=r=0,e&&(o.stopMove(),e=0),p)p.hasOwnProperty(t)&&clearTimeout(p[t]);p={}}function C(){x(1)}function M(){x(-1)}function x(t){var e=(n||o.getZoom())+t;e<o.getCurrentMinZoom()||e>o.getCurrentMaxZoom()||e==o.getZoom()||(n=e,function(){i&&clearTimeout(i);i=setTimeout(w,u.zoomTimeout)}())}function w(){i=null,o.setZoom(n,{smooth:u.smooth}),n=null}_(t),this.onAddToMap=function(t,e,i){o=t,s=Pt("<button />").addClass("YMaps-hot-keys-focus-holder");var n=o.Events;(a=Rt.observe(o,[n.DragEnd,n.Click],function(){s[0].focus()})).push(Rt.observe(o,n.Update,b),Rt.observe(o,n.Destruct,this._destruct,this)),(this.onAddToMap=f).call(this,t,e,i)},this.onRemoveFromMap=function(){b(),s.remove(),It(a,"disable")},this._destruct=function(){this.onRemoveFromMap(),It(a,"cleanup"),Pt(window).unbind("blur",b),o=s=a=null}},Ct.CopyrightsControl=function(){var n,o,s,a,r,h,l,c,u,i=[];function d(t,e,i,n,o){var s=" !important;",a="",r=["background-color: transparent","border: none","float: none","z-index: "+(bt.ZIndex.CONTROL+1),"position: "+t,"overflow: "+o||"hidden","padding: 0"];return e&&(r.push("display: "+e),"inline"==e&&r.push("font-family: Arial,sans-serif","font-size: 10px","text-indent: 0","text-align: left","white-space: nowrap","line-height: normal","text-decoration: "+i,"-webkit-text-size-adjust: none")),r.push(""),a=r.join(s),n=n||{},Pt.each(["margin-top","margin-right","margin-bottom","margin-left","height","width"],function(t,e){a+=e+": "+(n[e]?n[e]+"px":t<4?"0":"auto")+s}),a}function p(){var t=n.getType();o.find("*").andSelf().css("color",t.getTextColor()),.5<function(t){var e=t.replace("#",""),i=e.length/3,n=1==i?15:255,o=parseInt(e.slice(0,i),16)/n,s=parseInt(e.slice(i,2*i),16)/n,a=parseInt(e.slice(2*i,3*i),16)/n;return(Math.max(o,Math.max(s,a))+Math.min(o,Math.min(s,a)))/2}(t.getTextColor())?r.attr("class","YMaps-logo YMaps-logo-white"):r.attr("class","YMaps-logo"),_()}function _(){var t=i.concat(n._getLayerCopyrights());s.html(0<t.length?t.join(", ")+"&nbsp;&ndash;&nbsp;":""),h.attr("href",function(){var t=l;c&&(t+=(-1==t.indexOf("?")?"?":"&")+"origin=jsapi"+(u?"&ll="+n.getCenter().getX()+","+n.getCenter().getY()+"&z="+n.getZoom()+"&l=map":""));return t}())}this.onAddToMap=function(t){u=(n=t).coordSystem==Dt;var e=n.getContainer();r=Pt('<div style="'+d("absolute","block","none",{height:20,width:51})+'"><a href="javascript:void(0)" target="_blank" class="YMaps-logo-link" style="'+d("absolute","block","none",{height:20,width:51})+'"><i style="'+d("absolute",null,"none",{height:106,width:56})+'"></i></a></div>').appendTo(e),h=r.find(".YMaps-logo-link"),l=kt.copyrights.logoLink,c=kt.copyrights.addStateToLogoLink,St.msie&&bt.dom(h[0]).events.add("mouseenter",function(){h.addClass("YMaps-logo-link_hover")}).add("mouseleave",function(){h.removeClass("YMaps-logo-link_hover")}),o=Pt('<div class="YMaps-copyrights" style="'+d("absolute","block","none",{},"visible")+'"><span style="'+d("static","inline","none")+'"></span><a href="'+kt.copyrights.agreementLink+'" target="_blank" style="'+d("static","inline","underline")+'">'+kt.copyrights.agreement+"</a></div>").appendTo(e),s=o.find("span"),a=o.find("a"),p();var i=n.Events;Rt.observe(n,i.TypeChange,p),Rt.observe(n,[i.BoundsChange,i.AddLayer,i.RemoveLayer],_)},this.addCopyright=function(t){t&&(i.push(t),n&&_())},this.removeCopyright=function(t){var e=i.indexOf(t);-1!=e&&(i.splice(e,1),n&&_())},this.checkVisibility=function(){"blocked"==Ct.checkVisibility(h[0])&&Ct.statCount({pid:443,cid:72959,path:"logoHidden.1_1"}),"blocked"==Ct.checkVisibility(a[0])&&Ct.statCount({pid:443,cid:72959,path:"copyrightsHidden.1_1"})},this.onRemoveFromMap=wt.NULL,this.update=_},Mt=bt.TypeControl=function(t,e,i){this.__types=[],this.__buttons=[],this.__buttonListeners=[],this.__changeTypeListener=null,this.__enabled=1,this.__options=Pt.extend({width:100,caption:kt.hints.typeControl.more},i||{}),this.__toolBar=new bt.ToolBar([]),this.__listBox=new Ct.TypeListBox(this.__buttonGroup,this.__options),e=e||[];for(var n=0,o=(t=t||[bt.MapType.MAP,bt.MapType.SATELLITE,bt.MapType.HYBRID]).length;n<o;n++)this.addType(t[n],-1!=Pt.inArray(n,e))},(xt=Mt.prototype).__buttonGroup="default#types",xt.__isListItem=function(t){var e=Pt.inArray(t,this.__types);return-1==e?0:-1!=this.__listBox.indexOf(this.__buttons[e])},xt.__getTypeButton=function(t){var e=Pt.inArray(t,this.__types);return-1==e?null:this.__buttons[e]},xt.onAddToMap=function(t,e){this.__map=t,this.__toolBar.onAddToMap(t,e||new bt.ControlPosition(bt.ControlPosition.TOP_RIGHT,new bt.Point(5,5))),this.__changeTypeListener=Rt.observe(t,t.Events.TypeChange,this.update,this),this.update()},xt.update=function(){if(this.__map){var t=this.__map.getType(),e=Pt.inArray(t,this.__types);this.__applySelection(this.__currentType,0),-1==e?this.__currentType=null:(this.__applySelection(t,1),this.__currentType=t)}},xt.enable=function(){this.__enabled||(this.__toolBar.forEach(function(t){t.enable()}),this.__listBox.enable(),this.__enabled=1)},xt.disable=function(){this.__enabled&&(this.__toolBar.forEach(function(t){t.disable()}),this.__listBox.disable(),this.__enabled=0)},xt.isEnabled=function(){return this.__enabled},xt.__applySelection=function(t,e){t&&(this.__isListItem(t)?this.__listBox[e?"select":"deselect"](t):this.__getTypeButton(t)[e?"select":"deselect"]())},xt.addType=function(t,e){if(t&&-1==Pt.inArray(t,this.__types)){var i=e?new bt.ListBoxItem(t.getName()):new bt.ToolBarRadioButton(this.__buttonGroup,{caption:t.getName()});e||this.__enabled||i.disable(),this.__types.push(t),this.__buttons.push(i),e?(this.__listBox.add(i),1==this.__listBox.length()&&this.__toolBar.add(this.__listBox)):this.__listBox.length()?this.__toolBar.splice(-1,0,i):this.__toolBar.add(i),this.__buttonListeners.push(Rt.observe(i,i.Events.Click,function(){this.__map.setType(t),this.__isListItem(t)&&this.__listBox.collapse()},this))}this.update()},xt.removeType=function(t){var e=t?Pt.inArray(t,this.__types):-1;-1!=e&&(this.__buttonListeners[e].cleanup(),this.__buttonListeners.splice(e,1),this.__currentType==t&&(this.__applySelection(t,0),this.__currentType=null),this.__isListItem(t)?this.__listBox.remove(this.__buttons[e]):this.__toolBar.remove(this.__buttons[e]),this.__types.splice(e,1),this.__buttons.splice(e,1),this.__listBox.length()||this.__toolBar.remove(this.__listBox)),this.update()},xt.getTypes=function(){return this.__types.slice()},xt.onRemoveFromMap=function(){this.__map&&(this.__changeTypeListener.cleanup(),this.__changeTypeListener=null,this.__toolBar.onRemoveFromMap(),this.__map=null)},Mt=Ct.TypeListBox=function(t,e){bt.ListBox.call(this,e),this.__inactiveCaption=e.caption,this.__groupId=t,this.__selected=0},(xt=Lt(Mt,bt.ListBox)).isSelected=function(){return this.__selected},xt.getGroupId=function(){return this.__groupId},xt.select=function(t){if(!this.__selected&&(this.__selected=1,this.getToolBar)){var e=this;Pt.each(this.getToolBar().getByGroupId(this.__groupId),function(){this!=e&&this.isSelected()&&this.deselect()}),this.setState({color:"green"}),this.getElement().find(".YMaps-btn-name").removeClass("YMaps-btn-name_layers").addClass("YMaps-btn-name_green")}this.setCaption(t.getName())},xt.deselect=function(){this.__selected=0,this.setCaption(this.__inactiveCaption),this.setState({color:""}),this.getElement().find(".YMaps-btn-name").removeClass("YMaps-btn-name_green").addClass("YMaps-btn-name_layers")},function(){function v(t,e,i){if(t&&0<=e.currentIndex){var n=e.get(e.currentIndex);if(!i.noCentering)n.getBounds()?t.setBounds(n.getBounds()):t.setCenter(n.getCoordPoint());i.noPlacemark||(t.addOverlay(n),n.openBalloon(null,{mapAutoPan:!i.noCentering}))}}function g(t,e,i){t&&0<=e.currentIndex&&!i.noPlacemark&&t.removeOverlay(e.get(e.currentIndex))}bt.SearchControl=function(t){var s,a,r,h,i,n=this,l=Pt.extend({resultsPerPage:3,width:240,noCentering:0,noPlacemark:0,useMapBounds:1},t),c={action:bt.State.EMPTY,expanded:1,enabled:1},u="";function d(t,e,i){for(var n=0,o=t.length;n<o;n++)a.listeners.push(bt.dom(t[n]).events.eventListener().add(e,i))}function p(t){var e=h.get(t),i=h.page*l.resultsPerPage;bt.Events.notify(n,n.Events.Select,n,e),g(s,h,l),-1!=h.currentIndex&&a.$list.find("dd").eq(h.currentIndex-i).removeClass("YMaps-btn-list-item_current"),-1!=(h.currentIndex=t)&&a.$list.find("dd").eq(t-i).addClass("YMaps-btn-list-item_current"),v(s,h,l)}function _(){var t=P(a);if(t){var e=+new Date;u&&t==u&&e-i<kt.dblClickTimeout||(u=t,i=e,c.action=bt.State.LOADING,f(),C(c,h,a),h.search(t,o))}}function o(t){c.action=t,s&&(M(h,a,l,p),C(c,h,a),h.length()&&-1==h.currentIndex&&p(0))}function f(){s&&(a.$list.empty(),g(s,h,l)),h.currentIndex=-1,h.page=0,h.removeAll()}function m(t){h.page=t,h.length()>t*l.resultsPerPage?M(h,a,l,p):(c.action=b,C(c,h,a),h.getMore(o))}l.resultsPerPage=Math.round(wt.boundaryRestrict(l.resultsPerPage,1,20)),l.width=Math.max(l.width,200),h=new e(this,l),this.getMap=function(){return s},this.Events={Select:"Select"},this.onAddToMap=function(t,e){var i=e||new bt.ControlPosition(bt.ControlPosition.TOP_RIGHT,new bt.Point(200,5));if(s=t,a=new y(l),r=a.$element,i.apply(r),w(a,u),C(c,h,a),c.action==bt.State.SUCCESS&&M(h,a,l,p),r.appendTo(s.getContainer()),x(r),d(a.$submit,"click",function(){_()}),d(a.$switcher,"click",function(){c.expanded=!c.expanded,C(c,h,a)}),d(a.$cleaner,"click",function(){c.action=bt.State.EMPTY,u="",f(),s&&(C(c,h,a),w(a,""),0<=h.currentIndex&&!l.noPlacemark&&s.removeOverlay(h.get(h.currentIndex)))}),d(a.$hint,"click",function(){a.$input[0].focus()}),d(a.$input,"focus",function(){T(a)}),d(a.$input,"blur",function(){P(a)||S(a)}),d(a.$input,"keyup",function(t){13==t.which&&_()}),d(a.$prev,"click",function(){m(h.page-1)}),d(a.$next,"click",function(){m(h.page+1)}),St.msie&&(St.version<8||document.documentMode<8)){var n=r.find(".YMaps-arr"),o=r.find(".YMaps-btn-name_result");d(o,"mouseenter",function(){n.addClass("YMaps-arr_hover")}),d(o,"mouseleave",function(){n.removeClass("YMaps-arr_hover")})}d(r.find(".YMaps-pseudo-link"),"click",function(t){t.preventDefault()}),v(s,h,l)},this.onRemoveFromMap=function(){s&&(g(s,h,l),It(a.listeners,"removeAll"),It(a.itemListeners,"removeAll"),a.listeners=[],a.itemListeners=[],r.empty().remove(),r=a=s=null)},this.expand=function(){c.expanded||(c.expanded=1,s&&C(c,h,a))},this.collapse=function(){c.expanded&&(c.expanded=0,s&&C(c,h,a))},this.isExpanded=function(){return c.expanded},this.enable=function(){c.enabled||(c.enabled=1,s&&C(c,h,a))},this.disable=function(){c.enabled&&(c.enabled=0,s&&C(c,h,a))},this.isEnabled=function(){return c.enabled},this.parseGeocoderResult=function(t){if(!t.name&&!t.description)if(t.text){var e=t.text.split(", "),i=t.kind&&"house"==t.kind?-2:-1;t.name=e.slice(i).join(", "),t.description=e.slice(0,i).join(", ")}else t.getCoordPoint?t.name=t.getCoordPoint().toString():t.name=kt.hints.searchControl.noname;return t}};var y=function(t){var e=kt.hints.searchControl,i=Pt('<div class="YMaps-btn YMaps-cursor-default"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i" style="width: '+t.width+'px"><i class="YMaps-btn__disabler"></i><div class="YMaps-h-search"><table class="YMaps-l-search"><tbody><tr><td class="YMaps-l-search-l"><div class="YMaps-b-search-wrap"><label class="YMaps-b-hint-input">'+e.mapSearch+'</label><input type="text" name="text" class="YMaps-search-control-text" value=""/></div></td><td class="YMaps-l-search-r"><div class="YMaps-search-control-submit"><i>'+e.find+'</i></div></tr></tbody></table></div><table class="YMaps-l-search YMaps-b-result YMaps-b-result_hide"><tbody><tr><td class="YMaps-l-search-l"><a href="javascript:void(0)" class="YMaps-btn-name YMaps-btn-name_result YMaps-search-control-foundblock"><i class="YMaps-pseudo-link"><span class="YMaps-search-control-found YMaps-search-control-switch"></span></i><i class="YMaps-arr YMaps-search-control-switch"><i></i></i></a><p class="YMaps-search-control-wait">'+e.wait+'</p><p class="YMaps-notice YMaps-search-control-notfound">'+e.notFound+'</p><p class="YMaps-notice YMaps-search-control-failure"></p></td><td class="YMaps-l-search-r"><a href="javascript:void(0)" class="YMaps-pseudo-link"><span class="YMaps-search-control-clean">'+e.clear+'</span></a></td></tr><tr class="YMaps-b-result-list"><td colspan="2"><dl class="YMaps-btn-list YMaps-btn-list_search"><dt class="YMaps-btn-list-query">'+e.correction+' <b class="YMaps-search-control-suggest"></b></dt></dl><dl class="YMaps-btn-list YMaps-btn-list_search YMaps-search-control-list"></dl><dl class="YMaps-btn-list YMaps-btn-list_search"><dd class="YMaps-btn-list-item YMaps-btn-list-item_more"><a class="YMaps-pseudo-link YMaps-prev" href="javascript:void(0)"><span>'+(1<t.resultsPerPage?e.previous[1]+" "+t.resultsPerPage:e.previous[0])+'</span></a><a class="YMaps-pseudo-link YMaps-next" href="javascript:void(0)"><span></span></a></dd></dl></td></tr></tbody></table></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>').css({zIndex:bt.ZIndex.CONTROL,position:"absolute"});return{$element:i,listeners:[],itemListeners:[],$submit:i.find(".YMaps-search-control-submit"),$switcher:i.find(".YMaps-search-control-switch"),$wait:i.find(".YMaps-search-control-wait"),$foundblock:i.find(".YMaps-search-control-foundblock"),$found:i.find(".YMaps-search-control-found"),$notfound:i.find(".YMaps-search-control-notfound"),$failure:i.find(".YMaps-search-control-failure"),$result:i.find(".YMaps-b-result"),$input:i.find(".YMaps-search-control-text"),$hint:i.find(".YMaps-b-hint-input"),$cleaner:i.find(".YMaps-search-control-clean"),$list:i.find(".YMaps-search-control-list"),$correction:i.find(".YMaps-btn-list-query"),$suggest:i.find(".YMaps-search-control-suggest"),$prev:i.find(".YMaps-prev"),$next:i.find(".YMaps-next")}},b="InUpdate",i=["$foundblock","$notfound","$wait","$failure","$result","$element"],c="YMaps-display-none",s="YMaps-btn_disabled",a={cssClass:c,show:"remove",hide:"add"},r={$element:{cssClass:"YMaps-btn_expanded",show:"add",hide:"remove"},$result:{cssClass:"YMaps-b-result_hide",show:"remove",hide:"add"}};function C(t,e,n){var o=function(t,e,i){var n=[];switch(e.action){case bt.State.LOADING:n.push("$wait","$element");break;case b:n.push("$foundblock","$wait","$element");break;case bt.State.SUCCESS:n.push("$element"),i?(n.push("$foundblock"),e.expanded&&n.push("$result")):n.push("$notfound");break;case bt.State.FAILURE:n.push("$failure","$element");break;case bt.State.EMPTY:}P(t)||n.push("$hint");return n}(n,t,e.getFound());Pt.each(i,function(t,e){var i=r[e]||a;n[e][i[-1!=Pt.inArray(e,o)?"show":"hide"]+"Class"](i.cssClass)}),n.$element[(t.enabled?"remove":"add")+"Class"](s),n.$failure.html(e.getErrorMessage()),n.$found.html(function(t){var e=kt.hints.searchControl.quantity,i=0;return t%10==0||4<t%10||1==Math.floor(t/10)?i=1:t%10==1&&(i=2),e[i].found+" "+t.toString()+" "+e[i].objects}(e.getFound())),x(n.$element)}function M(t,e,i,n){var o=i.resultsPerPage,s=t.page,a=e.$list.empty(),r=Math.min(o,t.getFound()-(s+1)*o);It(e.itemListeners,"removeAll"),e.itemListeners=[],t.getSuggest()?(e.$suggest.html(""+t.getSuggest().replace(/<fix>/gi,"<i>").replace(/<\/fix>/gi,"</i>")+""),e.$correction.removeClass(c)):e.$correction.addClass(c);for(var h=s*o,l=Math.min((s+1)*o,t.getFound());h<l;h++)u(t,h,n,e.itemListeners).appendTo(a);0<s?e.$prev.removeClass(c):e.$prev.addClass(c),0<r?e.$next.html("<span>"+(1<r?kt.hints.searchControl.next[1]+" "+r:kt.hints.searchControl.next[0])+"</span>").removeClass(c):e.$next.addClass(c),x(e.$element)}function x(t){t.find(".YMaps-btn__disabler").height(t.find(".YMaps-btn-i").height()+3)}function w(t,e){var i=t.$input;typeof e!=Et?(i.attr("value",""),S(t)):(i.attr("value",e),T(t))}function P(t){return t.$input.attr("value")}function S(t){t.$hint.removeClass(c)}function T(t){t.$hint.addClass(c)}var e=function(n,i){bt.GeoObjectCollection.call(this);var o,s=this,a=[],r=0,h="",l="",c="",u=null,d="";function p(t){var e={results:3*i.resultsPerPage,skip:t,prefLang:i.prefLang};c&&(e.boundedBy=c),i.geocodeOptions&&(e=Pt.extend({},i.geocodeOptions,e)),a.length&&_(),o=new bt.Geocoder(l,e),a=function(i){return[bt.Events.observe(i,i.Events.Load,function(){!function(t){t==o&&(function(){for(var t=0,e=o.length();t<e;t++)s.add(n.parseGeocoderResult(o.get(t)));r=o.found,h=o.suggest}(),_(),u(bt.State.SUCCESS));t.removeAll()}(i)}),bt.Events.observe(i,i.Events.Fault,function(t,e){!function(t,e){t==o&&(_(),d=e,r=0,h="",u(bt.State.FAILURE))}(i,e)})]}(o)}function _(){It(a,"cleanup"),a=[]}this.getFound=function(){return r},this.getSuggest=function(){return h},this.getErrorMessage=function(){return d},this.page=0,this.currentIndex=-1,this.search=function(t,e){l=t,u=e,c=i.useMapBounds&&n.getMap()?n.getMap().getBounds():null,p(0)},this.getMore=function(t){u=t,p(this.length())}};function u(t,e,i,n){var o=t.get(e),s=Pt('<dd class="YMaps-btn-list-item'+(e==t.currentIndex?" YMaps-btn-list-item_current":"")+'">'+(o.name?'<a class="YMaps-pseudo-link" href="javascript:void(0)"><span>'+o.name+"</span></a>":"")+(o.description?'<p class="YMaps-note">'+o.description+"</p>":"")+"</dd>");return n.push(bt.dom(s[0]).events.eventListener().add("click",function(){i(e)})),o.name&&n.push(bt.dom(s.find(".YMaps-pseudo-link")[0]).events.eventListener().add("click",function(t){t.preventDefault()})),s}Lt(e,bt.GeoObjectCollection)}(),Ct.ZoomButton=function(i,n){var o,e,s=Pt('<a class="YMaps-slider-'+(1==i?"plus":"minus")+'" href="javascript:void(0)"><i class="YMaps-slider-btn"><i></i></i></a>'),a=[];function r(){1==i?o.getZoom()>=o.getCurrentMaxZoom()?s.addClass("YMaps-slider-plus_disable"):s.removeClass("YMaps-slider-plus_disable"):o.getZoom()<=o.getCurrentMinZoom()?s.addClass("YMaps-slider-minus_disable"):s.removeClass("YMaps-slider-minus_disable")}this.getElement=function(){return s},this.beginListening=function(t){return this.stopListening(),o=t,e=At(s[0]).events.eventListener().add("click",function(t){var e=o.getZoom()+i;(1==i?e<=o.getCurrentMaxZoom():e>=o.getCurrentMinZoom())&&o.zoomBy(i,{smooth:n}),t.preventDefault()}),a=bt.Events.observe(o,[o.Events.BoundsChange,o.Events.ZoomRangeChange],r),r(),this},this.stopListening=function(){return o&&(e.removeAll(),It(a,"cleanup"),a=[],o=null),this}},function(){bt.Zoom=function(a){var r,h,l,c,u,i,n,o=[];function s(){if(!u){var t=(u=new d(a)).getContainer(),e=Pt(t).find(".YMaps-slider-scale");(c=new Ct.ZoomButton(-1,a.smooth)).getElement().insertBefore(e),(l=new Ct.ZoomButton(1,a.smooth)).getElement().insertAfter(e),r.getContainer().appendChild(t),h.apply(t)}if(!u.isDragging()){for(var i=r.getZoom(),n=Math.max(i,r.getCurrentMaxZoom()),o=Math.min(i,r.getCurrentMinZoom()),s=[];o<=n;n--)s.push(n);u.update({value:r.getZoom(),values:s,isRight:h.anchor%2})}}a=Pt.extend({noTips:0,customTips:kt.hints.zoom,smooth:1},a||{}),this.onAddToMap=function(t,e){r=t,h=e||new bt.ControlPosition(bt.ControlPosition.TOP_LEFT,new bt.Point(5,75)),s(),o.push(Rt.observe(r,r.Events.Update,function(){u.setValue(r.getZoom()),s()}),Rt.observe(r,r.Events.ZoomRangeChange,s,this),Rt.observe(u.getContainer(),"sliderchange",function(t){n&&window.clearTimeout(n),n=window.setTimeout(function(){r.setZoom(t),u.setFocus()},300)},this)),c.beginListening(r),l.beginListening(r),i=Rt.observe(r,r.Events.Destruct,this._destruct,this)},this._destruct=function(){i.cleanup(),n&&window.clearTimeout(n),r&&(It([c,l],"stopListening"),r.getContainer().removeChild(u.getContainer()),u._destruct(),It(o,"cleanup"),r=h=u=c=l=null)},this.onRemoveFromMap=this._destruct};var d=function(e){var i,n,o,s,a,t,r,h,l,c,u,d,p,_,f,m,v=[],g=2e3;function y(e){return function(t){e(t),t.preventDefault()}}function b(){f=f||setTimeout(function(){f=void 0,_.hide()},g)}function C(){f&&(clearTimeout(f),f=void 0)}function M(){c=!0,p=i}function x(t){w(Math.round((u-t.clientY-Pt(window).scrollTop()-3+r.offset().top)/d))}function w(t){var e=Math.max(0,Math.min(n,t));a.css("margin-top",Math.round(u-(e+1)*d-1)+"px"),i=e}function P(){p!=i&&(Rt.notify(s[0],"sliderchange",O()),p=null),c=!1}function S(t){x(t),P()}function T(){L(i-1)}function E(){L(i+1)}function L(t){M(),w(t),P()}function O(t){return o[isNaN(t=parseInt(t))?i:t]}s=Pt('<div class="YMaps-slider"><div class="YMaps-slider-content"><div class="YMaps-slider-scale"><i class="YMaps-slider-grab" type="button"><i></i><input type="button"/></i><i class="YMaps-slider-marks"><i></i></i></div></div></div>').css("z-index",bt.ZIndex.CONTROL),a=s.find(".YMaps-slider-grab"),t=a.find("input"),h=s.find(".YMaps-slider-marks"),r=s.find(".YMaps-slider-scale"),e.noTips||(_=new I(r,this,e.customTips)),l=new wt.DragAndDrop.MouseMove(t[0]),Rt.observe(l,"start",M),Rt.observe(l,"move",x),Rt.observe(l,"stop",P),l.beginListening(),v.push(At(h[0]).events.eventListener().add("click",S)),v.push(At(a[0]).events.eventListener().add("mouseenter",function(){Pt(a).addClass("YMaps-slider-grab_h")}).add("mouseleave",function(){Pt(a).removeClass("YMaps-slider-grab_h")})),e.noTips||v.push(At(s[0]).events.eventListener().add("mouseenter",function(){_.show(),C()}).add("mouseleave",b)),m=St.opera?"keypress":"keydown",t.bind(m,"down",y(T)).bind(m,"+",y(T)).bind(m,"up",y(E)).bind(m,"-",y(E)).bind(m,"end",y(function(){L(0)})).bind(m,"home",y(function(){L(n)})),this.update=function(t){o=t.values,n=o.length-1,4,d=7,u=Math.round((1+n)*d),r.css({height:u+"px","padding-bottom":"0"}),h.css({height:u+"px"}),s.css({height:(u+50).toString()+"px"}),t.isRight?s.addClass("YMaps-slider_left"):s.removeClass("YMaps-slider_left"),e.noTips||_.update(u,d,t.isRight),this.setValue(t.value)},this._destruct=function(){e.noTips||C(),e.noTips||_._destruct(),It(v,"removeAll"),v=[],l.stopListening(),s.empty(),s=t=a=r=h=_=l=null},this.isDragging=function(){return c},this.setValue=function(t){if("number"==typeof t){var e=Pt.inArray(t,o);-1!=e&&w(e)}},this.getValue=O,this.setFocus=function(){t[0].focus()},this.getContainer=function(){return s[0]},this.getIndex=function(t){return Pt.inArray(t,o)}},I=function(t,e,i){this._slider=e,this._$element=Pt('<div class="YMaps-slider-tips" style="visibility: hidden;"></div>').appendTo(t),this._tips=[],this.listeners=[],this._visible=!1;var n=this;Pt.each(i,function(e,t){n._tips[e]={index:t.index,$element:Pt('<a href="javascript:void(0)" class="YMaps-button-tip YMaps-cursor-pointer"><i class="YMaps-button-tip-l"><i></i></i><i class="YMaps-button-tip-r"><i></i></i><b class="YMaps-button-tip-container"><i class="YMaps-button-tip-text">'+t.value+'</i><i class="YMaps-button-tip-m"></i></b></a>').appendTo(n._$element)},n.listeners.push(At(n._tips[e].$element[0]).events.eventListener().add("click",function(t){Rt.notify(n._slider.getContainer(),"sliderchange",n._tips[e].index),t.preventDefault()}))})};(xt=I.prototype).update=function(t,e,i){var n,o,s,a;for(n=0,o=this._tips.length;n<o;n++)s=this._tips[n],-1==(a=this._slider.getIndex(s.index))?s.$element.addClass("YMaps-display-none"):s.$element.removeClass("YMaps-display-none"),s.$element.css({top:Math.round(t-(a+1)*e-6)+"px"});if(this._$element.css({height:t+"px"}),i?this._$element.addClass("YMaps-slider-tips_left"):this._$element.removeClass("YMaps-slider-tips_left"),St.msie&&7<=St.version&&St.version<8&&"BackCompat"==document.compatMode){var r=this._$element.find(".YMaps-button-tip-r");for(n=0,o=r.length;n<o;n++){var h=r.eq(n);h.parent().eq(0).width()%2?h.css("right",i?"-10px":"-7px"):h.css("right",i?"-9px":"-6px"),i&&h.css("left","auto")}}},xt.show=function(){this._visible||(this._$element.css({visibility:"visible"}),this._visible=!0)},xt.getContainer=function(){return this._$element[0]},xt.hide=function(){this._visible&&(this._$element.css({visibility:"hidden"}),this._visible=!1)},xt._destruct=function(){It(this.listeners,"removeAll"),this.listeners=[]}}(),bt.SmallZoom=function(i){var n,o,s,a;(i=i||{}).smooth=void 0===i.smooth?1:i.smooth,this.onAddToMap=function(t,e){n=t,e=e||new bt.ControlPosition(bt.ControlPosition.TOP_LEFT,new bt.Point(5,75)),o=Pt('<div class="YMaps-slider"></div>').css("z-index",bt.ZIndex.CONTROL).appendTo(n.getContainer()),e.apply(o[0]),s&&a||(a=new Ct.ZoomButton(-1,i.smooth),s=new Ct.ZoomButton(1,i.smooth)),a.beginListening(n).getElement().appendTo(o),s.beginListening(n).getElement().appendTo(o)},this.onRemoveFromMap=function(){n&&(o.removeFromDom(),a.stopListening(),s.stopListening(),n=o=a=s=null)}},(Mt=Ct.RulerPointLayout=function(t){var e=Pt('<div class="YMaps-placemark-wrap"><i class="YMaps-ruler-point YMaps-cursor-move"><i></i></i><b class="YMaps-button-tip YMaps-ruler-tip YMaps-cursor-default"><i class="YMaps-button-tip-l"><i></i></i><i class="YMaps-button-tip-r"><i></i></i><b class="YMaps-button-tip-container"><i class="YMaps-button-tip-text"><span class="YMaps-number"></span>&nbsp;<span class="YMaps-ruler-text-dist"></span></i><i class="YMaps-button-tip-m"></i></b></b></div>');this.__$nodes={element:e,point:e.find(".YMaps-ruler-point"),hint:e.find(".YMaps-button-tip"),num:e.find(".YMaps-number"),text:e.find(".YMaps-ruler-text-dist"),tipR:e.find(".YMaps-button-tip-r"),button:null},this.setType(t.getType())}).prototype={__typeModifiers:{start:{element:"YMaps-popup-none",point:"YMaps-start-point"},via:{element:"YMaps-popup-hover",point:"YMaps-via-point",hint:"YMaps-ruler-tip-via"},end:{element:"YMaps-popup-visible",point:"YMaps-end-point"}},setType:function(t,e){var i=this.__typeModifiers,n=i[this.__type]||{},o=i[t]||{},s=this.__$nodes;if(Pt.each(["element","point","hint"],function(t,e){var i=s[e];n[e]&&i.removeClass(n[e]),o[e]&&i.addClass(o[e])}),"end"==this.__type&&"end"!=t&&(this.__buttonListener.removeAll(),s.button.remove(),s.button=null),"end"!=this.__type&&"end"==t){var a=Pt('<a class="YMaps-ruler-tip-delete YMaps-cursor-pointer" title="'+kt.hints.ruler.close+'"></a>').appendTo(s.element.find(".YMaps-button-tip-text"));this.__buttonListener=At(a[0]).events.eventListener().add("click",e),St.msie&&(St.version<7||St.quirksMode)&&this.__buttonListener.add("mouseenter",function(){a.addClass("YMaps-ruler-tip-delete_hover")}).add("mouseleave",function(){a.removeClass("YMaps-ruler-tip-delete_hover")}),s.button=a}s.element.width(),this.__type=t},setData:function(t){var e=this.__$nodes;e.num.html(t.number+")&nbsp;").width(),e.text.html(bt.humanDistance(t.distance)).width(),St.msie&&7<=St.version&&St.version<8&&"BackCompat"==document.compatMode&&e.tipR.css("right",e.tipR.parent().eq(0).width()%2?"-7px":"-6px"),St.opera&&St.version<9.5&&e.hint.css("width","auto")},onAddToParent:function(t){this.__$nodes.element.appendTo(t)},onRemoveFromParent:function(){this.__$nodes.element.remove(),"end"==this.__type&&this.__buttonListener.removeAll()},getOffset:function(){return new bt.Point(0,0)},setContent:wt.NULL,update:wt.NULL},bt.Templates.add("ruler#icon",new bt.LayoutTemplate(Mt)),Mt=Ct.RulerPoint=function(t){bt.Placemark.call(this,t,{draggable:1}),this.__type=Ct.RulerPoint.START_POINT,this.__data={},this.__listeners=[]},(xt=Lt(Mt,bt.Placemark)).getIconLayout=function(){return this._icon},Mt.START_POINT="start",Mt.VIA_POINT="via",Mt.END_POINT="end",xt.setData=function(t){this.__data=t||{};var e=this.getIconLayout();e&&e.setData(this.__data)},xt.getData=function(){return this.__data},xt.setType=function(t,e){this.__type=t;var i=this.getIconLayout();i&&i.setType(t,e)},xt.getType=function(){return this.__type},xt.onAddToGroup=function(t){bt.Placemark.prototype.onAddToGroup.call(this,t),this.__listeners=[bt.Events.observe(this,this.Events.DblClick,function(){t.remove(this)},this),bt.Events.observe(this,this.Events.Drag,function(){t.updatePoints(this)},this)]},xt.onRemoveFromGroup=function(){It(this.__listeners,"cleanup"),bt.Placemark.prototype.onRemoveFromGroup.call(this)},Mt=Ct.RulerContainer=function(t){bt.ConnectedPlacemarks.call(this,t);var e=this,i=[Rt.observe(this,this.Events.Add,function(t,e,i){var n=this.length(),o=0;if(1<n){var s=this.get(i-1);1<i&&s.setType(Ct.RulerPoint.VIA_POINT),o=s.getData().distance+this.getMap().coordSystem.rulerDistance(e.getCoordPoint(),s.getCoordPoint()),e.setType(Ct.RulerPoint.END_POINT,a)}e.setData({number:n,distance:o})},this),Rt.observe(this,this.Events.Remove,function(t,e,i){var n=this.length();n&&(0==i?this.get(0).setType(Ct.RulerPoint.START_POINT):i==n&&1<n&&this.get(-1).setType(Ct.RulerPoint.END_POINT,a));i!=n&&this.updatePoints(0<i?this.get(i):null)},this)];function a(t){(e.length()<3||confirm(kt.hints.ruler.sure))&&e.removeAll(),Ct.preventMapEvent(t),t.preventDefault()}this.updatePoints=function(t){for(var e=t?this.indexOf(t):0,i=0<e?this.get(e-1).getData().distance:0,n=this.length();e<n;e++){var o=this.get(e);i+=0<e?this.getMap().coordSystem.rulerDistance(o.getCoordPoint(),this.get(e-1).getCoordPoint()):0,o.setData({number:e+1,distance:i})}},this.removeAll=function(){It(i,"disable"),bt.ConnectedPlacemarks.prototype.removeAll.call(this),It(i,"enable")}},Lt(Mt,bt.ConnectedPlacemarks),Ct.RulerControl=function(){var s,a,e,r=new Ct.RulerContainer("ruler#style");this.onAddToMap=function(t){s||(s=t).addOverlay(r,1),e=Rt.observe(s,s.Events.Click,function(t,e){r.add(new Ct.RulerPoint(e.getGeoPoint(1)))},this),a&&(this.setStateString(a),a=null),s.addCursor(bt.Cursor.ARROW)},this.onRemoveFromMap=function(){s.removeCursor(bt.Cursor.ARROW),e.cleanup()},this.setStateString=function(t){if(s){if(r.removeAll(),t)for(var e=t.split("~"),i=s.coordSystem.getCoordPoint(0,0,1),n=0,o=e.length;n<o;n++)r.add(new Ct.RulerPoint(i.moveBy(bt.Point.fromString(e[n]))))}else a=t},this.getStateString=function(){if(r.length()){for(var t,e=r.get(0).getCoordPoint(),i=[s.coordSystem.getCoordPoint(0,0).moveTo(e).toString(8)],n=1,o=r.length();n<o;n++)t=r.get(n).getCoordPoint(),i.push(e.diff(t).toString(8)),e=t;return i.join("~")}return""}},(O=new bt.Style(null)).iconStyle={template:"ruler#icon",offset:new Bt(0,0)},O.lineStyle={strokeColor:"d61d00",strokeWidth:2},O.hasBalloon=0,bt.Styles.add("ruler#style",O),bt.Executor=function(t){this.resources=t||[]},(xt=bt.Executor.prototype).execCommand=function(t,e){if(t instanceof Array||(e=t,t=null),e)for(var i=[e].concat(Array.prototype.slice.call(arguments,t?2:1)),n=0,o=this.resources.length;n<o;n++)t&&-1!=Pt.inArray(this.resources[n],t)||this.resources[n].execCommand.apply(this.resources[n],i)},xt.destroy=function(){It(this.resources,"destroy"),this.resources=null},bt.Resource=function(t){this.data=t,this.commands={}},(xt=bt.Resource.prototype).execCommand=function(t){var e=this.commands[t];e&&e.apply(this,[this].concat(Array.prototype.slice.call(arguments,1)))},xt.destroy=function(){this.data=this.commands=null},bt.Connect=function(t){bt.Resource.call(this,t),this.events={},this.listeners={},this.eventsByCommand={},Pt.extend(this.commands,{connect:function(t){t.connect()},disconnect:function(t){t.disconnect()}})},(xt=Lt(bt.Connect,bt.Resource)).execCommand=function(t){var e,i,n,o=this.eventsByCommand[t];if(o&&this.isConnected())for(i=0,n=o.length;i<n;i++)(e=this.listeners[o[i]])&&e.disable();if(bt.Resource.prototype.execCommand.apply(this,arguments),o&&this.isConnected())for(i=0;i<n;i++)(e=this.listeners[o[i]])&&e.enable()},xt.connect=function(){function t(t,e,i){i.listeners[t]=Rt.observe(i.data,i.data.Events[t],function(){e.apply(t,[i].concat(Array.prototype.slice.call(arguments)))})}for(var e in this.listeners={},this.events)this.events.hasOwnProperty(e)&&t(e,this.events[e],this)},xt.disconnect=function(){for(var t in this.listeners)this.listeners.hasOwnProperty(t)&&this.listeners[t].cleanup();this.listeners=null},xt.isConnected=function(){return!!this.listeners},xt.destroy=function(){this.isConnected()&&this.disconnect(),this.events=this.listeners=this.eventsByCommand=null,bt.Resource.prototype.destroy.call(this)},bt.MapConnect=function(t,n){bt.Connect.call(this,t),Pt.extend(this.commands,{setCenter:function(t,e,i,n){t.data.setCenter(e,i,n)},setType:function(t,e){t.data.setType(e)},moveStart:function(t){t.data._moveStart()},move:function(t,e,i){var n=t.data.getZoom()-i;t.data._move(e.apply(function(t){return t*Math.pow(2,n)}))},moveEnd:function(t){t.data._moveEnd()}}),Pt.extend(this.eventsByCommand,{setCenter:["Update","TypeChange"],setType:["TypeChange"],moveStart:["MoveStart"],move:["Update","Move"],moveEnd:["MoveEnd"]}),Pt.extend(this.events,{Update:function(t,e){n.execCommand([t],"setCenter",e.getCenter(),e.getZoom())},TypeChange:function(t,e){n.execCommand([t],"setType",e.getType())},MoveStart:function(t){n.execCommand([t],"moveStart")},Move:function(t,e,i){n.execCommand([t],"move",i.copy(),e.getZoom())},MoveEnd:function(t){n.execCommand([t],"moveEnd")}})},Lt(bt.MapConnect,bt.Connect),bt.MiniMap=function(t){this.Events={VisibilityChange:"visibilitychange"};var i,n,o,s,a,r,h,l={zoomOffset:typeof t==Et?5:t,mapType:new bt.MapType(["map"],"",{minZoom:0}),visible:!0};function c(n){var t=new Ct.ALayer;return t.onAddToMap=function(t,e){Ct.ALayer.prototype.onAddToMap.call(this,t,e),Pt(this.getContainer()).addClass("YMaps-mini-map-frame").css({left:"50%",top:"50%"}),this.onMapUpdate()},t.onMapUpdate=function(){var t=n.getContainerSize().scale(1/Math.pow(2,n.getZoom()-this.getMap().getZoom())),e=t.copy().scale(-.5),i=this.getContainer();wt.size(i,t),Pt(i).css("margin",e.y+"px 0 0 "+e.x+"px")},t.onMove=wt.NULL,t}function u(t,e){this._options=e,this._construct(t)}function d(){var t=l.visible;i.toggleClass("YMaps-mini-map-invisible",!t),n.attr("title",kt.hints.miniMap[t?"hide":"show"]),i.css("zIndex",bt.ZIndex.CONTROL+(t?0:2)),t?(r.execCommand("connect"),r.resources[0].execCommand("setCenter",s.getCenter(),s.getZoom(),l.mapType)):r.execCommand("disconnect")}this.onAddToMap=function(t,e){s=t,e=e||new bt.ControlPosition(bt.ControlPosition.BOTTOM_LEFT,new bt.Point(5,5)),i=Pt("<div />").addClass("YMaps-mini-map"),n=Pt("<a />").addClass("YMaps-button-mini-map-hide").css("z-index",bt.ZIndex.CONTROL).attr("title",kt.hints.miniMap.hide).appendTo(i),o=Pt("<div />").addClass("YMaps-mini-map-map"),i.append(o),At(n[0]).events.add("click",function(){this.setVisible(!this.getVisible())},this),i.appendTo(s.getContainer()),e.apply(i),h=Rt.observe(s,s.Events.Destruct,this.onRemoveFromMap,this),function t(){if(St.webkit&&(0==o[0].offsetWidth||0==o[0].offsetHeight))return void window.setTimeout(function(){t()},100);a=new u(o,{coordSystem:s.coordSystem});a.enableDragging();a.addLayer(new c(s));r=new bt.Executor;var e=new bt.MapConnect(a,r),i=new bt.MapConnect(s,r);r.resources.push(e,i);delete i.events.TypeChange;delete e.events.TypeChange;e.commands.setCenter=function(t,e,i,n){t.data.setCenter(e,i-l.zoomOffset,n)};e.commands.redraw=function(t){t.data.redraw()};e.eventsByCommand.redraw=["Update"];i.events.Redraw=function(t){r.execCommand([t],"redraw")};e.events.Click=function(t,e,i){s.panTo(i.getCoordPoint())};d()}()},Lt(u,bt.Map),u.prototype._restrictCenter=function(t){return t},this.onRemoveFromMap=function(){s&&(h.cleanup(),At(n[0]).events.removeAll(),i.remove(),r.destroy(),h=s=a=r=i=n=o=null)},this.setType=function(t){l.mapType=t,l.visible&&a&&a.setType(t)},this.getType=function(){return l.mapType},this.setVisible=function(t){l.visible!=t&&(l.visible=t,a&&d(),Rt.notify(this,this.Events.VisibilityChange,this))},this.getVisible=function(){return l.visible}},bt.ScaleLine=function(){var o,s,a,r,h;function l(){var t=o.getType();h.css("color",t.getTextColor())}function c(){var t=function(t){var e=o.converter.coordinatesToLocalPixels(o.getCenter()),i=o.converter.localPixelsToCoordinates(new Bt(e.getX()-t/2,e.getY())),n=o.converter.localPixelsToCoordinates(new Bt(e.getX()+t/2,e.getY()));return o.coordSystem.distance(i,n)}(75),e=function(t){var e=Math.round(t).toString();return(Number(e.charAt(0))+1)*Math.pow(10,e.length-1)}(t);r.css("width",parseInt(75*e/t)+"px"),function(t){h.html(t)}(1e3<e?e/1e3+" "+kt.metric.kilometre:e+" "+kt.metric.metre)}this.onAddToMap=function(t,e){o=t,s=e||new bt.ControlPosition(bt.ControlPosition.BOTTOM_RIGHT,new bt.Point(5,37)),r=Pt('<div class="YMaps-scale-line"><span>0</span></div>').css({height:(Pt.boxModel?3:5)+"px","z-index":bt.ZIndex.CONTROL-2}).appendTo(o.getContainer()),h=r.find("span"),s.apply(r[0]),l(),c();var i=Rt.observe,n=o.Events;a=[i(o,n.BoundsChange,c),i(o,n.TypeChange,l)]},this.onRemoveFromMap=function(){o&&(r.remove(),It(a,"cleanup"),o=s=r=h=a=null)}},bt.RouteProviders=new wt.ObjectStorage,bt.RouteProviders.add("yandex#router",{route:function(t,e,i,n){i&&!Pt.isFunction(i)&&(n=i,i=wt.UNDEF);var o={wayPoints:t.wayPoints,viaPoints:t.viaPoints||[],options:Pt.extend({origin:"jsRouter"},t.options)},s={wayPoints:[],routes:[]},a=[R,Y,z,H(e,n)],r=!1;return function t(e){r||(e?H(i,n)(o,s):a.shift()(o,s,t))}(),{abort:function(){r=!0}}}}),bt.Router=function(e,t,i){bt.GeoObjectCollection.call(this),this.setStyle("router#route"),this._isLoaded=0,this._request={wayPoints:e,viaPoints:Pt.grep(t||[],function(t){return 0<t&&t<e.length-1}),options:i||{}},bt.RouteProviders.get("yandex#router").route(this._request,this._onLoad,this._onLoad,this)},(xt=Lt(bt.Router,bt.GeoObjectCollection))._onLoad=function(t){this._isLoaded=1,(t=V(t)).error?Rt.notifyPermanent(this,this.Events.Fault,this,t.error.message):(this._duration=t.duration,this._distance=t.distance,this.add(this._routes=t.routes),this.add(this._wayPoints=t.wayPoints),this._boundedBy=t.boundedBy,Rt.notifyPermanent(this,this.Events.Load,this),this.update(),this._map&&this._request.options.viewAutoApply&&this.applyView(),this._wayPoints.length<this._request.wayPoints.length-this._request.viaPoints.length?Rt.notifyPermanent(this,this.Events.GeocodeError,this,this._wayPoints.length):this._routes.length<this._request.wayPoints.length-this._request.viaPoints.length-1?Rt.notifyPermanent(this,this.Events.RouteError,this,this._routes.length+1):Rt.notifyPermanent(this,this.Events.Success,this))},xt.Events.Load="Load",xt.Events.Fault="Fault",xt.Events.Success="Success",xt.Events.GeocodeError="GeocodeError",xt.Events.RouteError="RouteError",xt.getDistance=function(){return this._distance},xt.getDuration=function(){return this._duration},xt.getNumWayPoints=function(){return this._wayPoints.length},xt.getWayPoint=function(t){var e=this._wayPoints[t];return e||null},xt.getNumRoutes=function(){return this._routes.length},xt.getRoute=function(t){var e=this._routes[t];return e||null},xt.onAddToMap=function(t,e){bt.GeoObjectCollection.prototype.onAddToMap.call(this,t,e),this._isLoaded&&this._request.options.viewAutoApply&&this.applyView()},xt.applyView=function(){this._boundedBy&&this._map&&this._map.setBounds(this._boundedBy)},bt.Styles.add("router#route",{balloonContentStyle:{template:new bt.Template("<div>$[text]</div>")},lineStyle:{strokeColor:"6C00FF99",strokeWidth:5}}),bt.Route=function(t,e,i,n,o,s,a){var r=bt.Polyline.fromEncodedPoints(t,e);Pt.extend(this,r),this.setOptions({interactive:0,hasBalloon:0}),this._boundedBy=i,this._routeSegments=n,this._distance=o,this._duration=s,this._viaPoints=a},(xt=Lt(bt.Route,bt.Polyline)).getDistance=function(){return this._distance},xt.getDuration=function(){return this._duration},xt.getNumRouteSegments=function(){return this._routeSegments.length},xt.getRouteSegment=function(t){return this._routeSegments[t]},xt.getNumViaPoints=function(){return this._viaPoints.length},xt.getViaPoint=function(t){return this._viaPoints[t]},bt.RouteSegment=function(t,e,i,n,o,s){this._indexInPolyline=t,this._distance=e,this._duration=i,this._action=n,this._angle=o,this._street=s},(xt=bt.RouteSegment.prototype).getDistance=function(){return this._distance},xt.getDuration=function(){return this._duration},xt.getAction=function(){return this._action},xt.getStreet=function(){return this._street},xt.getAngle=function(){return this._angle},xt.getPolylineIndex=function(){return this._indexInPolyline},bt.ViaPoint=function(t){this._indexInPolyline=t},(xt=bt.ViaPoint.prototype).getPolylineIndex=function(){return this._indexInPolyline},bt.WayPoint=function(t,e){bt.GeocoderResult.call(this,t,e)},xt=Lt(bt.WayPoint,bt.GeocoderResult),function(t){function a(t,e){return 0<t.x*e.y-t.y*e.x}var l,c,n=200,r=bt.Hotspots={},h=t.Hotspots={},o={maps:[],managers:[]};function u(t,e){l[t]?l[t].push(e):l[t]=[e]}function d(t){setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}o.get=function(t,e){var i=Pt.inArray(t,o.maps);if(-1!=i)return o.managers[i];var n=new h.Manager(t,e);return o.maps.push(t),o.managers.push(n),n},l={},c={},r.Loader={load:function(t,e){var i,n;if(e.key&&Pt.isArray(e.key)){n=e.key;for(var o=0,s=e.key.length;o<s;o++)u(e.key[o],{callback:e.callback[o],context:e.context[o]});i=e.key.join("_").replace(/\W/g,"_")}else u(n=e.key||e.id||Math.random(),e),i=n.replace(/\W/g,"_");!function(e,i){var n=window[i];window[i]=function(t){bt.Hotspots.Loader.onLoad(e,t),window[i]=n}}(n,i),function(t,e,i,n){var o=t+(/\?/.test(t)?"&":"?")+"callback="+i+(n.format?"&format="+n.format:"");tag=Pt.ajax({type:"GET",url:o,cache:n.cache,dataType:"script"}),function(t,e){for(var i=[].concat(t),n=0,o=i.length;n<o;n++)c[i[n]]?c[i[n]].push(e):c[i[n]]=[e]}(e,tag)}(t,n,i,e)},onLoad:function(t,e){for(var i=[].concat(t),n=0,o=i.length;n<o;n++){var s=i[n],a=l[s];if(a){for(var r=0,h=a.length;r<h;r++)a[r].callback&&a[r].callback.call(a[r].context||window,e);delete l[s]}}!function(t){for(var e=[].concat(t),i=0,n=e.length;i<n;i++)c[e[i]]&&d(c[e[i]])}(t)},cancel:function(t){var e="string"==typeof t?t:t.key,i=l[e];if(i)if(t.callback){for(var n=t.callback,o=t.context,s=[],a=0,r=i.length;a<r;a++)i[a].callback==n&&i[a].context==o||s.push(i[a]);s.length?l[e]=s:delete l[e]}else delete l[e]}},h.Loader=r.Loader,(Mt=h.AHotspotShape=function(t){var e,i,n,o,s,a,r=bt.Point;n=s=t[0],o=a=t[1],this._points=[new r(n,o)];for(var h=2;h<t.length-1;h+=2)e=t[h],i=t[h+1],n=Math.min(e,n),o=Math.min(i,o),s=Math.max(e,s),a=Math.max(i,a),this._points.push(new r(e,i));this._minX=n,this._minY=o,this._maxX=s,this._maxY=a}).prototype={setOwner:function(t){this._object=t},getOwner:function(){return this._object},getMinX:function(){return this._minX},getMinY:function(){return this._minY},getMaxX:function(){return this._maxX},getMaxY:function(){return this._maxY},contains:wt.NULL,getNumPoints:function(){return this._points.length},getPoint:function(t){return this._points[t].copy()}},Mt=r.RectShape=function(t){this._minX=Math.min(t[0],t[2]),this._minY=Math.min(t[1],t[3]),this._maxX=Math.max(t[0],t[2]),this._maxY=Math.max(t[1],t[3])},(xt=Lt(Mt,h.AHotspotShape)).contains=function(t){return t.x>=this._minX&&t.y>=this._minY&&t.x<=this._maxX&&t.y<=this._maxY},xt.getNumPoints=xt.getPoint=wt.NULL,Mt=r.CPolyShape=function(t){h.AHotspotShape.call(this,t)},(xt=Lt(Mt,h.AHotspotShape)).contains=function(t){for(var e=this._points,i=e[this._points.length-1].diff(t),n=e[0].diff(t),o=a(i,n),s=1;s<e.length;s++)if(i=n,n=e[s].diff(t),a(i,n)!=o)return 0;return 1},Mt=r.NPolyShape=function(t){h.AHotspotShape.call(this,t)},(xt=Lt(Mt,h.AHotspotShape)).contains=function(t){for(var e,i,n,o,s,a,r=this._points.length,h=this._points[r-1],l=0,c=0;c<r;c++)e=this._points[c],i=t,o=e,s=void 0,a=(n=h).diff(o),!(Math.abs(a.y)<1e-8)&&(s=(i.y-n.y)/a.y,-1e-8<n.x-i.x+s*a.x&&-1e-8<s&&s<1)&&(l=!l),h=e;return l},Mt=h.ShapeContainer=function(t){this.__sortFunction=t,this.__shapes=[],this.__maxWidth=0},(xt=Mt.prototype).add=function(t){for(var e=[],i=0,n=t.length;i<n;i++)for(var o=t[i],s=0,a=o.getNumShapes();s<a;s++){var r=o.getShape(s),h=r.getMaxX()-r.getMinX();e.push(r),h>this.__maxWidth&&(this.__maxWidth=h)}e.sort(function(t,e){return t.getMinX()-e.getMinX()}),this.__shapes=this.__merge(this.__shapes,e)},xt.remove=function(t){for(var e=[],i=0,n=this.__shapes.length;i<n;i++)-1==Pt.inArray(this.__shapes[i].getOwner(),t)&&e.push(this.__shapes[i]);this.__shapes=e},xt.__merge=function(t,e){for(var i=[],n=0,o=0,s=t.length,a=e.length;n<s&&o<a;)t[n].getMinX()<e[o].getMinX()?(i.push(t[n]),n++):(i.push(e[o]),o++);for(;n<s;n++)i.push(t[n]);for(;o<a;o++)i.push(e[o]);return i},xt.clear=function(){this.__shapes=[],this.__maxWidth=0},xt.getShapeInPosition=function(t){if(!this.__shapes.length)return null;for(var e=this.getPosition(t.getX()-this.__maxWidth),i=this.getPosition(t.getX()+1),n=t.x,o=t.y,s=[],a=e;a<i;a++){var r=this.__shapes[a];r.getMinX()<=n&&r.getMaxX()>=n&&r.getMinY()<=o&&r.getMaxY()>=o&&r.contains(t)&&s.push(this.__shapes[a])}return s.length?(s.sort(this.__sortFunction),s[0]):null},xt.getPosition=function(t){return this.__getPosition(0,this.__shapes.length-1,t)},xt.__getPosition=function(t,e,i){var n,o=this.__shapes[t].getMinX(),s=this.__shapes[e].getMinX();return i<=o?t:s<i?e+1:e-t==1?e:((n=t+Math.round((e-t)*(i-o)/(s-o)))==t?n++:n==e&&n--,this.__shapes[n].getMinX()<i?this.__getPosition(n,e,i):this.__getPosition(t,n,i))},Mt=r.Object=function(t,e,i,n){this.__layer=t,this.__data=i||{},"number"!=typeof n&&"string"!=typeof n||(n={priority:parseFloat(n)}),this.__options=Pt.extend({priority:0,style:bt.Styles.DefaultStyleKey},n),this.__shapes=e,It(this.__shapes,"setOwner",this)},(xt=Mt.prototype).getLayer=function(){return this.__layer},xt.getNumShapes=function(){return this.__shapes.length},xt.getShape=function(t){return this.__shapes[t]},xt.getData=function(){return this.__data},xt.getPriority=function(){return this.__options.priority},xt.__getComputedStyle=function(){if(!this.__computedStyle){for(var t=bt.Styles,e=bt.Style.copy(t.get(this.__options.style)||t.get(t.DefaultStyleKey)),i=e.parentStyle;i;)(i=t.get(i))&&(bt.Style.extendStyle(e,i,0),i=i.parentStyle);bt.Style.extendStyle(e,bt.AGeoObject.fullStyle),this.__computedStyle=e}return this.__computedStyle},xt.requestHintData=function(t){t(bt.Templates.get(this.__getComputedStyle().hintContentStyle.template).build(this.__data))},xt.requestBalloonData=function(t,e){t(bt.Templates.get(this.__getComputedStyle().balloonContentStyle.template).build(this.__data),e.getCoordPoint(1))},Mt=h.Manager=function(t,e){this.__map=t,this.__mapLayerContainer=e,this.__layers=[],this.__layerObjects=[],this.__containers=[],this.__overlays=[],this.__overlayShapeContainer=new h.ShapeContainer(function(t,e){return e.getOwner().getOptions().priority-t.getOwner().getOptions().priority}),this.__listeners=[],this.__activeTile={tile:null,zoom:null};var i=t.coordSystem,n=i.getWorldSize(),o=new bt.Point(n.getX()/2,n.getY()/2),s=i.toCoordPoint(o),a=i.toCoordPoint(o.copy().moveBy(n),1),r=i.fromCoordPoint(s,a).diff(o);this.__xCycled=!!r.getX(),this.__yCycled=!!r.getY(),this.__worldSizeInPixels=n.scale(Math.pow(2,t.getZoom()-i.getMaxZoom()))},(xt=Mt.prototype).__getShapeContainer=function(t){var e=t.getOptions().priority,i=this.__containers[e]||new h.ShapeContainer(function(t,e){return e.getOwner().getPriority()-t.getOwner().getPriority()});return this.__containers[e]||(this.__containers[e]=i),i},xt.addLayer=function(t){if(-1==Pt.inArray(t,this.__layers)){this.__layers.length||this.__overlays.length||this.__beginListening(),this.__layers.push(t),this.__layerObjects.push([]);var e=this.__activeTile.tile,i=this.__activeTile.zoom;e&&i&&t.getObjectSource().requestObjects(this.__getLoadListener(t,e,i,1),t,e,i)}},xt.removeLayer=function(t){var e=Pt.inArray(t,this.__layers);-1!=e&&(this.__removeObjects(t),this.__layers.splice(e,1),this.__layerObjects.splice(e,1),this.__layers.length||this.__overlays.length||this.__stopListening())},xt.addOverlay=function(t){-1==Pt.inArray(t,this.__overlays)&&(this.__layers.length||this.__overlays.length||this.__beginListening(),this.__overlays.push(t),this.__overlayShapeContainer.add([t]))},xt.removeOverlay=function(t){var e=Pt.inArray(t,this.__overlays);-1!=e&&(this.__activeShape&&this.__activeShape.getOwner()==t&&this.__leave(),this.__overlays.splice(e,1),this.__overlayShapeContainer.remove([t]),this.__layers.length||this.__overlays.length||this.__stopListening())},xt.__beginListening=function(){var t=this.__map,e=t.Events,i=this;this.__updateMapPixelOffset(),this.__listeners=bt.Events.observe(t,[e.BeforeMouseDown,e.BeforeMouseUp,e.BeforeClick,e.BeforeDblClick],this.__onMouseEvent,this),this.__listeners.push(bt.Events.observe(t,e.BeforeMouseMove,this.__onMoveEvent,this)),Pt.merge(this.__listeners,bt.Events.observe(t,[e.MoveStart,e.SmoothZoomStart,e.Destruct],this.__abortCurrentAction,this)),this.__listeners.push(bt.Events.observe(t,t.Events.BoundsChange,this.__onUpdate,this)),Pt(this.__mapLayerContainer).bind("mouseleave.hs",function(){i.__abortCurrentAction()})},xt.__stopListening=function(){Pt(this.__mapLayerContainer).unbind("mouseleave.hs"),It(this.__listeners,"cleanup"),this.__listeners=[],this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null),this.__lastMoveEvent=null,this.__lastMissedEvent=null},xt.__onMouseEvent=function(t,e){e.isMapEventPrevented()?this.__abortCurrentAction(e):(this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null,this.__processMouseEvent(this.__lastMoveEvent)),this.__processMouseEvent(e)),this.__lastMissedEvent=this.__activeShape||e.isMapEventPrevented()?null:e},xt.__onMoveEvent=function(t,e){var i=this;(this.__lastMoveEvent=e).isMapEventPrevented()?this.__abortCurrentAction(e):(this.__activeShape&&this.__activeShape.contains(this.__getPixelPosition(e))&&this.__notify("mousemove",this.__activeShape,e),this.__moveTickTimeout||(this.__moveTickTimeout=window.setTimeout(function(){i.__processMouseEvent(i.__lastMoveEvent),i.__moveTickTimeout=null},n)))},xt.__onUpdate=function(){this.__updateMapPixelOffset(),this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null),this.__lastMissedEvent=null,this.__lastMoveEvent=null},xt.__updateMapPixelOffset=function(){var t=this.__map,e=t.coordSystem,i=t.getZoom(),n=t.getContainerSize().scale(.5),o=e.fromCoordPoint(t.getCenter()),s=t.tileCoordinates.scale(o,e.getMaxZoom(),i);this.__mapPixelOffset=n.diff(s),this.__worldSizeInPixels=e.getWorldSize().scale(Math.pow(2,i-e.getMaxZoom()))},xt.__getPixelPosition=function(t){var e=t.getLocalPixels().copy().moveBy(this.__mapPixelOffset);return new bt.Point(this.__xCycled?wt.cycleRestrict(e.getX(),0,this.__worldSizeInPixels.getX()-1e-10):e.getX(),this.__yCycled?wt.cycleRestrict(e.getY(),0,this.__worldSizeInPixels.getY()-1e-10):e.getY())},xt.__processMouseEvent=function(t){if(!t.isMapEventPrevented()){var e=this.__getPixelPosition(t),i=this.__map.tileCoordinates,n=i.fromPixels(i.scale(e),this.__map.getZoom()).number;this.__updateActiveTile(n),this.__updateActiveObject(t,e),this.__activeShape&&"mousemove"!=t.getEvent().type&&this.__notify(t.getEvent().type,this.__activeShape,t)}},xt.__updateActiveObject=function(t,e){var i=this.__getActiveShape(e||t.getLocalPixels().copy().moveBy(this.__mapPixelOffset)),n=i?i.getOwner():null;n!=(this.__activeShape?this.__activeShape.getOwner():null)&&(this.__leave(t),n&&(this.__notify("mouseenter",i,t),this.__notify("mousemove",i,t))),this.__activeShape=i},xt.__notify=function(t,e,i){var n=e.getOwner();n.getLayer?bt.Events.notify(n.getLayer(),t,n.getLayer(),n,i,e):bt.Events.notify(n,t,n,i,e)},xt.__getActiveShape=function(t){for(var e=this.__overlayShapeContainer.getShapeInPosition(t),i=e?e.getOwner().getOptions().priority:0,n=this.__containers.length-1;i<=n;n--)if(this.__containers[n]){var o=this.__containers[n].getShapeInPosition(t);if(o){e=o;break}}return e},xt.__updateActiveTile=function(t){var e=this.__map.getZoom(),i=this.__activeTile.zoom!=e;this.__tileEquals(t,this.__activeTile.tile)&&!i||(this.__activeTile={tile:t,zoom:e},this.__updateLayers(),i&&this.__updateOverlays())},xt.__updateLayers=function(){var t,e,i=this.__activeTile.tile,n=this.__activeTile.zoom;for(this.__activeShape&&this.__activeShape.getOwner().getLayer&&this.__leave(),t=0,e=this.__containers.length;t<e;t++)this.__containers[t]&&this.__containers[t].clear();if(i)for(t=0,e=this.__layers.length;t<e;t++)this.__layers[t].getObjectSource().requestObjects(this.__getLoadListener(this.__layers[t],i,n),this.__layers[t],i,n)},xt.__updateOverlays=function(){this.__overlays.length&&(this.__activeShape&&-1!=Pt.inArray(this.__activeShape.getOwner(),this.__overlays)&&this.__leave(),this.__overlayShapeContainer.clear(),this.__overlayShapeContainer.add(this.__overlays))},xt.__getLoadListener=function(e,i,n,o){var s=this;return function(t){-1!=Pt.inArray(e,s.__layers)&&s.__activeTile.tile.equals(i)&&s.__activeTile.zoom==n&&s.__addObjects(e,t,o)}},xt.__abortCurrentAction=function(t){this.__leave(t),this.__moveTickTimeout&&(window.clearTimeout(this.__moveTickTimeout),this.__moveTickTimeout=null),this.__lastMoveEvent=null},xt.__leave=function(t){this.__activeShape&&(this.__notify("mouseleave",this.__activeShape,t||this.__lastMoveEvent),this.__activeShape=null)},xt.__addObjects=function(t,e,i){var n=Pt.inArray(t,this.__layers);if(-1!=n){this.__layerObjects[n]=e,this.__getShapeContainer(t).add(e);var o=this.__lastMissedEvent;o&&!i&&(this.__updateActiveObject(o),this.__activeShape&&(this.__notify(o.getEvent().type,this.__activeShape,o),this.__lastMissedEvent=null)),this.__lastMoveEvent&&!this.__lastMoveEvent.isMapEventPrevented()&&this.__updateActiveObject(this.__lastMoveEvent)}},xt.__removeObjects=function(t){var e=Pt.inArray(t,this.__layers),i=this.__activeShape;-1!=e&&this.__layerObjects[e].length&&(this.__containers[t.getOptions().priority].remove(this.__layerObjects[e]),i&&i.getOwner().getLayer&&i.getOwner().getLayer()==t&&this.__leave()),this.__layerObjects[e]=[]},xt.__tileEquals=function(t,e){return t&&e?t.equals(e):t==e},Mt=r.ObjectSource=function(t,e,i){this.__tileUrlTemplate=t,this.__keyTemplate=e,this.__options=Pt.extend({useBrowserCache:1,useProgramCache:0,programCacheEntries:100,bounds:null,minZoom:0,maxZoom:23},i),this.__options.useProgramCache&&this._enableCache(this.__options.programCacheEntries)},(xt=Mt.prototype).__gStrings=["","G","Ga","Gag","Gaga","Gagar","Gagari","Gagarin"],xt.getOptions=function(){return this.__options},xt.getTileUrl=function(t,e){return this.__tileUrlTemplate.replace("%d",2*(1&t.x)+(1&t.y)+1).replace("%c","x="+t.x+"&y="+t.y+"&z="+e).replace("%g","g="+this.__gStrings[(3*t.x+t.y)%8])},xt.getKey=function(t,e){return this.__keyTemplate.replace("%c","x="+t.x+"&y="+t.y+"&z="+e)},xt.getTileUrlTemplate=function(){return this.__tileUrlTemplate},xt.setTileUrlTemplate=function(t){this.__tileUrlTemplate=t},xt.getKeyTemplate=function(){return this.__keyTemplate},xt.setKeyTemplate=function(t){this.__keyTemplate=t},xt.requestObjects=function(i,n,t,e){if(this.isRestricted(n,t,e))i([]);else{var o=this.getKey(t,e),s=null;this.__options.useProgramCache&&(s=this.getCachedData(o)),s?i(s):r.Loader.load(this.getTileUrl(t,e),{key:o,cache:this.__options.useBrowserCache,callback:function(t){var e=this.parseResponse(n,t);this.__options.useProgramCache&&this.cacheData(o,e),i(e)},context:this})}},xt.isRestricted=function(t,e,i){var n=this.__options;if(i>n.maxZoom)return 1;if(i<n.minZoom)return 1;if(null!==n.bounds){var o=e.copy().moveBy(new bt.Point(.5,.5)).scale(bt.TILE_SIZE),s=t.getMap();if(!s)return 0;var a=s.coordSystem.toCoordPoint(s.tileCoordinates.scale(o));if(!n.bounds.contains(a))return 1}return 0},xt.parseResponse=function(o,t){var s=this,a=o.getMap();return a?Pt.map(t.objects,function(t){var e=t.base||t.center,i=a.tileCoordinates.scale(a.coordSystem.fromCoordPoint(e),a.coordSystem.getMaxZoom(),a.getZoom()),n=Pt.map(t.geometry,function(t){return s.__makeShape(i,t)});return s.createObject(o,n,t.data,{priority:t.priority,style:t.style})}):[]},xt.createObject=function(t,e,i,n){return new r.Object(t,e,i,n)},xt.__shapes={rect:r.RectShape,npoly:r.NPolyShape,cpoly:r.CPolyShape},xt.__makeShape=function(t,e){for(var i=e.shape?e.coords:e,n=t.getX(),o=t.getY(),s=0;s<i.length-1;s+=2)i[s]+=n,i[s+1]+=o;return e.shape?new this.__shapes[e.shape](i):new r.RectShape(i)},(xt=r.ObjectSource.prototype)._enableCache=function(t){this.__cacheCapacity=t,this.clearCache()},xt._disableCache=function(){this.clearCache()},xt.cacheData=function(t,e){this.__cacheEntries[this.__getFreeCachePosition()]=t,this.__cache[t]=e},xt.__getUsedSize=function(){var t=this.__cacheEnd-this.__cacheStart;return 0<=t?t:t+this.__cacheCapacity},xt.__getFreeCachePosition=function(){if(this.__getUsedSize()<this.__cacheCapacity){var t=this.__cacheEnd;return this.__cacheEnd=(this.__cacheEnd+1)%this.__cacheCapacity,t}var e=this.__cacheStart;return delete this.__cache[this.__cacheEntries[e]],this.__cacheEntries[e]=null,this.__cacheStart=(this.__cacheStart+1)%this.__cacheCapacity,this.__cacheEnd=(this.__cacheEnd+1)%this.__cacheCapacity,e},xt.getCachedData=function(t){return typeof this.__cache[t]!=Et?this.__cacheHits++:this.__cacheMisses++,this.__cache[t]},xt.clearCache=function(){this.__cache={},this.__cacheEntries=[],this.__cacheSize=this.__cacheStart=this.__cacheEnd=0,this.__cacheHits=this.__cacheMisses=0},Mt=r.Overlay=function(t,e){this._geometry=t||[],this._options=Pt.extend({},s,e),this.__listeners=[],bt.AInteractiveGeoObject.call(this,this._options),this._hintContent=null,this._hintCustomContent=null,this._hintCustomContentLayout=null,this._balloonContent=null,this._balloonCustomContent=null,this._balloonCustomContentLayout=null},xt=Lt(Mt,bt.AInteractiveGeoObject);var s={interactive:bt.Interactivity.INTERACTIVE,cursor:bt.Cursor.POINTER,priority:0};xt.Events={MouseEnter:"mouseenter",MouseMove:"mousemove",MouseLeave:"mouseleave",MouseDown:"mousedown",MouseUp:"mouseup",Click:"click",DblClick:"dblclick",BalloonOpen:"balloonopen",BalloonClose:"balloonclose"},xt.__shapes={rect:r.RectShape,cpoly:r.CPolyShape,npoly:r.NPolyShape},xt.getGeometry=function(){return this._geometry},xt.setGeometry=function(t){this._geometry=t,this.update()},xt.onAddToMap=function(t){this.__map=t,this.__beginListening(),o.get(t).addOverlay(this)},xt.getMap=function(){return this.__map},xt.__beginListening=function(){var t=this._options.interactive==bt.Interactivity.INTERACTIVE;this.__listeners=[],t&&this.getOptions().hasBalloon&&this.__listeners.push(bt.Events.observe(this,this.Events.Click,this.__onClick)),(t&&this.getOptions().hasHint||this._options.cursor!=bt.Cursor.INHERIT)&&(this.__listeners.push(bt.Events.observe(this,this.Events.MouseEnter,this.__onMouseEnter),bt.Events.observe(this,this.Events.MouseLeave,this.__onMouseLeave)),this.getOptions().hasHint&&t&&this.__listeners.push(bt.Events.observe(this,this.Events.MouseMove,this.__onMouseMove)))},xt.__stopListening=function(){It(this.__listeners,"cleanup"),this.__listeners=[]},xt.getOptions=function(){return Pt.extend(bt.AInteractiveGeoObject.prototype.getOptions.call(this),{priority:this._options.priority,cursor:this._options.cursor,interactive:this._options.interactive})},xt.setOptions=function(t,e){var i=0,n=e?Pt.extend({},s,t):t;if(typeof n.cursor!=Et&&n.cursor!=this._options.cursor){var o=this.__map&&this.__cursorAdded;this.__removeCursor(),this._options.cursor=n.cursor,o&&this.__addCursor(),i=1}typeof n.interactive!=Et&&(this._options.interactive=n.interactive,this.__map&&(i=1)),1==i&&(this.__stopListening(),this.__beginListening()),bt.AInteractiveGeoObject.prototype.setOptions.call(this,n,e),typeof n.priority!=Et&&n.priority!=this._options.priority&&(this._options.priority=n.priority,this.update())},xt.update=function(){var t=this.__map;bt.AInteractiveGeoObject.prototype.update.call(this),t&&(this.onRemoveFromMap(),this.onAddToMap(t))},xt.onRemoveFromMap=function(){this.closeBalloon(),this.__hideHint(0),this.__removeCursor(),o.get(this.__map).removeOverlay(this),It(this.__listeners,"cleanup"),this.__map=null},xt.getNumShapes=function(){return this.__map?this._geometry.length:0},xt.getShape=function(t){for(var e=this._geometry[t],i=e.shape?e.coords:e,n=this.__map,o=n.coordSystem,s=n.getZoom(),a=o.getMaxZoom(),r=n.tileCoordinates,h=[],l=0,c=i.length;l<c;l++){var u=r.scale(o.fromCoordPoint(i[l]),a,s);h.push(u.x,u.y)}var d=new this.__shapes[e.shape||"rect"](h);return d.setOwner(this),d},xt.onMapUpdate=wt.NULL,xt.__onClick=function(t,e,i){var n=this;e.preventMapEvent(),this.__map.openBalloon(e.getCoordPoint(),this._getBalloonContentLayout(),Pt.extend({},this.getBalloonOptions(),{onClose:function(){n.__onBalloonClose()}})),this.__balloonOpened=1,this.__hintShown&&this.__map.hint.hide(),bt.Events.notify(this,this.Events.BalloonOpen,this)},xt.__onBalloonClose=function(){this.__balloonOpened=0,bt.Events.notify(this,this.Events.BalloonClose,this)},xt.__onMouseEnter=function(t,e){this.getOptions().hasHint&&this._options.interactive==bt.Interactivity.INTERACTIVE&&this.__showHint(e.getLocalPixels()),this.__addCursor()},xt.__showHint=function(t){var e=this;this.__map.hint.show(t,this._getHintContentLayout(),Pt.extend({},this.getHintOptions(),{onHide:function(){e.__onHintHide()}})),this.__hintShown=1},xt.__addCursor=function(){var t=this._options.cursor;t&&t!=bt.Cursor.INHERIT&&!this.__cursorAdded&&(this.__map.addCursor(t),this.__cursorAdded=1)},xt.__onHintHide=function(){this.__hintShown=0},xt.__onMouseLeave=function(){this.__hideHint(),this.__removeCursor()},xt.__hideHint=function(t){this.__hintShown&&this.__map.hint.hide(t)},xt.__removeCursor=function(){this.__cursorAdded&&(this.__map.removeCursor(this._options.cursor),this.__cursorAdded=0)},xt.__onMouseMove=function(t,e){this.__hintShown?this.__map.hint.moveTo(e.getLocalPixels()):this.__showHint(e.getLocalPixels())},xt.openBalloon=function(t,e,i){if(this.__map){this.closeBalloon(),bt.AInteractiveGeoObject.prototype.openBalloon.call(this,t,e);var n=this;this.__map.openBalloon(i||this.__getBalloonPoint(),this._getBalloonContentLayout(),Pt.extend({},this.getBalloonOptions(),{onClose:function(){e&&e.onClose&&e.onClose(),n.__onBalloonClose()}})),this.__balloonOpened=1,bt.Events.notify(this,this.Events.BalloonOpen,this)}},xt.closeBalloon=function(){this.__balloonOpened&&this.__map.closeBalloon()},xt.__getBalloonPoint=function(){var t=this.__map.coordSystem;if(!this._geometry.length)return t.getCoordPoint(0,0);for(var e=this._geometry[0].coords?this._geometry[0].coords:this._geometry[0],i=0,n=0,o=e.length,s=0;s<o;s++)i+=e[s].getX(),n+=e[s].getY();return t.getCoordPoint(i/o,n/o)},xt.getBalloon=function(){return this.__map&&this.__balloonOpened?this.__map.getBalloon():null},xt.setBalloonOptions=function(t){bt.AInteractiveGeoObject.prototype.setBalloonOptions.call(this,t),this.__balloonOpened&&this.__map.getBalloon().setOptions(this._getComputedBalloonOptions(),1)},xt.setHintOptions=function(t,e){bt.AInteractiveGeoObject.prototype.setHintOptions.call(this,t,e),this.__hintShown&&this.__map.hint.setOptions(this._getComputedHintOptions(),e)},xt.setHintContent=function(t){this._hintCustomContent=t,this._hintCustomContentLayout=wt.normalizeContent(t),this._hintContent=null},xt.getHintContent=function(){return this._hintCustomContent},xt._getHintContentLayout=function(){return this._hintContent||(this._hintCustomContentLayout?this._hintContent=this._hintCustomContentLayout:this._hintContent=bt.Templates.get(this.getComputedStyle().hintContentStyle.template).build(this)),this._hintContent},xt.setBalloonContent=function(t){this._balloonCustomContent=t,this._balloonCustomContentLayout=wt.normalizeContent(t),this._balloonContent=null},xt.getBalloonContent=function(){return this._balloonCustomContent},xt._getBalloonContentLayout=function(){return this._balloonContent||(this._balloonContent=this._balloonCustomContentLayout||bt.Templates.get(this.getComputedStyle().balloonContentStyle.template).build(this)),this._balloonContent},Mt=r.Layer=function(t,e){this._options=Pt.extend({},p,e),this._objectSource=t,this.__cursorAdded=0},xt=Mt.prototype;var p={interactive:bt.Interactivity.INTERACTIVE,cursor:bt.Cursor.POINTER,priority:0,hasHint:1,hintOptions:{},hasBalloon:1,balloonOptions:{}};xt.Events={MouseEnter:"mouseenter",MouseMove:"mousemove",MouseLeave:"mouseleave",MouseDown:"mousedown",MouseUp:"mouseup",Click:"click",DblClick:"dblclick",BalloonOpen:"balloonopen",BalloonClose:"balloonclose"},xt.getObjectSource=function(){return this._objectSource},xt.getOptions=function(){return this._options},xt.setOptions=function(t,e){var i=e?Pt.extend({},p,t):t,n=typeof i.interactive!=Et&&this._options.interactive!=i.interactive;if(n&&this._options.interactive==bt.Interactivity.INTERACTIVE&&(this._options.hasHint&&this._disableHint(),this._options.hasBalloon&&this._disableBalloon()),this._setHintOptions(i),this._setBalloonOptions(i),n&&(this._options.interactive=i.interactive),n&&this._options.interactive==bt.Interactivity.INTERACTIVE&&(this._options.hasHint&&this._enableHint(),this._options.hasBalloon&&this._enableBalloon()),this._setCursorOptions(i),typeof i.priority!=Et&&i.priority!=this._options.priority){var o=this.getMap();o&&o.removeLayer(this),this._options.priority=i.priority,o&&o.addLayer(this)}},xt.update=function(){var t=this.__map;t&&(t.removeLayer(this),t.addLayer(this))},xt.getMap=function(){return this.__map},xt.onAddToMap=function(t,e){this.__map=t,this._layerManager=o.get(t,e),this._layerManager.addLayer(this),this._options.hasHint&&this._options.interactive==bt.Interactivity.INTERACTIVE&&this._enableHint(),this._options.hasBalloon&&this._options.interactive==bt.Interactivity.INTERACTIVE&&this._enableBalloon(),this._enableCursor()},xt.onRemoveFromMap=function(){this._layerManager.removeLayer(this),this._options.hasHint&&this._options.interactive==bt.Interactivity.INTERACTIVE&&this._disableHint(),this._options.hasBalloon&&this._options.interactive==bt.Interactivity.INTERACTIVE&&this._disableBalloon(),this._disableCursor(),this.__map=null},xt.onMapUpdate=xt.onSmoothZoomStart=xt.onSmoothZoomTick=xt.onMove=xt.onSmoothZoomEnd=xt.getCopyright=xt.getZoomRange=wt.NULL,(xt=r.Layer.prototype)._enableHint=function(){this.__mouseEventListeners=[bt.Events.observe(this,this.Events.MouseEnter,this.__onMouseEnter),bt.Events.observe(this,this.Events.MouseMove,this.__onMouseMove),bt.Events.observe(this,this.Events.MouseLeave,this.__onMouseLeave)],this.__hintDataIsReady=0,this.__hintPosition=null,this.__hintObject=null},xt._disableHint=function(){this.__hintObject&&this._hideHint(),It(this.__mouseEventListeners,"cleanup"),this.__mouseEventListeners=[]},xt._setHintOptions=function(t){var e=this,i=this.__hintObject,n=this.getMap();typeof t.hintOptions!=Et&&(this._options.hintOptions=t.hintOptions,n&&this.__hintObject&&this.__hintDataIsReady&&n.hint.setOptions(Pt.extend({},this._options.hintOptions,{onHide:function(){e.__onHideHint(i)}}))),typeof t.hasHint!=Et&&t.hasHint!=this._options.hasHint&&(n&&this._options.hasHint&&this._disableHint(),this._options.hasHint=t.hasHint,n&&t.hasHint&&this._enableHint())},xt.__onMouseEnter=function(t,e,i,n){var o=this;this.__hintObject=e,this.__hintPosition=i.getLocalPixels(),this.__hintDataIsReady=0,e.requestHintData(function(t){e!=o.__hintObject||o.__hintDataIsReady||o.__onLoadHintData(t)},i,n)},xt.__onMouseMove=function(t,e,i){this.__hintPosition=i.getLocalPixels(),this.__hintObject==e&&this.__hintDataIsReady&&this._moveHint(this.__hintPosition)},xt.__onMouseLeave=function(t,e){this.__hintObject==e&&this._hideHintIfVisible()},xt.__onLoadHintData=function(t){this.__hintDataIsReady=1;var e=this,i=this.__hintObject;this._showHint(t,function(){e.__onHideHint(i)}),this.__hintObject=i},xt.__onHideHint=function(t){this.__hintObject==t&&(this.__hintObject=null)},xt._showHint=function(t,e){this.getMap().hint.show(this.__hintPosition,t,Pt.extend({},this._hintOptions,{onHide:e}))},xt._moveHint=function(t){this.getMap().hint.moveTo(t)},xt._hideHint=function(){this.getMap().hint.hide()},xt._hideHintIfVisible=function(){this.__hintObject&&this.__hintDataIsReady&&this._hideHint(),this.__hintObject=null},(xt=r.Layer.prototype)._enableBalloon=function(){var t=this.getMap();this.__balloonListeners=[bt.Events.observe(this,this.Events.Click,this.__onClick),bt.Events.observe(t,t.Events.BalloonOpen,this.__onBalloonOpen,this),bt.Events.observe(this,this.Events.MouseDown,this.__onMouseDown)],this.__dragListeners=[bt.Events.observe(t,t.Events.BeforeMouseMove,function(){bt.Events.notify(t,t.Events.MouseDown,t,this.__lastMouseDown),It(this.__dragListeners,"disable"),this.__lastMouseDown=null},this,0),bt.Events.observe(t,t.Events.BeforeMouseUp,function(t,e){e.preventMapEvent(),It(this.__dragListeners,"disable"),this.__lastMouseDown=null},this,0)],this.__balloonInitEvent={object:null,dataIsReady:0,shape:null,event:null,canceled:0},this.__balloonOpened=0},xt._disableBalloon=function(){if(It(this.__balloonListeners,"cleanup"),It(this.__dragListeners,"cleanup"),this.__lastMouseDown){var t=this.getMap();bt.Events.notify(t,t.Events.MouseDown,t,this.__lastMouseDown),this.__lastMouseDown=null}this.__balloonListeners=[],this._closeBalloon()},xt._setBalloonOptions=function(t){var e=this.getMap();typeof t.balloonOptions!=Et&&(this._options.balloonOptions=t.balloonOptions,e&&this.__balloonOpened&&e.getBalloon().setOptions(Pt.extend(this._options.balloonOptions,{onClose:this.__getBalloonCloseListener(this.__balloonInitEvent)}))),typeof t.hasBalloon!=Et&&t.hasBalloon!=this._options.hasBalloon&&(e&&this._options.hasBalloon&&this._disableBalloon(),this._options.hasBalloon=t.hasBalloon,e&&t.hasBalloon&&this._enableBalloon())},xt.__getBalloonCloseListener=function(t){var e=this;return function(){bt.Events.notify(e,e.Events.BalloonClose,e,t.object),t.object=null,e.__balloonOpened=0}},xt.__onClick=function(t,i,n,e){var o=this;n.preventMapEvent(),this.__balloonInitEvent.object!=i&&(this.__balloonInitEvent={object:i,dataIsReady:0,event:n,shape:e,canceled:0},i.requestBalloonData(function(t,e){o.__balloonInitEvent.object!=i||o.__balloonInitEvent.canceled||o.__onLoadBalloonData(t,e||n.getCoordPoint(1))},n,e))},xt.__onMouseDown=function(t,e,i){(this.__lastMouseDown=i).preventMapEvent(),It(this.__dragListeners,"enable")},xt.__onLoadBalloonData=function(t,e){this.__balloonInitEvent.dataIsReady=1,this._openBalloon(t,e,this.__getBalloonCloseListener(this.__balloonInitEvent))},xt._openBalloon=function(t,e,i){this._options.hasHint&&this._hideHintIfVisible(),this.getMap().openBalloon(e,t,Pt.extend({},this._options.balloonOptions,{onClose:i})),this.__balloonOpened=1;var n=this.__balloonInitEvent;bt.Events.notify(this,this.Events.BalloonOpen,this,n.object,n.event,n.shape)},xt._closeBalloon=function(){this.__balloonOpened&&this.getMap().closeBalloon(),this.__balloonInitEvent.canceled=1},xt.__onBalloonOpen=function(){this.__balloonInitEvent.canceled=1},(xt=r.Layer.prototype)._enableCursor=function(){this.__cursorAdded=0,this.__cursorListeners=[bt.Events.observe(this,this.Events.MouseEnter,this.__addCursor),bt.Events.observe(this,this.Events.MouseLeave,this.__removeCursor)]},xt._disableCursor=function(){this.__removeCursor()},xt._setCursorOptions=function(t){if(typeof t.cursor!=Et){var e=this.__cursorAdded;e&&this.__removeCursor(),this._options.cursor=t.cursor,e&&this.__addCursor()}},xt.__addCursor=function(){var t=this._options.cursor;this.getMap()&&!this.__cursorAdded&&(t!=bt.Cursor.INHERIT&&this.getMap().addCursor(t),this.__cursorAdded=1)},xt.__removeCursor=function(){var t=this._options.cursor,e=this.getMap();e&&this.__cursorAdded&&(t!=bt.Cursor.INHERIT&&window.setTimeout(function(){e.removeCursor(t)},0),this.__cursorAdded=0)}}(Ct),I=bt.Metro={},function(){var t=new bt.Template("<div>$[text]</div>");bt.Templates.add("metro#stationBalloonTemplate",t);var e=new bt.Style;e.balloonContentStyle={template:"metro#stationBalloonTemplate"},bt.Styles.add("metro#station",e)}(),Mt=I.Closest=function(t,e){bt.GeoObjectCollection.call(this,"metro#station"),e=e||{},this.request=t,this.found=0,this.prefLang=e.prefLang||null;var i=new bt.Size(e.span?Math.min(e.span.getX(),1):.1,e.span?Math.min(e.span.getY(),1):.1);bt.GeocodeProviders.get("yandex#map").geocode(t,{boundedBy:bt.GeoBounds.fromCenterAndSpan(t,i),kind:"metro",origin:"jsClosestMetro",prefLang:e.prefLang,results:e.results,skip:e.skip},bt.Utils.bindContext(this.__successCallback,this),bt.Utils.bindContext(this.__failureCallback,this))},(xt=bt.Utils.extend(Mt,bt.GeoObjectCollection)).Events.Load="Load",xt.Events.Fault="Fault",xt.__successCallback=function(t){this.found=t.found,this.add(Pt.map(t.results,this.__createStation)),bt.Events.notifyPermanent(this,this.Events.Load,this)},xt.__failureCallback=function(t){bt.Events.notifyPermanent(this,this.Events.Fault,this,t)},xt.__createStation=function(t){var e=new bt.Metro.Station(t.getGeoPoint());return e.AddressDetails=t.AddressDetails,e.setBounds(t.getBounds()),e.text=t.text,e},Mt=I.Station=function(t,e){bt.Placemark.call(this,t,e),this.text="",this.AddressDetails=null},bt.Utils.extend(Mt,bt.Placemark),function(){var d=Pt.browser,r=bt.Point,h=bt.Events;function l(t,e,i){bt.dom(t).events.add(e,i)}function i(t,e,i){bt.dom(t).events.remove(e,i)}var t={DEFAULT_MAX_WIDTH:520,DEFAULT_MAX_HEIGHT:100,DEFAULT_MIN_WIDTH:56,DEFAULT_MIN_HEIGHT:15,CLOSE_BUTTON_WIDTH:20,SIDE_BORDER_WIDTH:12,TAIL_HEIGHT:14},e=Ct.versionPath+"i/0.4/plainstyle",o={balloon:{close:""}},c=Mt=function(t,e){this._context=t,this._map=e,this._parentNode=null};(u=Mt.prototype)._setContent=function(t,e){this._contentLayout&&this._contentLayout.onRemoveFromParent(),t&&t.onAddToParent(e),this._contentLayout=t},u.getRootNodes=function(){return this._$elements},u.onAddToParent=function(t){this._parentNode=t,Pt(t).append(this._$elements)},u.onRemoveFromParent=function(){this._parentNode=null,this._$elements.removeFromDom()},function(){function t(t,o){function e(t,e){c.call(this,t,e);var i='<ymaps:balloon class="YMaps-balloon-small YMaps-balloon-small_'+o+'">                    <ymaps:balloon-content></ymaps:balloon-content>                    <ymaps:balloon-tail class="YMaps-border"></ymaps:balloon-tail>                    <ymaps:balloon-tail></ymaps:balloon-tail>                </ymaps:balloon>',n=this._$elements=Pt(i);this._nodes={visContainer:n,content:n.find("ymaps\\:balloon-content"),tail:n.find("ymaps\\:balloon-tail")}}function i(t,e){this._context=t,this._map=e,this._content=null,this._parentNode=null}(u=Lt(e,c)).onAddToParent=function(t){c.prototype.onAddToParent.call(this,t),this.update()},u.update=function(){var t=this._nodes.visContainer;t.css({visibility:"hidden",width:790}),d.opera&&t.css("overflow","hidden"),this._nodes.content.css({overflow:"",width:"auto",height:"auto",float:"left"});var e=wt.size(this._nodes.content);"mac"==Pt.os.name&&Pt.browser.mozilla&&e.x++,e.x=Math.min(790,Math.max(s,e.x))+3,e.y=Math.max(17,e.y),wt.size(this._nodes.content[0],e),this._nodes.content.css({overflow:"hidden",float:""}),d.opera&&t.css("overflow",""),t.css({left:-(e.x+4)/2+1,visibility:"",width:""})},u.setContent=function(t){this._setContent(t,this._nodes.content);var e=this;wt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()})},u.getOffset=function(){return new r(0,0)},(u=i.prototype).onAddToParent=function(t){this._parentNode=t,this._getLayout().onAddToParent(t)},u.onRemoveFromParent=function(){this._parentNode=null,this._getLayout().onRemoveFromParent()},u.update=function(){this._getLayout().update()},u.getRootNodes=function(){return this._getLayout().getRootNodes()},u.setContent=function(t){if(this._content!=t){var e=this._parentNode;!this._content!=!(this._content=t)?(e&&this._getLayout().onRemoveFromParent(),this._currentLayout=null,this._getLayout(),t&&this._currentLayout.setContent(t),e&&this._currentLayout.onAddToParent(this._parentNode)):this._currentLayout.setContent(t)}},u._getLayout=function(){return this._currentLayout||(this._content?this._currentLayout=new e(this._context,this._map):this._currentLayout=new a(this._context,this._map)),this._currentLayout},u.getOffset=function(){return this._currentLayout.getOffset()};var n=new bt.LayoutTemplate(i);return bt.Templates.add("plain#"+t+"PointIcon",n),n}var s=d.msie&&d.quirksMode?26:13;t("black","black"),t("blue","blue"),t("lightblue","blue-l"),t("darkblue","blue-d"),t("brown","brown"),t("green","green"),t("darkgreen","green-d"),t("grey","grey"),t("night","night"),t("orange","orange"),t("darkorange","orange-d"),t("pink","pink"),t("violet","violet"),t("white","white"),t("red","red"),t("yellow","yellow");var a=function(t,e){c.call(this,t,e);this.__getStyleData();this._$elements=Pt(d.msie&&d.version<7?"<div />":"<img />")};(u=Lt(a,c)).__getStyleData=function(){return this._context.getComputedStyle().iconStyle},u.onAddToParent=function(t){c.prototype.onAddToParent.call(this,t),this.update()},u.update=function(){var t=this.__getStyleData();d.msie&&d.version<7?this._$elements.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+(t&&t.href)+"', sizingMethod='scale')","line-height":"0px"}):this._$elements[0].src=t&&t.href,t.size&&wt.size(this._$elements[0],t.size)},u.setContent=wt.NULL,u.getOffset=function(){return this.__getStyleData().offset||new r(0,0)}}();function n(t,e){c.call(this,t,e);var i=this._$elements=Pt('<ymaps:balloon class="YMaps-balloon-full YMaps-balloon-full_hint">            <ymaps:balloon-inner>                <ymaps:balloon-content></ymaps:balloon-content>            </ymaps:balloon-inner>        </ymaps:balloon>');this._nodes={visContainer:i,inner:i.find("ymaps\\:balloon-inner"),content:i.find("ymaps\\:balloon-content")},this._topNode=i[0],this._size=null,this._hasContent=!1}var a=new r(12,12);(u=Lt(n,c)).DEFAULT_MIN_WIDTH=42,u.update=function(){if(this._parentNode&&this._hasContent){var t=this._nodes.content,e=this._maxSize,i=this._nodes.visContainer;i.css("width","10000px"),t.css({width:"",height:"",overflow:"",float:"left"}),this._nodes.inner.css("width","auto");var n=t.width();"mac"==Pt.os.name&&Pt.browser.mozilla&&n++;var o=n+a.getX();e[0]&&o>e[0]?o=e[0]:o<this.DEFAULT_MIN_WIDTH&&(o=this.DEFAULT_MIN_WIDTH),o=Math.max(0,o-a.getX()),t.css("width",o),this._nodes.inner.css("width",o+"px");var s=t.height()+a.getY();e[1]&&s>e[1]&&(s=e[1]),s=Math.max(0,s-a.getY()),t.css({height:s,overflow:"hidden",float:""}),i.css("width","").addClass("YMaps-fake").removeClass("YMaps-fake")}},u.setMaxSize=function(t,e){this._maxSize=[t,e]},u.setContent=function(t){if(this._setContent(t,this._nodes.content[0]),t){this._$elements.css("display","");var e=this;wt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update()}),this._hasContent=!0}else this._$elements.css("display","none"),this._hasContent=!1;this._size=null},u.getSize=function(){return this._size||(this._size=wt.size(this._nodes.visContainer[0])),this._size},bt.Templates.add("plain#hint",new bt.LayoutTemplate(n));function s(t,e,i){c.call(this,t,e);var n=this._$elements=Pt('<ymaps:balloon class="YMaps-balloon-full YMaps-balloon-full_close">                <ymaps:balloon-inner>                    <ymaps:balloon-content></ymaps:balloon-content>                </ymaps:balloon-inner>                <ymaps:balloon-tail class="YMaps-border"></ymaps:balloon-tail>                <ymaps:balloon-tail></ymaps:balloon-tail>                <ymaps:balloon-close></ymaps:balloon-close>            </ymaps:balloon>');this.__balloon=i,this._nodes={topNode:n[0],visContainer:n[0],contentParent:n.find("ymaps\\:balloon-inner"),content:n.find("ymaps\\:balloon-content")[0],$close:n.find("ymaps\\:balloon-close"),$eventBlockNode:n.find("ymaps\\:balloon-tail").add(n.find("ymaps\\:balloon-inner"))},this._nodes.$eventBlockNode=this._nodes.$eventBlockNode.add(this._nodes.$close),this._nodes.$close[0].title=o.balloon.close}var u=Lt(s,c),p="YMaps-balloon-content-overflow-hidden";u.onAddToParent=function(t){var e;Pt(t).append(this._$elements),d.mozilla&&(this._ffObservers=[],this._ffObservers.push(h.observe(this._map,this._map.Events.MoveStart,function(){e||(e=1,Pt(this._nodes.content).addClass(p))},this)),this._ffObservers.push(h.observe(this._map,this._map.Events.MoveEnd,function(){e&&(Pt(this._nodes.content).removeClass(p),e=0)},this)));var n=this,o=this._nodes.$close[0],s=o.childNodes[0];this.__contextMenuHandler=function(t){new bt.MouseEvent(t,n._map).preventMapEvent()},l(this._nodes.content,"contextmenu",this.__contextMenuHandler),this.__mouseEventHandler=function(t){var e=t.target,i=new bt.MouseEvent(t,n._map);"click"!=t.type||!n._closeCallback||e!=o&&e!=s||n._closeCallback(t),"contextmenu"!=t.type||i.isMapEventPrevented()||t.preventDefault(),i.preventMapEvent()};for(var i=0,a=this._nodes.$eventBlockNode.length;i<a;i++)l(this._nodes.$eventBlockNode[i],["click","dblclick","mouseup","mousedown","mousemove","wheel"],this.__mouseEventHandler);this.update()},u.onRemoveFromParent=function(){this._updateTimeout&&(window.clearTimeout(this._updateTimeout),this._updateTimeout=null),this._ffObservers&&(It(this._ffObservers,"cleanup"),this._ffObservers=null),Pt(this._nodes.content).removeClass(p),i(this._nodes.content,"contextmenu",this.__contextMenuHandler);for(var t=0,e=this._nodes.$eventBlockNode.length;t<e;t++)i(this._nodes.$eventBlockNode[t],["click","dblclick","mouseup","mousedown","mousemove","wheel"],this.__mouseEventHandler);this._$elements.removeFromDom()},u.DEFAULT_MAX_WIDTH=t.DEFAULT_MAX_WIDTH,u.DEFAULT_MAX_HEIGHT=t.DEFAULT_MAX_HEIGHT,u.DEFAULT_MIN_WIDTH=t.DEFAULT_MIN_WIDTH,u.DEFAULT_MIN_HEIGHT=t.DEFAULT_MIN_HEIGHT,u.CLOSE_BUTTON_WIDTH=t.CLOSE_BUTTON_WIDTH,u.TAIL_HEIGHT=t.TAIL_HEIGHT,u.update=function(){if(this.__balloon&&this.__balloon._map&&this.__balloon._map._state){var t,e,i=this._nodes.visContainer,n=this._nodes.content,o=Pt(n),s=this._maxSize[0],a=this._maxSize[1],r=o.hasClass(p),h=this._nodes.contentParent;if(o.css("float","left"),r&&o.removeClass(p),wt.size(i,1e4),h.css("width",""),Pt(i).css("visibility","hidden"),o.css({overflow:"auto",width:"auto",height:"auto"}),d.opera&&Pt(i).css("overflow","hidden"),!s||!a){var l=this._map.getContainerSize();s=s||Math.max(this.DEFAULT_MAX_WIDTH,l.x-60),a=a||(250<l.y?l.y-100:this.DEFAULT_MAX_HEIGHT)}if(o.css("maxWidth",s),t=Math.max(n.scrollWidth,n.offsetWidth)>s,null!=a&&(d.opera&&o.css("overflow","hidden"),o.css("maxHeight",a),e=Math.max(n.scrollHeight,n.offsetHeight)>a),t&&d.opera&&o.css("overflow","auto"),d.safari&&this._$elements[0].offsetParent==document.body){var c=this;this._updateTimeout=window.setTimeout(function(){c._updateTimeout=null,c.update()},100)}else{var u=wt.size(n);"mac"==Pt.os.name&&Pt.browser.mozilla&&(u.x=Math.min(s,u.x+1)),u.y=Math.max(u.y,this.DEFAULT_MIN_HEIGHT),u.x=Math.max(u.x,this.DEFAULT_MIN_WIDTH),o.css({width:u.x,height:u.y,overflow:t||e?"auto":"hidden",float:""}),r&&o.addClass(p),d.opera&&Pt(i).css("overflow",""),Pt(i).css({width:"",height:"",visibility:""}).css("left",-this.getSize().x/2+1+"px")}}},u.moveTo=function(t){wt.position(this._nodes.topNode,t)},u.setMaxSize=function(t,e){this._maxSize=[t,e]},u.getOffset=function(){var t=this.getSize();return new r(-(t.x-(this._closeCallback?this.CLOSE_BUTTON_WIDTH:0))/2,1-t.y)},u.getSize=function(){return wt.size(this._nodes.visContainer).moveBy(new r(2,this.TAIL_HEIGHT+2))},u.enableClose=function(t){this._closeCallback=t,Pt(this._nodes.visContainer).addClass("YMaps-balloon-full_close")},u.disableClose=function(){this._closeCallback&&(this._closeCallback=null),Pt(this._nodes.visContainer).removeClass("YMaps-balloon-full_close")},u.setContent=function(t){this._setContent(t,this._nodes.content);var e=this;wt.imagesOnLoad(this._nodes.content,function(){e.update()},function(t){0==t&&e.update(),e.__balloon&&"function"==typeof e.__balloon.mapAutoPan&&e.__balloon.getOptions().mapAutoPan&&e.__balloon.mapAutoPan()})},bt.Templates.add("plain#balloon",new bt.LayoutTemplate(s));for(var _,f,m=["black","blue","brown","darkblue","darkgreen","darkorange","green","grey","lightblue","night","orange","pink","red","violet","white","yellow"],v=0,g=m.length;v<g;v++)_=m[v],f=void 0,(f=new bt.Style(null)).iconStyle={offset:new r(-11,-25),href:e+"placemarks/"+_+".png",size:new r(27,26),shadow:null,template:"plain#"+_+"PointIcon"},f.balloonStyle={template:"plain#balloon"},f.hintStyle={template:"plain#hint"},bt.Styles.add("plain#"+_+"Point",f);var y=new bt.Style("plain#whitePoint");y.iconStyle={href:e+"placemarks/nashlos.png"},bt.Styles.add("plain#nashlos",y)}(),bt.MapType.PMAP=bt.MapType.MAP,bt.MapType.PHYBRID=bt.MapType.HYBRID,bt.GeocodeProviders.add("yandex#pmap",{geocode:function(t,e,i,n){n("http://clubs.ya.ru/mapsapi/58473")}}),function(){var l=bt.Regions={},s=Ct.PolygonPoints;l.RegionHotspot=function(t,e){bt.Hotspots.Overlay.call(this,t,e),this._highlightRegion=e&&void 0!==e.highlightRegion?e.highlightRegion:1,this._listeners=[bt.Events.observe(this,this.Events.MouseEnter,this._addPolygons,this),bt.Events.observe(this,this.Events.MouseLeave,this._removePolygons,this)]};(e=Lt(l.RegionHotspot,bt.Hotspots.Overlay)).getGeometry=function(){var t=bt.Hotspots.Overlay.prototype.getGeometry.call(this);return t.length||(t=this._decodeGeometry(),this.setGeometry(t)),t},e._decodeGeometry=function(){var t=[];this.metaDataProperty.polygonPoints=[];for(var e=0,i=this.metaDataProperty.encodedShapes.length;e<i;e++){var n=this.metaDataProperty.encodedShapes[e],o=new s;o.setEncodedPoints(n.coords,n.levels,new bt.GeoCoordSystem),t.push({shape:"npoly",coords:o.getPoints()}),this.metaDataProperty.polygonPoints.push(o)}return t},e.onAddToMap=function(t){this.getGeometry(),bt.Hotspots.Overlay.prototype.onAddToMap.call(this,t)},e._addPolygons=function(){if(this._highlightRegion){var t=this.metaDataProperty.polygons;if(t)t.setStyle(this.getComputedStyle());else{var e=this.metaDataProperty.polygonPoints,i=0,n=e.length;for(t=new bt.GeoObjectCollection(this.getComputedStyle());i<n;i++)t.add(new bt.Polygon(e[i],{interactive:bt.Interactivity.NONE}));this.metaDataProperty.polygons=t}this.getMap().addOverlay(t)}},e._removePolygons=function(){var t=this.metaDataProperty.polygons;t&&this.getMap().removeOverlay(t)},e.setOptions=function(t,e){t&&void 0!==t.highlightRegion?this._highlightRegion=t.highlightRegion:e&&(this._highlightRegion=1),bt.Hotspots.Overlay.prototype.setOptions.call(this,t,e)},e.getOptions=function(){var t=bt.Hotspots.Overlay.prototype.getOptions.call(this);return t.highlightRegion=this._highlightRegion,t};var t=l.RegionCollection=function(t){bt.GeoObjectCollection.call(this,t),this._hotspotListeners=[],bt.Events.observe(this,this.Events.Add,this._onHotspotAdd,this),bt.Events.observe(this,this.Events.Remove,this._onHotspotRemove,this)},e=Lt(t,bt.GeoObjectCollection);bt.jQuery.extend(e.Events,{MouseEnter:"mouseenter",MouseMove:"mousemove",MouseLeave:"mouseleave",MouseDown:"mousedown",MouseUp:"mouseup",Click:"click",DblClick:"dblclick",BalloonOpen:"balloonopen",BalloonClose:"balloonclose"}),e._onHotspotAdd=function(n,o,t){var e=[];for(var i in this.Events)o.Events.hasOwnProperty(i)&&e.push(function(i){return bt.Events.observe(o,i,function(t,e){bt.Events.notify(n,i,n,o,e)})}(o.Events[i]));this._hotspotListeners[t]=e},e._onHotspotRemove=function(t,e,i){wt.callMethod(this._hotspotListeners.splice(i,1)[0],"cleanup")},l.load=function(t,r){var e=t.toUpperCase(),i=Ct.versionPath+"xml/regions/getRegion.xml?region="+t+"&v="+Ct.fullVersion,h=new bt.Style;h.polygonStyle=new bt.PolygonStyle,h.polygonStyle.fillColor={BY:"918f7180",KZ:"a2a68180",RU:"b2a2a180",UA:"b2a17b80"}[e],h.polygonStyle.outline=!1,h.hasHint=!0,h.hasBalloon=!1,l.Loader.load(i,{key:e+"regions",cache:!0,callback:function(t){var e=t.regionCode&&t.regions;if(e){var i=new l.RegionCollection(h);i.name=t.regionCode;for(var n=0,o=t.regions.length;n<o;n++){var s=t.regions[n],a=new bt.Regions.RegionHotspot([]);a.name=s.name,a.metaDataProperty.encodedShapes=s.shapes,i.add(a)}}r(e?bt.State.SUCCESS:bt.State.FAILURE,i||t)}})},l.Loader=bt.Hotspots.Loader}(),function(){function t(t){this._context=t,this._element=Pt('<div><div style="text-align: center; padding-top: 2px; font-size: 14px"></div></div>'),this.update()}var r=bt.RouterEditor={},s=bt.Events;t.prototype={onAddToParent:function(t){this._element.appendTo(t)},onRemoveFromParent:function(){this._element.remove()},setContent:function(t){this._content&&this._content.onRemoveFromParent(),t&&t.onAddToParent(this._element.children()[0]),this._content=t},update:function(){var t,e=this._context.getComputedStyle(),i=e.iconContentStyle,n=e.iconStyle;(t=Pt.browser.msie&&Pt.browser.version<7?{filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+n.href+'",sizingMethod="scale")'}:{backgroundImage:"url("+n.href+")"}).width=n.size.x+"px",t.height=n.size.y+"px",this._element.css(t).children().css({color:i.color,width:i.width+"px"})}},bt.Templates.add("router#icon",new bt.LayoutTemplate(t)),bt.Styles.add("router#viaPoint",{iconStyle:{href:Ct.versionPath+"i/0.4/router-editor/via.png",size:new bt.Point(18,19),offset:new bt.Point(-9.5,-10)}}),bt.Styles.add("router#wayPoint",{hasBalloon:!0,iconContentStyle:{color:"white",width:21},iconStyle:{template:"router#icon",size:new bt.Point(27,26),href:Ct.versionPath+"i/0.4/plainstyle/placemarks/red.png"}}),r.RouteProviders=new wt.ObjectStorage,r.RouteProviders.add("yandex#router",{route:function(t,e,i,n){return t.options=Pt.extend(t.options,{origin:"jsRouterEditor",minWayPoints:1}),bt.RouteProviders.get("yandex#router").route(t,e,i,n)}}),r.RouterResultHelper=function(t){this._cachedRoutes=[],this._routerResult=t,this._routerRequest=t.request,this._routerResponse=t.response},r.RouterResultHelper.prototype={getDistance:function(){return this._routerResponse.distance},getDuration:function(){return this._routerResponse.duration},getBounds:function(){var t=this._routerResponse.boundedBy;return t?new bt.GeoBounds(new bt.GeoPoint(t[0][0],t[0][1]),new bt.GeoPoint(t[1][0],t[1][1])):null},getNumWayPoints:function(){var t=this._routerResponse.wayPoints;return t?t.length:0},getWayPoint:function(t){var e=this._routerResponse.wayPoints;return e&&e[t]},getRouterRequest:function(){return this._routerRequest},getRouterResponse:function(){return this._routerResponse},getRouterResult:function(){return this._routerResult},getNumRoutes:function(){var t=this._routerResponse.routes;return t?t.length:0},getRoute:function(t){var e,i,n,o,s=this._cachedRoutes,a=this._routerResponse.routes;return s[t]?s[t]:(e=a&&a[t])?(i=Pt.map(e.routeSegments,function(t){return new bt.RouteSegment(t.indexInPolyline,t.distance,t.duration,t.action,t.angle,t.street)}),n=new bt.GeoBounds(new bt.GeoPoint(e.boundedBy[0][0],e.boundedBy[0][1]),new bt.GeoPoint(e.boundedBy[1][0],e.boundedBy[1][1])),o=Pt.map(e.viaPoints,function(t){return new bt.ViaPoint(t.indexInPolyline)}),s[t]=new bt.Route(e.encodedPoints,e.levels,n,i,e.distance,e.duration,o)):void 0},hasAllRoutes:function(){return this.getNumWayPoints()-this.getNumRoutes()==1}};function n(t){t=t||{},this._map=null,this._activeRoute=null,this._routes=[],this._pmCursor=new bt.Placemark(new bt.GeoPoint(0,0),{draggable:!0,style:t.cursorStyle||"router#viaPoint",hasHint:!!t.cursorHintContent,zIndexHover:bt.ZIndex.OVERLAY-1,hasBalloon:!1}),this._visible=!1,t.cursorHintContent&&this._pmCursor.setHintContent(t.cursorHintContent),this._observers={routeMouseEnter:[],routeMouseMove:[],routeMouseLeave:[],pmCursorMouseMove:[],pmCursorMouseLeave:[],pmDragStart:[],pmDragEnd:[]}}n.prototype={Events:{DragStart:"DragStart",DragEnd:"DragEnd"},enable:function(){var n=this._pmCursor,e=this._observers,o=this;Pt.each(this.getRoutes(),function(t,i){i.setOptions({interactive:1}),e.routeMouseEnter.push(s.observe(i,i.Events.MouseEnter,function(t,e){this._hideCursorTimeout&&(clearTimeout(this._hideCursorTimeout),delete this._hideCursorTimeout),this._showAt(i,e.getGeoPoint())},o)),e.routeMouseMove.push(s.observe(i,i.Events.MouseMove,function(t,e){this._hideCursorTimeout&&(clearTimeout(this._hideCursorTimeout),delete this._hideCursorTimeout),this._showAt(i,e.getGeoPoint())},o)),e.routeMouseLeave.push(s.observe(i,i.Events.MouseLeave,function(){this._hideCursorTimeout=setTimeout(function(){n.metaDataProperty.mouseOverCursor||o.hide()},100)},o))}),e.pmCursorMouseMove.push(s.observe(n,n.Events.MouseMove,function(t,e){n.metaDataProperty.mouseOverCursor=!0,this._showAt(this._activeRoute,this._activeRoute.getClosestPoint(e.getGeoPoint()).point)},this)),e.pmCursorMouseLeave.push(s.observe(n,n.Events.MouseLeave,function(){delete n.metaDataProperty.mouseOverCursor,this.hide()},this)),e.pmDragStart.push(s.observe(n,n.Events.DragStart,function(t){this._doWithObservers(["routeMouseEnter","routeMouseMove","routeMouseLeave","pmCursorMouseMove","pmCursorMouseLeave"],"disable"),s.notify(this,this.Events.DragStart,t,this,this._activeRoute)},this)),e.pmDragEnd.push(s.observe(n,n.Events.DragEnd,function(t){s.notify(this,this.Events.DragEnd,t,this,this._activeRoute)},this))},_doWithObservers:function(t,i){var n=this._observers;Pt.each(t,function(t,e){wt.callMethod(n[e],i),"cleanup"==i&&(n[e]=[])})},disable:function(){this._doWithObservers(["routeMouseEnter","routeMouseMove","routeMouseLeave","pmCursorMouseMove","pmCursorMouseLeave","pmDragStart","pmDragEnd"],"cleanup")},show:function(){this._setVisible(!0)},hide:function(){this._setVisible(!1)},setMap:function(t){this._map=t},getMap:function(){return this._map},setRoutes:function(t){this._routes=t},getRoutes:function(){return this._routes},_setVisible:function(t){var e=this._pmCursor,i=this._map;this._visible!=t&&((this._visible=t)?i.addOverlay(e):i.removeOverlay(e))},_showAt:function(t,e){this.show(),this._pmCursor.setGeoPoint(e),this._activeRoute=t}},r.DragAndDropEditor=function(t,e){this._model=t,this._options=e||{},this._options.maxPoints=void 0===this._options.maxPoints?2:+this._options.maxPoints,this._map=null,this._isDrawing=!1,this._editorPoints=[],this._routerResultHelper=null,this._routerResultVisible=!1,this._routeProviderHandler=null,this._cursor=new n({cursorStyle:this._options.cursorStyle,cursorHintContent:this._options.cursorHintContent}),s.observe(this._cursor,this._cursor.Events.DragStart,this._onCursorDragStart,this),s.observe(this._cursor,this._cursor.Events.DragEnd,this._onCursorDragEnd,this),s.observe(this._model,this._model.Events.RouterResultChange,this._onRouterResultChange,this);var i=this._model.getRouterResult();i&&this._setRouterResult(i)},r.DragAndDropEditor.prototype={_onRouterResultChange:function(t){this._destroyRouterResult(),this._setRouterResult(t)},_destroyRouterResult:function(){this._cursor.hide(),this._cursor.disable(),this._setRouterResultVisible(!1),this._destroyPoints(),this._abortRouteProviderHandler(),this._routerResultHelper=null},_setRouterResult:function(t){this._routerResultHelper=new r.RouterResultHelper(t),this._createPoints(),this._setRouterResultVisible(!0),this._cursor.setRoutes(this._getRoutes()),this._cursor.enable()},_abortRouteProviderHandler:function(){this._routeProviderHandler&&(this._routeProviderHandler.abort(),this._routeProviderHandler=null)},_setRouterResultVisible:function(i){var n=this._map;n&&this._routerResultVisible!=i&&(Pt.each(this._editorPoints,function(t,e){i?e.show(n):e.hide(n)}),Pt.each(this._getRoutes(),function(t,e){i?n.addOverlay(e):n.removeOverlay(e)}),this._routerResultVisible=i)},_destroyPoints:function(){wt.callMethod(this._editorPoints,"cleanup"),this._editorPoints=[]},_getPointIndex:function(t){for(var e=this._editorPoints,i=e.length;i--;)if(e[i]==t)return i;return-1},_onCursorDragStart:function(t,e,i){this._abortRouteProviderHandler(),this._viaPointIndex=this._calculateViaPointIndex(t.getGeoPoint(),i)},_onCursorDragEnd:function(t,e,i){this._update("addPoint",t.getGeoPoint(),!0,this._viaPointIndex)},_calculateViaPointIndex:function(t,i){var n=i.getClosestPoint(t).index,o=0;return Pt.each(this._editorPoints,function(t,e){e.getRoute()==i&&i.getClosestPoint(e.getGeoPoint()).index<n&&(o=t)}),o+1},_onPointDragStart:function(t,e){this._abortRouteProviderHandler()},_onPointDragEnd:function(t,e){this._update("editPoint",e.getGeoPoint(),t.isVia(),this._getPointIndex(t))},_onPointDblClick:function(t,e){t.isVia()&&this._update("deletePoint",e.getGeoPoint(),!0,this._getPointIndex(t))},_addObserversToPoint:function(t){return t.addObserver(t.Events.DragStart,this._onPointDragStart,this),t.addObserver(t.Events.DragEnd,this._onPointDragEnd,this),t.addObserver(t.Events.DblClick,this._onPointDblClick,this),t},_createPoints:function(){for(var t,e,i,n=[],o=this._routerResultHelper,s=o.hasAllRoutes(),a=0,r=o.getNumWayPoints();a<r;a++)if(e=o.getRoute(a==r-1?a-1:a),(i=(t=c.fromRouterResultWayPoint(o.getWayPoint(a))).getLabel())&&(this._options.onWayPointUpdate?this._options.onWayPointUpdate(a,i):i.setIconContent(63<a?a-63:String.fromCharCode(1040+a)),t.setRoute(e),this._addObserversToPoint(t)),n.push(t),a<r-1&&s)for(var h=0,l=e.getNumViaPoints();h<l;h++)t=new c({geoPoint:e.getPoint(e.getViaPoint(h).getPolylineIndex()),via:!0,viaPointHintContent:this._options.viaPointHintContent,route:e}),n.push(this._addObserversToPoint(t));this._editorPoints=n},_replaceRouterResult:function(t){this._model.setRouterResult(t)},_getRoutes:function(){var t,e=this._routerResultHelper,i=[];if(!e)return i;for(var n=0,o=e.getNumRoutes();n<o;n++)(t=e.getRoute(n)).setStyle("router#route"),i.push(t);return i},onAddToMap:function(t,e){this._map=t,this._cursor.setMap(t),this._setRouterResultVisible(!0)},onRemoveFromMap:function(){this._setRouterResultVisible(!1),this._map=null},_update:function(t,e,i,n){var o=this._convertToRouteProviderFormat(t,e,i,n),s=function(t){this._replaceRouterResult(t)},a=function(t){};this._cursor.disable(),"addPoint"==t&&i?(s=function(t){new r.RouterResultHelper(t).hasAllRoutes()?this._replaceRouterResult(t):(this._cursor.enable(),this._cursor.hide())},a=function(t){this._cursor.enable(),this._cursor.hide()}):"editPoint"==t&&i&&(s=function(t){var e=new r.RouterResultHelper(t).hasAllRoutes(),i=this._editorPoints[n];e?this._replaceRouterResult(t):i.getLabel().setGeoPoint(i.getGeoPoint())},a=function(t){var e=this._editorPoints[n];e.getLabel().setGeoPoint(e.getGeoPoint())}),this._abortRouteProviderHandler(),this._routeProviderHandler=this._model.getRouteProvider().route(o,s,a,this)},_convertToRouteProviderFormat:function(t,e,i,n){if("clear"==t)return{wayPoints:[],viaPoints:[],options:this._routerResultHelper&&this._routerResultHelper.getRouterRequest().options};var o=this._editorPoints.slice(),s=[],a=[],r="deletePoint"==t?[n,1]:[n,"addPoint"==t?0:1,new c({geoPoint:e,via:i})];return Array.prototype.splice.apply(o,r),Pt.each(o,function(t,e){s.push(e.toRouteProviderPoint()),e.isVia()&&a.push(t)}),{wayPoints:s,viaPoints:a,options:this._routerResultHelper&&this._routerResultHelper.getRouterRequest().options}},clear:function(){this._update("clear")},startDrawing:function(){var t=this._map;t&&!this._isDrawing&&this._options.maxPoints&&(this._isDrawing=!0,t.addCursor(bt.Cursor.ARROW),this._mapClickObserver?this._mapClickObserver.enable():this._mapClickObserver=s.observe(t,t.Events.Click,function(t,e){var i=0;Pt.each(this._editorPoints,function(t,e){e.isVia()||i++}),i<this._options.maxPoints&&this._update("addPoint",e.getGeoPoint(),!1,this._editorPoints.length),i+1>=this._options.maxPoints&&this.stopDrawing()},this))},stopDrawing:function(){this._isDrawing&&(this._isDrawing=!1,this._mapClickObserver.disable(),this._map.removeCursor(bt.Cursor.ARROW))}},r.RouterModel=function(t){t=t||{},this._routeProvider=r.RouteProviders.get(t.routeProvider||"yandex#router"),this._routerResult=null},r.RouterModel.prototype={Events:{RouterResultChange:"RouterResultChange"},setRouterResult:function(t){this._routerResult=t,s.notify(this,this.Events.RouterResultChange,t)},getRouterResult:function(){return this._routerResult},getRouteProvider:function(){return this._routeProvider}};var c=function(t){this._geocoderText=t.geocoderText,this._request=t.request,this._geoPoint=t.geoPoint,this._via=!!t.via,this._viaPointHintContent=t.viaPointHintContent,this._route=t.route,this._labelObservers=[],this._observers=[],this._visible=!1,this._createLabel()};c.prototype={Events:{DragStart:"DragStart",DragEnd:"DragEnd",DblClick:"DblClick"},isVia:function(){return this._via},getGeoPoint:function(){return this._geoPoint},setGeoPoint:function(t){this._geocoderText=null,this._request=null,this._geoPoint=t},setRoute:function(t){this._route=t},getRoute:function(){return this._route},show:function(t){t&&!this._visible&&this._label&&(this._visible=!0,t.addOverlay(this._label))},hide:function(t){t&&this._visible&&this._label&&(this._visible=!1,t.removeOverlay(this._label))},getLabel:function(){return this._label},addObserver:function(t,e,i){this._observers.push(s.observe(this,t,e,i))},cleanup:function(){wt.callMethod(this._labelObservers,"cleanup"),wt.callMethod(this._observers,"cleanup")},_createLabel:function(){if(this._geoPoint){var t=this._via,e=this._viaPointHintContent,i=new bt.Placemark(this._geoPoint,{draggable:!0,style:t?"router#viaPoint":"router#wayPoint",hasBalloon:!t,hasHint:t&&!!e}),n=this._labelObservers;t?(e&&i.setHintContent(e),n.push(s.observe(i,i.Events.DragStart,function(t){s.notify(this,this.Events.DragStart,this,t)},this),s.observe(i,i.Events.DragEnd,function(t){s.notify(this,this.Events.DragEnd,this,t)},this),s.observe(i,i.Events.DblClick,function(t){s.notify(this,this.Events.DblClick,this,t)},this))):(i.name=this._geocoderText||this._geoPoint.toString(),n.push(s.observe(i,i.Events.DragEnd,function(t){s.notify(this,this.Events.DragEnd,this,t)},this))),this._label=i}},toRouteProviderPoint:function(){return this._geoPoint&&!this._geocoderText?this._geoPoint:this._request}},c.fromRouterResultWayPoint=function(t){var e={request:t.request};return"ok"==t.status&&(e.geoPoint=new bt.GeoPoint(t.data.point[0],t.data.point[1]),"geocoder"==t.data.type&&(e.geocoderText=t.data.text)),new c(e)}}(),function(t){function s(t,e){if(t.getTop()>e.getBottom()&&t.getBottom()<e.getTop()){var i,n,o,s;if(s=t.getLeft()>e.getLeft()?(i=t.getLeft(),n=e.getLeft(),o=t.getRight(),e.getRight()):(i=e.getLeft(),n=t.getLeft(),o=e.getRight(),t.getRight()),o<i&&(o+=360),s<n&&(s+=360),n<=i&&i<=s)return 1;if(n+360<=o&&o<=s+360)return 1}return 0}function i(t,e){var i,n,o=[],s=[];for(i=0,n=t.length;i<n;i++)-1==Pt.inArray(t[i],e)&&s.push(t[i]);for(i=0,n=e.length;i<n;i++)-1==Pt.inArray(e[i],t)&&o.push(e[i]);return{equals:!o.length&&!s.length,added:o,removed:s}}function a(t,e){for(var i in t)t.hasOwnProperty(i)&&typeof e[i]!=Et&&("object"==typeof e[i]?Pt.extend(!0,t[i],e[i]):t[i]=e[i]);return t}function h(t){return t&&0!=parseInt(t)?1==parseInt(t)?t.toString()+"&#160;"+M.strings.points[0]:parseInt(t)<5?t.toString()+"&#160;"+M.strings.points[1]:t.toString()+"&#160;"+M.strings.points[2]:"0&#160;"+M.strings.points[2]}function e(t){return t>=M.localTrafficMinZoom}function r(t,e){return t+":"+(e<10?"0":"")+e}function l(t,e){for(var i=new bt.GeoObjectCollection,n=0,o=t.length;n<o;n++){var s=y.coverage.getRegionById(t[n].regionId);if(s){var a=new bt.Placemark(s.view.point);a.name=s.name,a.stat=t[n],t[n].nodata?a.setStyle(e.nodata):a.setStyle(e[t[n].style||"nolevel"]),i.add(a)}}return i}var u,d,c=wt.browser,y=t.Traffic={},p=bt.Hotspots.Loader,_="YMaps-display-none",n=bt.Traffic={},f={Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6},m=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];d=bt.dom?(u=function(t,e,i){bt.dom(t).events.add(e,i)},function(t,e,i){bt.dom(t).events.remove(e,i)}):(u=function(t,e,i){Pt(t).bind("string"==typeof e?e:e.join(" "),i)},function(t,e,i){Pt(t).bind("string"==typeof e?e:e.join(" "),i)});var o,v,g=t.trafficHost,b=t.trafficArchiveHost,C=t.versionPath+"i/0.4/"+"traffic/semaphores/",M={coverageUrl:g+"trf/coverage.js",regionsStatUrl:g+"trf/stat.js",archiveVersionUrl:b+"version.js",archiveCounterUrl:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=70774/rnd=%u/*https://maps.yandex.ru/",archiveStatUrl:b+"trf/%r/%s/stat.js",updateTimeout:12e4,compactForm:!1,hotspotsCacheSize:100,regionContentTemplate:"traffic#regionContent",semaphoreStyles:{red:"traffic#red",yellow:"traffic#yellow",green:"traffic#green",nodata:"traffic#nodata",nolevel:"traffic#nolevel"},layers:{baseUrl:g+"1.1/tiles?%l&%c&%t",key:"%c&%l&%t",jams:{png:"trf",js:"trj",layerOptions:{hintOptions:{hideTimeout:1e3,maxWidth:150},balloonOptions:{hasCloseButton:0},cursor:"pointer",priority:0,hasHint:1,hasBalloon:1,interactive:bt.Interactivity.INTERACTIVE}},info:{png:"trfe",js:"trje",layerOptions:{cursor:"pointer",priority:1,hasHint:1,hasBalloon:1,interactive:bt.Interactivity.INTERACTIVE,balloonOptions:{maxWidth:350}}},archive:{baseUrl:b+"tiles?%l&%c&%v&%t",key:"%c&%l&%t&%v",png:"trf",js:"trj",layerOptions:{hintOptions:{hideTimeout:1e3,maxWidth:150},balloonOptions:{hasCloseButton:0},cursor:"pointer",priority:0,hasHint:1,hasBalloon:0,interactive:bt.Interactivity.INTERACTIVE}},image:{layerOptions:{zIndex:5}}},providers:{traffic:{urlTemplate:g+"description?%l&%t&id=%j&lang=ru_RU",keyTemplate:"jamInfo-%j",hintContentTemplate:"traffic#jamsHintContent",balloonContentTemplate:"traffic#jamsBalloonContent",counters:{show:"https://clck.yandex.ru/jclck/dtype=stred/pid=443/cid=70634/path=show/rnd=%u/*https://maps.yandex.ru/",click:"https://clck.yandex.ru/jclck/dtype=stred/pid=443/cid=70634/path=click/rnd=%u/*https://mobile.yandex.ru/maps?api=web",infoLayer:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=71334/path=turn_%s/rnd=%u/*https://maps.yandex.ru/"}},"traffic-events":{urlTemplate:g+"description?%l&%t&id=%j&lang=ru_RU",keyTemplate:"traffic-events-%j",hintContentTemplate:"traffic#infoHintContent",balloonContentTemplate:"traffic#infoBalloonContent",counters:{load:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=70596/path=%p/rnd=%u/*https://maps.yandex.ru/",links:"https://clck.yandex.ru/jclck/dtype=stred/pid=30/cid=70603/path=%p/rnd=%u/*https://maps.yandex.ru/"},regionsEnabled:["2","10174"]}},strings:{toCity:" ",instruction:",   ",noRegionData:" &#160; ",jams:"",points:["","",""],length:"",kmh:"/",blocked:" ",infoLayer:" ",time:"",times:"",address:"",description:"",source:"",providers:{"traffic#actual":"","traffic#archive":""},archiveDataText:"   .",daysOfWeek:["","","","","","",""],noTimeZone:"   "},globalTraffic:{icons:{red:{href:C+"styles/red.png",iconOffset:new bt.Point(-13,-39),iconSize:new bt.Point(25,39)},yellow:{href:C+"styles/yellow.png",iconOffset:new bt.Point(-13,-39),iconSize:new bt.Point(25,39)},green:{href:C+"/styles/green.png",iconOffset:new bt.Point(-13,-39),iconSize:new bt.Point(25,39)},nodata:{href:C+"/styles/nodata.png",iconOffset:new bt.Point(-13,-39),iconSize:new bt.Point(25,39)},nolevel:{href:C+"/styles/nolevel.png",iconSize:new bt.Point(8,20),iconOffset:new bt.Point(-4,-20)}}},timeScale:{markers:[0,4,8,12,16,20,24],step:12,sliderSize:6,dragUpdateTimeout:500},localTrafficMinZoom:8,showRegionZoom:10,trafficTypes:[{color:"brown",tag:" "},{color:"red",tag:""},{color:"yellow",tag:" "},{color:"green",tag:""}],trafficButton:{icons:{beta:{on:{href:C+"3lights-on.png",size:new bt.Point(11,19)},off:{href:C+"3lights-off.png",size:new bt.Point(11,19)}},full:{red:{href:C+"small-lights/red.png",size:new bt.Point(22,18)},yellow:{href:C+"small-lights/yellow.png",size:new bt.Point(22,18)},green:{href:C+"small-lights/green.png",size:new bt.Point(22,18)},nodata:{href:C+"small-lights/grey.png",size:new bt.Point(22,18)},off:{href:C+"small-lights/grey.png",size:new bt.Point(22,18)}}}}};function x(t){y.coverage.regions=t.regions,y.coverage.state=bt.State.SUCCESS;for(var e=0,i=o.length;e<i;e++)o[e]()}y.AutoUpdater=function(t,e){var i,n,o,s=0;function a(){i=window.setTimeout(function(){i=null,n=bt.Events.observe(o,o.Events.MouseMove,r)},t)}function r(){n.cleanup(),n=null,e(),a()}this.enable=function(t){s||(s=1,o=t,a())},this.disable=function(){s&&(s=0,o=null,i&&(window.clearTimeout(i),i=null),n&&(n.cleanup(),n=null))}},bt.TrafficLoader={onLoad:bt.Hotspots.Loader.onLoad},o=[],y.coverage={regions:[],state:bt.State.EMPTY,load:function(t){this.state==bt.State.SUCCESS?t():(o.push(t),this.state==bt.State.EMPTY&&(this.state=bt.State.LOADING,p.load(M.coverageUrl,{key:"coverage",callback:x,cache:0})))},getRegionById:function(t){for(var e=0,i=this.regions.length;e<i;e++)if(this.regions[e].regionId==t)return this.regions[e];return null},getRegionsByBounds:function(t){for(var e,i=[],n=0,o=this.regions.length;n<o;n++)e=this.regions[n],s(e.boundedBy,t)&&i.push(e);return i}},y.TimeZone={get:function(t,e,i){e.call(i||window,y.TimeZone.UNKNOWN,!1)},UNKNOWN:"unknown"},Mt=y.ABaseLayout=function(t,e){this._context=t,this.__map=e,this._parentNode=null},(xt=Mt.prototype)._setContent=function(t,e){this._contentLayout&&this._contentLayout.onRemoveFromParent(),t&&t.onAddToParent(e),this._contentLayout=t},xt.getRootNodes=function(){return this._$elements},xt.onAddToParent=function(t){this._parentNode=t,Pt(t).append(this._$elements)},xt.onRemoveFromParent=function(){this._parentNode=null,this._$elements.removeFromDom()},function(){for(var t,e,i,a=y.ABaseLayout,n=M.globalTraffic,o=["red","yellow","green","nodata","nolevel"],s=0;s<o.length;s++)t=o[s],i=void 0,e=n.icons[t],(i=new bt.Style).iconStyle=new bt.IconStyle,i.iconStyle.offset=e.iconOffset,i.iconStyle.size=e.iconSize,i.iconStyle.href=e.href,i.balloonContentStyle=new bt.BalloonContentStyle(M.regionContentTemplate),bt.Styles.add("traffic#"+t,i);function r(t){var e=t.stat,i=typeof e.level!=Et;this.__master=t,this._$elements=Pt(e?'<div class="YMaps-b-traffic-balloon'+(i?" YMaps-b-traffic-balloon_level":"")+'"><h3>'+t.name+'</h3><div class="YMaps-inner">'+(i?'<i class="YMaps-traffic YMaps-traffic_'+e.style+'"></i><h4>'+M.strings.jams+" "+h(e.level)+"</h4><p>"+e.localTime+" "+e.hint+"</p>":"")+'<p class="YMaps-zoom"><a class="YMaps-b-pseudo-link" href="javascript:void(0)"><span>'+M.strings.toCity+"</span></a>"+M.strings.instruction+"</p></div></div>":'<div class="YMaps-b-traffic-balloon"><div class="YMaps-inner"<i class="YMaps-traffic"></i><h4>'+t.name+'</h4><p class="YMaps-access">'+M.strings.noRegionData+"</p></div></div>")}(xt=Lt(r,a)).onAddToParent=function(t){a.prototype.onAddToParent.call(this,t);var e=this.__master.getMap(),i=this.__master.getCoordPoint();this.__clickListener=function(t){e.setCenter(i,M.showRegionZoom),t.stopPropagation(),t.preventDefault(),e.closeBalloon()};for(var n=this._$elements.find("a"),o=0,s=n.length;o<s;o++)u(n[o],"click",this.__clickListener)},xt.onRemoveFromParent=function(){for(var t=this._$elements.find("a"),e=0,i=t.length;e<i;e++)d(t[e],"click",this.__clickListener);a.prototype.onRemoveFromParent.call(this)},bt.Templates.add("traffic#regionContent",new bt.LayoutTemplate(r))}(),function(){function t(t){var e=(this._data=t).content;this._$elements=Pt("<span>"+(e&&"0"!=e?e:M.strings.blocked)+"</span>")}var o=y.ABaseLayout;(xt=Lt(t,o)).onAddToParent=function(t){o.prototype.onAddToParent.call(this,t);var e=this._data,i=e.object.getLayer(),n=i.getOptions();n.hasBalloon&&n.interactive==bt.Interactivity.INTERACTIVE&&this._$elements.addClass("YMaps-cursor-pointer").bind("click",function(){bt.Events.notify(i,i.Events.Click,i,e.object,e.event,e.shape)})},xt.onRemoveFromParent=function(){o.prototype.onRemoveFromParent.call(this),this._$elements.unbind("click")},bt.Templates.add("traffic#jamsHintContent",new bt.LayoutTemplate(t));function e(t,e){var i=parseInt(t.type),n=t.from?t.from+(t.to?"&nbsp; "+t.to:"")+"<br/>":"",o=t.region?'<div class="YMaps-b-traffic-tip__location">'+t.region+"</div>":"";this._$elements=Pt('<div class="YMaps-b-traffic-tip YMaps-b-traffic-tip_'+s[i]+'" style="width: 250px"><div class="YMaps-b-traffic-tip__round"><i class="YMaps-b-round YMaps-b-round_4"><i class="YMaps-l YMaps-t"><i></i></i><i class="YMaps-r YMaps-t"><i></i></i></i><div class="YMaps-b-traffic-tip__round-i"><h3 class="YMaps-b-traffic-tip__title">'+(t.speed?t.speed+" "+M.strings.kmh:M.strings.blocked)+'</h3><i class="YMaps-b-traffic-tip__close YMaps-cursor-pointer"></i></div><i class="YMaps-b-round YMaps-b-round_4"><i class="YMaps-l YMaps-b"><i></i></i><i class="YMaps-r YMaps-b"><i></i></i></i></div>'+o+'<div class="YMaps-b-traffic-tip__distance">'+n+M.strings.length+": "+bt.humanDistance(t.length)+"</div></div>"),this._$elements.find(".YMaps-b-traffic-tip__close").bind("click",function(t){e.closeBalloon(),new bt.MouseEvent(t,e).preventMapEvent()})}var s=["brown","red","yellow","green"];Lt(e,o),bt.Templates.add("traffic#jamsBalloonContent",new bt.LayoutTemplate(e))}(),function(){function t(t){this._data=t,this._$elements=Pt("<span>"+t.content+"</span>")}var n=M.strings,o=y.ABaseLayout,s=[" ",""," "," ","",""];(xt=Lt(t,o)).onAddToParent=function(t){o.prototype.onAddToParent.call(this,t);var e=this._data,i=e.object.getLayer(),n=i.getOptions();n.hasBalloon&&n.interactive==bt.Interactivity.INTERACTIVE&&this._$elements.addClass("YMaps-cursor-pointer").bind("click",function(){bt.Events.notify(i,i.Events.Click,i,e.object,e.event,e.shape)})},xt.onRemoveFromParent=function(){o.prototype.onRemoveFromParent.call(this),this._$elements.unbind("click")},bt.Templates.add("traffic#infoHintContent",new bt.LayoutTemplate(t));function e(t){var e='<div class="YMaps-b-traffic-info-balloon YMaps-b-traffic-info-balloon_'+t.type+'"><h3 class="YMaps-b-traffic-info-balloon__title">'+s[t.type]+'</h3><p class="YMaps-b-traffic-info-balloon__parameter">'+(t.startTime&&t.endTime?"<strong>"+n.times+":</strong> "+t.startTime+" - "+t.endTime:"<strong>"+n.time+":</strong> "+t.startTime)+"</p>"+(t.district?'<p class="YMaps-b-traffic-info-balloon__parameter"><strong>'+n.address+": </strong>"+t.district+"</p>":"")+(t.description?'<p class="YMaps-b-traffic-info-balloon__parameter"><strong>'+n.description+":</strong> "+t.description+"</p>":"")+(t.href?'<i class="YMaps-b-traffic-info-balloon__separator"></i><p class="YMaps-b-traffic-info-balloon__copyright YMaps-b-traffic-info-balloon__parameter">'+n.source+': <a href="'+t.href+'" target="_blank">'+(t.localizedSource||t.href)+"</a></p>":t.localizedSource?'<i class="YMaps-b-traffic-info-balloon__separator"></i><p class="YMaps-b-traffic-info-balloon__copyright YMaps-b-traffic-info-balloon__parameter">'+n.source+": "+t.localizedSource+"</p>":"");this._$elements=Pt(e);var i=M.providers["traffic-events"].counters.links.replace("%p",t.source).replace("%u",+new Date);this._$elements.find("a").bind("click",function(){Pt.ajax({url:i,cache:!0,dataType:"script"})})}(xt=Lt(e,o)).onRemoveFromParent=function(){o.prototype.onRemoveFromParent.call(this),this._$elements.find("a").unbind("click")},bt.Templates.add("traffic#infoBalloonContent",new bt.LayoutTemplate(e))}(),Mt=y.TrafficObject=function(){bt.Hotspots.Object.apply(this,arguments)},(xt=Lt(Mt,bt.Hotspots.Object)).requestHintData=function(t,e,i){t(bt.Templates.get(M.providers[this.getData().provider].hintContentTemplate).build({content:this.getData().description,event:e,object:this,shape:i}))},xt.requestBalloonData=function(i){var n=this.getLayer().getMap(),o=M.providers[this.getData().provider].balloonContentTemplate,s=this.getData().point;this.getLayer().getObjectSource().requestObjectData(this,function(t){var e=bt.Templates.get(o).build(t,n);i(e,s)})},Mt=y.MultiObjectSource=function(t,e,i){bt.Hotspots.ObjectSource.call(this,t,e,i),this.__layers=[],this.__layerIds=[]},(xt=Lt(Mt,bt.Hotspots.ObjectSource)).addLayer=function(t,e){-1==Pt.inArray(e,this.__layers)&&(this.__layers.push(e),this.__layerIds.push(t))},xt.removeLayer=function(t){var e=Pt.inArray(t,this.__layerIds);-1!=e&&(this.__layers.splice(e,1),this.__layerIds.splice(e,1),this.__request&&this.__request.layers[t]&&delete this.__request.layers[t])},xt.getLayersAbbr=function(){return"l="+this.__layerIds.join(",")},xt.requestObjects=function(t,e,i,n){var o,s=this.__request,a=Pt.inArray(e,this.__layers),r=!0;if(-1!=a)if(s&&s.tile.equals(i)&&s.zoom==n||(r=!1,s=this.__request=null),this.isRestricted(e,i,n))t([]);else if(this.getOptions().useProgramCache&&(o=this.getCachedData(this.getKey(i,n,e))),o)t(o);else{var h=this.__layerIds[a];r?s.layers[h]&&s.layers[h].data?t(s.layers[h].data):s.layers[h]={callback:t}:(this.__request={tile:i.copy(),zoom:n,layers:{}},this.__request.layers[h]={callback:t},this.__load())}},xt.parseResponse=function(t,e,i,n){if(!e||e.error)return[];if(!t.getMap())return[];var o=this.__getLayerData(t,e.data);if(!o)return[];for(var s=[],a=this.__layerIds[Pt.inArray(t,this.__layers)],r=new bt.Point(256*i.getX(),256*i.getY()),h=0,l=o.features.length;h<l;h++){var c=o.features[h],u=c.properties.HotspotMetaData||{},d=u.zIndex,p=this.__makeShapes(r,u.RenderedGeometry),_=this.createObject(t,p,{id:u.id,provider:"trj"==a?"traffic":"traffic-events",description:c.properties.hintContent},{priority:d});s.push(_)}return s},xt.__getLayerData=function(t,e){var i=Pt.inArray(t,this.__layers);if(-1==i)return null;var n=this.__layerIds[i],o=e.properties.HotspotSearchMetaData.HotspotSearchResponse.layer;if(Pt.isArray(o)&&-1!=Pt.inArray(n,o)){for(var s=0,a=e.features.length;s<a;s++){var r=this.__getLayerData(t,e.features[s]);if(r)return r}return null}return o==n?e:null},xt.__load=function(){for(var t=this.__request,e=t.tile,i=t.zoom,n=this.getTileUrl(e,i),o={key:[],callback:[],context:[],cache:this.getOptions().useBrowserCache,format:"json"},s=0,a=this.__layers.length;s<a;s++)o.key.push(this.getKey(e,i,this.__layers[s])),o.callback.push(this.__getCallback(e,i,this.__layers[s])),o.context.push(this);p.load(n,o)},xt.__getCallback=function(a,r,h){return function(t){var e=Pt.inArray(h,this.__layers);if(-1!=e){var i=this.parseResponse(h,t,a,r);this.getOptions().useProgramCache&&this.cacheData(this.getKey(a,r,h),i);var n=this.__request,o=this.__layerIds[e];if(n&&n.tile.equals(a)&&n.zoom==r){var s=n.layers[o]||(n.layers[o]={});s.data=i,s.callback&&s.callback(i)}}}},xt.__makeShapes=function(t,e){e.coordinates;var i=[t.getX(),t.getY()],n=this.__makeCoordinates(e.coordinates,i);switch(e.type){case"Rectangle":return[new this.__shapes.rect(this.__makePlainCoordinates(n))];case"Polygon":return[new this.__shapes.npoly(this.__makePlainCoordinates(n[0]))];case"MultiPolygon":for(var o=[],s=0,a=n.length;s<a;s++)o.push(new this.__shapes.npoly(this.__makePlainCoordinates(n[s][0])));return o;case"ConvexPolygon":return[new this.__shapes.cpoly(this.__makePlainCoordinates(n[0]))];case"MultiConvexPolygon":for(o=[],s=0,a=n.length;s<a;s++)o.push(new this.__shapes.cpoly(this.__makePlainCoordinates(n[s][0])));return o}},xt.__makeCoordinates=function(t,e){var i=[];if(t[0].length)for(var n=0,o=t.length;n<o;n++)i[n]=this.__makeCoordinates(t[n],e);else i=[t[0]+e[0],t[1]+e[1]];return i},xt.__makePlainCoordinates=function(t){for(var e=[],i=0,n=t.length;i<n;i++)e.push(t[i][0]),e.push(t[i][1]);return e},xt.clearCache=function(){this.__request=null,bt.Hotspots.ObjectSource.prototype.clearCache.call(this)},xt.getTileUrl=function(t,e){return bt.Hotspots.ObjectSource.prototype.getTileUrl.call(this,t,e).replace("%l",this.getLayersAbbr())},xt.getKey=function(t,e,i){var n=bt.Hotspots.ObjectSource.prototype.getKey.call(this,t,e);if(i){var o=Pt.inArray(i,this.__layers);-1!=o&&(n=n.replace("%l","l="+this.__layerIds[o]))}return n},Mt=y.TrafficMultiSource=function(t,e,i,n){this.__timestamp=i,y.MultiObjectSource.call(this,t,e,n)},(xt=Lt(Mt,y.MultiObjectSource)).setTimestamp=function(t){this.__timestamp=t},xt.applyTimestamp=function(t){return t.replace("%t","tm="+this.__timestamp).replace("%s",this.__timestamp)},xt.getTileUrl=function(t,e){return this.applyTimestamp(y.MultiObjectSource.prototype.getTileUrl.call(this,t,e))},xt.getKey=function(t,e,i){return this.applyTimestamp(y.MultiObjectSource.prototype.getKey.call(this,t,e,i))},xt.applyLayer=function(t,e){var i="traffic"==e?M.layers.jams.js:M.layers.info.js;return this.applyTimestamp(t.replace("%l","l="+i))},xt.applyObjectId=function(t,e){var i=e.getData();return this.applyLayer(t.replace("%j",i.id),i.provider)},xt.requestObjectData=function(t,i){var e=t.getData(),n=e.id,o=M.providers[e.provider];this.__lastObjectDataKey=this.applyObjectId(o.keyTemplate,t),p.load(this.applyObjectId(o.urlTemplate,t),{key:this.__lastObjectDataKey,callback:function(t){if(o.counters&&o.counters.load){var e=o.counters.load.replace("%p",n+"."+t.type).replace("%u",+new Date);Pt.ajax({url:e,cache:!0,dataType:"script"})}i(t)},cache:this.getOptions().useBrowserCache})},xt.cancelObjectDataRequest=function(){this.__lastObjectDataKey&&p.cancel(this.__lastObjectDataKey)},xt.createObject=function(t,e,i,n){return new y.TrafficObject(t,e,i,n)},Mt=y.AView=function(t){this.__provider=t,this.__listeners=[],this.__addedLayers=[],this.__addedOverlays=[]},(xt=Mt.prototype).onAdd=function(t){this.__control=t,this.__provider.isInited()?(this.__updateLayers(),this.__updateOverlays(),this.beginListening()):this.__initListener=bt.Events.observe(this.__provider,this.__provider.Events.Init,this.__onProviderInit,this)},xt.onRemove=function(){this.__control&&(this.__provider.isInited()?(this.stopListening(),this.__removeLayers(this.__addedLayers),this.__removeOverlays(this.__addedOverlays),this.__addedLayers=this.__addedOverlays=[],this.__control=null):this.__initListener.cleanup())},xt.getProvider=function(){return this.__provider},xt.getControl=function(){return this.__control},xt.__onProviderInit=function(){this.__initListener.cleanup(),this.__updateLayers(),this.__updateOverlays(),this.beginListening()},xt.beginListening=function(){var t=this.__control,e=this.__provider,i=t.getMap();this.__listeners=[bt.Events.observe(t,t.Events.StateChange,this.__onUpdate,this),bt.Events.observe(e,e.Events.StateChange,this.__onUpdate,this),bt.Events.observe(i,i.Events.Update,this.__onUpdate,this)]},xt.stopListening=function(){It(this.__listeners,"cleanup")},xt.getVisibleLayers=function(){return[]},xt.getVisibleOverlays=function(){return[]},xt.__onUpdate=function(){this.__updateLayers(),this.__updateOverlays()},xt.__updateLayers=function(){var t=this.getVisibleLayers(),e=i(this.__addedLayers,t);e.equals||(this.__removeLayers(e.removed),this.__addLayers(e.added)),this.__addedLayers=t},xt.__updateOverlays=function(){var t=this.getVisibleOverlays(),e=i(this.__addedOverlays,t);e.equals||(this.__removeOverlays(e.removed),this.__addOverlays(e.added)),this.__addedOverlays=t},xt.__addLayers=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.addLayer(t[i])},xt.__removeLayers=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.removeLayer(t[i])},xt.__addOverlays=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.addOverlay(t[i])},xt.__removeOverlays=function(t){for(var e=this.__control.getMap(),i=0,n=t.length;i<n;i++)e.removeOverlay(t[i])},Mt=y.ActualView=function(t){y.AView.call(this,t),this.__trafficLayerListeners=[]},(xt=Lt(Mt,y.AView)).getVisibleLayers=function(){var t=[];if(this.__isLocalZoom()){var e=this.getControl().getState();if(e.shown){var i=this.getProvider().getLayers();t.push(i.png,i.jams),e.infoLayerShown&&t.push(i.info)}}return t},xt.getVisibleOverlays=function(){var t=[];return!this.__isLocalZoom()&&this.getControl().getState().shown&&t.push(this.getProvider().getRegionCollection()),t},xt.__isLocalZoom=function(){return e(this.getControl().getMap().getZoom())},xt.onAdd=function(t){y.AView.prototype.onAdd.call(this,t);var e,i=t.getMap(),n=i.getZoom(),o=this.getProvider().getLayers().jams;this.__trafficLayerListeners=[bt.Events.observe(o,o.Events.BalloonOpen,function(){e=1}),bt.Events.observe(o,o.Events.BalloonClose,function(){e=0}),bt.Events.observe(i,i.Events.Update,function(){n!=i.getZoom()&&(n=i.getZoom(),e&&i.closeBalloon())})]},xt.onRemove=function(){It(this.__trafficLayerListeners,"cleanup"),y.AView.prototype.onRemove.call(this)},Mt=y.ArchiveView=function(t){y.AView.call(this,t)},(xt=Lt(Mt,y.AView)).getVisibleLayers=function(){var t=[];if(this.__isLocalZoom()&&this.getControl().getState().shown&&this.getProvider().getState().timeZone!=y.TimeZone.UNKNOWN){var e=this.getProvider().getLayers();t.push(e.png,e.js)}return t},xt.getVisibleOverlays=function(){var t=[];return!this.__isLocalZoom()&&this.getControl().getState().shown&&this.getProvider().getState().action==bt.State.SUCCESS&&t.push(this.getProvider().getRegionCollection()),t},xt.__isLocalZoom=function(){return e(this.getControl().getMap().getZoom())},y.InfoLayerSwitcher=function(e){var i,n,o,t;function s(){i&&n.attr("checked",e.getState().infoLayerShown?"checked":null)}function a(){e.setState({infoLayerShown:!e.getState().infoLayerShown})}function r(t){a(),t.stopPropagation()}function h(){t=window.setTimeout(function(){t=null,s()},0)}this.onAddToParent=function(t){i=Pt(t),Pt('<input type="checkbox" class="YMaps-traffic-button-layers__control"'+(e.getState().infoLayerShown?' checked="checked"':"")+'><label class="YMaps-traffic-button-layers__description">'+M.strings.infoLayer+"</label>").appendTo(i),n=i.find("input"),u(i[0],"click",a),u(n[0],"click",r),c.opera&&c.version<9.5?u(n[0],"change",s):c.msie&&(n[0].onpropertychange=h),o=bt.Events.observe(e,e.Events.StateChange,s)},this.onRemoveFromParent=function(){o.cleanup(),c.opera&&c.version<9.5?d(n[0],"change",s):c.msie&&(n[0].onpropertychange=null,t&&(window.clearTimeout(t),t=null)),d(n[0],"click",r),d(i[0],"click",a),i.empty(),i=null}},y.ProviderSwitcher=function(i,s,t){var a,r={},h={},l=t;function c(e){return function(t){"input"==t.target.tagName&&t.stopPropagation(),i.setState({provider:e})}}this.onAddToParent=function(t){var e=document&&8<=document.documentMode;a=Pt(t);for(var i=0,n=s.length;i<n;i++){var o=s[i];r[o]=Pt('<span class="YMaps-traffic-provider-switcher"><input type="radio" class="YMaps-traffic-switcher-control'+(e?" YMaps-traffic-switcher-control__ie8":"")+'"'+(l==o?' checked="checked"':"")+'/><label class="YMaps-traffic-switcher-description">'+M.strings.providers[o]+"</label></span>").appendTo(a),h[o]=c(o),u(r[o][0],"click",h[o])}},this.onRemoveFromParent=function(){if(a){for(var t=0,e=s.length;t<e;t++){var i=s[t];d(r[i][0],"click",h[i]),r[i].remove()}r=h=[],a=null}}},Mt=y.TimeSlider=function(t){this.__master=t,this.__listeners=[],this.__dom={},this.__domListeners={}},(xt=y.TimeSlider.prototype).onAddToParent=function(t,e){this.__$parentContainer=t;var i=this,n=this.__master.getProvider().getState(),o=e?" YMaps-cursor-pointer":"";Pt('<i class="YMaps-traffic-button-time__minus'+o+'"></i><i class="YMaps-traffic-button-time__plus'+o+'"></i><div class="YMaps-traffic-button-time__scale-line'+o+'"></div>'+this.__getTimeMarkersHTML()+'<div style="left: '+this.__getSliderOffset(n)+'px;"class="YMaps-traffic-button-time__slider YMaps-cursor-pointer'+(e?"":" "+_)+'"><i class="YMaps-traffic-button-time__slider-i"></i></div>').appendTo(t),this.__dom={$minus:t.find(".YMaps-traffic-button-time__minus"),$plus:t.find(".YMaps-traffic-button-time__plus"),$scale:t.find(".YMaps-traffic-button-time__scale-line"),$slider:t.find(".YMaps-traffic-button-time__slider")},this.__domListeners.minusClick=function(){i.__moveBy({hours:0,minutes:-15})},this.__domListeners.plusClick=function(){i.__moveBy({hours:0,minutes:15})},this.__dragAndDrop=new bt.Utils.DragAndDrop.MouseMove(t[0]),e&&this.enable()},xt.onRemoveFromParent=function(){this.__$parentContainer&&(this.__enabled&&this.disable(),this.__$parentContainer.empty(),this.__$parentContainer=null,this.__dom={})},xt.enable=function(){this.__$parentContainer&&!this.__enabled&&(u(this.__dom.$minus[0],"click",this.__domListeners.minusClick),u(this.__dom.$plus[0],"click",this.__domListeners.plusClick),this.__listeners=[bt.Events.observe(this.__dragAndDrop,"start",this.__onDragStart,this),bt.Events.observe(this.__dragAndDrop,"move",this.__onDrag,this),bt.Events.observe(this.__dragAndDrop,"stop",this.__onDragEnd,this)],this.__dragAndDrop.beginListening(),this.__dom.$slider.removeClass(_),this.__dom.$scale.addClass("YMaps-cursor-pointer"),this.__dom.$plus.addClass("YMaps-cursor-pointer"),this.__dom.$minus.addClass("YMaps-cursor-pointer"),this.__enabled=1)},xt.disable=function(){this.__$parentContainer&&this.__enabled&&(this.__isDragged&&this.abort(),d(this.__dom.$minus[0],"click",this.__domListeners.minusClick),d(this.__dom.$plus[0],"click",this.__domListeners.plusClick),It(this.__listeners,"cleanup"),this.__dragAndDrop.stopListening(),this.__dom.$slider.addClass(_),this.__dom.$scale.removeClass("YMaps-cursor-pointer"),this.__dom.$plus.removeClass("YMaps-cursor-pointer"),this.__dom.$minus.removeClass("YMaps-cursor-pointer"),this.__enabled=0)},xt.update=function(t){this.__applyTime(t)},xt.abort=function(){this.__dragAndDrop.abort(),this.__cancelDragUpdate()},xt.__getTimeMarkersHTML=function(){for(var t=this.__master.getOptions().timeScale,e=t.markers,i=t.step,n="",o=0,s=e.length;o<s;o++)n+='<i style="left: '+(i*e[o]).toString()+'px;" class="YMaps-traffic-button-time__scale__marker"><i class="YMaps-traffic-button-time__scale__marker-time">'+r(Math.floor(e[o]),60*(e[o]-Math.floor(e[o])))+"</i></i>";return n},xt.__getSliderOffset=function(t){var e=this.__master.getOptions().timeScale,i=t.timeZone==y.TimeZone.UNKNOWN?0:t.timeZone;return wt.cycleRestrict(i+t.hours+t.minutes/60,0,24)*e.step-e.sliderSize/2},xt.__moveSlider=function(t){var e=this.__getSliderOffset(t);this.__dom.$slider.css("left")!=e&&this.__dom.$slider.css("left",e)},xt.__moveBy=function(t){var e=this.__master.getProvider().getState(),i=e.hours+t.hours,n=e.minutes+t.minutes;this.__master.getProvider().setState(this.__getAdjustedState({hours:i,minutes:n}))},xt.__applyTime=function(t){var e=t.timeZone==y.TimeZone.UNKNOWN?0:t.timeZone;this.__moveSlider(t),this.__master.setDisplayTime(r(wt.cycleRestrict(t.hours+e,0,24),t.minutes))},xt.__onDragStart=function(t){this.__initialDragX=t.clientX;var e=this.__$parentContainer.offset().left,i=e+24*this.__master.getOptions().timeScale.step,n=t.clientX,o=this.__master.getOptions().timeScale.sliderSize/2+1;if(e-o<=n&&n<=i+o){n=wt.boundaryRestrict(n,e-o,i+o);var s=this.__master.getProvider().getState(),a=s.timeZone==y.TimeZone.UNKNOWN?0:s.timeZone,r={hours:-a,minutes:0,timeZone:a},h=this.__getStateByOffset(t.clientX-e,r);this.__initialState=h,this.__applyTime(h),this.__setDragUpdate(h)}else this.__dragAndDrop.abort()},xt.__onDrag=function(t){var e=this.__getStateByOffset(t.clientX-this.__initialDragX,this.__initialState);this.__moveSlider(e),this.__applyTime(e),this.__setDragUpdate(e)},xt.__onDragEnd=function(t){this.__cancelDragUpdate(),this.__updateProviderState(this.__getStateByOffset(t.clientX-this.__initialDragX,this.__initialState))},xt.__getStateByOffset=function(t,e){var i=e.timeZone,n=e.hours+e.minutes/60,o=wt.boundaryRestrict(n+t/this.__master.getOptions().timeScale.step,-i,24-i-.25);return{hours:Math.floor(o),minutes:15*Math.floor(4*(o-Math.floor(o))),timeZone:i}},xt.__setDragUpdate=function(t){this.__dragUpdateTimeout&&window.clearTimeout(this.__dragUpdateTimeout);var e=this;this.__dragUpdateTimeout=window.setTimeout(function(){e.__updateProviderState(t),e.__dragUpdateTimeout=null},this.__master.getOptions().timeScale.dragUpdateTimeout)},xt.__updateProviderState=function(t){this.__master.getProvider().setState(this.__getAdjustedState(t))},xt.__getAdjustedState=function(t){var e=this.__master.getProvider().getState(),i=f[e.dayOfWeek],n=wt.cycleRestrict(t.hours+Math.floor(t.minutes/60),0,24),o=wt.cycleRestrict(t.minutes,0,60),s=e.timeZone,a=24-s;return a<=n&&e.hours<a?i=wt.cycleRestrict(i-1,0,7):n<a&&e.hours>=a&&(i=wt.cycleRestrict(i+1,0,7)),{hours:n,minutes:o,dayOfWeek:m[i],timeZone:s}},xt.__cancelDragUpdate=function(){this.__dragUpdateTimeout&&(window.clearTimeout(this.__dragUpdateTimeout),this.__dragUpdateTimeout=null)},Mt=y.AButtonLayout=function(t,e,i){this.__options=Pt.extend({compactForm:M.compactForm,providerKey:y.ActualProvider.key},e||{}),this.__state=Pt.extend({currentRegion:null},i||{}),this.__provider=t,this.__captionListeners=[],this.__controlListeners=[],this.__needWidthUpdate=c.msie&&c.version<8||document.documentMode&&document.documentMode<8},(xt=Mt.prototype).onAddToParent=function(t){this.__$parentContainer=Pt(t);var e,i=this.__provider.getControl(),n=i.getOptions(),o=(e=this.__$element=Pt(this.getHTML()).appendTo(this.__$parentContainer)).find(".YMaps-traffic-expander");this.__captionListeners=[];for(var s=0,a=o.length;s<a;s++)this.__captionListeners.push(function(){i.setState({shown:!i.getState().shown})}),u(o[s],"click",this.__captionListeners[s]);if(this.__options.compactForm||this.__setClickCounter(),n.showProviderSwitcher&&(this.__providerSwitcher=new y.ProviderSwitcher(i,[y.ActualProvider.key,y.ArchiveProvider.key],this.__options.providerKey),this.__providerSwitcher.onAddToParent(e.find(".YMaps-traffic-provider-switcher"))),this.__controlListeners=[bt.Events.observe(i,i.Events.StateChange,this.__onControlStateChange,this),bt.Events.observe(i,i.Events.OptionsChange,this.__onControlOptionsChange,this)],this.__needWidthUpdate){var r=this;this.__updateWidthTimeout=window.setTimeout(function(){r.__updateWidth(),r.__updateWidthTimeout=null},0)}},xt.onRemoveFromParent=function(){if(this.__$parentContainer){this.__updateWidthTimeout&&(window.clearTimeout(this.__updateWidthTimeout),this.__updateWidthTimeout=null),It(this.__controlListeners,"cleanup"),this.__provider.getControl().getOptions().showProviderSwitcher&&(this.__providerSwitcher.onRemoveFromParent(),this.__providerSwitcher=null);for(var t=this.__$element.find(".YMaps-traffic-expander"),e=0,i=t.length;e<i;e++)d(t[e],"click",this.__captionListeners[e]);this.__options.compactForm||this.__unsetClickCounter(),this.__$element.remove(),this.__$parentContainer=this.__$element=null}},xt.startRegionChangeListening=function(){var t=this.__provider,e=t.getControl().getMap();t.isInited()?(this.setState({activeRegion:this.getActiveRegion()}),this.__regionChangeListener=bt.Events.observe(e,e.Events.BoundsChange,this.__onMapBoundsChange,this)):this.__regionChangeListener=bt.Events.observe(t,t.Events.Init,function(){this.setState({activeRegion:this.getActiveRegion()}),this.__regionChangeListener.cleanup(),this.__regionChangeListener=bt.Events.observe(e,e.Events.BoundsChange,this.__onMapBoundsChange,this)},this)},xt.stopRegionChangeListening=function(){this.setState({activeRegion:null}),this.__regionChangeListener.cleanup()},xt.getHTML=function(){return this.getCollapsedHTML()+this.getExpandedHTML()},xt.getCollapsedHTML=function(){return'<div class="YMaps-btn YMaps-btn-traffic YMaps-cursor-default YMaps-traffic-collapsed'+(this.getProvider().getControl().getState().shown?" YMaps-display-none":"")+'"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i"><div class="YMaps-btn-reduce"><div class="YMaps-traffic-caption__layout">'+this.getIconHTML(M.trafficButton.icons.beta.off,"YMaps-traffic-icon")+'<span class="YMaps-btn-caption YMaps-cursor-pointer YMaps-traffic-expander">'+M.strings.jams+'</span></div></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>'},xt.getExpandedHTML=function(){return""},xt.getRootNodes=function(){return this.__$element},xt.getProvider=function(){return this.__provider},xt.getOptions=function(){return this.__options},xt.getState=function(){return this.__state},xt.setState=function(t){Pt.extend(this.__state,t),this.__updateWidth()},xt.applyIcon=function(t,e){e?(c.msie&&c.ieDocumentMode<10?t.css({width:e.size.getX(),height:e.size.getY(),filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+e.href+")"}):t.html('<img src="'+e.href+'" style="width: '+e.size.getX()+"px;height:"+e.size.getY()+'px;"/>'),t.removeClass(_)):(t.addClass(_),c.msie&&t.css("filter",null))},xt.getIconHTML=function(t,e){if(t){var i="width:"+t.size.getX()+"px;height:"+t.size.getY()+"px;";return c.msie?'<span class="'+e+'" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='+t.href+");"+i+'"></span>':'<span class="'+e+'"><img src="'+t.href+'" style="'+i+'"/></span>'}return'<span class="'+e+" "+_+'"></span>'},xt.__onControlStateChange=function(){var t=this.__$parentContainer;this.__provider.getControl().getState().shown?(t.find(".YMaps-traffic-collapsed").addClass(_),t.find(".YMaps-traffic-expanded").removeClass(_)):(t.find(".YMaps-traffic-collapsed").removeClass(_),t.find(".YMaps-traffic-expanded").addClass(_)),this.__updateWidth()},xt.__onControlOptionsChange=function(){var t=this.getProvider().getControl(),e=t.getOptions();if(e.showProviderSwitcher&&!this.__providerSwitcher){this.__providerSwitcher=new y.ProviderSwitcher(t,[y.ActualProvider.key,y.ArchiveProvider.key],this.__options.providerKey);var i=this.__$element.find(".YMaps-traffic-provider-switcher");this.__providerSwitcher.onAddToParent(i)}else!e.showProviderSwitcher&&this.__providerSwitcher&&(this.__providerSwitcher.onRemoveFromParent(),this.__providerSwitcher=null);this.__updateWidth()},xt.__onMapBoundsChange=function(){this.getProvider().isInited()&&this.setState({activeRegion:this.getActiveRegion()})},xt.getActiveRegion=function(){return this.getProvider().isInited()&&y.coverage.getRegionsByBounds(this.getProvider().getControl().getMap().getBounds())[0]||null},xt.getActiveRegionStat=function(){var t=this.getProvider().getState().stat,e=this.getState().activeRegion;if(e&&t)for(var i=0,n=t.length;i<n;i++)if(t[i].regionId==e.regionId)return t[i];return null},xt.__setClickCounter=function(){for(var t=this.__$element.find(".YMaps-traffic-addtext a"),e=0,i=t.length;e<i;e++)this.__clickCounter=function(){var t=M.providers.traffic.counters.click.replace("%u",+new Date);Pt.ajax({url:t,cache:!0,dataType:"script"})},u(t[e],"click",this.__clickCounter)},xt.__unsetClickCounter=function(){for(var t=this.__$element.find(".YMaps-traffic-addtext a"),e=0,i=t.length;e<i;e++)d(t[e],"click",this.__clickCounter)},xt.__updateWidth=function(){if(this.__needWidthUpdate){var t=this.__provider.getControl().getState().shown,e=this.__$parentContainer.find((t?".YMaps-traffic-expanded":".YMaps-traffic-collapsed")+" .YMaps-btn-i"),i=e.width();i%2&&e.width(i+1)}},Mt=y.ActualButtonLayout=function(t,e,i){y.AButtonLayout.call(this,t,e,i),this.__actualButtonListeners=[],this.__cachedZoom=0},(xt=Lt(Mt,y.AButtonLayout)).onAddToParent=function(t){y.AButtonLayout.prototype.onAddToParent.call(this,t);var e=this.getRootNodes().parent().find(".YMaps-traffic-expanded"),i=e.find(".YMaps-btn-i"),n=this.getProvider(),o=n.getControl(),s=o.getMap();this.__dom={$top:e,$content:i,$switcher:i.find(".YMaps-traffic-info-switcher"),$switcherContainer:i.find(".YMaps-traffic-button-layers"),$level:i.find(".YMaps-traffic-button-content__traffic-level"),$full:i.find(".YMaps-traffic-button-content__traffic-hint"),$time:i.find(".YMaps-traffic-button-content__traffic-time"),$hint:i.find(".YMaps-traffic-button-content__level-hint"),$nodata:this.getRootNodes().find(".YMaps-traffic-nodata"),$smallIcon:i.find(".YMaps-btn-reduce .YMaps-traffic-button-content__img"),$fullIcon:i.find(".YMaps-btn-expand .YMaps-traffic-button-content__img")},this.__cachedZoom=this.__isLocalZoom(),this.__updateInfoSwitcher(),this.__updateProviderSwitcher(),this.__updateRegionData(),this.__actualButtonListeners=[bt.Events.observe(o,o.Events.OptionsChange,this.__onActualControlOptionsChange,this),bt.Events.observe(n,n.Events.Update,this.__onActualProviderUpdate,this),bt.Events.observe(s,s.Events.BoundsChange,this.__onActualMapBoundsChange,this)],this.startRegionChangeListening()},xt.onRemoveFromParent=function(){this.stopRegionChangeListening(),It(this.__actualButtonListeners,"cleanup"),this.__infoLayerSwitcher&&(this.__infoLayerSwitcher.onRemoveFromParent(),this.__infoLayerSwitcher=null),y.AButtonLayout.prototype.onRemoveFromParent.call(this)},xt.getExpandedHTML=function(){var t=this.getProvider().getControl(),e=t.getState(),i=this.__isFull;return'<div class="YMaps-btn YMaps-btn-traffic YMaps-cursor-default YMaps-btn_expanded YMaps-traffic-expanded'+(e.shown?"":" YMaps-display-none")+(i&&!t.getOptions().showProviderSwitcher?" YMaps-btn-traffic_with-providers":"")+'"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i"><div class="YMaps-btn-reduce"><div class="YMaps-traffic-caption__layout"><span class="YMaps-traffic-provider-switcher YMaps-traffic-switchers"></span>'+this.getIconHTML(this.__getSmallIcon(),"YMaps-traffic-button-content__img")+'<span class="YMaps-btn-caption YMaps-cursor-pointer YMaps-traffic-expander">'+M.strings.jams+'</span></div></div><div class="YMaps-traffic-button YMaps-btn-expand"><div class="YMaps-traffic-button-content YMaps-traffic-button-content_now">'+this.getIconHTML(this.__getFullIcon(),"YMaps-traffic-button-content__img")+'<p class="YMaps-traffic-button-content__traffic-level"></p><p class="YMaps-traffic-button-content__traffic-hint'+(i?"":" YMaps-display-none")+'"><span class="YMaps-traffic-button-content__traffic-time"></span><span class="YMaps-traffic-button-content__level-hint"></span></p></div><div class="YMaps-traffic-button-layers"><div class="YMaps-traffic-button-layers__item YMaps-traffic-info-switcher"></div></div><div class="YMaps-traffic-nodata YMaps-display-none"></div></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>'},xt.__getFullIcon=function(){return this.__isFull()?M.trafficButton.icons.full[this.getActiveRegionStat().style]:null},xt.__getSmallIcon=function(){var t=this.__isFull(),e=this.getProvider().getControl().getOptions().showProviderSwitcher;return t||e?null:M.trafficButton.icons.beta.on},xt.__updateInfoSwitcher=function(){var t=this.getProvider(),e=t.getControl(),i=this.__isLocalZoom()&&t.isInited()&&e.getOptions().showInfoSwitcher;i&&!this.__infoLayerSwitcher&&(this.__infoLayerSwitcher=new y.InfoLayerSwitcher(e),this.__infoLayerSwitcher.onAddToParent(this.__dom.$switcher)),!i&&this.__infoLayerSwitcher&&(this.__infoLayerSwitcher.onRemoveFromParent(),this.__infoLayerSwitcher=null)},xt.__updateRegionData=function(){var t=this.getActiveRegionStat(),e=this.__isFull(),i=this.__dom;e?(i.$level.html(h(t.level)).removeClass(_),i.$time.html(t.localTime),i.$hint.html(t.hint).removeClass(_),i.$full.removeClass(_)):(i.$level.addClass(_),i.$full.addClass(_),i.$hint.addClass(_)),t&&t.nodata?i.$nodata.html(M.strings.noRegionData).removeClass(_):i.$nodata.html("").addClass(_)},xt.__updateProviderSwitcher=function(){this.__isFull()&&!this.getProvider().getControl().getOptions().showProviderSwitcher?this.__dom.$top.addClass("YMaps-btn-traffic_with-providers"):this.__dom.$top.removeClass("YMaps-btn-traffic_with-providers")},xt.__onActualControlOptionsChange=function(){this.__updateInfoSwitcher(),this.__updateProviderSwitcher(),this.__updateIcons()},xt.__onActualMapBoundsChange=function(){var t=this.__isLocalZoom();t!=this.__cachedZoom&&(this.__cachedZoom=t,this.__updateViewState(),this.__updateIcons(),this.__updateRegionData(),this.__updateProviderSwitcher(),this.__updateInfoSwitcher())},xt.__updateViewState=function(){this.__isLocalZoom()?this.__dom.$switcherContainer.removeClass(_):this.__dom.$switcherContainer.addClass(_)},xt.setState=function(t){var e=Pt.extend({},this.getState());y.AButtonLayout.prototype.setState.call(this,t),typeof t.activeRegion!=Et&&t.activeRegion!=e.activeRegion&&(this.__updateIcons(),this.__updateRegionData(),this.__updateProviderSwitcher(),this.__updateInfoSwitcher())},xt.__updateIcons=function(){this.applyIcon(this.__dom.$smallIcon,this.__getSmallIcon()),this.applyIcon(this.__dom.$fullIcon,this.__getFullIcon())},xt.__onActualProviderUpdate=function(){this.__updateIcons(),this.__updateRegionData(),this.__updateProviderSwitcher()},xt.__isLocalZoom=function(){return e(this.getProvider().getControl().getMap().getZoom())},xt.__isFull=function(){var t=this.getActiveRegionStat();return this.__isLocalZoom()&&t&&typeof t.level!=Et},Mt=y.ArchiveButtonLayout=function(t,e,i){y.AButtonLayout.call(this,t,a({providerKey:y.ArchiveProvider.key,timeScale:M.timeScale},e||{}),i),this.__archiveProviderListeners=[]},(xt=Lt(Mt,y.AButtonLayout)).onAddToParent=function(t){var i=this.getProvider(),e=i.getControl().getMap();this.__localZoom=this.__isLocalZoom(),this.__hasTimeZone=i.getState().timeZone!=y.TimeZone.UNKNOWN,y.AButtonLayout.prototype.onAddToParent.call(this,t);var n=this.getRootNodes().parent().find(".YMaps-traffic-expanded");this.__dom={$scale:n.find(".YMaps-traffic-button-time__scale"),$select:n.find(".YMaps-traffic-day-of-week"),$disabler:n.find(".YMaps-traffic-button-time"),$time:n.find(".YMaps-traffic-button-time__header__time"),$icon:n.find(".YMaps-btn-reduce .YMaps-traffic-icon"),$level:n.find(".YMaps-traffic-button-time__header__forecast"),$scaleText:n.find(".YMaps-traffic-button-content__scale-text"),$noDataText:n.find(".YMaps-traffic-nodata")},this.__timeSlider=new y.TimeSlider(this),this.__timeSlider.onAddToParent(this.__dom.$scale,this.__localZoom&&this.__hasTimeZone);var o=i.getControl();this.__archiveButtonListeners=[bt.Events.observe(i,i.Events.StateChange,this.__onProviderStateChange,this),bt.Events.observe(o,o.Events.OptionsChange,this.__onArchiveControlOptionsChange,this),bt.Events.observe(o,o.Events.StateChange,this.__onArchiveControlStateChange,this)],this.__archiveMapListener=bt.Events.observe(e,e.Events.BoundsChange,this.__onMapUpdate,this);var s=this.__dom.$select;this.__dayChangeListener=function(){var t=Number(s.attr("value")),e=i.getState();24<=e.hours+e.timeZone?t=wt.cycleRestrict(t-1,0,7):e.hours+e.timeZone<0&&(t=wt.cycleRestrict(t+1,0,7)),i.setState({dayOfWeek:m[t]}),c.msie&&Pt("body").focus()},u(this.__dom.$select[0],"change",this.__dayChangeListener),this.startRegionChangeListening();var a=this;this.__updateBottomTimeout=window.setTimeout(function(){a.__bottomAnchor=a.getRootNodes().parent()[0].style.bottom,null!==a.__bottomAnchor&&"auto"!=a.__bottomAnchor&&""!==a.__bottomAnchor&&(a.__needBottomUpdate=1,a.__updateBottom()),a.__updateBottomTimeout=null},0)},xt.onRemoveFromParent=function(){this.__updateBottomTimeout&&window.clearTimeout(this.__updateBottomTimeout),this.stopRegionChangeListening(),this.__timeSlider.onRemoveFromParent(),It(this.__archiveButtonListeners,"cleanup"),this.__archiveMapListener.cleanup(),d(this.__dom.$select[0],"change",this.__dayChangeListener),this.__needBottomUpdate&&(this.getRootNodes().parent().css("bottom",this.__bottomAnchor),this.__needBottomUpdate=0),y.AButtonLayout.prototype.onRemoveFromParent.call(this)},xt.getExpandedHTML=function(){var t=this.getProvider().getLocalTime(),e=this.__hasTimeZone&&this.__localZoom;return'<div class="YMaps-btn YMaps-btn-traffic YMaps-cursor-default YMaps-btn_expanded YMaps-btn_expanded-usually YMaps-traffic-expanded"><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-btn-v"><div class="YMaps-btn-h"><div class="YMaps-btn-i"><div style="display: block;" class="YMaps-btn-reduce"><div class="YMaps-traffic-caption__layout"><span class="YMaps-traffic-provider-switcher YMaps-traffic-switchers"></span>'+this.getIconHTML(this.__getIcon(),"YMaps-traffic-icon")+'<span class="YMaps-btn-caption YMaps-cursor-pointer YMaps-traffic-expander">'+M.strings.jams+'</span></div></div><i class="YMaps-btn-reduce__inner-corner"><i class="YMaps-btn-reduce__inner-corner-i"></i></i><div class="YMaps-btn-expand"><div class="YMaps-traffic-button-content"><div class="YMaps-traffic-button-content_usually"><i class="YMaps-btn-round YMaps-btn-round_half"><i class="YMaps-btn-l YMaps-btn-t"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-t"><i></i><b></b></i></i><div class="YMaps-traffic-button-content_usually-i"><div class="YMaps-traffic-button-content_usually-i2"><div class="YMaps-traffic-button-time'+(e?"":" YMaps-traffic-button-content__disabled")+'"><div class="YMaps-traffic-button-time__header"><select class="YMaps-traffic-day-of-week"'+(e?"":' disabled="disabled"')+">"+this.__getDayOfWeeksHTML(t.dayOfWeek)+'</select><i class="YMaps-traffic-button-time__header__time">'+r(t.hours,t.minutes)+'</i><div class="YMaps-traffic-button-time__header__forecast">'+this.__getLevelHTML()+'</div></div><div class="YMaps-traffic-button-time__scale"></div><p class="YMaps-traffic-button-content__scale-text'+(this.__localZoom&&!this.__hasTimeZone?" "+_:"")+'">'+M.strings.archiveDataText+'</p><div class="YMaps-traffic-nodata'+(this.__localZoom&&!this.__hasTimeZone?"":" "+_)+'">'+M.strings.noTimeZone+'</div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div></div></div></div></div></div><i class="YMaps-btn-round"><i class="YMaps-btn-l YMaps-btn-b"><i></i><b></b></i><i class="YMaps-btn-r YMaps-btn-b"><i></i><b></b></i></i></div>'},xt.__getIcon=function(){var t=this.__isFull(),e=this.getProvider().getControl().getOptions().showProviderSwitcher;return t||e?null:M.trafficButton.icons.beta.on},xt.__getLevelHTML=function(){var t=this.getActiveRegionStat();return this.__isFull()?this.getIconHTML(M.trafficButton.icons.full[t.style],"YMaps-traffic-button-content__img")+'<p class="YMaps-traffic-button-content__traffic-level">'+h(t.level)+"</p>":""},xt.__getDayOfWeeksHTML=function(t){for(var e="",i=0;i<7;i++)e+='<option value="'+i+'"'+(i==f[t]?' selected="selected"':"")+">"+M.strings.daysOfWeek[i]+"</option>";return e},xt.setState=function(t){var e=Pt.extend({},this.getState());y.AButtonLayout.prototype.setState.call(this,t),typeof t.activeRegion!=Et&&t.activeRegion!=e.activeRegion&&(this.__updateIcon(),this.__updateLevelData(),this.__applyEnableState())},xt.setDisplayTime=function(t){this.getRootNodes()&&this.__dom.$time.html(t)},xt.__onMapUpdate=function(){this.__updateIcon(),this.__updateLevelData(),this.__applyEnableState()},xt.__onArchiveControlOptionsChange=function(){this.__updateIcon()},xt.__onArchiveControlStateChange=function(){this.__updateBottom()},xt.__onProviderStateChange=function(){this.__selectDay(this.getProvider().getLocalTime().dayOfWeek),this.__applyEnableState(),this.getProvider().getState().action==bt.State.SUCCESS&&(this.__updateIcon(),this.__updateLevelData())},xt.__applyEnableState=function(){var t=this.__dom,e=this.getProvider().getState(),i=this.__isLocalZoom(),n=e.timeZone!=y.TimeZone.UNKNOWN,o=this.__localZoom&&this.__hasTimeZone,s=i&&n,a=(this.getRootNodes(),i!=this.__localZoom||n!=this.__hasTimeZone);this.__timeSlider.update(this.getProvider().getState()),a&&(o!=s&&(s?(this.__timeSlider.enable(),t.$select.attr("disabled",null),t.$disabler.removeClass("YMaps-traffic-button-content__disabled")):(this.__timeSlider.disable(),t.$select.attr("disabled","disabled"),t.$disabler.addClass("YMaps-traffic-button-content__disabled"))),i&&!n?(t.$scaleText.addClass(_),t.$noDataText.removeClass(_)):(t.$scaleText.removeClass(_),t.$noDataText.addClass(_)),this.__hasTimeZone=n,this.__localZoom=i),this.__updateBottom()},xt.__updateIcon=function(){this.applyIcon(this.__dom.$icon,this.__getIcon())},xt.__updateLevelData=function(){this.__dom.$level.html(this.__getLevelHTML())},xt.__selectDay=function(t){var e=f[t],i=this.__dom.$select;i.attr("selectedIndex")!=e&&i.attr({selectedIndex:e})},xt.__isLocalZoom=function(){return e(this.getProvider().getControl().getMap().getZoom())},xt.__isFull=function(){var t=this.getActiveRegionStat();return this.__isLocalZoom()&&t&&typeof t.level!=Et},xt.__updateBottom=function(){this.__needBottomUpdate&&this.getRootNodes().parent().css("bottom",parseInt(this.__bottomAnchor)+this.getRootNodes().find(".YMaps-traffic-button-content_usually").height()+"px")},v={},y.Providers={get:function(t){if(v[t])return new v[t]},add:function(t,e){v[t]=e}},n.Providers=y.Providers,function(){(Mt=y.ActualProvider=function(t,e){this.__options=a(Pt.extend(!0,{},n),t||{}),this.__state=a(Pt.extend(!0,{},o),e||{}),this.__buttonLayout=new y.ActualButtonLayout(this),this.__view=new y.ActualView(this),this.__controlListeners=[];var i=this;y.coverage.load(function(){i.__onCoverageReady()}),this.__autoUpdater=new y.AutoUpdater(this.__options.updateTimeout,function(){i.update()}),this.__isInited=y.coverage.state==bt.State.SUCCESS&&this.__state.timestamp,this.__sources={png:new bt.TileDataSource(this.__getPngTemplate(),!0,!1),js:new y.TrafficMultiSource(this.__options.urlTemplate,this.__options.keyTemplate,this.__state.timestamp,this.__options.objectSourceOptions)},this.__layers={png:new bt.Layer(this.__sources.png,this.__options.imageLayerOptions),jams:new bt.Hotspots.Layer(this.__sources.js,this.__options.layerOptions),info:new bt.Hotspots.Layer(this.__sources.js,this.__options.infoLayerOptions)},this.__sources.js.addLayer(this.__options.layerAliases.jams.js,this.__layers.jams)}).key="traffic#actual",(xt=Mt.prototype).Events={StateChange:"statechange",Update:"update",Init:"init"},xt.onAdd=function(t){this.__control=t,this.__options.autoUpdate&&(this.__autoUpdater.enable(t.getMap()),this.update()),this.__currentControlState=t.getState(),this.__currentControlState.infoLayerShown&&this.__sources.js.addLayer(this.__options.layerAliases.info.js,this.__layers.info),this.__sources.png.setTileUrlTemplate(this.__getPngTemplate()),this.__layers.png.update(),this.__applyLayerOptions(),this.__controlListeners=[bt.Events.observe(t,t.Events.StateChange,this.__onControlStateChange,this),bt.Events.observe(t,t.Events.OptionsChange,this.__onControlOptionsChange,this)]},xt.onRemove=function(){this.__control&&(It(this.__controlListeners,"cleanup"),this.__currentControlState.infoLayerShown&&this.__sources.js.removeLayer(this.__options.layerAliases.info.js),this.__options.autoUpdate&&this.__autoUpdater.disable(),this.__control=null)},xt.isInited=function(){return this.__isInited},xt.getControl=function(){return this.__control},xt.getButtonLayout=function(){return this.__buttonLayout},xt.getView=function(){return this.__view},xt.__getPngTemplate=function(){var t=this.__options.layerAliases,e=this.__control&&this.__control.getState(),i=e?e.infoLayerShown?[t.jams.png,t.info.png]:[t.jams.png]:[];return this.__options.urlTemplate.replace("%l","l="+i.join("%2C")).replace("%t","tm="+this.__state.timestamp)},xt.getLayers=function(){return this.__layers},xt.getRegionCollection=function(){return this.__regionCollection},xt.__onCoverageReady=function(){this.__state.timestamp&&!this.__isInited&&(this.__isInited=1,this.__regionCollection=this.__buildRegionCollection(this.__state.stat),bt.Events.notify(this,this.Events.Init,this))},xt.setState=function(t){var e;typeof t.timestamp!=Et&&t.timestamp!=this.__state.timestamp&&(this.__state.timestamp=t.timestamp,this.__updateLayers(),e=1),typeof t.stat!=Et&&t.stat!=this.__state.stat&&(this.__state.stat=t.stat,y.coverage.state==bt.State.SUCCESS&&(this.__regionCollection=this.__buildRegionCollection(this.__state.stat)),e=1),e&&(bt.Events.notify(this,this.Events.StateChange,this),bt.Events.notify(this,this.Events.Update,this)),!this.__isInited&&t.timestamp&&y.coverage.state==bt.State.SUCCESS&&(this.__isInited=1,bt.Events.notify(this,this.Events.Init,this))},xt.getState=function(){return this.__state},xt.__updateLayers=function(){for(var t in this.__sources.png.setTileUrlTemplate(this.__getPngTemplate()),this.__sources.js.setTimestamp(this.__state.timestamp),this.__layers)this.__layers.hasOwnProperty(t)&&this.__layers[t].update()},xt.__onControlStateChange=function(){var t=this.__control.getState();t.infoLayerShown!=this.__currentControlState.infoLayerShown&&(t.infoLayerShown?(this.__sources.js.addLayer(this.__options.layerAliases.info.js,this.__layers.info),this.__sources.png.setTileUrlTemplate(this.__getPngTemplate()),this.__layers.png.update()):(this.__sources.js.removeLayer(this.__options.layerAliases.info.js),this.__sources.png.setTileUrlTemplate(this.__getPngTemplate()),t.shown&&this.__layers.png.update())),this.__currentControlState=t},xt.__onControlOptionsChange=function(){this.__applyLayerOptions()},xt.__applyLayerOptions=function(){var t=this.__control.getOptions();this.__layers.jams.setOptions(t.layerOptions||{}),this.__layers.info.setOptions(t.infoLayerOptions||{})},xt.update=function(){p.load(this.__options.updateUrl,{key:"stat",callback:this.__onUpdateComplete,context:this})},xt.__onUpdateComplete=function(t){this.setState({timestamp:t.timestamp,stat:t.regions})},xt.__buildRegionCollection=function(){return l(this.__state.stat,this.__options.regionIconStyles)};var n={updateTimeout:M.updateTimeout,updateUrl:M.regionsStatUrl,urlTemplate:M.layers.baseUrl,keyTemplate:M.layers.key,layerOptions:M.layers.jams.layerOptions,infoLayerOptions:M.layers.info.layerOptions,imageLayerOptions:M.layers.image.layerOptions,layerAliases:{jams:{png:M.layers.jams.png,js:M.layers.jams.js},info:{png:M.layers.info.png,js:M.layers.info.js}},objectSourceOptions:{useBrowserCache:1,useProgramCache:1,programCacheEntries:M.hotspotsCacheSize},regionContentTemplate:M.regionContentTemplate,regionIconStyles:M.semaphoreStyles,autoUpdate:1},o={timestamp:null,stat:null};y.Providers.add(Mt.key,function(){return new y.ActualProvider})}(),function(){(Mt=y.ArchiveProvider=function(t,e){this.__buttonLayout=new y.ArchiveButtonLayout(this),this.__view=new y.ArchiveView(this),this.__options=Pt.extend(!0,{},i,t||{}),this.__state=Pt.extend(!0,{},o,e||{}),this.__sources={png:new bt.TileDataSource(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.png),!0,!1),js:new bt.Hotspots.ObjectSource(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.js),this.__processTemplate(this.__options.keyTemplate,this.__options.layerAliases.js))};var n=this;this.__sources.js.requestObjectData=function(t,e){var i=t.getData().id;p.load(n.__getObjectUrl(i),{key:n.__getObjectKey(i),callback:e,cache:this.getOptions().useBrowserCache})},this.__sources.js.createObject=function(t,e,i,n){return new y.TrafficObject(t,e,i,n)},this.__layers={png:new bt.Layer(this.__sources.png,this.__options.imageLayerOptions),js:new bt.Hotspots.Layer(this.__sources.js,this.__options.layerOptions)},this.__state.version||p.load(this.__options.versionUrl,{key:"version",callback:this.__onVersionLoad,context:this}),y.coverage.load(function(){n.__onCoverageLoad()}),this.__isInited=this.__state.version&&y.coverage.state==bt.State.SUCCESS,this.__isInited&&this.__loadStat()}).key="traffic#archive",(xt=Mt.prototype).Events={StateChange:"statechange",Update:"update",Init:"init"},xt.getButtonLayout=function(){return this.__buttonLayout},xt.getView=function(){return this.__view},xt.getControl=function(){return this.__control},xt.isInited=function(){return this.__isInited},xt.onAdd=function(t){this.__control=t,this.__layers.js.setOptions(t.getOptions().layerOptions||{}),this.__controlOptionsChangeListener=bt.Events.observe(t,t.Events.OptionsChange,function(){this.__layers.js.setOptions(t.getOptions().layerOptions||{})},this);var e=t.getMap();this.__options.autoTimeZoneUpdate&&(this.__boundsChangeListener=bt.Events.observe(e,e.Events.BoundsChange,this.__onMapBoundsChange,this),this.updateTimeZone(t.getMap().getCenter()))},xt.onRemove=function(){this.__control&&(this.__options.autoTimeZoneUpdate&&this.__boundsChangeListener.cleanup(),this.__controlOptionsChangeListener.cleanup(),this.__control=null)},xt.update=function(){},xt.setState=function(e){var t,i,n=Pt.extend({},this.__state);function o(t){return typeof e[t]!=Et&&e[t]!=n[t]}o("dayOfWeek")&&(this.__state.dayOfWeek=e.dayOfWeek,i=t=1),o("hours")&&(this.__state.hours=e.hours,i=t=1),o("minutes")&&(this.__state.minutes=e.minutes,i=t=1),o("timeZone")&&(this.__state.timeZone=e.timeZone,t=1),o("dst")&&(this.__state.dst=e.dst,t=1),o("version")&&(this.__state.version=e.version,i=t=1),o("action")&&(this.__state.action=e.action,t=1),o("stat")&&(this.__state.stat=e.stat,this.__regionCollection=l(this.__state.stat,this.__options.regionIconStyles),t=1),i&&(this.__sources.png.setTileUrlTemplate(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.png)),this.__sources.js.setTileUrlTemplate(this.__processTemplate(this.__options.urlTemplate,this.__options.layerAliases.js)),this.__sources.js.setKeyTemplate(this.__processTemplate(this.__options.keyTemplate,this.__options.layerAliases.js)),this.__layers.png.update(),this.__layers.js.update(),this.__isInited&&this.__loadStat()),t&&bt.Events.notify(this,this.Events.StateChange,this),e.version&&y.coverage.state==bt.State.SUCCESS&&!this.__isInited&&(this.__isInited=1,bt.Events.notify(this,this.Events.Init,this),this.__loadStat())},xt.getState=function(){return this.__state},xt.getLayers=function(){return this.__layers},xt.getRegionCollection=function(){return this.__regionCollection},xt.__onVersionLoad=function(t){this.setState({version:t.version})},xt.__processTemplate=function(t,e){return t.replace("%r",this.__state.version).replace("%s",this.__getTimestamp()).replace("%v","v="+this.__state.version).replace("%l","l="+(e||"")).replace("%t","tm="+this.__getTimestamp())},xt.__getTimestamp=function(){var t=f[this.__state.dayOfWeek],e=this.__state.dst?this.__state.hours+1:this.__state.hours;return 24<=e&&(t=wt.cycleRestrict(t+1,0,7),e-=24),wt.cycleRestrict(86400*t+3600*e+60*this.__state.minutes,0,604800)},xt.__getObjectUrl=function(t){return this.__processTemplate(this.__options.objectUrlTemplate).replace("%j",t)},xt.__getObjectKey=function(t){return this.__options.objectKeyTemplate.replace("%j",t)},xt.updateTimeZone=function(t){y.TimeZone.get(t,this.__onTimeZoneLoad,this)},xt.__onTimeZoneLoad=function(t,e){this.setState({timeZone:t,dst:e})},xt.__onMapBoundsChange=function(){this.updateTimeZone(this.__control.getMap().getCenter())},xt.getLocalTime=function(){var t=this.__state.minutes,e=Number(this.__state.timeZone!=y.TimeZone.UNKNOWN?this.__state.timeZone:0),i=Number(this.__state.hours)+e,n=f[this.__state.dayOfWeek];return 24<=i?(i-=24,n=wt.cycleRestrict(n+1,0,7)):i<0&&(i+=24,n=wt.cycleRestrict(n-1,0,7)),{hours:i,minutes:t,dayOfWeek:m[n]}},xt.__onCoverageLoad=function(){this.__regionCollection=this.__buildRegionCollection(),this.__state.version&&!this.__isInited&&(this.__isInited=1,bt.Events.notify(this,this.Events.Init,this),this.__loadStat())},xt.__buildRegionCollection=function(){return l(this.__state.stat,this.__options.regionIconStyles)},xt.__loadStat=function(){this.__state.stat=null,this.__state.action=bt.State.LOADING,p.load(this.__processTemplate(this.__options.statUrlTemplate),{key:"archive-stat",callback:function(t){Number(t.timestamp)==this.__getTimestamp()&&this.setState({action:bt.State.SUCCESS,stat:t.regions})},context:this})},t.allowTrafficForecast&&y.Providers.add(Mt.key,function(){return new y.ArchiveProvider});var i={versionUrl:M.archiveVersionUrl,urlTemplate:M.layers.archive.baseUrl,keyTemplate:M.layers.archive.key,statUrlTemplate:M.archiveStatUrl,objectUrlTemplate:M.layers.archive.objectUrlTemplate,objectKeyTemplate:M.layers.archive.objectKeyTemplate,layerOptions:M.layers.archive.layerOptions,imageLayerOptions:M.layers.archive.layerOptions,regionIconStyles:M.semaphoreStyles,autoTimeZoneUpdate:1,layerAliases:{png:M.layers.archive.png,js:M.layers.archive.js}},o={version:null,timeZone:y.TimeZone.UNKNOWN,dst:!1,dayOfWeek:"Mon",hours:12,minutes:0,action:bt.State.EMPTY,stat:{}}}(),function(){n.Control=function(t,e){var s,i,n,o,a,r=Pt.extend(!0,{},g,t||{}),h=Pt.extend({},{shown:0,infoLayerShown:0,provider:"traffic#actual"},e||{}),l={},c=!M.compactForm,u=!1,d=this;function p(){var t=M.providers.traffic.counters.show.replace("%u",+new Date);Pt.ajax({url:t,cache:!0,dataType:"script"}),c=0}function _(t){return t.shown&&t.infoLayerShown}function f(t){var e=M.providers.traffic.counters.infoLayer.replace("%u",+new Date).replace("%s",t);Pt.ajax({url:e,cache:!0,dataType:"script"})}function m(){var t=d.getProvider();t.onAdd(d),(i=t.getButtonLayout()).onAddToParent(n),(o=t.getView()).onAdd(d),a=bt.Events.observe(t,t.Events.Update,function(){bt.Events.notify(this,this.Events.Update,this)},d),h.provider==y.ArchiveProvider.key&&Pt.ajax({url:M.archiveCounterUrl.replace("%u",+new Date),cache:!0,dataType:"script"})}function v(){a.cleanup(),o.onRemove(),i.onRemoveFromParent(),d.getProvider().onRemove()}this.Events={Show:"show",Hide:"hide",Update:"update",InfoLayerShow:"infolayershow",InfoLayerHide:"infolayerhide",StateChange:"statechange",OptionsChange:"optionschange"},this.onAddToMap=function(t,e){s=t,n=Pt('<div class="YMaps-buttons" style="z-index: '+(bt.ZIndex.CONTROL||"1000")+';"></div>')[0],(e||new bt.ControlPosition(bt.ControlPosition.TOP_RIGHT,new bt.Size(5,40))).apply(n),m(),s.getContainer().appendChild(n),c&&h.shown&&p(),u!=_(h)&&f((u=_(h))?"on":"off")},this.onRemoveFromMap=function(){s&&(Pt(n).remove(),v(),s=i=o=null,u=!1)},this.show=function(){this.setState({shown:1})},this.hide=function(){this.setState({shown:0})},this.isShown=function(){return this.getState().shown},this.getMap=function(){return s},this.setOptions=function(t,e){r=e?Pt.extend(!0,{},g,t):Pt.extend(!0,{},r,t),bt.Events.notify(this,this.Events.OptionsChange,this)},this.getOptions=function(){return Pt.extend(!0,{},r)},this.setState=function(t,e){var i=e?Pt.extend({},{shown:0,infoLayerShown:0,provider:y.ActualProvider.key},t):Pt.extend({},h,t),n=Pt.extend({},h),o=typeof i.provider!=Et&&i.provider!=h.provider;s&&o&&v(),h=i,s&&o&&m(),n.shown!=i.shown&&bt.Events.notify(this,i.shown?this.Events.Show:this.Events.Hide,this),n.infoLayerShown!=i.infoLayerShown&&bt.Events.notify(this,i.infoLayerShown?this.Events.InfoLayerShow:this.Events.InfoLayerHide,this),u!=_(i)&&f((u=_(h))?"on":"off"),bt.Events.notify(this,this.Events.StateChange,this),s&&h.shown&&c&&p()},this.getState=function(){return Pt.extend({},h)},this.update=function(){this.getProvider().update()},this.getProvider=function(){var t=h.provider;return"string"==typeof t?(l[t]||(l[t]=y.Providers.get(t)),l[t]):h.provider}};var g={layerOptions:{hasHint:1,hasBalloon:1,cursor:bt.Cursor.POINTER},infoLayerOptions:{hasHint:1,hasBalloon:1,cursor:bt.Cursor.POINTER},showInfoSwitcher:0,showProviderSwitcher:0}}()}(Ct)});